function mobileApp(a,b){return angular.element(document).injector().get("MobileApp").broadcast(a,b)}function adsApi(a,b){return angular.element(document).injector().get("AdsApi").broadcast(a,b)}function frameLoginSuccess(a){return angular.element(document).injector().get("Tools").frameLoginSuccess(a)}function frameLoginFailed(a){return angular.element(document).injector().get("Tools").frameLoginFailed(a)}var deps=["ui.router","ui.select","ngSanitize","angularFileUpload","ngProgressLite","ngTouch","ngCookies","nxt-framework","nxt-offer","nxt-avatar","nxt-common","nxt-composition","nxt-contact","nxt-dialog","nxt-exception","nxt-external-account","nxt-filter","nxt-folder","nxt-message","nxt-navigation","nxt-notification","nxt-settings","nxt-slideshow","nxt-public-gallery","ngDfp"];NXT_CONFIG.env.device.isPc?deps.push("ui.tinymce"):deps.push("contenteditable"),angular.module("nxt-webmail",deps).config(["uiSelectConfig","$httpProvider","$compileProvider","DoubleClickProvider",function(a,b,c,d){a.theme="selectize",a.searchEnabled=!1,b.useApplyAsync(!0),c.debugInfoEnabled(!1),d.defineSlot("/44520695/17interia/poczta_next/dfp_ad_message",[1,1],"dfp_ad_message")}]),NXT_CONFIG.env.isMobileApp,angular.module("nxt-avatar",["nxt-webmail","nxt-folder"]),angular.module("nxt-common",[]),angular.module("nxt-composition",["nxt-webmail","nxt-common","nxt-contact","nxt-dialog","nxt-external-account","nxt-notification"]),angular.module("nxt-contact",["nxt-webmail","nxt-common","nxt-composition","nxt-dialog","nxt-filter","nxt-folder","nxt-notification"]),angular.module("nxt-crop",[]),angular.module("nxt-dialog",[]),angular.module("nxt-exception",["nxt-webmail"]),angular.module("nxt-external-account",["nxt-webmail","nxt-common","nxt-composition","nxt-dialog","nxt-folder","nxt-notification"]),angular.module("nxt-filter",["nxt-webmail","nxt-notification"]),angular.module("nxt-folder",["nxt-webmail","nxt-common","nxt-composition","pickadate","nxt-dialog","nxt-external-account","nxt-message","nxt-notification"]),angular.module("nxt-framework",[]),angular.module("nxt-message",["nxt-webmail","nxt-common","nxt-composition","nxt-dialog","nxt-folder","nxt-notification"]),angular.module("nxt-navigation",["nxt-webmail","nxt-composition","nxt-dialog","nxt-folder","nxt-notification"]),angular.module("nxt-notification",[]),angular.module("nxt-offer",[]),angular.module("nxt-public-gallery",["nxt-webmail","nxt-notification"]),angular.module("nxt-settings",["nxt-webmail","nxt-common","nxt-crop"]),angular.module("nxt-slideshow",["nxt-webmail","nxt-message"]),angular.module("nxt-webmail").config(["$provide","$httpProvider",function(a,b){"use strict";var c="/mails",d=c.length;a.factory("LoadingIndicatorInterceptor",["$q","$rootScope",function(a,b){return{request:function(a){return a&&a.url&&a.url.indexOf(c)===a.url.length-d&&b.$broadcast("loadingIndicator:folderLoading"),a},response:function(a){return a&&a.config&&a.config.url&&a.config.url.indexOf(c)===a.config.url.length-d&&b.$broadcast("loadingIndicator:folderLoaded"),a},responseError:function(e){return e&&e.config&&e.config.url&&e.config.url.indexOf(c)===e.config.url.length-d&&b.$broadcast("loadingIndicator:folderLoaded"),a.reject(e)}}}]),b.interceptors.push("LoadingIndicatorInterceptor")}]),angular.module("nxt-webmail").config(["$provide","$httpProvider",function(a,b){"use strict";a.factory("ProgressInterceptor",["$q","ngProgressLite","$location","ApplicationData",function(a,b,c,d){return{request:function(a){return a.url.indexOf(c.host())===-1||a.data&&"touch"==a.data.oper||(b.start(),d.setIsRequesting(!0)),a},response:function(a){return b.done(),d.setIsRequesting(!1),a},responseError:function(c){return b.done(),d.setIsRequesting(!1),a.reject(c)}}}]),b.interceptors.push("ProgressInterceptor")}]),angular.module("nxt-framework").config(["$provide","$httpProvider",function(a,b){"use strict";a.factory("BaseUrlInterceptor",["ApplicationConfig","$location",function(a,b){return{request:function(c){return c.url.indexOf(".html")!==-1?c.url=a.env.staticUrl+"/js"+c.url:c.url.indexOf("//")===-1&&(c.url=b.protocol()+"://"+b.host()+"/"+a.env.baseUrl+c.url),c}}}]),b.interceptors.push("BaseUrlInterceptor")}]),angular.module("nxt-framework").config(["$provide","$httpProvider",function(a,b){"use strict";a.factory("CacheInterceptor",["ApplicationConfig",function(a){return{request:function(b){return void 0===b.cache&&(b.cache=!0,b.params=b.params||{},b.params.cacheTime=a.cacheTime),b},response:function(b){var c=b.config;return c&&"POST"===c.method&&c.headers["X-CACHE-IS-VALID"]!==!0&&(a.cacheTime=Date.now()),b}}}]),b.interceptors.push("CacheInterceptor")}]),angular.module("nxt-framework").config(["$provide","$httpProvider",function(a,b){"use strict";a.factory("DefaultTransformationInterceptor",function(){return{request:function(a){return Array.isArray(a.transformRequest)||(a.transformRequest=[a.transformRequest].concat(b.defaults.transformRequest)),Array.isArray(a.transformResponse)||(a.transformResponse=b.defaults.transformResponse.concat(a.transformResponse)),a},response:function(a){return a.data&&"object"==typeof a.data&&("result"in a.data?a.data=a.data.result:"data"in a.data&&(a.data=a.data.data)),a}}}),b.interceptors.push("DefaultTransformationInterceptor")}]),angular.module("nxt-framework").config(["$provide","$httpProvider",function(a,b){"use strict";a.factory("ErrorInterceptor",["$q","$rootScope","$location","ApplicationConfig",function(a,b,c,d){return{response:function(c){if(c&&c.data){if(c.data.status===!1)return c.data.code!==-101?setTimeout(function(){d.env.isMobileApp&&c.data.isMobileAppPush?console.log("Error: "+JSON.stringify(c)):b.$broadcast("http:response:error",c)},0):c.data.code===-101&&b.$broadcast("http:response:error:sessionExpired",c),a.reject(c);if(c.data.result&&c.data.result.error)return b.$broadcast("http:response:error",c.data.result),a.reject(c)}return c},responseError:function(d){return d&&d.config&&d.config.url&&d.config.url.indexOf(c.host())!==-1&&(d.data&&d.data.code==-103?location.reload():b.$broadcast("http:response:error",d)),a.reject(d)}}}]),b.interceptors.push("ErrorInterceptor")}]),angular.module("nxt-framework").config(["$provide","$httpProvider",function(a,b){"use strict";a.factory("PlaceholderInterceptor",function(){return{request:function(a){var b=/:[a-z]+/gi;return a.params&&b.test(a.url)&&(a.url=a.url.replace(b,function(b){var c=b.substr(1),d=a.params[c];return d?(delete a.params[c],d):b})),a}}}),b.interceptors.push("PlaceholderInterceptor")}]),angular.module("nxt-framework").config(["$provide","$httpProvider",function(a,b){"use strict";a.factory("PostInterceptor",function(){return{request:function(a){return"PUT"!==a.method&&"PATCH"!==a.method&&"DELETE"!==a.method||(a.headers["X-HTTP-Method-Override"]=a.method,a.method="POST"),"POST"===a.method&&(a.headers["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8"),a}}}),b.interceptors.push("PostInterceptor")}]),angular.module("nxt-framework").config(["$provide","$httpProvider",function(a,b){"use strict";a.factory("SessionExpiredInterceptor",["$q","$rootScope",function(a,b){var c=0,d=function(a){a.data&&a.data.code===-101&&0===c&&(b.$broadcast("http:response:error:sessionExpired",a),NXT_CONFIG.blockRequest=!0,c++)};return{response:function(a){return d(a),a},responseError:function(b){return d(b),a.reject(b)}}}]),NXT_CONFIG.excludeSessionExpired||b.interceptors.push("SessionExpiredInterceptor")}]),angular.module("nxt-framework").config(["$provide","$httpProvider",function(a,b){"use strict";a.factory("XsrfInterceptor",["ApplicationConfig","$location",function(a,b){return{request:function(c){return c.url.indexOf(b.host())!==-1&&c.url.indexOf("tol.ag.warta.pl")===-1&&(c.headers["X-Requested-With"]="XMLHttpRequest",a.env.uid&&(c.headers["X-XSRF-TOKEN"]=a.env.uid)),c}}}]),b.interceptors.push("XsrfInterceptor")}]),angular.module("nxt-webmail").service("AdsApi",["$rootScope","$stateParams","$http","ApplicationConfig",function(a,b,c,d){"use strict";var e=function(a){return c.jsonp(a,{transformResponse:function(a){return a}})};this.broadcast=function(a,b){this[a]&&this[a](b)},this.createMessageAd=function(c){c.url&&e(c.url).success(function(e){var f={};f.response=e,f.params=c,0!==f.response.response_status||d.env.accountType||b.folderId!=d.folders.SHOPPING||a.$broadcast("ads:create:message",f),d.cacheTime=Date.now()})}}]),angular.module("nxt-webmail").provider("Bugtracker",function(){"use strict";var a,b=5,c={DEFAULT:1,CONNECTION_ERRORS:2,TOL_ERRORS:3},d="looped error: ",e=0;this.$get=["$http","ApplicationConfig",function(f,g){function h(a,b){var e={};return e.type=a.type?a.type:c.DEFAULT,e.location=location.href,e.userAgent=navigator.userAgent,a.exception&&(a.exception.stack&&(e.stack=a.exception.stack),a.exception.fileName&&(e.fileName=a.exception.fileName),a.exception.columnNumber&&(e.columnNumber=a.exception.columnNumber),a.exception.lineNumber&&(e.lineNumber=a.exception.lineNumber)),b?e.message=d+a.message:e.message=a.message,a.cause&&(e.cause=a.cause),e}return{send:function(c){if(c.message==a?e++:e=0,e<2){var d=h(c);a=c.message,g.env.dev?console.error("Bugtracker",d):f.post("/bugtracker",d)}if(e==b){var d=h(c,!0);g.env.dev?console.error("Bugtracker",d):f.post("/bugtracker",d)}}}}]}),angular.module("nxt-webmail").provider("ApplicationConfig",function(){"use strict";function a(){return NXT_CONFIG.env.sid}function b(){var b=a(),c=sessionStorage.getItem("nxtVisitCounter");return c&&(c=JSON.parse(c),c instanceof Object==!1&&(c={}),c[b])?c[b]:0}function c(b){var c=a(),d=sessionStorage.getItem("nxtVisitCounter");d?(d=JSON.parse(d),d instanceof Object==!1&&(d={})):d={},d.length||(d.length=0),d.length>10&&(d={},d.length=0),d[c]||d.length++,d[c]=b;try{sessionStorage.setItem("nxtVisitCounter",JSON.stringify(d))}catch(e){}}function d(){var a=navigator.userAgent,b=new RegExp(/AppleWebKit\/([\d.]+)/),c=b.exec(a),d=null===c?null:parseFloat(b.exec(a)[1]),e=new RegExp(/Chrome\/([\d.]+)/),f=e.exec(a),g=null===f?null:parseFloat(e.exec(a)[1]),h=null!==d&&d<537||null!==g&&g<37;return h&&angular.element(document.body).addClass("isAndroidBrowser"),h}function e(){var a=navigator.userAgent.toLowerCase(),b=a.match(/android\s([0-9\.]*)/);return!!b&&b[1]}var f="stary_next",g=0;NXT_CONFIG.blockRequest=!1,NXT_CONFIG.isMessageScaleUp=!1;var h={folders:{INBOX:1,SENT:2,DRAFTS:-1,TRASH:3,SPAM:-2},keyCodes:{SEMICOLON:186,COMMA:188,SPACE:32,NEWLINE:13,BACKSPACE:8,ARROW_DOWN:40,ARROW_UP:38,TAB:9},patterns:{email:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,phone:/^[(]{0,1}[0-9]{3}[)\.\- ]{0,1}[0-9]{3}[\.\- ]{0,1}[0-9]{3}$/,specialChars:/^[^\/\\:*?"<>|'%]+$/,date:/^[0-9]{4}-(?:0[0-9]{1}|1[0-2]{1})-(?:[0-2]{1}[0-9]{1}||3[0-1]{1})$/},hacks:{isIpad:"iPad"===navigator.platform,isIOS:angular.element(document.querySelector("body")).hasClass("isIOS"),isIE:angular.element(document.querySelector("body")).hasClass("isIE"),isAndroid:navigator.userAgent.indexOf("Mozilla/5.0")>-1&&navigator.userAgent.indexOf("Android ")>-1&&navigator.userAgent.indexOf("AppleWebKit")>-1,isFirefox:navigator.userAgent.toLowerCase().indexOf("firefox")>-1,isWindowsPhoneOS:/Windows Phone 10.0|Windows Phone 8.1|Windows Phone 8.0|Windows Phone OS|XBLWP7|ZuneWP7|Windows NT 6.[23]; ARM;/g.test(navigator.userAgent)},cacheTime:Date.now(),visitCounter:b(),modulesConfig:[]};angular.forEach(h.folders,function(a){h.maxSystemFolderId=a>h.maxSystemFolderId?a:h.maxSystemFolderId}),h.hacks.isIpad&&(h.hacks.iosVersion=parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||!1),h.hacks.isFirefox&&angular.element(document.body).addClass("isFirefox"),h.hacks.isAndroid&&(h.hacks.isAndroidDefault=d(),h.hacks.AndroidVersion=parseFloat(e())),h=angular.extend(h,NXT_CONFIG),h.ContactKeys={ID:0,AVATAR:1,EMAIL:2,NAME:3,SCORE:4,TYPE:5,GROUPS:6},h.ADMIN_BUSINESS_TYPE={FREE:0,ADMIN:1,SUBACCOUNT:2};for(var i in h.ContactKeys)h.ContactKeys.hasOwnProperty(i)&&h.ContactKeys[i]>g&&(g=h.ContactKeys[i]);g++,h.isShowAdDescription=NXT_CONFIG.env.advKeyword==f&&1!=NXT_CONFIG.env.accountType,"WORDS,IS_HIDDEN,IS_FORCED_HIDDEN,SORT_NAME,IS_READONLY,IS_ON_BLACKLIST,EMAILS,PHONES,NOTE".split(",").forEach(function(a,b){h.ContactKeys[a]=g+b}),h.incrementSessionVisits=function(){c(++h.visitCounter)},h.getConfigAppModule=function(a){if(!h.modulesConfig[a]){var b;h.configApplicationModule.forEach(function(c){if(c.name==a){var d=[];c.actions&&c.actions.forEach(function(a){"false"==a.allow?d[a.name]=!1:d[a.name]=!0}),c.actions=d,b=c}}),h.modulesConfig[a]=b}return h.modulesConfig[a]},function(){var a=h.getConfigAppModule("links")&&h.getConfigAppModule("links").data.links;a&&(h.links=[],a.map(function(a){var b=a.name;delete a.name,h.links[b]=a}))}(),h.aliasDomains=[],function(){angular.forEach(h.signatures,function(a,b){a.id=parseInt(b,10)})}(),this.$get=function(){return h}}),angular.module("nxt-webmail").provider("ApplicationData",["$cacheFactoryProvider","ApplicationConfigProvider",function(a,b){"use strict";var c,d=b.$get(),e=a.$get(),f=e("nxt"),g=!1;for(var h in NXT_INIT_DATA)f.put(h[0].toUpperCase()+h.substr(1),{time:d.cacheTime,data:NXT_INIT_DATA[h]}),"theme"===h&&(c=NXT_INIT_DATA[h].filter(function(a){return"2"===a.type}));var i=[];f.MESSAGE_OPERATION_LIMIT=1e3,f.isFrozen=function(a){return a=parseInt(a,10),i.indexOf(a)!==-1},f.freeze=function(a){return a=parseInt(a,10),i.push(a)},f.unfreeze=function(a){return a=parseInt(a,10),i=i.filter(function(b){return b!=a})},f.getUserSkinMainObject=function(a){return c.filter(function(b){return b.id===a})},f.getIsRequesting=function(){return g},f.setIsRequesting=function(a){g=a},this.$get=function(){return f}}]),angular.module("nxt-webmail").provider("LongPoll",function(){"use strict";function a(a){var b=Date.now()/1e3,c=360;return a>=b-c}var b,c,d="newMg",e="PushId not exist",f="Error",g=1210,h=3e5,i=5,j=3e4,k=0,l=0,m=36e5;this.$get=["ApplicationConfig","$http","$rootScope","$q","$timeout","Notification","DialogManager","Bugtracker",function(n,o,p,q,r,s,t,u){function v(){l&&l<Date.now()-m&&p.$broadcast("folder:refresh",{refreshCache:!0,forceRefresh:!0}),l=Date.now()}return{isConnnected:!1,errorCounter:0,firstErrorTimestamp:null,connect:function(){this.isConnnected||NXT_CONFIG.blockRequest||(v(),b&&r.cancel(b),k=q.defer(),o.get(n.env.longPollUrl,{timeout:k.promise,params:{PUSHID:n.env.pushId,revision:n.env.revision,d:Date.now()}}).success(this.success.bind(this)).error(this.error.bind(this)),this.isConnnected=!0,b=r(function(){k.resolve()},h))},disconnect:function(a){this.isConnnected=!1,0!==k&&k.resolve(),b&&r.cancel(b)},success:function(b){this.isConnnected=!1,n.env.revision=void 0,b.event===e?this.getPushId().success(this.connect.bind(this)):b.event==f?b.errCode==g?(t.sessionExpiredDialog({message:"Sesja wygasła"}),NXT_CONFIG.blockRequest=!0,this.disconnect()):(u.send({type:3,message:"longPoll Error:"+JSON.stringify(b)}),this.error()):(this.errorCounter=0,b.event===d&&(n.cacheTime=Date.now(),n.env.revision=b.currentRevision,b.inLastHour=a(b.rawDate),p.$broadcast("service:longpoll:success",b)),this.connect())},error:function(){this.isConnnected=!1,this.hasExceededErrorLimit()?(this.errorCounter=0,c&&clearTimeout(c),c=setTimeout(this.connect.bind(this),j)):(this.connect(),this.errorCounter++,1===this.errorCounter&&(this.firstErrorTimestamp=Date.now()))},hasExceededErrorLimit:function(){return this.errorCounter>=i},getPushId:function(){return o.get("/getpushid",{cache:!1}).success(function(a){n.env.pushId=a})}}}]}),angular.module("nxt-webmail").provider("ApplicationMessage",function(){"use strict";var a={1014:{broadcast:"service:notification:info",title:"Operacja niedostępna"}},b={"service:contact:delete":"Kontakt został usunięty.","service:contacts:delete":"Kontakty zostały usunięte.","service:contact:save":"Kontakt został dodany.","service:contact:edit":"Zmiany zostały zapisane.","service:contact:save:specialContact":"Kontakt o podanym adresie e-mail już istnieje.","service:contacts:import:succes":"Kontakty zostały zaimportowane.","service:message:move":"Wiadomość została przeniesiona.","service:messages:move":"Wiadomości zostały przeniesione.","service:folder:delete":"Folder został opróżniony.","service:message:move-to-trash":"Wiadomość została przeniesiona do kosza.","service:messages:move-to-trash":"Wiadomości zostały przeniesione do kosza.","service:message:delete":"Wiadomość została usunięta.","service:messages:delete":"Wiadomości zostały usunięte.","external-account:service:deleteAlias":"Alias został usunięty.","external-account:service:deleteAccount":"Konto zewnętrzne zostało usunięte.","external-account:service:sendConfirmMail":"Link aktywacyjny został wysłany.","external-account::noactive":"Wystąpił problem z obsługą konta. Sprawdź ustawienia i spróbuj ponownie za kilka minut.","external-account:service:add":"Dodatkowy adres został dodany.","external-account:service:save":"Zmiany zostały zapisane.","external-account:service:edit":'%s% <a ng-click="callback()">Sprawdź »</a>',"filtr:service:quickCreate":"Filtr został dodany.","filtr:service:quickUpdate":"Zmiany zostały zapisane.","composition:message-sent":"Wiadomość wysłana","composition:message-saved":"Wiadomość zapisana w folderze Robocze","composition:signature-saved":"Nowy podpis został zapisany.","composition:no-recipients":"Wpisz odbiorców!","composition:sending-error":"Nie udało się wysłać wiadomości","composition:saving-error":"Nie udało się zapisać wiadomości","composition:empty-signature":"Wpisz treść podpisu!","composition:empty-signature-name":"Podaj nazwę!","composition:saving-signature-error":"Nie udało się zapisać podpisu.","composition:add-attachment-error":"Nie udało się dodać załącznika","composition:add-attachment-error-reasone":"Nie udało się dodać załącznika: %s%","composition:add-attachment-error-bug-external-app":"Załącznik nie został dodany - błąd po stronie zewnętrznej aplikacji.","composition:add-attachment-error-bug-external-app-int":'Załącznik nie został dodany - błąd po stronie zewnętrznej aplikacji.<br>Zachęcamy do skorzystania z aplikacji <a ng-click="callback()">INT Poczta</a>',"composition:add-attachment-error-bug-external-app-next":'Załącznik nie został dodany - błąd po stronie zewnętrznej aplikacji.<br>Zachęcamy do skorzystania z aplikacji <a ng-click="callback()">Nowa Poczta Interia</a>',"uploader:all-attachments-removed":"Załączniki zostały usunięte.","uploader:all-attachments-added":"Załączniki zostały dodane.","uploader:adding-attachments":"Dodawanie załączników","uploader:theme-added":"Nowa skórka została dodana.","uploader:theme-size-exceeded":"Wgrywane zdjęcie jest za duże, maksymalny rozmiar to 10 MB.","uploader:avatar-size-exceeded":"Wgrywane zdjęcie jest za duże, maksymalny rozmiar to 10 MB.","uploader:theme-other-error":"Coś poszło nie tak z ustawianiem własnej skórki.","uploader:theme-token-error":"Błąd tokena. Proszę odświeżyć stronę.","uploader:avatar-other-error":"Coś poszło nie tak z ustawianiem awataru.","message:sender-marked-as-trusted":"Dodano adres do listy zaufanych nadawców.","message:thread-error":"Wystąpił błąd podczas pobierania wątku.","security:saved-success":"Informacje zostały zapisane","marketingData:saved-success":"Informacje zostały zapisane","marketingData:validate-error":"Wybierz jedną z opcji"},c=function(a,c,d){var e="";if(b[c])return e=d,a.replace(/%s%/g,function(){return e.shift()})};this.$get=function(){return{list:function(){return b},get:function(a,d){var e=b[a];return d?c(e,a,d):b[a]},getOptions:function(b){return a[b]}}}}),angular.module("nxt-webmail").service("MobileApp",["$rootScope","$state","Compositions","Message","Folder","Notification","ApplicationConfig","DialogManager","$stateParams","Bugtracker",function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(){h.isCompositionOpen()&&a.$apply(function(){a.$broadcast("directive:dialog:close-composition")})}function l(a){var b=0,c=setInterval(function(){b>20&&(a.scrollTop=0),0!==a.scrollTop?(a.scrollTop=a.scrollTop-90,b++):clearInterval(c)},10)}if(NXT_CONFIG.env.isMobileApp){var m=g.hacks.isIOS;this.broadcast=function(a,b){this[a]&&this[a](b)},this.addExternalAccount=function(){"abstract"==b.current.parent?b.go(".external-account.configure"):b.go("^.external-account.configure")},this.scrollTop=function(){var a=document.querySelector(".msglist-container"),b=document.querySelector(".message-section-container"),c=document.querySelector(".section--navigation");l(c?document.querySelector(".navigation--main"):i.messageId?b:a)},this.newComposition=function(b){k(),a.$apply(function(){c.addComposition(b)})},this.finishUpload=function(b){function c(a){var b,c=a.slice(-2);return a=a.slice(0,-2),a=a.replace(",","."),b="MB"==c?1024*a*1024:1024*a,b=parseInt(b),d+=b,b}for(var d=0,e=[],g=0;g<b.attach.list.length;g++){var h=b.attach.list[g];h.status?e.push({index:h.index,name:h.name,size:c(h.size),mpid:h.index}):(a.$apply(function(){f.error("Wystąpił błąd podczas dodawania załącznika")}),j.send({message:"Dodawanie załącznika mobile error: "+JSON.stringify(h)}))}var i={attach:{list:e,totalSize:d}};a.$broadcast("composition:add:attachment",i)},this.openMessage=function(b){k(),a.$broadcast("isapp:message:open",b),g.cacheTime=Date.now(),a.$broadcast("folder:refresh",{refreshCache:!0})},this.newMessages=function(b){console.log("Run newMessages function"),i.search||a.$broadcast("isapp:message:pop",b)},this.openFolderList=function(){k(),b.go(".navigation"),a.$broadcast("folder:refresh",{refreshCache:!0})},this.enableAutosave=function(){a.$broadcast("composition:enableAutosave")},this.openFolder=function(c){k(),e.get({id:c}).success(function(d){null!==d&&(c==b.params.folderId&&a.$broadcast("folder:refresh",{refreshCache:!0}),b.go("folder",{folderId:c}))})},this.reply=function(b){k(),d.get({id:b,leaveAsUnread:!0}).success(function(d){c.addComposition({opt:"ra",mesg:b,to:d.replyTo||d.from,envelopeTo:d.envelopeTo,originalRecipients:d.originalRecipients,senderConfig:d.senderConfig,isReplyingToSingle:!0}),a.$broadcast("folder:refresh",{refreshCache:!0})})},this.deleteMessage=function(b){k(),d.get({id:b}).success(function(b){d.moveToFolder(3,b),b.folderId==i.folderId&&a.$broadcast("folder:refresh",{refreshCache:!0})})},this.showSettings=function(){b.go("^");try{m?window.webkit.messageHandlers.showSettings.postMessage("show app Settings"):MobileAppConnector.showSettings()}catch(a){console.log("Only to use in mobileApp")}},this.logout=function(){try{m?window.webkit.messageHandlers.logout.postMessage("Logout"):MobileAppConnector.logout()}catch(a){console.log("Only to use in mobileApp")}},this.refreshFolder=function(){try{m?window.webkit.messageHandlers.refreshFolder.postMessage("refreshFolder"):MobileAppConnector.refreshFolder()}catch(a){console.log("Only to use in mobileApp - refreshFolder")}},this.refreshCurrentFolder=function(){g.cacheTime=Date.now(),a.$broadcast("folder:refresh",{refreshCache:!0,forceRefresh:!0,page:1}),a.$broadcast("controller:folder:seen",i.folderId),this.scrollTop()},this.sessionExpired=function(){try{m?window.webkit.messageHandlers.sessionExpired.postMessage("sessionExpired"):MobileAppConnector.sessionExpired()}catch(a){console.log("Only to use in mobileApp - sessionExpired")}},this.onNativeBackClick=function(){var c="folder"===b.current.name,d="message"===b.current.name;if(h.isCompositionOpen())k();else if(g.isSearchExpanded&&!d)a.$broadcast("directive:search:close");else if(a.isAnyMessageChecked)a.$apply(function(){a.$broadcast("isapp:message-list:clear-selection")});else if(null!=i.filter)b.go("folder",{folderId:i.folderId,filter:"all"}),a.$broadcast("folder:refresh",{refreshCache:!0,filter:"all",forceRefresh:!0});else if(null!==i.search&&d)b.go("^");else if(null!=i.search)b.go("folder",{folderId:i.folderId,search:null});else if(1!=i.folderId&&c)b.go("folder",{folderId:1});else try{b.go("^")}catch(e){try{b.go("^.^")}catch(f){MobileAppConnector.appClose()}}},this.connectionError=function(){try{m?window.webkit.messageHandlers.connectionError.postMessage("connectionError"):MobileAppConnector.connectionError()}catch(a){console.log("Only to use in mobileApp - connection error")}},this.onSwipeLeft=function(){NXT_CONFIG.isMessageScaleUp||"/slideshow"==b.current.url||a.$broadcast("message:open-message:prev-next","next")},this.onSwipeRight=function(){NXT_CONFIG.isMessageScaleUp||"/slideshow"==b.current.url||a.$broadcast("message:open-message:prev-next","prev")},this.onUnreadCountChange=function(a){try{m||MobileAppConnector.onUnreadCountChange(a)}catch(b){console.log("Only to use in mobileApp - counter change")}}}}]),angular.module("nxt-webmail").provider("ApplicationTrackEvent",function(){"use strict";this.NOT_SEND_TRACK=2,this.SEND_TRACK=1;var a={mainNewMes:["Lewa szpalta","Nowa wiadomość","klik w ikonę"],folderInbox:["Lewa szpalta","Odebrane","klik w ikonę"],folderShop:["Lewa szpalta","Oferty","klik w ikonę"],folderSocial:["Lewa szpalta","Społeczności","klik w ikonę"],folderSent:["Lewa szpalta","Wysłane","klik w ikonę"],folderDraft:["Lewa szpalta","Robocze","klik w ikonę"],folderTrash:["Lewa szpalta","Kosz","klik w ikonę"],folderSpam:["Lewa szpalta","Spam","klik w ikonę"],foldersUser:["Lewa szpalta","Foldery","klik w ikonę"],clickAddFolder:["Lewa szpalta","Foldery","Dodaj folder - klik link"],clickAddFolderPlus:["Lewa szpalta","Foldery","Dodaj (+) klik"],closeFolderList:["Lewa szpalta","Foldery","Zamknij (x)"],editFolder:["Lewa szpalta","Foldery","Edytuj folder"],deleteFolder:["Lewa szpalta","Foldery","Usuń"],openFolder:["Lewa szpalta","Foldery","Otwórz folder"],actionSearch:["Lista wiadomości","Szukaj","akcja wyszukania"],selectOptSubfolder:["Lewa szpalta","Foldery","zaznaczenie opcji dodania jako podfolderu"],folderSettingMore:["Lewa szpalta","Foldery","Ustawienia folderu"],addSubFolder:["Lewa szpalta","Dodaj folder","stworzenie nowego folderu"],selectAllMessages:["Lista wiadomości","zaznaczenie checkboxa","Zaznaczenie wszystkich"],addExtAccLink:["Lista wiadomości","Dodaj konto zewnętrzne","klik w link"],checkSingleMessage:["Lista wiadomości","zaznaczenie checkboxa","Zaznaczenie pojedynczego maila"],useSuggestSearch:["Lista wiadomości","Szukaj","skorzystanie z zapisanej podpowiedzi"],delSuggestItem:["Lista wiadomości","Szukaj","usuń z historii podpowiedź"],searcherClose:["Lista wiadomości","Szukaj","zamknij (x)"],searcherMoreOptions:["Lista wiadomości","Szukaj","pokaż więcej opcji"],searcherInContent:["Lista wiadomości","Szukaj","szukaj w treści"],searcherAdvanceClose:["Lista wiadomości","Wyszukiwanie (rozwinięte) - wybór opcji podczas wyszukiwania","zamknij rozwinięcie (anuluj)"],searcherOptionFolder:["Lista wiadomości","wybór opcji podczas wyszukiwania","folder"],searcherOptionTo:["Lista wiadomości","wybór opcji podczas wyszukiwania","nadawca"],searcherOptionFrom:["Lista wiadomości","wybór opcji podczas wyszukiwania","odbiorca"],searcherOptionTopic:["Lista wiadomości","wybór opcji podczas wyszukiwania","temat"],searcherOptionDateFrom:["Lista wiadomości","wybór opcji podczas wyszukiwania","data od"],searcherOptionDateTo:["Lista wiadomości","wybór opcji podczas wyszukiwania","data do"],searcherOptionAttach:["Lista wiadomości","wybór opcji podczas wyszukiwania","załącznik"],searcherOptionClose:["Lista wiadomości","wybór opcji podczas wyszukiwania","zamknij rozwinięcie (anuluj)"],mailForwardAllSelect:["Lista wiadomości","więcej - Prześlij dalej","wszystkie zaznaczone"],mailForwardSingle:["Lista wiadomości","więcej - Prześlij dalej","pojedynczy mail"],mailSaveAll:["Lista wiadomości","więcej - zapisz","wszystkie zaznaczone"],mailMarkReadSingleMenuMore:["Lista wiadomości","oznacz jako przeczytane","pojedynczy mail"],mailMarkReadAllMenuMore:["Lista wiadomości","oznacz jako przeczytane","wszystkie zaznaczone"],mailMarkUnReadSingleMenuMore:["Lista wiadomości","oznacz jako nieprzeczytane","pojedynczy mail"],mailMarkUnReadAllMenuMore:["Lista wiadomości","oznacz jako nieprzeczytane","wszystkie zaznaczone"],mailSaveSingle:["Lista wiadomości","więcej - zapisz","pojedynczy mail"],setStarAll:["Lista wiadomości","oznacz gwiazdką","wszystkie zaznaczone"],setStarSingle:["Lista wiadomości","oznacz gwiazdką","pojedynczy mail"],moveAllCheckMesToSocial:["Lista wiadomości","przenieś -  społeczności","wszystkie zaznaczone"],moveMesToSocial:["Lista wiadomości","przenieś -  społeczności","pojedynczy mail"],moveAllCheckMesToSpam:["Lista wiadomości","przenieś -  spam","wszystkie zaznaczone"],moveMesToSpam:["Lista wiadomości","przenieś -  spam","pojedynczy mail"],moveAllCheckMesToUserFolder:["Lista wiadomości","przenieś -  folder użytkownika","wszystkie zaznaczone"],moveMesToUserFolder:["Lista wiadomości","przenieś -  folder użytkownika","pojedynczy mail"],moveAllCheckMesToInbox:["Lista wiadomości","przenieś -  odebrane","wszystkie zaznaczone"],moveMesToInbox:["Lista wiadomości","przenieś -  odebrane","pojedynczy mail"],moveAllCheckMesToTrash:["Lista wiadomości","przenieś -  kosz","wszystkie zaznaczone"],moveMesToTrash:["Lista wiadomości","przenieś -  kosz","pojedynczy mail"],moveAllCheckMesToShop:["Lista wiadomości","przenieś - oferty","wszystkie zaznaczone"],moveMesToShop:["Lista wiadomości","przenieś - oferty","pojedynczy mail"],topPanelClose:["Lista wiadomości","zamknij","klik x"],topPanelCloseCheckSingle:["Lista wiadomości","zamknij","pojedynczy mail"],topPanelCloseCheckAll:["Lista wiadomości","zamknij","wszystkie zaznaczones"],topDeleteAllMes:["Lista wiadomości","usuń","wszystkie zaznaczone"],topDeleteSingleMes:["Lista wiadomości","usuń","pojedynczy mail"],topToSpamAllMes:["Lista wiadomości","spam","wszystkie zaznaczone"],topToSpamSingleMes:["Lista wiadomości","spam","pojedynczy mail"],selectUnReadMainToolBar:["Lista wiadomości","nieprzeczytane","Filtrowanie z paska"],filterImportantToolBar:["Lista wiadomości","ważne","Filtrowanie z paska"],filterStarsToolBar:["Lista wiadomości","z gwiazdką","Filtrowanie z paska"],filterAllToolBar:["Lista wiadomości","wszystkie","Filtrowanie z paska"],filterAttachToolBar:["Lista wiadomości","pokaż wiadomości z załącznikami","Filtrowanie z paska"],filterAttachOnlyToolBar:["Lista wiadomości","Pokaż tylko załączniki z wiadomości","Filtrowanie z paska"],filterContactsToolBar:["Lista wiadomości","od znajomych ","Filtrowanie z paska"],dialogNewMailClose:["Nowy mail","zamknij","klik"],dialogNewMailFull:["Nowy mail","pełny ekran","otwarcie"],dialogNewMailFullClose:["Nowy mail","pełny ekran","zamknięcie"],dialogNewMailMin:["Nowy mail","minimalizuj/ przywróć","klik"],newMailDW:["Nowy mail","DW","dodanie adresata do DW"],newMailUDW:["Nowy mail","DW","dodanie adresata do UDW"],newMailDelContact:["Nowy mail","usuń adresata","x"],newMailMoreAction:["Nowy mail","„ptaszek” (więcej)","rozwinięcie"],newMailSave:["Nowy mail","„ptaszek” (więcej)","zapisz jako robocze"],mailToggleImportant:["Nowy mail","priorytet","oznacz jako piorytet"],addSignatureClick:["Nowy mail","dodaj podpis","klik"],addSignature:["Nowy mail","dodaj podpis","akcja"],selectSignature:["Nowy mail","ustaw podpisu","klik"],sendMail:["Nowy mail","Wyślij","wysłanie wiadomości"],addAttachClick:["Nowy mail","Załączniki","klik -dodaj załącznik"],deleteAllAttach:["Nowy mail","Załączniki","usuń wszystkie (załączniki)"],deleteAttach:["Nowy mail","Załączniki","„x” usuń załącznik"],mailContentBold:["Nowy mail","pogrubienie (bold)"," "],mailContentItalic:["Nowy mail","kursywa (italic)"," "],mailContentFontType:["Nowy mail","rozmiar i krój czcionki","klik"],mailContentFontTypeName:["Nowy mail","rozmiar i krój czcionki","%s%"],mailContentFontSize:["Nowy mail","rozmiar i krój czcionki","%s%"],mailContentUnderline:["Nowy mail","podkreślenie (underline)"," "],mailContentFontColor:["Nowy mail","kolor czcionki","%s%"],mailContentAlignClick:["Nowy mail","wyrównanie i lista","klik"],mailContentNumericList:["Nowy mail","wyrównanie i lista","Lista numerowana"],mailContentPointList:["Nowy mail","wyrównanie i lista","Lista punktowa"],
mailContentAlign:["Nowy mail","wyrównanie i lista","Do %s%"],mailContentStationery:["Nowy mail","wybierz papeterię","klik"],mailContentInsImg:["Nowy mail","wstaw obrazek","klik"],mailContentInsEmot:["Nowy mail","wstaw emotikonę","klik"],mailContentClearFormat:["Nowy mail","edytor plain text","klik"],mailContentEditorHtmlOn:["Nowy mail","edytor plain text","włącz html"],mailContentEditorHtmlOff:["Nowy mail","edytor plain text","wyłącz html"],mailAutosaveShow:["Nowy mail","autozapis kopii roboczej","wyświetlenie",[[this.NOT_SEND_TRACK]]],mailAutosaveClose:["Nowy mail","autozapis kopii roboczej","“x” zamknij"],mailAutosaveConfirm:["Nowy mail","autozapis kopii roboczej","Zapisz",[[this.NOT_SEND_TRACK]]],mailAutosaveCancel:["Nowy mail","autozapis kopii roboczej","Anuluj"],extAccClickLink:["Lista wiadomości","Dodaj konto zewnętrzne","klik w link"],extAccClosePanel:["Lista wiadomości","Dodaj konto zewnętrzne","Zamknij (x)"],extAccMoreOptions:["Lista wiadomości","Dodaj konto zewnętrzne","Więcej ustawień"],extAccLessOptions:["Lista wiadomości","Dodaj konto zewnętrzne","Mniej ustawień"],extAccAdd:["Lista wiadomości","Dodaj konto zewnętrzne","Dodanie konta zewnetrznego - %s%"],extAccAddWithChanges:["Lista wiadomości","Dodaj konto zewnętrzne","Dodanie z wprowadzonymi zmianami - %s%"],extAccDelete:["Lista wiadomości","Dodaj konto zewnętrzne","Usuń konto zewnetrzne"],extAccEdit:["Lista wiadomości","Dodaj konto zewnętrzne","Edytuj konto zewnetrzne"],extAccSendVeryfiMail:["Lista wiadomości","Dodaj konto zewnętrzne","Wyślij mail weryfikacyjny"],extAccFilter:["Lista wiadomości","Dodaj konto zewnętrzne","Filtruj po koncie zewnętrzym"],extAccAddServer:["Lista wiadomości","Dodaj konto zewnętrzne","Adres serwera"],extAccAddServerPort:["Lista wiadomości","Dodaj konto zewnętrzne","Port serwera"],extAccAddSsl:["Lista wiadomości","Dodaj konto zewnętrzne","Szyfrowanie SSL/TLS"],extAccAddOptions:["Lista wiadomości","Dodaj konto zewnętrzne","Opcje wysyłki/odbioru (3)"],extAccAddDefualtAcc:["Lista wiadomości","Dodaj konto zewnętrzne","Domyślnie wysyłaj maile z tego konta"],extAccAddCopyOnServer:["Lista wiadomości","Dodaj konto zewnętrzne","Zostaw kopię na serwerze (2 &ndash; tak/nie)"],messageListNextPack:["Lista wiadomości","Pokaż kolejną paczkę maili",""],userTooltipNewMes:["Lista wiadomości","tooltip nadawcy","nowa wiadomość"],userTooltipFilterBy:["Lista wiadomości","tooltip nadawcy","wyszukaj po nadawcy"],userTooltipAddToContact:["Lista wiadomości","tooltip nadawcy","dodaj/usuń  do/z kontaków"],userTooltipBlock:["Lista wiadomości","tooltip nadawcy","zablokuj/odblokuj nadawcę"],userTooltipFilter:["Lista wiadomości","tooltip nadawcy","Filtruj od tej osoby"],viewMailShowImg:["Otwarty mail","Pokaż obrazki","klik w link"],viewMailAlwaysShowImg:["Otwarty mail","Zawsze pokazuj obrazki ","klik w link"],viewMailSetStar:["Otwarty mail","Gwiazdka w nagłówku","oznaczenie maila gwiazdką"],viewMailToolboxReplay:["Otwarty mail","Odpowiedz","klik w ikonę w pasku"],viewMailMoreOptionsReplay:["Otwarty mail","Odpowiedz","klik w ikonę z więcej opcji"],viewMailToolbarDelete:["Otwarty mail","Usunięcie maila"," poprzez klik w ikonę w pasku"],viewMailMoreOptionsDelThread:["Otwarty mail","Usunięcie maila","poprzez opcję - Usuń cały wątek"],viewMailMoreOptionsDelete:["Otwarty mail","Usunięcie maila","poprzez opcję - Usuń tę wiadomość"],viewMailMoreOptionsShow:["Otwarty mail","Więcej opcji","rozwinięcie listy"],viewMailMoreOptionsSpam:["Otwarty mail","To jest Spam","klik w ikonę z więcej opcji"],viewMailMoreOptionsNoSpam:["Otwarty mail","To nie jest Spam","klik w ikonę z więcej opcji"],viewMailMoreOptionsForward:["Otwarty mail","Prześlij dalej","klik w ikonę z więcej opcji"],viewMailMoreOptionsMoveToFolder:["Otwarty mail","Przenieś do folderu","przenies do %s%"],viewMailMoreOptionsPrint:["Otwarty mail","Drukuj","klik w ikonę z więcej opcji"],viewMailMoreOptionsSave:["Otwarty mail","Zapisz","klik w ikonę z więcej opcji"],viewMailMoreOptionsInfo:["Otwarty mail","Szczegóły wiadomości","klik w ikonę z więcej opcji"],viewMailMoreOptionsHistory:["Otwarty mail","Historia wiadomości","klik w ikonę z więcej opcji"],viewMailMoreOptionsRelated:["Otwarty mail","Pokaż wiadomości powiązane","klik w ikonę z więcej opcji"],contactShowList:["Prawa szpalta","Rozwiń kontakty"," rozwiń"],contactListClickIcon:["Prawa szpalta","opcje na kontakcie","wyślij maila - klik w ikonkę"],contactListClick:["Prawa szpalta","opcje na kontakcie","wyślij maila - klik na kontakcie"],contactHistory:["Prawa szpalta","opcje na kontakcie","pokaż historię korespondencji"],contactAddFilter:["Prawa szpalta","opcje na kontakcie","dodaj filtr"],contactBlock:["Prawa szpalta","opcje na kontakcie","zablokuj"],contactEdit:["Prawa szpalta","opcje na kontakcie","edytuj kontakt"],contactDelete:["Prawa szpalta","opcje na kontakcie","usuń kontakt"],contactsMoreOptionsShow:["Prawa szpalta","więcej opcji","„^” daszek rozwinięcie listy"],contactsMoreOptionsAdd:["Prawa szpalta","więcej opcji","dodaj kontakt"],contactsMoreOptions:["Prawa szpalta","więcej opcji","zaznacz kilka kontaktów"],contactsMoreOptionsImportFile:["Prawa szpalta","więcej opcji","importuj kontakty z pliku"],contactsMoreOptionsExportFile:["Prawa szpalta","więcej opcji","eksportuj kontakty do pliku"],contactsMoreOptionsGroups:["Prawa szpalta","więcej opcji","grupy kontaktów"],contactsMoreOptionsSortPopularity:["Prawa szpalta","więcej opcji","sortuj:najpopularniejsze"],contactsMoreOptionsSortAlfa:["Prawa szpalta","więcej opcji","sortuj:alfabetycznie"],settingPanelShow:["Prawa szpalta","Ustawienia","klik"],settingPanelClose:["Prawa szpalta","Ustawienia","„x” zamknij"],settingPanelLogout:["Prawa szpalta","Ustawienia","Wyloguj"],settingPanelMain:["Prawa szpalta","Ustawienia","Główne ustawienia"],settingPanelNoAds:["Prawa szpalta","Ustawienia","Poczta bez reklam"],settingPanelChangePass:["Prawa szpalta","Ustawienia","Zmiana hasła i opcji odzyskiwania"],settingPanelSignature:["Prawa szpalta","Ustawienia","Ustaw podpisy"],settingPanelAddAlias:["Prawa szpalta","Ustawienia","Dodaj alias"],settingPanelBlackWhieList:["Prawa szpalta","Ustawienia","Czarna/biała lista"],settingPanelAutorespond:["Prawa szpalta","Ustawienia","Autoresponder"],settingPanelMore:["Prawa szpalta","Ustawienia","Więcej ustawień"],settingPanelReorder:["Prawa szpalta","Ustawienia","Uporządkuj pocztę"],settingPanelHelp:["Prawa szpalta","Ustawienia","Pomoc"],settingPanelMoreInfo:["Prawa szpalta","Ustawienia","Dowiedz się więcej"],settingPanelAutopromo1:["Autopromo_bez_reklam","klik","v1"],settingPanelAutopromo2:["Autopromo_bez_reklam","klik","v2"],settingPanelAutopromo3:["Autopromo_bez_reklam","klik","v3"],settingPanelTutorial:["Prawa szpalta","Ustawienia","Pokaż jak to zrobić"],settingPanelClickAutoPromo:["Prawa szpalta","Ustawienia","Klik w planszę autopromo"],settingPanelChangeSkin:["Prawa szpalta","Ustawienia","Zmiana skin  na %s% "],contactsMainToolbarAddClick:["Prawa szpalta","Dodaj kontakt","klik w ikonę"],contactActionAdd:["Prawa szpalta","Dodaj kontakt","faktyczne dodanie kontaktu"],contactAddToGroup:["Prawa szpalta","Dodaj kontakt","dodanie do grupy kontaktów"],contactSelectPhone:["Prawa szpalta","Dodaj kontakt","wybranie typu telefonu (%s%)"],contactAddPhone:["Prawa szpalta","Dodaj kontakt","wpisanie nr telefonu %s%"],contactAddNote:["Prawa szpalta","Dodaj kontakt","dodanie notatki"],contactAddNextEmail:["Prawa szpalta","Dodaj kontakt","dodanie kolejnego adresu e-mail"],contactDeleteEmail:["Prawa szpalta","Dodaj kontakt","usunięcie jednego z adresów e-mail"],contactSetDefualtEmail:["Prawa szpalta","Dodaj kontakt","ustaw jako adres główny e-mail "],contactAddNextPhone:["Prawa szpalta","Dodaj kontakt","dodanie kolejnego numeru telefonu"],contactDeletePhone:["Prawa szpalta","Dodaj kontakt","usunięcie jednego z numerów telefonu"],searcherContactClose:["Prawa szpalta","Wyszukaj kontakt","„x” zamknij wyszukiwarkę"],useSearcherContact:["Prawa szpalta","Wyszukaj kontakt","wyszukanie kontaktu"],welcomeMailingShow:["Kampania_next_nowy","mailing_pow","wyswietlenie"],welcomeMailingDetails:["Kampania_next_nowy","mailing_pow","klik"],addAttachmentErrorBugExternalAppInt:["komunikat_brak_zalacznika","view","mobi_int"],addAttachmentErrorBugExternalAppIntClick:["komunikat_brak_zalacznika","klik","mobi_int"],addAttachmentErrorBugExternalAppNext:["komunikat_brak_zalacznika","view","mobi_next"],addAttachmentErrorBugExternalAppNextClick:["komunikat_brak_zalacznika","klik","mobi_next"],avatarCardShow:["Menu_przy_wiadomosci","view"],avatarCardNewMessage:["Menu_przy_wiadomosci","klik","napisz wiadomosc"],avatarCardAddToContactsList:["Menu_przy_wiadomosci","klik","dodaj do listy kontaktow"],avatarCardShowMessages:["Menu_przy_wiadomosci","klik","zobacz wiadomosc"],avatarCardFilterMessages:["Menu_przy_wiadomosci","klik","filtruj wiadomosc"],avatarCardBlockThisUser:["Menu_przy_wiadomosci","klik","zablokuj te osobe"]},b={filterAllToolBar:["next","","-","filtrowanie","wszystkie"],filterStarsToolBar:["next","","-","filtrowanie","z_gwiazdka"],filterAttachToolBar:["next","","-","filtrowanie","z_zalacznikami"],selectUnReadMainToolBar:["next","","-","filtrowanie","nieprzeczytane"],filterContactsToolBar:["next","","-","filtrowanie","od_znajomych"],move:["next","","-","przenies","pojedynczy_mail","%s%"],moveAll:["next","","-","przenies","wszystkie_zaz","%s%"],reply:["next","","-","odpowiedz","-"],markRead:["next","","-","oznacz_przeczytane","pojedynczy_mail"],markReadAll:["next","","-","oznacz_przeczytane","wszystkie_zaz"],markUnread:["next","","-","oznacz_nieprzeczytane","pojedynczy_mail"],markUnreadAll:["next","","-","oznacz_nieprzeczytane","wszystkie_zaz"],markFavourite:["next","","-","oznacz_gwiazdka","pojedynczy_mail"],markFavouriteAll:["next","","-","oznacz_gwiazdka","wszystkie_zaz"],replyOnlySender:["next","","-","odpowiedz-tylko-nadawcy","-"],removeThread:["next","","-","usun_watek","-"],viewMailShowImg:["next","","-","pokaz_obrazki","-"],viewMailAlwaysShowImg:["next","","-","pokaz_obazki_zawsze","-"]},c=function(a,b,c,d){var e="";d[a]&&d[a][c]&&(e=b,d[a][c]=d[a][c].replace(/%s%/g,function(){return e.shift()}))},d=function(a,b,d,e){if(d[a]){var f,g=d[a].slice();return b&&(c(a,b,1,d),c(a,b,2,d),c(a,b,5,d)),f=d[a],d[a]=g,e&&(f[1]=e),f}};this.$get=["$stateParams","ApplicationConfig","Tools",function(c,e,f){var g=function(a){return f.removePolishDiacritics(a.toLowerCase()).split(" ").join("_")};return{get:function(b,c){return d(b,c,a)},getIWAFolder:function(a,f){var h=e.folders[c.folderId],i=g(h.name);return f&&(f[0]=g(f[0])),d(a,f,b,i)}}}]}),angular.module("nxt-webmail").factory("uiTinymceConfig",["$rootScope","ApplicationConfig","DialogManager","Track","$timeout","Tools",function(a,b,c,d,e,f){"use strict";var g=b.env.staticUrl+"/css/vendor/tinymce",h=b.env.staticUrl+"/js/tinymce",i=b.env.staticUrl+"/js/vendor/tinymce",j=!1;return{theme:"webmail",theme_url:h+"/themes/webmail/theme.min.js",skin:"webmail",skin_url:g+"/skins/webmail",autoresize_bottom_margin:20,plugins:"autoresize",external_plugins:{autoresize:i+"/plugins/autoresize/plugin.min.js",emoticons:h+"/plugins/emoticons/plugin.min.js",expand:h+"/plugins/expand/plugin.min.js",inlineimage:h+"/plugins/inlineimage/plugin.min.js",pasteurl:h+"/plugins/pasteurl/plugin.min.js",stationery:h+"/plugins/stationery/plugin.min.js",webmailcontentstyle:h+"/plugins/webmailcontentstyle/plugin.min.js",webmailfont:h+"/plugins/webmailfont/plugin.min.js",webmailtextcolor:h+"/plugins/webmailtextcolor/plugin.min.js"},menubar:!1,statusbar:!1,toolbar:"bold italic webmailfont underline webmailforecolor webmailcontentstyle stationery inlineimage emoticons | expand",content_css:g+"/content.css",forced_root_block:!1,paste_data_images:!0,browser_spellcheck:!0,init_instance_callback:function(g){var h=g.getElement(),i=angular.element(h)[0].isolateScope();g.on("BeforeGetContent",function(a){"text"!=a.format&&(a.format="raw")},!0),g.staticUrl=b.env.staticUrl,i.$on("tinymce:before-insert-image",function(a,b){g.focus(),g.insertContent('<img class="inpl-inline-attachment loading" data-inline-id="'+b.inlineId+'" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAWdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjA76PVpAAAADElEQVQYV2NAAwwMAAASAAGjJ+O6AAAAAElFTkSuQmCC">')}),i.$on("tinymce:insert-image",function(a,c){var d,e=b.env.uploadUrl+"/html/getattach,mid,"+c.mid+",mpid,"+c.mpid+",uid,"+b.env.uid+"?f=inline";d=new Image,d.onload=function(){var a=g.getBody().querySelector("[data-inline-id='"+c.inlineId+"']");a&&angular.element(a).attr("src",e).attr("id","inpl-inline-attachment_"+c.mpid).attr("data-cidval",c.cid).removeClass("loading").removeAttr("data-mce-src"),g.execCommand("mceAutoResize"),i.$emit("composition:updateSize"),i.$emit("ac:update")},d.src=e}),i.$on("tinymce:insert-content",function(a,b){g.focus();var c=g.selection.getBookmark();g.setContent("<div>"+g.getContent()+b+"</div>"),g.selection.moveToBookmark(c),g.execCommand("mceAutoResize")}),i.$on("tinymce:autoresize",function(a,b){g.execCommand("mceAutoResize")}),i.$on("tinymce:textmode-confirm",function(a,b){e(function(){c.confirm({title:"Czy na pewno?",message:"Zmieniasz tryb pracy edytora, czyli utracisz możliwość ustawienia czcionek, kolorów i obrazków w pisanej wiadomości.",confirm:"Zatwierdź",callback:function(){e(function(){g.fire("tinymce-textmode-confirmed",b)},0,!1)},callbackCancel:function(){e(function(){g.fire("tinymce-textmode-canceled",b)},0,!1)},callbackClose:function(){e(function(){g.fire("tinymce-textmode-canceled",b)},0,!1)}})},0)}),i.$on("tinymce:focus",function(a,b){g.focus()}),g.on("angular-broadcast",function(b){a.$broadcast(b.name,b.data)}),g.on("angular-emit",function(a){i.$emit(a.name,a.data),"tinymce:stationerySelected"==a.name&&d.pushCode("mailContentStationery")}),g.on("focus",function(){i.$emit("tinymce:content:focus")}),g.on("ExecCommand",function(a){switch(a.command){case"FontName":d.pushCode("mailContentFontTypeName",[a.value]);break;case"FontSize":d.pushCode("mailContentFontSize",[a.value]);break;case"ForeColor":d.pushCode("mailContentFontColor",[a.value]),g.editorContainer.querySelector(".mce-i-forecolor").style.color=a.value;break;case"InsertOrderedList":d.pushCode("mailContentNumericList",[a.value]);break;case"InsertUnorderedList":d.pushCode("mailContentPointList");break;case"JustifyLeft":d.pushCode("mailContentAlign",["lewej"]);break;case"JustifyRight":d.pushCode("mailContentAlign",["prawej"]);break;case"JustifyCenter":d.pushCode("mailContentAlign",["środek"])}}),g.on("ExecCommand",function(){}),g.on("blur",function(){i.$emit("tinymce:content:blur")}),g.on("paste keyup",function(){j||i.$emit("composition:mark-as-modified")}),g.on("paste",function(a){var b;a.clipboardData&&(a.preventDefault(),b=(a.originalEvent||a).clipboardData.getData("text/plain"),g.execCommand("insertText",!1,b)),e(function(){var a=document.createElement("style");a.type="text/css",a.innerHTML="#icselection13 {width: 100% !important; height: 100% !important; padding-top: 0px !important; overflow: visible !important;}",angular.element(g.iframeElement)[0].contentDocument.body.appendChild(a),g.execCommand("mceAutoResize"),i.$emit("composition:updateSize"),i.$emit("ac:update")},100,!1)}),g.on("change",function(){i.$emit("composition:onchange")}),g.Tools=f,i.$emit("tinymce:init");var k={"mce-i-bold":{tooltip:"Pogrubienie",track:"mailContentBold",additionalClass:"btn-active-shadow"},"mce-i-italic":{tooltip:"Kursywa",track:"mailContentItalic",additionalClass:"btn-active-shadow"},"mce-i-webmailfont":{tooltip:"Rodzaj i wielkość czcionki",track:"mailContentFontType"},"mce-i-underline":{tooltip:"Podkreślenie",track:"mailContentUnderline",additionalClass:"btn-active-shadow"},"mce-i-forecolor":{tooltip:"Kolor tekstu",track:"mailContentFontColor"},"mce-i-webmailcontentstyle":{tooltip:"Tworzenie list i wyrównanie tekstu",track:"mailContentAlignClick"},"mce-i-stationery":{tooltip:"Papeterie",track:"mailContentStationery"},"mce-i-inlineimage":{tooltip:"Wstaw obrazek",track:"mailContentInsImg"},"mce-i-emoticons":{tooltip:"Wstaw emotikonę",track:"mailContentInsEmot"},"mce-i-expand":{tooltip:"Wyczyść formatowanie",track:"mailContentClearFormat"}};Object.keys(k).forEach(function(a){var b=g.editorContainer.querySelector("."+a);k[a].tooltip&&(b.setAttribute("data-tooltip",k[a].tooltip),b.parentNode.setAttribute("data-tooltip",k[a].tooltip)),k[a].track&&(b.setAttribute("data-track-click",k[a].track),b.parentNode.setAttribute("data-track-click",k[a].track)),k[a].additionalClass&&b.parentNode.classList.add(k[a].additionalClass)}),i.$on("tinymce:switched-editor-mode",function(a,b){var c=b.isHTML?"Wyczyść formatowanie":"Wielkość i kolor liter oraz inne opcje formatowania (tryb html)",e=b.isHTML?".mce-i-expand":".mce-i-collapse",f=g.container.querySelector(e);f.setAttribute("data-tooltip",c),f.parentNode.setAttribute("data-tooltip",c),b.isHTML?d.pushCode("mailContentEditorHtmlOn"):d.pushCode("mailContentEditorHtmlOff")}),i.$on("hideAllPanels",function(){tinymce.ui.FloatPanel.hideAll()}),i.$on("$destroy",function(){tinymce.ui.FloatPanel.hideAll(),g.off(),g.remove(),g.destroy(),g=null})}}}]),angular.module("nxt-avatar").provider("Avatar",function(){this.$get=["$http","ApplicationConfig",function(a,b){return{setAvatar:function(c){return a.put(b.env.pocztaApiUrl+"/v1/avatar/change",c)},addToAlbum:function(c){return a.post(b.env.pocztaApiUrl+"/v1/avatar/addToAlbum",c)}}}]}),angular.module("nxt-common").provider("Bubble",function(){"use strict";var a=[],b=[],c=1;this.$get=["$rootScope","ApplicationConfig","Track","$http","$state","$timeout",function(d,e,f,g,h,i){function j(a){return g.put("/bubble",a).success(function(a){})}return function(){a=e.env.infoBoards.length>0||""===e.env.infoBoards?[]:e.env.bubbles}(),function(){if(!e.env.device.isMobile){var b={showSettings:function(){i(function(){h.go(".settings")},1500)}};if(a.length>0){var c=a[0].options.callbackBefore;c&&"function"==typeof b[c]&&b[c]()}}}(),{getBubbleToShow:function(c){if(b.indexOf(c)!==-1)return null;for(var d=0;d<a.length;d++)if(a[d].id==c)return b.push(c),a[d];return null},updateSetting:function(a){j(a)},updateSettingAsVisible:function(a){a<0||j({id:a,state:c})},showNotClosed:function(a){var c=b.indexOf(a);c>-1&&b.splice(c,1)},injectBubble:function(b){if(b.id>=0)throw"id should be less than 0";a=[{id:b.id?b.id:"",options:{isPc:"1",showOnlyOnce:"1",textField:b.textField?b.textField:"",template:"/common/views/bubble.html"},type:0,value:0,setting:null,name:b.name?b.name:"",priority:"1"}]}}}]}),angular.module("nxt-common").provider("Counter",function(){"use strict";function a(){var a=j.userFolderUnseen+j.folders[b];return c&&(a+=j.folders[c]),d&&(a+=j.folders[d]),a}var b,c,d,e,f,g,h,i=!1,j={folders:{},userFolders:{},userFolderUnseen:0},k={},l=document.title;this.$get=["$rootScope","ApplicationConfig","Folder","MobileApp","$state","$stateParams",function(m,n,o,p,q,r){function s(){m.$broadcast("controller:counters:update");var b=a();document.title=l+(b>0?" ("+b+")":"")}return{init:function(){i||(i=!0,m.$on("service:longpoll:success",function(a,b){b.inLastHour&&(k.user[b.folderId]?(j.userFolderUnseen++,j.userFolders[b.folderId]?(j.userFolders[b.folderId]++,j.userFolders[b.folderId].total&&j.userFolders[b.folderId].total++):j.userFolders[b.folderId]=1):k.system[b.folderId]&&(j.folders[b.folderId]++,k.system[b.folderId].total++)),s()}),m.$on("controller:folder:seen",function(a,b){[e,f,h,g].indexOf(b)===-1&&(k.user&&k.user[b]?(o.touch(parseInt(b)),j.userFolderUnseen-=j.userFolders[b],j.userFolders[b]=0):k.system&&k.system[b]&&(o.touch(parseInt(b)),j.folders[b]=0),s())}),m.$on("controller:folder:update",function(a,b){var c=1,d=1;b.messages.length>0?b.messages.forEach(function(a){a.threadId>0?(c=a.undreadMsgCount,d=a.msgCount):(c=1,d=1),k.all[a.folderId]&&(k.all[a.folderId].total-=d),k.all[b.folderId]&&(k.all[b.folderId].total+=d)}):(k.all[b.folderId]&&(k.all[b.folderId].total+=k.all[q.params.folderId].total),k.all[q.params.folderId]&&(k.all[q.params.folderId].total=0)),m.$broadcast("controller:folder:seen",r.folderId)}),m.$on("controller:folder:update:delete",function(a,b){b.messages.forEach(function(a){k.all[a.folderId].total--})}))},update:function(a){function i(b){return a.all[b].unseen}function l(a){a.unseen?(j.userFolders[a.id]=a.unseen,j.userFolderUnseen+=a.unseen):j.userFolders[a.id]=0}k=a,b||(b=a.all.INBOX,c=a.all.SHOPPING,d=a.all.SOCIAL,e=a.all.SPAM,f=a.all.DRAFTS,g=a.all.SENT,h=a.all.TRASH),j.folders[b]=i(b),j.folders[e]=i(e),j.folders[f]=i(f),j.folders[g]=i(g),j.folders[h]=i(h),c&&(j.folders[c]=i(c)),d&&(j.folders[d]=i(d)),j.userFolderUnseen=0,Object.keys(a.user).forEach(function(b){var c=a.user[b];if(0===c.parentId&&(l(c),c.subfolders))for(var d=0;d<c.subfolders.length;d++)l(c.subfolders[d])}),s()},updateWithoutFolders:function(){this.update(k)},getCounters:function(){return j},getSumAllCounters:function(){var b=a();return n.env.device.isMobileApp&&p.onUnreadCountChange(b),b}}}]}),angular.module("nxt-common").service("FileClassFinder",function(){var a={zip:["zip","rar","7z","tar","gz","bz2","tgz","zipx"],web:["html","htm","css","js","php","xml"],vid:["asf","wm","wmv","wmp","avi","ifv","dat","mov","qt","mpg","mpeg","mpe","mpv","m1v","rm","ram","rl2","swf","vob","mp4","flv","rmvb","3gp","3g2","oggmovie"],txt:["txt","mobi","epub"],spr:["xls","xlsx","ods","csv"],pre:["ppt","pptx","odp"],pdf:["pdf"],oof:["ott","odm","ots","odg","otg","otp","odf","odc","odb"],mus:["aif","aiff","aifc","aifr","midi","mid","rmi","mp2","mp3","mpeg3","ogg","ra","vqf","wave","wav","wma","flac","amr","ac3","m4a"],mso:["dot","docm","dotx","dotm","xlt","xlm","xlsm","xltx","xltm","xlsb","xla","xlam","xll","xlw","pot","pps","pptm","potx","potm","ppam","ppsx","ppsm","sldx","sldm"],img:["jpg","jpeg","gif","png","bmp","dib","cdr","tif","tiff","psd","pcx","ico"],cad:["dwg"],doc:["doc","docx","rtf","odt"],eml:["eml"]};this.getFileClass=function(b){for(var c in a)if(a.hasOwnProperty(c)&&a[c].indexOf(b.toLowerCase())!==-1)return c;return"undetected"},this.isImage=function(a){return["gif","jpg","jpeg","png","tif","tiff","ico","bmp"].indexOf(a.toLowerCase())!==-1}}),angular.module("nxt-common").provider("InfoBoards",function(){"use strict";var a=1,b=201,c=601,d=203,e=204,f=212,g=213,h=214,i=216,j=220,k=221,l=800,m=801,n=[],o={},p=!1;this.$get=["$rootScope","ApplicationConfig","DialogManager","Track","$http","Notification","$state","$stateParams","Messages","Setting","Folder","Bubble",function(q,r,s,t,u,v,w,x,y,z,A,B){function C(){r.hacks.isWindowsPhoneOS||(r.env.device.isAndroid?(L(h),K(e)):r.env.device.isIOS&&(L(i),K(f)))}function D(){y.deleteMailings().success(function(a){a.status&&q.$broadcast("folder:refresh",{refreshCache:!0})})}function E(){B.injectBubble({id:-1,textField:"Wypróbuj świąteczną skórkę!",name:"christmasSkin"}),w.go(".settings")}function F(){var a,b=o.options;if(p&&(b=angular.extend(b,p)),a={additionalClass:o.name,additionalData:b,template:!!o.options.template&&o.options.template,isHeaderHidden:void 0===o.options.isHeaderShow||!o.options.isHeaderShow,title:void 0!==o.options.title?o.options.title:"",message:void 0!==o.options.message?o.options.message:"",isModal:!b.notMaximize,callback:M[o.options.displayCallback],success:M[o.options.successCallback],callbackCancel:M[o.options.cancelCallback]},b.callbackClose&&(a.callbackClose=b.callbackClose),s.infoBoard(a),o.options.stat){var c;"iwa"==o.options.stat.type?(c=o.options.stat.display.split("|"),t.pushIWA(c)):"ga"==o.options.stat.type?(c=o.options.stat.display.split("|"),t.pushGA(c)):"gemius"==o.options.stat.type&&t.pushGemius(o.options.stat.display)}}function G(a){return e==a||f==a||j||k}function H(c){b==c&&(p=r.env.premiumInfo,p=angular.extend(p,{mail:r.env.ownEmail,confirm:"Przedłuż teraz"})),G(c)&&(p={callbackClose:function(){J({id:c,state:a,sValue:1})},appUrl:o.options.appUrl})}function I(){var a,b,c=r.hacks.isWindowsPhoneOS;r.env.device.isPc&&(b="isPc"),r.env.device.isMobile&&(b="isMobile"),r.env.device.isMobileApp&&(b="isMobileApp");var d=function(a){return!c||"undefined"==typeof a.options.doNotShowOnWindowsPhoneOS};for(a=0;a<n.length;a++)if(n[a].options&&n[a].options[b]&&d(n[a]))return n[a]}function J(a){return u.put("/infoBoard",a).success(function(a){})}function K(b){b=b||o.id,o.options.blockShowRequest||J({id:b,state:a,sValue:1})}function L(a,b){var c={id:a};return b&&(c.isTrigger=1),u.get("/infoBoard",{params:c,transformResponse:function(a){var b;return r.env.device.isPc?b="isPc":r.env.device.isMobileApp?b="isMobileApp":r.env.device.isMobile&&(b="isMobile"),!!(a.data&&a.data.options&&a.data.options[b])&&(o=a.data,F(),K(),a.data)}})}var M={closeMigrationFromTouch:C,deleteMailings:D,changeSkinChristmas:E};return{REMOVE_MAILING_BOARD_ID:l,SPAM_MAILING_BOARD_ID:m,init:function(a){if(n=a?[a]:r.env.infoBoards,o=I()){if(5==parseInt(o.type))switch(parseInt(o.id)){case c:s.dataSecurity({});break;case d:s.adultPermission({});break;case g:s.popTrashBar({additionalData:{cancel:function(a){a&&z.update({dontShowPopTrashBar:1})},success:function(a){a&&z.update({dontShowPopTrashBar:1}),A.restorepopped().success(function(a){v.success("Przywrócono wiadomości usunięte POP3"),x.folderId!=r.folders.INBOX&&x.folderId!=r.folders.TRASH||(y.clearBuffer(),$scope.refresh(!1,!0,!0))})}}});break;default:H(o.id),F()}else 7==parseInt(o.type)?s.multiBoards(o.options):(H(o.id),F());this.displayBoardTrigger(),this.clearInfoboardsQueque()}},clearInfoboardsQueque:function(){r.env.infoBoards=""},displayBoardTrigger:function(){K()},updateSetting:function(a){J(a)},getBoardConfById:function(a){return u.get("/infoBoard",{params:{id:a},transformResponse:function(a){return a.data}})},displayById:L}}]}),angular.module("nxt-common").provider("MarketingData",function(){"use strict";this.$get=["ApplicationConfig","$http",function(a,b){return{updateAgreementData:function(c){return b.post(a.env.pocztaApiUrl+"/v1/marketingData/updateAdultAgreement?uid="+a.env.uid,c,{withCredentials:!0})}}}]}),angular.module("nxt-common").provider("Profile",function(){"use strict";function a(){var a=document.cookie.replace(/(?:(?:^|.*;\s*)UPROFILE\s*\=\s*([^;]*).*$)|^.*$/,"$1");return a&&(a=decodeURIComponent(a),a=JSON.parse(a)),a}var b={IMAGE:1,TEXT:2};this.$get=["ApplicationConfig","$http",function(c,d){return{AVATAR_TYPE:b,updateAccountType:function(a){return d.post(c.env.pocztaApiUrl+"/v1/profileData/updateAccountType",{uid:c.env.uid,sid:c.env.sid,type:a},{withCredentials:!0})},getAvatarFromCookie:function(){var d="1006",e=a(),f=c.env.ownName.length>0?c.env.ownName.substr(0,1):c.env.ownEmail.substr(0,1),g={type:b.TEXT,data:c.env.avatarStyle,initial:f};return e&&e[d]&&e[d].e&&(g.type=b.IMAGE,g.data={id:e[d].a,ext:e[d].e}),g}}}]}),angular.module("nxt-common").provider("Security",function(){"use strict";this.$get=["ApplicationConfig","$http",function(a,b){return{getSecurityData:function(){return b.post(a.env.pocztaApiUrl+"/v1/personalData/read?uid="+a.env.uid,{},{withCredentials:!0})},setSecurityData:function(c){return b.post(a.env.pocztaApiUrl+"/v1/personalData/update?uid="+a.env.uid,c,{withCredentials:!0})}}}]}),angular.module("nxt-common").provider("Setting",function(){"use strict";this.$get=["$http","Notification",function(a,b){return{get:function(){return a.get("/setting",{transformResponse:function(a){return a}})},update:function(c,d){return a.put("/setting",c).success(function(a){d&&b.success(d,a)})}}}]}),angular.module("nxt-common").service("Tools",["$rootScope",function(a){var b={1:"Poniedziałek",2:"Wtorek",3:"Środa",4:"Czwartek",5:"Piątek",6:"Sobota",7:"Niedziela"};this.stripTagsFormatBlockQuotes=function(a){if(!a||!a.length)return"";var b,c=a.replace(/&gt;/g,">").replace(/> +>/g,">>"),d=c.split(/(?=<\/?(?:address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)[^>]*>|<br\s*\/?>)/i),e="",f="";return d.forEach(function(a,b,c){0===a.indexOf("<blockquote")?e+=">":0===a.indexOf("</blockquote")&&(e=e.substring(0,e.length-1)),c[b]=a.replace(/^<\/?[^>]*>\s*/,e+(e&&" ")).replace(/<\/?[^>]*>/gi,"")}),d.length>1?(f=b=d[0],d.forEach(function(a,c){c>0&&a!==b&&(f+="\n"+a),b=a})):1===d.length&&(f=d[0]),f},this.getSortString=function(a){a=a.toLocaleLowerCase();var b="1".charCodeAt(0),c="aąbcćdeęfghijklłmnńoópqrsśtuvwxyzźż".split(""),d=a.split("");return d=d.map(function(a){var d=c.indexOf(a);return d!==-1?String.fromCharCode(d+b):"0".charCodeAt(0)}),d.join("")},this.getTextOnly=function(a){if(!a)return"";var b=document.createElement("DIV");return b.innerHTML=a.replace(/<(?:.|\n)*?>/gm,""),b.textContent||b.innerText||""},this.formatDateForReply=function(a){var c=a.split(" "),d=c[0].split("-"),e=c[1].split(":"),f=new Date(d[0],d[1]-1,d[2],e[0],e[1]);return c[1]+" "+b[f.getDay()]+" "+c[0]},this.removeFromArray=function(a,b){var c=a.indexOf(b);c>-1&&a.splice(c,1)},this.extendArray=function(a,b){var c={},d=0;for(d=a.length-1;d>=0;--d)c[a[d]]=a[d];for(d=b.length-1;d>=0;--d)c[b[d]]=b[d];var e=[];for(var f in c)c.hasOwnProperty(f)&&e.push(c[f]);return e},this.removePolishDiacritics=function(a){var b=a.toLowerCase(),c={a:"[ą]",c:"ć",e:"[ę]",l:"[ł]",n:"ń",o:"[ó]",s:"ś",z:"[źż]"};for(var d in c)b=b.replace(new RegExp(c[d],"g"),d);return b},this.frameLoginSuccess=function(b){a.$broadcast("frame-login:success",b)},this.frameLoginFailed=function(){a.$broadcast("frame-login:failed")},this.setElementIsolateScope=function(a,b){a[0].isolateScope=function(){return b}}}]),angular.module("nxt-common").provider("TooltipBubble",function(){"use strict";this.$get=["ApplicationConfig",function(a){var b=[];return b="int"==a.env.service.name?[{id:0,title:"Bezpieczny nadawca",desc:"Ten symbol oznacza, że nadawca tej wiadomości został poprawie zweryfikowany.",href:"http://help.int.pl/news-oznaczenie-bezpieczny-nadawca,nId,2451589",icon:"icon-padlock"}]:[{id:0,title:"Bezpieczny nadawca",desc:"Ten symbol oznacza, że nadawca tej wiadomości został poprawie zweryfikowany.",href:"http://pomoc.poczta.interia.pl/news-oznaczenie-bezpieczny-nadawca,nId,2450294",icon:"icon-padlock"}],{getTooltipBubbleToShow:function(a){for(var c=0;c<b.length;c++)if(b[c].id===parseInt(a))return b[c];return null}}}]}),angular.module("nxt-common").service("Track",["ApplicationTrackEvent","ApplicationConfig",function(a,b){var c="poczta-PV_czesciowe",d=this,e={pushGA:function(){},pushGFK:function(){},pushGemius:function(){},pushIWA:function(){},push:function(){},pushCode:function(){},pushIWAFolder:function(){}},f=function(b){var c=[];return c.gemius=[],c.gemius.inMobileApp=a.SEND_TRACK,b[3]&&b[3][0]&&b[3][0][0]&&(c.gemius.inMobileApp=b[3][0][0]),c};if(this.pushMobileApp=function(c,d){var e=f(c);if(e.gemius.inMobileApp==a.SEND_TRACK)try{var g=b.hacks.isIOS;g?window.webkit.messageHandlers.hitGemius.postMessage("hitGemius"):MobileAppConnector.sendGemiusHit()}catch(h){console.log("Only to use in mobileApp hitGemius",c)}},this.pushGA=function(a,c){if(c=[c||"b._trackEvent"],"undefined"!=typeof _gaq)if(a=c.concat(a),b.env.dev)console.log(a);else try{_gaq.push(a)}catch(d){console.log(d)}else console.log(a)},this.pushGFK=function(a){a&&(c=a),"undefined"!=typeof gfkSst},this.pushGemius=function(a){b.env.dev?console.log("gemius",a):gemius_hit&&gemius_hit(a)},this.pushIWA=function(a){a.unshift("trackEvent"),b.env.dev?console.log("IWA",a):"undefined"!=typeof iwa&&iwa.apply(this,a)},this.push=function(a,b){this.pushGA(a,b)},this.pushCode=function(b,c){this.push(a.get(b,c)||b)},this.pushIWAFolder=function(b,c){this.pushIWA(a.getIWAFolder(b,c))},b.env&&b.env.isMobileApp)return e.pushGA=d.pushMobileApp,e.push=d.pushMobileApp,e.pushCode=d.pushCode,e}]),angular.module("nxt-composition").factory("Compositions",["DialogManager","Track","$http","$rootScope","ApplicationConfig","ExternalAccount","Contact","Uploader","$state","Stationery","Tools","ApplicationData",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(a,b){D=a,d.$broadcast("compositions:update-sender",b),E&&(E=!1,d.$broadcast("external-account:close"));
}function n(a){var b=[];a&&a.forceUpdate?f.query().success(function(c){angular.isArray(c)&&(b=angular.copy(c)),m(b,a)}):(angular.isArray(l.get("ExternalAccount").data)&&(b=angular.copy(l.get("ExternalAccount").data)),m(b,a))}function o(c){if(c&&("ra"===c.opt||"e"===c.opt)&&c.mesg&&(c.singleInstanceId=c.mesg),c&&c.toActive){if("function"==typeof C)return void C(c.toActive);c.to=c.toActive,delete c.toActive}a.add({compositionConfig:c,title:"Nowa wiadomość",template:e.env.device.isMobile?"/dialog/views/dialog_composition_mobile.html":"/dialog/views/dialog_composition.html",dialogType:a.DialogTypes.COMPOSITION,isHeaderHidden:!!e.env.device.isMobile,isHeaderVisible:!0,callbackClose:function(){b.pushCode("dialogNewMailClose")},callbackMinimize:function(){b.pushCode("dialogNewMailMin")},callbackMaximize:function(a){a.hasClass("maximized")?b.pushCode("dialogNewMailFull"):b.pushCode("dialogNewMailFullClose")}}),d.$broadcast("composition:save")}function p(a){return a.attachments||(a.isGallery=0),c.post("/message/send",a).success(function(a){if(a.contacts&&a.contacts.length&&(d.$broadcast("service:composition:autoinsert-contact",a.contacts),e.env.device.isMobile)){var b=l.get("Contact").data;a.contacts.forEach(function(a){if("pomoc@firma.interia.pl"!==a.email){a.name=a.email.substr(0,a.email.indexOf("@")),a.score=9.89009141411e-7,a.type=g.CONTACT_TYPE_AUTOINSERT;var c=g.create(a);b.push(g.contactObjectToArray(c))}}),l.put("Contact",{time:e.cacheTime,data:b})}})}function q(a){var c,f=["to","cc","bcc","prior","cntType","from"],j=["to","cc","bcc"],k=[],l=a.attachments,m=a.params,n=a.originalMessageRevealed,o=a.originalContent;switch(m.rawContent&&(k=h.getInlineAttachmentsIds(m.rawContent),k.forEach(function(a){l.indexOf(a)===-1&&l.push(a)})),c={mid:m.mid,to:m.to,fromId:m.from&&m.from.vsmtpId?m.from.vsmtpId:-1,fromEmail:m.from&&m.from.email?m.from.email:"",fromType:m.from&&m.from.type?m.from.type:"",cc:m.cc,bcc:m.bcc,subject:m.subject,prior:m.prior,content:m.content,isGallery:I,attachments:l.join(),cntType:m.isHTML?"html":null,originalContent:!n&&o,extAccType:m.from&&m.from.type?m.from.type:"",extAccId:m.from&&m.from.id&&m.from.id!=-1?Math.abs(m.from.id):null},m.mode){case"send":c=angular.extend(c,{optSend:1});break;case"reply":c=angular.extend(c,{optSend:1,opt:"ra"});break;case"save":c=angular.extend(c,{optSend:3,opt:"e"}),m.selectedSignature&&m.selectedSignature.id&&m.selectedSignature.id!==e.defaultSignatureId&&(c.signatureId=m.selectedSignature.id)}f.forEach(function(a){(!c[a]||angular.isArray(c[a])&&0===c[a].length)&&delete c[a]}),j.forEach(function(a){c[a]&&angular.isArray(c[a])&&(c[a]=c[a].map(function(a){return{name:a.name||"",email:a.email,type:a.type||g.CONTACT_TYPE_ALL,id:a.id||""}}))}),m.onBeforeStart&&m.onBeforeStart(),p(c).success(function(a){a?m.onSuccess&&(m.onSuccess(a),i.params.folderId==e.folders.SENT&&d.$broadcast("service:search:refresh"),b.pushCode("mailAutosaveConfirm")):m.onError&&m.onError()}).error(function(a){m.onError&&m.onError(a)})}function r(a,b,c){var d="--";F||(d="");var e,f,g=c?"<br>":"\n",h=c?b.split("\n").join("<br>"):b,i=g+d+g+h+(c?"":g),j="",k="",l=c?'<div class="inpl-collapsed':"\n> \n> ",m=a.indexOf(l);return e=a.match(/<[^>]+(data-inpl-forward-mark|inpl-revealable)[^>]*>((?!<\/div>).)*<\/div>/),e&&e.length>0?(f=a.indexOf(e[0]),f!==-1&&(m=f,a=a.replace(/<[^>]+data-inpl-forward-mark[^>]*>((?!<\/div>).)*<\/div>/,"<br>"))):i=g+i,m===-1?j=a:(j=a.substring(0,m),k=a.substring(m)),j+i+k}function s(a,b,c){if(c){var d="<blockquote",e=b.indexOf(d)+d.length,f=b.substring(0,e),g=b.substring(e);return f+=' class="nxt-original-message-notrevealed"',b=f+g,a+b}return a+k.stripTagsFormatBlockQuotes(b)}function t(a,b){var c=b?"<br>":"\n";return a+c+c+"Rozdzielczość: "+screen.width+"x"+screen.height}function u(a){return a+" <public_gallery_body>"}function v(a,b){var c=b?"<br>":"\n";return a+c+c+c+c+c+c+"Platforma: "+navigator.platform+c+"User Agent: "+navigator.userAgent+c+"Rozdzielczość: "+screen.width+"x"+screen.height}function w(a){var b=/(?:https?:\/\/)?(?:[\da-z])(?:[\da-z-@]|\.(?!\.))+\.(?:[a-z]{2,})(?:\.[a-z]{2,})?(?:[\/\w\.\-?@!:;'&=#\+%_,ąćęłńóśżźĄĆĘŁŃÓŚŻŹäöüÄÖÜß])*\/?(?=[\s)]+(?!<\/a>)|$)/gi;return a.replace(b,function(a){return a.indexOf("http://")!==-1?'<a href="'+a+'" target="_blank">'+a+"</a>":a.indexOf("https://")!==-1?'<a href="'+a+'" target="_blank">'+a+"</a>":a.indexOf("@")!==-1?'<a href="mailto:'+a+'">'+a+"</a>":'<a href="http://'+a+'" target="_blank">'+a+"</a>"})}function x(a,b){return"save"!==a&&(!F&&G&&H||F&&b.config.selectedSignature&&b.config.selectedSignature.value&&b.config.selectedSignature.value.length)}function y(a,b){return b.config.originalContent&&!b.config.originalMessageRevealed}function z(a,b){return"save"!==a&&b.config.isHTML&&angular.isObject(b.config.selectedStationery)}function A(a,b){return b.config.recipients.to&&1==b.config.recipients.to.length&&"pomoc@firma.interia.pl"==b.config.recipients.to[0].email&&!b.config.recipients.cc.length&&!b.config.recipients.bcc.length}function B(a,b){return b.config.attachments.length&&b.config.isHTML}var C,D,E=!1,F=e.getConfigAppModule("composition")&&e.getConfigAppModule("composition").actions.signature,G=e.signatures[-1],H=e.signatures[-2],I=1==e.env.publicGalleryEnabled&&e.env.device.isPc?1:0;return d.$on("directive:publicGallery:isGallery",function(a,b){I=b}),d.$on("directive:emailinput:focus",function(a,b){C=b.addEmailFn}),n(),{get:function(a){return c.postPreserveCache("/message",a)},save:p,addSignature:function(a){return c.postPreserveCache("/signature",a)},addComposition:function(a){a&&a.ids&&a.ids.length?(a.ids=a.ids.map(function(a){return parseInt(a)}),a.to=a.to||[],g.cachedQuery().then(function(b){b.forEach(function(b){var c=g.contactArrayToObject(b);a.ids.indexOf(c.id)!==-1&&a.to.push(c)}),o(a)})):o(a)},removeComposition:a.remove,updateExternalAccounts:n,getStoredExternalAccounts:function(){var a,b=[],c=[];if(angular.isArray(D))for(a=0;a<D.length;a++)b.indexOf(D[a].email)===-1&&(c.push(D[a]),b.push(D[a].email));else c=D;return c},waitForNewAccount:function(){E=!0},sendMessage:function(a,b){var c=b.config.recipients.to,d=b.config.recipients.cc,f=b.config.recipients.bcc,g=b.config.subject,h=b.config.rawContent,i=h,k={};e.env.device.isMobile&&(i=w(i)),B(a,b)&&(i=u(i)),x(a,b)&&(k=F?b.config.selectedSignature.value:b.config.isHTML?G.value:H.value,i=r(i,k,b.config.isHTML)),y(a,b)&&(i=s(i,b.config.originalContent,b.config.isHTML)),z(a,b)&&(i=j.applyBeforeSend(b.config.selectedStationery,i)),A(a,b)&&(i=e.env.device.isMobile?v(i,b.config.isHTML):t(i,b.config.isHTML)),e.hacks.isAndroid&&(i=i.replace(/\n/gi,"<br>")),q({attachments:b.config.attachments,originalMessageRevealed:b.config.originalMessageRevealed,originalContent:b.config.originalContent,params:{mode:a,mid:b.config.compositionId,from:b.config.sender,to:c,cc:d,bcc:f,subject:g||"",prior:b.config.important,content:i,selectedSignature:b.config.selectedSignature,rawContent:h,isHTML:b.config.isHTML,onBeforeStart:b.onBeforeStart,onSuccess:b.onSuccess,onError:b.onError}})}}}]),angular.module("nxt-composition").service("Sender",["ApplicationConfig",function(a){function b(a,b,c,d){if(b&&b.length&&c)for(var e=0;e<b.length;e++)if(c===b[e].email)return a.setIfChangingSenderAllowed(d),a.setFilteredAccounts(b),b[e];return null}this.autoSelectSender=function(c){var d,e,f=a.prefs.defaultAccount,g=c.accounts;if(g&&g.length){if(c.senderConfig)if((c.senderConfig.isSent||c.senderConfig.isDraft)&&c.senderConfig.fromEmail){if(d=b(c,g,c.senderConfig.fromEmail,!1),null!==d)return d}else if(!c.senderConfig.isSent){if(angular.isArray(c.senderConfig.recipientsEmails))for(e=0;e<c.senderConfig.recipientsEmails.length;e++)if(d=b(c,g,c.senderConfig.recipientsEmails[e],!1),null!==d)return d;if(c.senderConfig.multipopAccountHeader&&c.senderConfig.multipopAccountHeader.indexOf("@")!==-1&&(d=b(c,g,c.senderConfig.multipopAccountHeader,!1),null!==d))return d;if(c.senderConfig.envelopeToHeader&&(d=b(c,g,c.senderConfig.envelopeToHeader,!1),null!==d))return d}for(e=0;e<g.length;e++)if(parseInt(f,10)===g[e].vsmtpId||f===g[e].email)return c.setIfChangingSenderAllowed(!0),c.setFilteredAccounts(g),g[e];for(e=0;e<g.length;e++)if(g[e].isOwnEmail||g[e].ownEmail)return c.setIfChangingSenderAllowed(!0),c.setFilteredAccounts(g),g[e];return c.setIfChangingSenderAllowed(!0),c.setFilteredAccounts(g),g[0]}}}]),angular.module("nxt-composition").service("Stationery",["ApplicationConfig",function(a){var b=["background-color","background-image","color","font-family","font-size","link","font-style"];this.applyBeforeSend=function(c,d){var e,f,g=c.template,h="",i="";return b.forEach(function(b){b in c.bodyStyle&&(f=c.bodyStyle[b],"background-image"===b?i+=' background="'+f.replace(/\%STATIC_URL\%/g,a.env.staticUrl).replace("url(","").replace(")","")+'"':"link"===b?i+=' alink="'+f+'" link="'+f+'" vlink="'+f+'"':"color"===b?(i+=' text="'+f+'"',h+=" color:"+f+";"):h+=" "+b+":"+f.replace(/\%STATIC_URL\%/g,a.env.staticUrl)+";")},this),c.bodyStyle["font-style"]||(h+="font-style:normal;"),g=g.replace(/style='/g,"style='"+h).replace(/\%MAIL_BODY\%/g,d).replace(/\%STATIC_URL\%/g,a.env.staticUrl),e='<body marginwidth="0" marginheight="0" topmargin="0" leftmargin="0" rightmargin="0" bottommargin="0" '+i+' style="padding:0px;margin:0px'+h+'">'+g+"</body>"}}]),angular.module("nxt-composition").service("Uploader",["ApplicationConfig","FileUploader","$rootScope","$timeout","FileClassFinder","Notification","Track","$window","UploaderResize",function(a,b,c,d,e,f,g,h,i){var j=0,k=!1,l=!1,m=!1,n=a.env.device.isMobile,o=a.env.service&&"int"==a.env.service.name,p=a.env.isCorp,q=!o&&!p,r=function(a){return a.imgCount=0,a.otherCount=0,a.showGalleryPanel=!1,a.queue.forEach(function(b,c){"img"===b.className?(a.showGalleryPanel=!0,a.imgCount++):a.otherCount++}),a};this.getUploader=function(i){function k(a,b,c){g.pushCode(a),f.setOnClickCallback(b,p(a+"Click",c)),f.error(b)}function p(a,b){return function(){g.pushCode(a),h.open(b,"_blank")}}return i.attachments=[],i.uploader=new b({scope:i,alias:"attach",withCredentials:!0,autoUpload:!1}),i.uploader.updateUploadUrls=function(){i.uploadUrl=a.env.uploadUrl+"/next/addattachswf,markmsg,"+i.compositionId+",attId,2-0,uid,"+a.env.uid+"?redir_host="+location.host,i.inlineUploadUrl=a.env.uploadUrl+"/next/addattachswf,markmsg,"+i.compositionId+",attId,2-0,inline,1,uid,"+a.env.uid+"?redir_host="+location.host},i.uploader.updateUploadUrls(),i.uploader.queueLength=0,i.uploader.MAX_TOTAL_SIZE=100,i.uploader.MAX_ITEMS_COUNT=50,i.uploader.updateTotalSize=function(){i.uploader.queueLength=i.uploader.queue.filter(function(a){return!a.isInline}).length,i.uploader.queueLength?i.uploader.totalSize=i.uploader.queue.filter(function(a){return!a.isInline}).map(function(a){return a._file.size}).reduce(function(a,b){return a+b})/1048576:i.uploader.totalSize=0,i.uploader.isTotalSizeExceeded=i.uploader.totalSize>i.uploader.MAX_TOTAL_SIZE,i.uploader.isItemsCountExceeded=i.uploader.queue.filter(function(a){return!a.isInline}).length>i.uploader.MAX_ITEMS_COUNT},i.uploader.updateUploadedSize=function(){i.uploader.queueLength=i.uploader.queue.filter(function(a){return!a.isInline}).length,i.uploader.queueLength?i.uploader.uploadedSize=i.uploader.queue.filter(function(a){return!a.isInline}).map(function(a){return a._file.size*(a.progress/100)}).reduce(function(a,b){return a+b})/1048576:i.uploader.uploadedSize=0},i.uploader.updateUploadedCount=function(){i.uploader.uploadedCount=i.uploader.queue.filter(function(a){return!a.isInline}).filter(function(a){return a.isUploaded}).length},i.uploader.removeAttachment=function(a,b){var e;e=i.attachments.indexOf(a.mimePartIndex),e>-1&&i.attachments.splice(e,1),0===i.attachments.length&&i.$emit("composition:enableSending"),d(function(){a.isUploading&&i.uploader.cancelItem(a),i.uploader.removeFromQueue(a),"img"==a.className&&(i.uploader.imgCount--,c.$broadcast("directive:publicGallery:removeAttachment")),c.$broadcast("composition:mark-as-modified"),i.uploader.updateUploadedCount(),i.uploader.updateUploadedSize(),i.uploader.updateTotalSize(),i.uploader.isItemsCountExceeded||i.uploader.isTotalSizeExceeded||(i.uploader.uploadAll(),i.$emit("composition:enableSending"))}),b||g.pushCode("deleteAttach")},i.uploader.removeAllAttachments=function(){i.uploader.queue.filter(function(a){return!a.isInline}).forEach(function(a){i.uploader.removeAttachment(a,!0)}),i.$emit("composition:enableSending"),l=!0,f.success("uploader:all-attachments-removed"),g.pushCode("deleteAllAttach")},i.uploader.loadAttachments=function(a){if(a.attach&&a.attach.list)for(var b=0;b<a.attach.list.length;b++)i.uploader.queue.push({_file:{name:a.attach.list[b].name,size:parseInt(a.attach.list[b].size,10),mid:a.mid,mpid:a.attach.list[b].mpid,remote:!0},className:e.getFileClass(a.attach.list[b].name.split(".").pop()),progress:100,isUploaded:!0,isSuccess:!0,mimePartIndex:a.attach.list[b].mpid,extension:a.attach.list[b].name.split(".").pop(),_destroy:function(){this._input&&this._input.remove(),this._form&&this._form.remove(),delete this._form,delete this._input}}),i.attachments.push(a.attach.list[b].mpid);else{if(!a.uploaderQueue||!a.attachments)return;i.uploader.queue=a.uploaderQueue,i.attachments=a.attachments}i.uploader=r(i.uploader),i.uploader.updateTotalSize(),i.uploader.updateUploadedSize(),i.uploader.updateUploadedCount(),d(function(){i.$emit("ac:update")},0,!1)},i.uploader.onAfterAddingAll=function(a){if(i.isSaving){for(var b=i.uploader.getNotUploadedItems(),c=0;c<b.length;c++)i.uploader.removeFromQueue(b[c]);i.$emit("composition:enableSending"),i.$on("directive:composition:saved-finish",function(){b.length&&d(function(){for(var a=0;a<b.length;a++)b[a].url=i.uploadUrl;i.uploader.queue=i.uploader.queue.concat(b),i.uploader.uploadAll(),i.$emit("composition:disableSending"),b=[]},0,!1)})}},i.uploader.onAfterAddingFile=function(a){i.$emit("composition:disableSending");var b=angular.isObject(a._file)?a._file:a.file,c=b.name.split(".").pop();c&&(a.extension=c,a.className=e.getFileClass(c)),i.uploader.updateTotalSize(),d(function(){i.$emit("ac:update"),i.scrollToUploadManager()},0,!1),a.isInline&&(a.inlineId=j,j++,i.$broadcast("tinymce:before-insert-image",{inlineId:a.inlineId})),a.batchNumber=0},i.uploader.onProgressItem=function(a,b){i.uploader.updateUploadedSize()},i.uploader.onSuccessItem=function(a,b,c,d){if(f.close("uploader:adding-attachments"),b&&b.status!==!1&&b.data&&b.data.files){if(a.mimePartIndex=b.data.files[0].index,a.isInline){if(i.attachments.indexOf(a.mimePartIndex)>-1)return;i.$broadcast("tinymce:insert-image",{mid:i.compositionId,mpid:a.mimePartIndex,f:b.data.files[0].name,inlineId:a.inlineId,cid:b.data.files[0].cid}),a.remove()}i.attachments.push(a.mimePartIndex),i.$emit("composition:updateSize"),m=!1}else m=!0,i.uploader.removeAttachment(a),f.setReplaceParams([b.msg]),f.error("composition:add-attachment-error-reasone")},i.uploader.onCancelItem=function(a,b,c,d){if(m=!0,i.uploader.removeAttachment(a),n){var e="",g="",h="";q?(e="addAttachmentErrorBugExternalAppNext",g="composition:add-attachment-error-bug-external-app-next",h="https://play.google.com/store/apps/details?id=pl.interia.poczta_next&referrer=utm_source%3Dnext_mobilny_blad%26utm_medium%3Dkomunikat_bledu_zalacznik%26utm_campaign%3Dnext_mobilny_blad_zalacznik%26anid%3Dadmob",k(e,g,h)):o?(e="addAttachmentErrorBugExternalAppInt",g="composition:add-attachment-error-bug-external-app-int",h="https://play.google.com/store/apps/details?id=pl.int.poczta&referrer=utm_source%3Dint_mobilny_blad%26utm_medium%3Dkomunikat_bledu_zalacznik%26utm_campaign%3Dint_mobilny_blad_zalacznik%26anid%3Dadmob",k(e,g,h)):f.error("composition:add-attachment-error-bug-external-app")}else f.error("composition:add-attachment-error")},i.uploader.onProgressAll=function(a){i.uploader.updateUploadedCount(),c.$broadcast("directive:publicGallery:progressall")},i.uploader.onCompleteAll=function(a){i.uploader.updateUploadedCount(),m||(i.$emit("composition:enableSending"),l||f.success("uploader:all-attachments-added"),l=!1),c.$broadcast("composition:mark-as-modified"),c.$broadcast("directive:publicGallery:completeUpload")},i.uploader.onAfterAddingAll=function(a){i.uploader.queue.forEach(function(a,b,c){c[b].batchNumber++}),i.uploader=r(i.uploader),i.uploader.queue.sort(function(a,b){var c=a.className,d=b.className,e=a.batchNumber,f=b.batchNumber;return e===f?"img"===c&&"img"!==d?-1:"img"!==c&&"img"===d?1:0:e<f?1:-1}),i.uploader.isItemsCountExceeded||i.uploader.isTotalSizeExceeded||i.uploader.uploadAll()},i.showUploader=!0,i.uploader},this.getInlineAttachmentsIds=function(a){var b=document.createElement("div"),c=[];return b.innerHTML=a,Array.prototype.forEach.call(b.querySelectorAll(".inpl-inline-attachment"),function(a){var b=a.id;b&&c.push(b.split("_").pop())}),c},this.fakeFileInputClick=function(a,b){if(!k){k=!0;var c;document.createEvent&&(c=document.createEvent("MouseEvent"),c.initMouseEvent("click",!0,!0,window,null,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(c)),d(function(){k=!1},1e3,!1)}}}]),angular.module("nxt-composition").service("UploaderResize",["$rootScope",function(a){"use strict";function b(a,b){return a.lastModifiedDate=new Date,a.name=b,a}var c,d,e=1920,f=1280;this.resize=function(g){var h=g;window.URL=window.URL;var i=document.createElement("img");i.src=window.URL.createObjectURL(h),i.onload=function(){c=i.width,d=i.height,c>d?c>e&&(d*=e/c,c=e):d>f&&(c*=f/d,d=f);var g=document.createElement("canvas");g.width=c,g.height=d;var j=g.getContext("2d");j.drawImage(i,0,0,c,d),h.name.match(/jpg.*/)||name.match(/jpeg.*/)?g.toBlob(function(c){var d=b(c,h.name);h.size<d.size?a.$broadcast("resizeCanvas",h):a.$broadcast("resizeCanvas",d)},"image/jpg",.95):g.toBlob(function(c){var d=b(c,h.name);h.size<d.size?a.$broadcast("resizeCanvas",h):a.$broadcast("resizeCanvas",d)},"image/png",1),window.URL.revokeObjectURL(i.src)}}}]),angular.module("nxt-contact").provider("Contact",function(){"use strict";var a=1,b=2,c=3,d=4,e=5,f=7,g=!1,h=!1,i=-2;this.$get=["$http","$rootScope","$q","FileUploader","Notification","ApplicationConfig","Track","Tools","ApplicationData",function(j,k,l,m,n,o,p,q,r){function s(a,b){var c,d,e=[],f=[];return a&&a!==b&&(e=e.concat(a.toLowerCase().split(/[^\wąćęłńóśźż]/))),b&&(e=e.concat(b.toLowerCase().split(/[^\w]/)),b.indexOf("@")!==-1&&(e.push(b.toLowerCase()),c=b.toLowerCase().split("@")[0],d=c.match(/(\d+)/g),angular.isArray(d)&&(e=e.concat(d)))),e=e.filter(function(a){return!!a}),e=e.map(function(a){return/^.*[ąćęłńóśźż]+.*$/.test(a)&&f.push(a),q.removePolishDiacritics(a)}),f.length&&(e=e.concat(f)),e}function t(a){return a&&a.length&&a.forEach(function(a,b,c){c[b][G.WORDS]=s(a[G.NAME],a[G.EMAIL])}),a}function u(a){return a.toLowerCase().replace(/_(\w)/g,function(a){return a.toUpperCase().replace("_","")})}function v(a){var b,c="NOTE,PHONES,EMAILS,WORDS".split(","),d={id:a[G.ID],avatar:a[G.AVATAR],email:a[G.EMAIL],name:a[G.NAME],score:a[G.SCORE],type:a[G.TYPE],groups:a[G.GROUPS]||[],isReadonly:a[G.IS_READONLY],sortName:a[G.SORT_NAME]};return c.forEach(function(c){b=a[G[c]],"undefined"!=typeof b&&(d[u(c)]=b)}),d}function w(a){var b,c=[],d="ID,AVATAR,EMAIL,NAME,SCORE,TYPE,SORT_NAME,IS_READONLY,IS_ON_BLACKLIST,EMAILS,GROUPS,PHONES,NOTE,WORDS".split(",");return d.forEach(function(d){b=a[u(d)],"undefined"!=typeof b&&(c[G[d]]=b)}),c}function x(a){a&&a.length&&a.forEach(function(a,b,c){angular.isObject(a)&&!angular.isArray(a)&&(c[b]=w(a))})}function y(a){return{data:(10*Math.random()+1)%16|0,type:2,initial:a?a.substr(0,1):""}}function z(a){a=a||{};var b=y(a.email),c={name:a.name||"",email:a.email||"",score:a.score||0,emails:a.emails||[],groups:a.groups||[],phones:a.phones||[],avatar:a.avatar||[b],note:a.note||"",isReadonly:!0};return a.id&&(c.id=a.id),c}function A(a){var b,c,d=o.env.isCorp,e=-1;if(!g){if(g=r.get("SpecialContacts"),!angular.isArray(g.data))return void(g=!1);g=g.data,x(g)}for(c=0;c<g.length;c++)if(g[c][G.ID]===-666){b=angular.copy(g[c]);break}for(c=0;c<a.length;c++)if(a[c][G.ID]===-666){e=c;break}b&&e>=0?a[e]=b:d||a.push(b)}function B(a){for(var b=[],c=0;c<a.length;c++)a[c]&&b.push(a[c]);return b}function C(){return j.get("/contact",{params:{type:c,ver:2,addFake:1},transformResponse:function(a){return a&&a.data?(A(a.data),a.data=B(a.data),a.data=a.data.map(function(a){return a[G.IS_READONLY]=a[G.TYPE]==d||a[G.TYPE]==e,"undefined"==typeof a[G.SORT_NAME]&&(a[G.SORT_NAME]=q.getSortString(a[G.NAME])),a}),a.data=t(a.data),a.data.sort(D),H.resolve(a.data),r.put("Contact",{time:o.cacheTime,data:a.data}),h=!0):H.reject("Brak kontaktów"),a}})}function D(a,b){return a[G.SCORE]>b[G.SCORE]?-1:a[G.SCORE]<b[G.SCORE]?1:0}function E(a,b){return a[G.SORT_NAME]<b[G.SORT_NAME]?-1:a[G.SORT_NAME]>b[G.SORT_NAME]?1:0}var F=new m({url:"/next/contact-import",removeAfterUpload:!0,withCredentials:!0,headers:{"X-XSRF-TOKEN":o.env.uid,"X-Requested-With":"XMLHttpRequest"}}),G=o.ContactKeys,H=l.defer();return F.onAfterAddingFile=function(a){k.$broadcast("service:contacts:import:addfile",a.file)},C(),{CONTACT_TYPE_STANDARD:a,CONTACT_TYPE_AUTOINSERT:b,CONTACT_TYPE_ALL:c,CONTACT_TYPE_CORPORATE:d,CONTACT_TYPE_EMPLOYEE:e,CONTACT_TYPE_FAKE:f,EMAIL_TYPE_WORK:1,EMAIL_TYPE_BUSINESS:2,EMAIL_TYPE_OTHER:3,PHONE_TYPE_PRIVATE:0,PHONE_TYPE_BUSINESS:1,PHONE_TYPE_OTHER:2,EMPLOYEE_GROUP_ID:i,query:C,cachedQuery:function(){return H.promise},get:function(a){var b=this;return j.get("/contact/:id?type=:type",{params:a,transformResponse:function(a){return a.data&&(a.data.isReadonly=a.data.type==d||a.data.type==e,a.data.emails.length||a.data.emails.push({type:b.EMAIL_TYPE_OTHER,value:a.data.email})),a}})},search:function(a){return j.get("/contact",{transformResponse:function(b){return b.data&&(b.data=b.data.filter(function(b){return b.email===a}).pop(),b.data&&(b.data.isReadonly=b.data.type==d||b.data.type==e)),b}})},create:function(a){a=a||{};var b=this.createAvatar(a.email),d={name:a.name||"",score:a.score||0,emails:[],groups:[],phones:[],avatar:a.avatar||[b]};return a.id&&(d.id=a.id),a.email&&(d.email=a.email,d.emails.push({type:this.EMAIL_TYPE_OTHER,value:a.email})),d.sortName=q.getSortString(d.name),d.words=s(d.name,a.email),d.type=a.type||c,d},createFake:z,createAvatar:y,save:function(a){return j.post("/contact",a,{transformRequest:function(a){return void 0===a.id&&a.emails.length&&(a.email=a.emails[0].value,a.type=a.emails[0].type),a.name&&(a.sortName=q.getSortString(a.name)),a}}).success(function(b){void 0===a.id?(b.isNew=!0,b=angular.extend(a,b),n.success("service:contact:save",a),p.pushCode("contactActionAdd")):n.success("service:contact:edit")})},deleteContact:function(a){return j["delete"]("/contact",{ids:[a.id]}).success(function(){n.success("service:contact:delete",a)})},deleteContacts:function(a){return j["delete"]("/contact",a,{transformRequest:function(a){return a=a.map(function(a){return a.id}),{ids:a}}}).success(function(){n.success("service:contacts:delete")})},importContacts:function(){var a=l.defer(),b=a.promise;return b.success=function(a){return b.then(a),b},b.error=function(a){return b.then(null,a),b},F.onSuccessItem=function(b,c,d,e){c.status===!1?(n.error(c.msg),a.reject(c.msg)):(o.cacheTime=Date.now(),c.msg||(c.msg="service:contacts:import:succes"),n.success(c.msg,c.data),a.resolve(c.data))},F.uploadAll(),b},getContactDictionary:s,initDictionary:t,convertSpecialContactsToArrays:x,contactArraysToObjects:function(a){return a.map(v)},contactArrayToObject:v,contactObjectToArray:w,popularitySorter:D,alphabeticSorter:E,mapCompositionContacts:function(a,b){var c=a.to||[],d=a.cc||[],e=a.bcc||[];if(angular.isArray(c)||(c=[c]),a.from&&angular.isArray(a.from)&&(c=c.concat(a.from)),a.envelopeTo?(c=c.filter(function(b){return b.email!==a.envelopeTo}),d=d.filter(function(b){return b.email!==a.envelopeTo}),e=e.filter(function(b){return b.email!==a.envelopeTo})):c=c.filter(function(b){return b.email!==a.envelopeTo}),c=c.filter(function(a){return a.email!==b.email}),0===c.length&&a.from&&1===a.from.length){var f=b;"Ja"===a.from[0].name&&(f=a.from[0]),c.push(f)}return{to:c,cc:d,bcc:e}},countContacts:function(a){var b=0;return a&&(angular.isArray(a.to)&&(b+=a.to.length),angular.isArray(a.cc)&&(b+=a.cc.length),angular.isArray(a.bcc)&&(b+=a.bcc.length)),b},filterOutOwnContacts:function(a,b){var c=[];if(!angular.isArray(a)&&angular.isObject(a)&&(a=[a]),b&&b.length&&a&&a.length)for(var d=0;d<a.length;d++)b.indexOf(a[d].email.toLowerCase())!==-1||a[d].ommitInReply||c.push(a[d]);return c},getUplouder:function(){return F},getContactByGroup:function(a,b){return a.filter(function(a){return a[G.GROUPS].indexOf(b)!=-1})},isNotEmpty:function(a,b){for(var c=0;c<a.length;c++)if(a[c][G.GROUPS].indexOf(b)!=-1)return!0;return!1},isCachedQueryAlreadyResolved:function(){return h},isNotEmployeeFilter:function(a){return a[G.TYPE]===e&&a[G.GROUPS].indexOf(i)===-1&&a[G.GROUPS].push(i),a[G.TYPE]!==e}}}]}),angular.module("nxt-contact").provider("ContactGroup",function(){"use strict";this.$get=["$http","Contact",function(a,b){return{create:function(){return{id:-1,name:""}},query:function(){return a.get("/group",{transformResponse:function(a){return a&&a.data&&(a.data=a.data.map(function(a){return a.words=b.getContactDictionary(a.name),a})),a}})},save:function(b,c){b.id===-1&&delete b.id;var d=b.id?"put":"post";return a[d]("/group",b,{transformRequest:function(a){return a.cIds=c.map(function(a){return a.id}),a},transformResponse:function(a){return a&&a.data&&void 0===b.id&&(a.data=angular.extend(b,a.data),a.data.isNew=!0),a}})},"delete":function(b){return a["delete"]("/group",b)}}}]}),angular.module("nxt-crop").factory("CropArea",["CropCanvas",function(a){var b=function(b,c,d){this._ctx=b,this._events=c,this._minWidth=58,this._minHeight=40,this._cropCanvas=new a(b),this._image=new Image,this._x=0,this._y=0,this._wSize=0,this._hSize=0,this._aspectRadio=1};return b.prototype.getImage=function(){return this._image},b.prototype.setImage=function(a){this._image=a},b.prototype.getX=function(){return this._x},b.prototype.setX=function(a){this._x=a,this._dontDragOutside()},b.prototype.setAspectRadio=function(a){this._aspectRadio=a,this._dontDragOutside()},b.prototype.getY=function(){return this._y},b.prototype.setY=function(a){this._y=a,this._dontDragOutside()},b.prototype.getWidth=function(){return this._wSize},b.prototype.setWidth=function(a){this._wSize=Math.max(this._minWidth,a),this._dontDragOutside()},b.prototype.getHeight=function(){return this._hSize},b.prototype.setHeight=function(a){this._hSize=Math.max(this._minHeight,a),this._dontDragOutside()},b.prototype.getMinWidth=function(){return this._minWidth},b.prototype.setMinWidth=function(a){this._minWidth=a,this._wSize=Math.max(this._minWidth,this._wSize),this._dontDragOutside()},b.prototype.getMinHeight=function(){return this._minHeight},b.prototype.setMinHeight=function(a){this._minHeight=a,this._hSize=Math.max(this._minHeight,this._hSize),this._dontDragOutside()},b.prototype._dontDragOutside=function(){var a=this._ctx.canvas.height,b=this._ctx.canvas.width;this._wSize>b&&(this._wSize=b),this._hSize>a&&(this._hSize=a),this._x<this._wSize/2&&(this._x=this._wSize/2),this._x>b-this._wSize/2&&(this._x=b-this._wSize/2),this._y<this._hSize/2&&(this._y=this._hSize/2),this._y>a-this._hSize/2&&(this._y=a-this._hSize/2)},b.prototype._drawArea=function(){},b.prototype.draw=function(){this._cropCanvas.drawCropArea(this._image,[this._x,this._y],this._wSize,this._hSize,this._drawArea)},b.prototype.processMouseMove=function(){},b.prototype.processMouseDown=function(){},b.prototype.processMouseUp=function(){},b}]),angular.module("nxt-crop").factory("CropAreaSquare",["CropArea",function(a){"use strict";var b=function(b,c,d){a.apply(this,arguments),this._resizeCtrlBaseRadius=7,this._resizeCtrlNormalRatio=.6,this._resizeCtrlHoverRatio=2,this._iconMoveNormalRatio=.9,this._iconMoveHoverRatio=1.2,this._resizeCtrlNormalRadius=this._resizeCtrlBaseRadius*this._resizeCtrlNormalRatio,this._resizeCtrlHoverRadius=this._resizeCtrlBaseRadius*this._resizeCtrlHoverRatio,this._posDragStartX=0,this._posDragStartY=0,this._posResizeStartX=0,this._posResizeStartY=0,this._posResizeStartWidth=0,this._posResizeStartHeight=0,this._resizeCtrlIsHover=-1,this._areaIsHover=!1,this._resizeCtrlIsDragging=-1,this._areaIsDragging=!1};return b.prototype=new a,b.prototype._calcSquareCorners=function(){var a=this._wSize/2,b=this._hSize/2;return[[this._x-a,this._y-b],[this._x+a,this._y-b],[this._x-a,this._y+b],[this._x+a,this._y+b]]},b.prototype._calcSquareDimensions=function(){var a=this._wSize/2,b=this._hSize/2;return{left:this._x-a,top:this._y-b,right:this._x+a,bottom:this._y+b}},b.prototype._isCoordWithinArea=function(a){var b=this._calcSquareDimensions();return a[0]>=b.left&&a[0]<=b.right&&a[1]>=b.top&&a[1]<=b.bottom},b.prototype._isCoordWithinResizeCtrl=function(a){for(var b=this._calcSquareCorners(),c=-1,d=0,e=b.length;d<e;d++){var f=b[d];if(a[0]>f[0]-this._resizeCtrlHoverRadius&&a[0]<f[0]+this._resizeCtrlHoverRadius&&a[1]>f[1]-this._resizeCtrlHoverRadius&&a[1]<f[1]+this._resizeCtrlHoverRadius){c=d;break}}return c},b.prototype._drawArea=function(a,b,c,d){var e=d/2,f=c/2;a.rect(b[0]-f,b[1]-e,c,d)},b.prototype.draw=function(){a.prototype.draw.apply(this,arguments),this._cropCanvas.drawIconMove([this._x,this._y],this._areaIsHover?this._iconMoveHoverRatio:this._iconMoveNormalRatio);for(var b=this._calcSquareCorners(),c=0,d=b.length;c<d;c++){var e=b[c];this._cropCanvas.drawIconResizeCircle(e,this._resizeCtrlBaseRadius,this._resizeCtrlIsHover===c?this._resizeCtrlHoverRatio:this._resizeCtrlNormalRatio)}},b.prototype.processMouseMove=function(a,b){var c="default",d=!1;if(this._resizeCtrlIsHover=-1,this._areaIsHover=!1,this._areaIsDragging)this._x=a-this._posDragStartX,this._y=b-this._posDragStartY,this._areaIsHover=!0,c="move",d=!0,this._events.trigger("area-move");else if(this._resizeCtrlIsDragging>-1){var e,f;switch(this._resizeCtrlIsDragging){case 0:e=-1,f=-1,c="nwse-resize";break;case 1:e=1,f=-1,c="nesw-resize";break;case 2:e=-1,f=1,c="nesw-resize";break;case 3:e=1,f=1,c="nwse-resize"}var g=(a-this._posResizeStartX)*e,h=(b-this._posResizeStartY)*f,i=this._posResizeStartWidth+g,j=this._posResizeStartHeight+h;Math.abs(g)>Math.abs(h)?j=this._posResizeStartHeight+g/this._aspectRadio:i=this._posResizeStartWidth+h*this._aspectRadio;var k,l,m=this._ctx.canvas.height,n=this._ctx.canvas.width,o=this._wSize,p=this._hSize;n/m<this._aspectRadio?(this._wSize=Math.min(Math.max(this._minWidth,i),n),k=(this._wSize-o)/2,this._hSize=this._wSize/this._aspectRadio,l=(this._hSize-p)/2):(this._hSize=Math.min(Math.max(this._minHeight,j),m),l=(this._hSize-p)/2,this._wSize=this._hSize*this._aspectRadio,k=(this._wSize-o)/2),this._x+=k*e,this._y+=l*f,this._resizeCtrlIsHover=this._resizeCtrlIsDragging,d=!0,this._events.trigger("area-resize")}else{var q=this._isCoordWithinResizeCtrl([a,b]);if(q>-1){switch(q){case 0:c="nwse-resize";break;case 1:c="nesw-resize";break;case 2:c="nesw-resize";break;case 3:c="nwse-resize"}this._areaIsHover=!1,this._resizeCtrlIsHover=q,d=!0}else this._isCoordWithinArea([a,b])&&(c="move",this._areaIsHover=!0,d=!0)}return this._dontDragOutside(),angular.element(this._ctx.canvas).css({cursor:c}),d},b.prototype.processMouseDown=function(a,b){var c=this._isCoordWithinResizeCtrl([a,b]);c>-1?(this._areaIsDragging=!1,this._areaIsHover=!1,this._resizeCtrlIsDragging=c,this._resizeCtrlIsHover=c,this._posResizeStartX=a,this._posResizeStartY=b,this._posResizeStartWidth=this._wSize,this._posResizeStartHeight=this._hSize,this._events.trigger("area-resize-start")):this._isCoordWithinArea([a,b])&&(this._areaIsDragging=!0,this._areaIsHover=!0,this._resizeCtrlIsDragging=-1,this._resizeCtrlIsHover=-1,this._posDragStartX=a-this._x,this._posDragStartY=b-this._y,this._events.trigger("area-move-start"))},b.prototype.processMouseUp=function(){this._areaIsDragging&&(this._areaIsDragging=!1,this._events.trigger("area-move-end")),this._resizeCtrlIsDragging>-1&&(this._resizeCtrlIsDragging=-1,this._events.trigger("area-resize-end")),this._areaIsHover=!1,
this._resizeCtrlIsHover=-1,this._posDragStartX=0,this._posDragStartY=0},b}]),angular.module("nxt-crop").factory("CropCanvas",function(){"use strict";var a=[[-.5,-2],[-3,-4.5],[-.5,-7],[-7,-7],[-7,-.5],[-4.5,-3],[-2,-.5]],b=[[.5,-2],[3,-4.5],[.5,-7],[7,-7],[7,-.5],[4.5,-3],[2,-.5]],c=[[-.5,2],[-3,4.5],[-.5,7],[-7,7],[-7,.5],[-4.5,3],[-2,.5]],d=[[.5,2],[3,4.5],[.5,7],[7,7],[7,.5],[4.5,3],[2,.5]],e=[[-1.5,-2.5],[-1.5,-6],[-5,-6],[0,-11],[5,-6],[1.5,-6],[1.5,-2.5]],f=[[-2.5,-1.5],[-6,-1.5],[-6,-5],[-11,0],[-6,5],[-6,1.5],[-2.5,1.5]],g=[[-1.5,2.5],[-1.5,6],[-5,6],[0,11],[5,6],[1.5,6],[1.5,2.5]],h=[[2.5,-1.5],[6,-1.5],[6,-5],[11,0],[6,5],[6,1.5],[2.5,1.5]],i={areaOutline:"#fff",resizeBoxStroke:"#fff",resizeBoxFill:"#444",resizeBoxArrowFill:"#fff",resizeCircleStroke:"#fff",resizeCircleFill:"#444",moveIconFill:"#fff"};return function(j){var k=function(a,b,c){return[c*a[0]+b[0],c*a[1]+b[1]]},l=function(a,b,c,d){j.save(),j.fillStyle=b,j.beginPath();var e,f=k(a[0],c,d);j.moveTo(f[0],f[1]);for(var g in a)g>0&&(e=k(a[g],c,d),j.lineTo(e[0],e[1]));j.lineTo(f[0],f[1]),j.fill(),j.closePath(),j.restore()};this.drawIconMove=function(a,b){l(e,i.moveIconFill,a,b),l(f,i.moveIconFill,a,b),l(g,i.moveIconFill,a,b),l(h,i.moveIconFill,a,b)},this.drawIconResizeCircle=function(a,b,c){var d=b*c;j.save(),j.strokeStyle=i.resizeCircleStroke,j.lineWidth=2,j.fillStyle=i.resizeCircleFill,j.beginPath(),j.arc(a[0],a[1],d,0,2*Math.PI),j.fill(),j.stroke(),j.closePath(),j.restore()},this.drawIconResizeBoxBase=function(a,b,c){var d=b*c;j.save(),j.strokeStyle=i.resizeBoxStroke,j.lineWidth=2,j.fillStyle=i.resizeBoxFill,j.fillRect(a[0]-d/2,a[1]-d/2,d,d),j.strokeRect(a[0]-d/2,a[1]-d/2,d,d),j.restore()},this.drawIconResizeBoxNESW=function(a,d,e){this.drawIconResizeBoxBase(a,d,e),l(b,i.resizeBoxArrowFill,a,e),l(c,i.resizeBoxArrowFill,a,e)},this.drawIconResizeBoxNWSE=function(b,c,e){this.drawIconResizeBoxBase(b,c,e),l(a,i.resizeBoxArrowFill,b,e),l(d,i.resizeBoxArrowFill,b,e)},this.drawCropArea=function(a,b,c,d,e){var f=a.width/j.canvas.width,g=a.height/j.canvas.height,h=b[0]-c/2,k=b[1]-d/2;j.save(),j.strokeStyle=i.areaOutline,j.lineWidth=2,j.beginPath(),e(j,b,c,d),j.stroke(),j.clip(),c>0&&d>0&&j.drawImage(a,h*f,k*g,c*f,d*g,h,k,c,d),j.beginPath(),e(j,b,c,d),j.stroke(),j.clip(),j.restore()}}}),angular.module("nxt-crop").service("CropEXIF",function(){"use strict";function a(a){return!!a.exifdata}function b(a,b){b=b||a.match(/^data\:([^\;]+)\;base64,/im)[1]||"",a=a.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var c=atob(a),d=c.length,e=new ArrayBuffer(d),f=new Uint8Array(e),g=0;g<d;g++)f[g]=c.charCodeAt(g);return e}function c(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="blob",c.onload=function(a){200!=this.status&&0!==this.status||b(this.response)},c.send()}function d(a,d){function g(b){var c=e(b),g=f(b);a.exifdata=c||{},a.iptcdata=g||{},d&&d.call(a)}var h;if(a.src)if(/^data\:/i.test(a.src)){var i=b(a.src);g(i)}else if(/^blob\:/i.test(a.src))h=new FileReader,h.onload=function(a){g(a.target.result)},c(a.src,function(a){h.readAsArrayBuffer(a)});else{var j=new XMLHttpRequest;j.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";g(j.response),j=null},j.open("GET",a.src,!0),j.responseType="arraybuffer",j.send(null)}else window.FileReader&&(a instanceof window.Blob||a instanceof window.File)&&(h=new FileReader,h.onload=function(a){l&&console.log("Got file of length "+a.target.result.byteLength),g(a.target.result)},h.readAsArrayBuffer(a))}function e(a){var b=new DataView(a);if(l&&console.log("Got file of length "+a.byteLength),255!=b.getUint8(0)||216!=b.getUint8(1))return l&&console.log("Not a valid JPEG"),!1;for(var c,d=2,e=a.byteLength;d<e;){if(255!=b.getUint8(d))return l&&console.log("Not a valid marker at offset "+d+", found: "+b.getUint8(d)),!1;if(c=b.getUint8(d+1),l&&console.log(c),225==c)return l&&console.log("Found 0xFFE1 marker"),k(b,d+4,b.getUint16(d+2)-2);d+=2+b.getUint16(d+2)}}function f(a){var b=new DataView(a);if(l&&console.log("Got file of length "+a.byteLength),255!=b.getUint8(0)||216!=b.getUint8(1))return l&&console.log("Not a valid JPEG"),!1;for(var c=2,d=a.byteLength,e=function(a,b){return 56===a.getUint8(b)&&66===a.getUint8(b+1)&&73===a.getUint8(b+2)&&77===a.getUint8(b+3)&&4===a.getUint8(b+4)&&4===a.getUint8(b+5)};c<d;){if(e(b,c)){var f=b.getUint8(c+7);f%2!==0&&(f+=1),0===f&&(f=4);var h=c+8+f,i=b.getUint16(c+6+f);return g(a,h,i)}c++}}function g(a,b,c){for(var d,e,f,g,h,i=new DataView(a),k={},l=b;l<b+c;)28===i.getUint8(l)&&2===i.getUint8(l+1)&&(g=i.getUint8(l+2),g in q&&(f=i.getInt16(l+3),h=f+5,e=q[g],d=j(i,l+5,f),k.hasOwnProperty(e)?k[e]instanceof Array?k[e].push(d):k[e]=[k[e],d]:k[e]=d)),l++;return k}function h(a,b,c,d,e){var f,g,h,j=a.getUint16(c,!e),k={};for(h=0;h<j;h++)f=c+12*h+2,g=d[a.getUint16(f,!e)],!g&&l&&console.log("Unknown tag: "+a.getUint16(f,!e)),k[g]=i(a,f,b,c,e);return k}function i(a,b,c,d,e){var f,g,h,i,k,l,m,n=a.getUint16(b+2,!e),o=a.getUint32(b+4,!e),p=a.getUint32(b+8,!e)+c;switch(n){case 1:case 7:if(1==o)m=a.getUint8(b+8,!e);else{for(f=o>4?p:b+8,g=[],i=0;i<o;i++)g[i]=a.getUint8(f+i);m=g}break;case 2:f=o>4?p:b+8,m=j(a,f,o-1);break;case 3:if(1==o)m=a.getUint16(b+8,!e);else{for(f=o>2?p:b+8,g=[],i=0;i<o;i++)g[i]=a.getUint16(f+2*i,!e);m=g}break;case 4:if(1==o)m=a.getUint32(b+8,!e);else{for(g=[],i=0;i<o;i++)g[i]=a.getUint32(p+4*i,!e);m=g}break;case 5:if(1==o)k=a.getUint32(p,!e),l=a.getUint32(p+4,!e),h=Number(k/l),h.numerator=k,h.denominator=l,m=h;else{for(g=[],i=0;i<o;i++)k=a.getUint32(p+8*i,!e),l=a.getUint32(p+4+8*i,!e),g[i]=Number(k/l),g[i].numerator=k,g[i].denominator=l;m=g}break;case 9:if(1==o)m=a.getInt32(b+8,!e);else{for(g=[],i=0;i<o;i++)g[i]=a.getInt32(p+4*i,!e);m=g}break;case 10:if(1==o)m=a.getInt32(p,!e)/a.getInt32(p+4,!e);else{for(g=[],i=0;i<o;i++)g[i]=a.getInt32(p+8*i,!e)/a.getInt32(p+4+8*i,!e);m=g}}}function j(a,b,c){for(var d="",e=b;e<b+c;e++)d+=String.fromCharCode(a.getUint8(e));return d}function k(a,b){if("Exif"!=j(a,b,4))return l&&console.log("Not valid EXIF data! "+j(a,b,4)),!1;var c,d,e,f,g,i=b+6;if(18761==a.getUint16(i))c=!1;else{if(19789!=a.getUint16(i))return l&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;c=!0}if(42!=a.getUint16(i+2,!c))return l&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var k=a.getUint32(i+4,!c);if(k<8)return l&&console.log("Not valid TIFF data! (First offset less than 8)",a.getUint32(i+4,!c)),!1;if(d=h(a,i,i+k,n,c),d.ExifIFDPointer){f=h(a,i,i+d.ExifIFDPointer,m,c);for(e in f){switch(e){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":f[e]=p[e][f[e]];break;case"ExifVersion":case"FlashpixVersion":f[e]=String.fromCharCode(f[e][0],f[e][1],f[e][2],f[e][3]);break;case"ComponentsConfiguration":f[e]=p.Components[f[e][0]]+p.Components[f[e][1]]+p.Components[f[e][2]]+p.Components[f[e][3]]}d[e]=f[e]}}if(d.GPSInfoIFDPointer){g=h(a,i,i+d.GPSInfoIFDPointer,o,c);for(e in g){switch(e){case"GPSVersionID":g[e]=g[e][0]+"."+g[e][1]+"."+g[e][2]+"."+g[e][3]}d[e]=g[e]}}return d}var l=!1,m=this.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},n=this.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},o=this.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},p=this.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},q={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};this.getData=function(b,c){return!((b instanceof Image||b instanceof HTMLImageElement)&&!b.complete)&&(a(b)?c&&c.call(b):d(b,c),!0)},this.getTag=function(b,c){if(a(b))return b.exifdata[c]},this.getAllTags=function(b){if(!a(b))return{};var c,d=b.exifdata,e={};for(c in d)d.hasOwnProperty(c)&&(e[c]=d[c]);return e},this.pretty=function(b){if(!a(b))return"";var c,d=b.exifdata,e="";for(c in d)d.hasOwnProperty(c)&&(e+="object"==typeof d[c]?d[c]instanceof Number?c+" : "+d[c]+" ["+d[c].numerator+"/"+d[c].denominator+"]\r\n":c+" : ["+d[c].length+" values]\r\n":c+" : "+d[c]+"\r\n");return e},this.readFromBinaryFile=function(a){return e(a)}}),angular.module("nxt-crop").factory("CropHost",["$document","CropAreaSquare","CropEXIF",function(a,b,c){"use strict";var d=function(a){var b=a.getBoundingClientRect(),c=document.body,d=document.documentElement,e=window.pageYOffset||d.scrollTop||c.scrollTop,f=window.pageXOffset||d.scrollLeft||c.scrollLeft,g=d.clientTop||c.clientTop||0,h=d.clientLeft||c.clientLeft||0,i=b.top+e-g,j=b.left+f-h;return{top:Math.round(i),left:Math.round(j)}};return function(e,f,g,h){function i(){t.clearRect(0,0,t.canvas.width,t.canvas.height),null!==u&&(t.drawImage(u,0,0,t.canvas.width,t.canvas.height),t.save(),t.fillStyle="rgba(0, 0, 0, 0.65)",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.restore(),v.draw())}var j=h.cropX,k=h.cropY,l=h.cropWidth,m=h.cropHeight;h.cropAspectRatio=l/m;var n,o=h.resultImageWidth,p=h.resultImageHeight,q=h.cropDataInPercentage,r=h.cropResetWrapperSelector,s=r?a[0].querySelector(r):null,t=null,u=null,v=null,w=[50,50],x=[500,500],y=o,z=p,A=j,B=l,C=k,D=m,E=h.cropAspectRatio,F=0,G="image/png",H=null,I=function(){if(null!==u){v.setImage(u);var a=[u.width,u.height],b=u.width/u.height,c=a;c[0]>x[0]?(c[0]=x[0],c[1]=c[0]/b):c[0]<w[0]&&(c[0]=w[0],c[1]=c[0]/b),c[1]>x[1]?(c[1]=x[1],c[0]=c[1]*b):c[1]<w[1]&&(c[1]=w[1],c[0]=c[1]*b),e.prop("width",c[0]).prop("height",c[1]).css({"margin-left":-c[0]/2+"px","margin-top":-c[1]/2+"px"});var d=A,f=B,g=C,j=D;q&&(d=A/1e3*u.width,f=B/1e3*u.width,g=C/1e3*u.height,j=D/1e3*u.height);var k=void 0===A||void 0===B||void 0===C||void 0===D;if(F>1||k){var l=y,m=z,n=y/z,o=u.width/u.height;o>n?(m=u.height-30,l=m*n):(l=u.width-30,m=l/n),(l<20||m<20)&&(l=1.25*y,m=1.25*z),d=u.width/2-l/2,f=l,g=u.height/2-m/2,j=m}E=h.cropAspectRatio=q?f/j:E,v.setX(0),v.setY(0),v.setWidth(0),v.setHeight(0),v.setAspectRadio(E),v.setX(d+f/2||t.canvas.width/2),v.setY(g+j/2||t.canvas.height/2),t.canvas.width/t.canvas.height<E?(v.setWidth(Math.min(f,t.canvas.width)),v.setHeight(v.getWidth()/E)):(v.setHeight(Math.min(j,t.canvas.height)),v.setWidth(v.getHeight()*E))}else e.prop("width",0).prop("height",0).css({"margin-top":0});i()},J=function(a){return angular.isDefined(a.changedTouches)?a.changedTouches:a.originalEvent.changedTouches},K=function(a){if(null!==u){var b,c,e=d(t.canvas);if("touchmove"===a.type?(b=J(a)[0].pageX,c=J(a)[0].pageY):(b=a.pageX,c=a.pageY),v.processMouseMove(b-e.left,c-e.top),s){var f=s.getBoundingClientRect().left,g=s.getBoundingClientRect().top,h=s.getBoundingClientRect().width,j=s.getBoundingClientRect().height;(b<f||c<g||b>f+h||c>g+j)&&M(a)}i()}},L=function(a){if(a.preventDefault(),a.stopPropagation(),null!==u){var b,c,e=d(t.canvas);"touchstart"===a.type?(b=J(a)[0].pageX,c=J(a)[0].pageY):(b=a.pageX,c=a.pageY),v.processMouseDown(b-e.left,c-e.top),i()}},M=function(a){if(null!==u){var b,c,e=d(t.canvas);"touchend"===a.type?(b=J(a)[0].pageX,c=J(a)[0].pageY):(b=a.pageX,c=a.pageY),v.processMouseUp(b-e.left,c-e.top),i()}};this.getResultImageDataURI=function(){var a,b;return b=angular.element("<canvas></canvas>")[0],a=b.getContext("2d"),b.width=y,b.height=z,null!==u&&a.drawImage(u,(v.getX()-v.getWidth()/2)*(u.width/t.canvas.width),(v.getY()-v.getHeight()/2)*(u.height/t.canvas.height),v.getWidth()*(u.width/t.canvas.width),v.getHeight()*(u.height/t.canvas.height),0,0,y,z),null!==H?b.toDataURL(G,H):b.toDataURL(G)},this.getCropData=function(){if(null===u)return{x:0,y:0,width:10,height:10};var a=v.getX()-v.getWidth()/2,b=u.width/t.canvas.width,c=v.getWidth(),d=v.getY()-v.getHeight()/2,e=u.height/t.canvas.height,f=v.getHeight(),g=1e3;return{x:q?~~(a/u.width*g):a*b,y:q?~~(d/u.height*g):d*e,width:q?~~(c/u.width*g):c*b,height:q?~~(f/u.height*g):f*e}},this.setNewImageSource=function(a){if(u=null,I(),g.trigger("image-updated"),a){var b=new Image,d=a.split("|");a=d[0];var e=d[1];e!==n&&F++,n=e,b.crossOrigin="anonymous",b.onload=function(){g.trigger("load-done"),c.getData(b,function(){var a=c.getTag(b,"Orientation");if([3,6,8].indexOf(a)>-1){var d=document.createElement("canvas"),e=d.getContext("2d"),f=b.width,h=b.height,i=0,j=0,k=0;switch(a){case 3:i=-b.width,j=-b.height,k=180;break;case 6:f=b.height,h=b.width,j=-b.height,k=90;break;case 8:f=b.height,h=b.width,i=-b.width,k=270}d.width=f,d.height=h,e.rotate(k*Math.PI/180),e.drawImage(b,i,j),u=new Image,u.src=d.toDataURL("image/png")}else u=b;I(),g.trigger("image-updated")})},b.onerror=function(){g.trigger("load-error")},g.trigger("load-start"),b.src=a}},this.setMaxDimensions=function(a,b){if(x=[a,b],null!==u){var c=t.canvas.width,d=t.canvas.height,f=[u.width,u.height],g=u.width/u.height,h=f;h[0]>x[0]?(h[0]=x[0],h[1]=h[0]/g):h[0]<w[0]&&(h[0]=w[0],h[1]=h[0]/g),h[1]>x[1]?(h[1]=x[1],h[0]=h[1]*g):h[1]<w[1]&&(h[1]=w[1],h[0]=h[1]*g),e.prop("width",h[0]).prop("height",h[1]).css({"margin-left":-h[0]/2+"px","margin-top":-h[1]/2+"px"});var j=t.canvas.width/c,k=t.canvas.height/d;Math.min(j,k)}else e.prop("width",0).prop("height",0).css({"margin-top":0});i()},this.setResultImageSize=function(a,b){a=parseInt(a,10),b=parseInt(b,10),isNaN(a)||(y=a),isNaN(b)||(z=b)},this.setResultImageFormat=function(a){G=a},this.setResultImageQuality=function(a){a=parseFloat(a),!isNaN(a)&&a>=0&&a<=1&&(H=a)},this.setAreaType=function(a){var c=v.getWidth(),d=v.getHeight(),e=v.getMinWidth(),f=v.getMinHeight(),j=v.getX(),k=v.getY(),l=b;v=new l(t,g,h),v.setMinWidth(e),v.setMinHeight(f),v.setWidth(c),v.setHeight(d),v.setX(j),v.setY(k),null!==u&&v.setImage(u),i()},t=e[0].getContext("2d"),v=new b(t,g,h),a.on("mousemove",K),e.on("mousedown",L),a.on("mouseup",M),a.on("touchmove",K),e.on("touchstart",L),a.on("touchend",M),this.destroy=function(){a.off("mousemove",K),e.off("mousedown",L),a.off("mouseup",K),a.off("touchmove",K),e.off("touchstart",L),a.off("touchend",K),e.remove()}}}]),angular.module("nxt-crop").factory("CropPubSub",function(){"use strict";return function(){var a={};this.on=function(b,c){return b.split(" ").forEach(function(b){a[b]||(a[b]=[]),a[b].push(c)}),this},this.trigger=function(b,c){return angular.forEach(a[b],function(a){a.call(null,c)}),this}}}),angular.module("nxt-dialog").service("DialogManager",["$rootScope","$location","ApplicationConfig","$timeout","$http","Track","MarketingData","Security","Notification",function(a,b,c,d,e,f,g,h,i){function j(a){return a.message=a.message||"",a.callback=a.callback||function(){},a.callbackCancel=a.callbackCancel||function(){},a.callbackClose=a.callbackClose||function(){},a.callbackMaximize=a.callbackMaximize||function(){},a.callbackMinimize=a.callbackMinimize||function(){},a.isModal=void 0===a.isModal||a.isModal,a.isMovable=!1,a.isMinimizable=!1,a.isMaximizable=!1,a}var k=0,l={},m=this;this.DialogTypes={COMPOSITION:{name:"composition",limit:5},OTHER:{name:"other",limit:100},CONFIRM:{name:"confirm",limit:100},SESSION_EXPIRED:{name:"session-expired",limit:1},USER_THEME:{name:"user-theme",limit:1,forceId:1e4},SPECIAL_BOARD:{name:"special-board",limit:1,forceId:10001}},this.add=function(b){if(b.compositionConfig&&b.compositionConfig.singleInstanceId&&!c.env.device.isMobile)for(var d in l)if(l.hasOwnProperty(d)&&l[d].compositionConfig&&l[d].compositionConfig.singleInstanceId&&l[d].compositionConfig.singleInstanceId===b.compositionConfig.singleInstanceId)return void a.$broadcast("dialog:blink",d);var e=b.compositionConfig,f=b.title,g=b.message||"Komunikat",h=b.template||"/dialog/views/dialog_default.html",i=b.dialogType||this.DialogTypes.OTHER,j=i.forceId||b.forceId||i.name+"_"+ ++k,m=0,n=i.limit;for(var o in l)l.hasOwnProperty(o)&&l[o].dialogType===i&&m++;m>=n||(l[j]={id:j,title:f,template:h,dialogType:i,message:g,callback:b.callback,success:b.success,callbackCancel:b.callbackCancel||function(){},callbackClose:b.callbackClose||function(){},callbackMaximize:b.callbackMaximize||function(){},callbackMinimize:b.callbackMinimize||function(){},confirm:b.confirm||"OK",isModal:void 0!==b.isModal&&b.isModal,isMinimizable:void 0===b.isMinimizable||b.isMinimizable,isMaximizable:void 0===b.isMaximizable||b.isMaximizable,isMovable:void 0===b.isMovable||b.isMovable,isClosable:void 0===b.isClosable||b.isClosable,isHeaderVisible:void 0!==b.isHeaderVisible&&b.isHeaderVisible,compositionConfig:e,folders:b.folders||[],additionalData:b.additionalData||{},isHeaderHidden:b.isHeaderHidden,additionalClasses:b.additionalClasses,boards:b.boards||{}})},this.confirm=function(a){a=j(a),a.message=a.message||"Czy na pewno?",a.dialogType=this.DialogTypes.CONFIRM,a.template=a.template||"/dialog/views/dialog_confirm.html",a.additionalData=a.additionalData||{},this.add(a)},this.folderConfirm=function(a){a=j(a),a.message=a.message||"Czy na pewno?",a.dialogType=this.DialogTypes.OTHER,a.template="/dialog/views/dialog_folder_confirm.html",this.add(a)},this.info=function(a){a=j(a),a.dialogType=this.DialogTypes.OTHER,a.template="/dialog/views/dialog_info.html",a.isClosable=!1,this.add(a)},this.mobileCalendar=function(b){b=j(b),b.dialogType=this.DialogTypes.OTHER,b.template="/dialog/views/dialog_mobile_calendar.html",b.additionalClasses="mobile-calendar",b.isClosable=!1,b.isHeaderHidden=!0,this.add(b),d(function(){a.$digest()},0,!1)},this.infoBoard=function(a){a=j(a),a.template=a.template?a.template:"/dialog/views/dialog_info_board.html",a.dialogType=this.DialogTypes.OTHER,a.additionalClasses="board"+(a.additionalClass?" "+a.additionalClass:""),a.isClosable=!1,this.add(a),a.callback&&a.callback()},this.userTheme=function(b){b=j(b),b.dialogType=this.DialogTypes.USER_THEME,b.template="/dialog/views/dialog_user_themes.html",b.additionalClasses="user-themes",b.isClosable=!0,b.isMinimizable=!0,b.isHeaderHidden=!c.env.device.isPc,b.isModal=!1,b.isHeaderVisible=!0,this.add(b),d(function(){a.$digest()},0,!1)},this.dataSecurity=function(b){b=j(b),b.title="Bezpieczna poczta",b.dialogType=this.DialogTypes.SPECIAL_BOARD,b.template="/dialog/views/dialog_data_security.html",b.additionalClasses="data-security",b.isClosable=!!c.env.device.isMobile,b.isHeaderHidden=c.env.device.isPc,b.additionalData={saveSpec:function(b,c){h.setSecurityData({newMail:c,mobilePhone:b}).success(function(b){1==b.status?(i.success("security:saved-success"),a.$broadcast("directive:dialog:close-composition")):i.error(b.msg)}),f.pushGemius(".W070GthFNmvfIkKcUlcT6Q9fQuGPYc0WTqYYqi1b8v.z7")},validate:function(a,b){return void 0!==a&&void 0!==b&&!a.length&&!b.length},phonePattern:c.patterns.phone,emailPattern:c.patterns.email},b.callbackCancel=function(){f.pushGemius(".W2VVGthySxZTKCF8TbQwaSdHQKGLccDueJIEMgIv9T.t7")},f.pushGemius("Bx01NOO4uSrOJ3BPbLkQLZaEHQIppccD3qpIEIdCZzv.77"),h.getSecurityData().success(function(a){a.data&&(b.additionalData.tel=a.data.mobilePhone,b.additionalData.mail=a.data.recoveryMail)}),this.add(b)},this.adultPermission=function(b){b=j(b),b.title="Zgoda na treści dla pełnoletnich",b.dialogType=this.DialogTypes.SPECIAL_BOARD,b.template="/dialog/views/dialog_adult_permission.html",b.additionalClasses="adult-permission",b.isClosable=!1,b.isHeaderHidden=c.env.device.isPc,b.additionalData={save:function(b){return!b||b.no===!1&&b.yes===!1?void i.error("marketingData:validate-error"):(b.yes===!0?(b=1,f.pushIWA(["Plansza","Pelnoletni","klik","tak"])):(b=0,f.pushIWA(["Plansza","Pelnoletni","klik","nie"])),void g.updateAgreementData({adultAgreement:b,withCredentials:!1}).success(function(b){1==b.status?(i.success("marketingData:saved-success"),a.$broadcast("directive:dialog:close-composition"),e.put("/infoBoard",{id:203,state:1,sValue:1}).success(function(a){})):i.error(b.msg)}))}},this.add(b),f.pushIWA(["Plansza","Pelnoletni","view","-"])},this.popTrashBar=function(a){a=j(a),a.template="/dialog/views/dialog_pop_trash.html",a.isModal=!1,a.isHeaderHidden=!0,a.additionalData=a.additionalData||{},a.additionalClasses="dialog-popTrash",this.add(a)},this.voucheInfo=function(a){a=j(a),a.dialogType=this.DialogTypes.OTHER,a.template="/dialog/views/dialog_voucher_info.html",a.isHeaderHidden=!c.env.device.isMobile,this.add(a)},this.sessionExpiredDialog=function(a){if(NXT_CONFIG.env.isMobileApp)try{NXT_CONFIG.env.device.isIOS?window.webkit.messageHandlers.sessionExpired.postMessage("sessionExpired"):MobileAppConnector.sessionExpired()}catch(d){console.log("Only to use in mobileApp - sessionExpired")}else f.pushIWA(["plansza","wygasla_sesja","view","-"]),a=j(a),a.dialogType=this.DialogTypes.SESSION_EXPIRED,a.template="/dialog/views/dialog_session_expired.html",a.isClosable=!1,a.isHeaderHidden=!0,a.additionalClasses="session-expired force-css-center",a.additionalData={loginUrl:c.env.loginUrl,ownEmail:c.env.ownEmail,loginReferer:b.protocol()+"://"+b.host()+"/next/framelogin",loginFailedReferer:b.protocol()+"://"+b.host()+"/next/frameloginfailed",formTarget:"loginFrame",fromHTTP:"http"===b.protocol()},a.additionalData.onLogin=function(){a.additionalData.ownEmail!==c.env.ownEmail&&(a.additionalData.formTarget="",a.additionalData.loginReferer=a.additionalData.loginFailedReferer=b.protocol()+"://"+b.host())},this.add(a)},this.multiBoards=function(a){a=j(a),a.dialogType=this.DialogTypes.SPECIAL_BOARD,a.isHeaderHidden=!0,a.additionalClasses="multi-board",a.template="/dialog/views/multiBoards/dialog_multiBoard_template.html",this.add(a)},a.$on("http:response:error:sessionExpired",function(){m.sessionExpiredDialog({message:"Sesja wygasła"})}),this.confirmFolderFreeze=function(a,b){this.confirm({message:"Operacja, którą chcesz wykonać może chwilę potrwać.",callback:a,callbackCancel:b,callbackClose:b})},this.remove=function(a){delete l[a]},this.removeUserTheme=function(){delete l[this.DialogTypes.USER_THEME.forceId]},this.getList=function(){return l},this.isCompositionOpen=function(){var a=0;for(var b in l)l[b].dialogType&&"composition"===l[b].dialogType.name&&a++;return!!a}}]),angular.module("nxt-external-account").provider("ExternalAccount",function(){"use strict";this.$get=["$http","$rootScope","Notification","ApplicationConfig",function(a,b,c,d){function e(a){return a=a||"",f(a)?a.substring(a.indexOf("@")+1,a.lastIndexOf(".")):j}function f(a){return i=d.aliasDomains,d.env.adminBusinessPackType==d.ADMIN_BUSINESS_TYPE.ADMIN?"hub.pl"==g(a)?i.indexOf(h(a))===-1:i.indexOf(g(a))===-1:d.env.adminBusinessPackType==d.ADMIN_BUSINESS_TYPE.SUBACCOUNT||(d.env.isCorp?i.indexOf(g(a))===-1:i.indexOf(h(a))===-1)}function g(a){return a=a||"",a.substr(a.indexOf("@")+1).toLowerCase()}function h(a){var b=g(a),c=b.split(".");return c.length>2&&(b=c[c.length-2]+"."+c[c.length-1]),b}var i=d.aliasDomains;0===d.prefs.defaultAccount&&(d.prefs.defaultAccount=d.env.ownEmail);var j=d.env.service?d.env.service.name:"interia";return{query:function(c,f){var g=f?{id:c||d.folders.INBOX,time:(new Date).getTime()}:{id:c||d.folders.INBOX};return a.get("/extacclist/:id",{params:g,transformResponse:function(a){if(a&&a.data){var b=0;a.data=a.data.map(function(a){return a.service=e(a.email),a.unread=a.totalMsg-a.readMsg,a.defaultSent=a.email==d.prefs.defaultAccount,"alias"===a.type?a.isAlias=!0:a.isAlias=!1,"0"===a.allowSend&&(b=1),a}),d.env.hasErrorInExternalAccounts=b}return a}}).success(function(a){b.$broadcast("external-account:service:query",a)})},getDomain:g,getMainDomain:h,isExternalDomain:f,getService:e,isAlias:function(b){return a.get("/extacc",{transformResponse:function(a){return!!a.data&&a.data.some(function(a){return a.email==b&&"alias"==a.type})}})},isExternalAccount:function(b){return a.get("/extacc",{transformResponse:function(a){return!(!a||!a.data)&&a.data.some(function(a){return a.email==b&&"account"==a.type})}})},checkAliasAvailability:function(c){return a.get("/extacc/checkAlias",{params:{email:c},transformResponse:function(a){return a&&a.data&&(a.data=a.data.map(function(a){return a.email=a.login+"@"+a.domain,a})),a}}).success(function(a){b.$broadcast("external-account:service:checkAvailability",a)})},get:function(c){return a.get("/extacc/:id",{params:c,transformResponse:function(a){return a&&a.data&&"alias"==a.data.type&&(a.data.id=a.data.id*-1),a}}).success(function(a){b.$broadcast("external-account:service:get",a)})},saveAlias:function(b,e){var f=b.isAlias?"put":"post";return b.method="alias",a[f]("/extacc",b).success(function(a){"1"==b.defaultSent?d.prefs.defaultAccount=b.email:b.email==d.prefs.defaultAccount&&(d.prefs.defaultAccount=d.env.ownEmail),c.success(e?e:"external-account:service:save",a)})},saveAccount:function(b,e){var f=b.id?"put":"post";return a[f]("/extacc",b).success(function(a){"1"==b.defaultSent?d.prefs.defaultAccount=b.email:b.email==d.prefs.defaultAccount&&(d.prefs.defaultAccount=d.env.ownEmail),c.success(e?e:"external-account:service:save",a)})},deleteAlias:function(b){return a["delete"]("/extacc",{email:b,method:"alias"}).success(function(a){c.success("external-account:service:deleteAlias",a)})},deleteAccount:function(b,d){var e={id:b};return d&&(e.deleteMessages=1),a["delete"]("/extacc",e).success(function(a){c.success("external-account:service:deleteAccount",a)})},sendConfirmationMail:function(b){return a.post("/extacc",{id:b,method:"confirmation"}).success(function(a){c.success("external-account:service:sendConfirmMail",a)})},settings:function(c){return a.get("/extacc/settings",{params:{email:c}}).success(function(a){b.$broadcast("external-account:service:settings",a)})},getInteriaDomains:function(){return a.post(d.env.pocztaApiUrl+"/v1/account/getDomains",{serviceId:d.env.service.id,sid:d.env.sid,uid:d.env.uid})}}}]}),angular.module("nxt-filter").provider("Blacklist",function(){"use strict";var a=1,b=2;this.$get=["$http",function(c){return{query:function(){return c.get("/bwlist")},search:function(a){return c.get("/bwlist",{transformResponse:function(b){return b&&b.data&&(b.data=b.data.filter(function(b){return b===a}).pop()),b}})},addToBlacklist:function(a){return c.post("/bwlist",{email:a.email,color:b})},removeFromBlacklist:function(a){return c["delete"]("/bwlist",{email:a.email,color:b})},addToWhitelist:function(b){return c.post("/bwlist",{email:b.email,color:a})}}}]}),angular.module("nxt-filter").provider("QuickFilter",function(){"use strict";this.$get=["$http","Notification",function(a,b){return{get:function(){return a.get("/quickfilter",{transformResponse:function(a){return a&&a.data&&(a.data=a.data.filters),a}})},create:function(c){return a.post("/quickfilter",c).success(function(a){a.filterId?b.success("filtr:service:quickCreate",a):b.success("filtr:service:quickUpdate",a)})}}}]}),angular.module("nxt-folder").provider("Attachments",function(){"use strict";this.$get=["$http","$rootScope","$q","$state","ApplicationConfig",function(a,b,c,d,e){return{openAtt:function(a,b){"eml"==b.extension?(d.go("messageEml",{messageId:b.mid,mpid:b.mpid}),a.preventDefault(),a.stopPropagation()):"pdf"==b.extension?e.hacks.isAndroid&&!e.env.isMobileApp||e.hacks.isIOS&&e.env.isMobileApp?window.location.href=b.urlDownload:(e.hacks.isAndroid||e.hacks.isIOS)&&window.open(b.url):e.hacks.isAndroid&&!e.env.isMobileApp||e.hacks.isIOS&&e.env.isMobileApp?window.location.href=b.urlDownload:(e.hacks.isAndroid||e.hacks.isIOS)&&(e.env.isMobileApp&&e.hacks.isAndroid&&!e.env.appSupportedOpenFiles?window.open(b.urlDownload):window.open(b.url));
}}}]}),angular.module("nxt-folder").provider("Folder",function(){"use strict";function a(b,c){var d,e=[];for(d=0;d<b.length;d++)e.push({name:c+b[d].name,id:b[d].id}),b[d].subfolders&&(e=e.concat(a(b[d].subfolders,"_"+c)));return e}var b;this.$get=["$stateParams","$http","$rootScope","Notification","ApplicationConfig","Track","ApplicationData","Bugtracker",function(c,d,e,f,g,h,i,j){function k(a){return a.isInbox=a.id===g.folders.INBOX,a.isSent=a.id===g.folders.SENT,a.isDrafts=a.id===g.folders.DRAFTS,a.isTrash=a.id===g.folders.TRASH,a.isSpam=a.id===g.folders.SPAM,a}return{query:function(){return d.get("/folder",{transformResponse:function(a){return a&&a.data&&(a.data=a.data.map(function(a){return a.id==b&&(a.unseen=0),a})),a}})},queryAsMap:function(){return d.get("/folder",{transformResponse:function(a){if(a&&a.data){var b={all:g.folders,system:g.folders,user:{}};a.data.forEach(function(a){b.all[a.id]=a,a.isSystem||a.isShopping||a.isSocial?(b.system[a.id]=a,a.isShopping&&(b.all.SHOPPING=a.id,b.system.SHOPPING=a.id),a.isSocial&&(b.all.SOCIAL=a.id,b.system.SOCIAL=a.id)):(b.user[a.id]=a,Array.isArray(a.subfolders)&&a.subfolders.forEach(function(a){b.all[a.id]=a,b.user[a.id]=a}))}),a.data=b}return a}})},get:function(a){return d.get("/folder/:id",{params:a,transformResponse:function(a){return a&&a.data&&(a.data=k(a.data)),a}})},operation:function(a,b){c.filter&&(a.filter=c.filter);var e=b?"putPreserveCache":"put";return d[e]("/folder/oper",a)},operationPreserveCache:function(a){return this.operation(a,!0)},save:function(a){return a.oper=a.id>0?"update":"create",a.folderId=a.id,this.operation(a).success(function(b){e.$broadcast("service:folder:save",b),"create"==a.oper&&a.parentId>0?h.pushCode("selectOptSubfolder"):"create"==a.oper&&h.pushCode("addSubFolder")})},deleteFolder:function(a){return this.operation({oper:"delete",folderId:a}).success(function(a){e.$broadcast("service:folder:deleted",a)})},deleteMessages:function(a){var b={oper:"purge"};return b.folderId=a&&a.folderId?a.folderId:c.folderId,b.folderId!=g.folders.SPAM&&b.folderId!=g.folders.TRASH||(b.real=1),this.operation(b).success(function(a){f.success("service:folder:delete",b.folderId)})},moveToFolder:function(a,b){return this.operation({oper:"movemesg",destinationId:a}).success(function(){a==g.folders.TRASH?f.success("service:messages:move-to-trash"):f.success("service:messages:move"),e.$broadcast("controller:folder:update",{folderId:a,messages:b}),e.$broadcast("service:message:move",{messages:b})})},moveToUnSpam:function(a){return this.moveToFolder(g.folders.INBOX,a)},markAsFavorite:function(a){return this.operation({oper:"star",isStarred:!a[0].isStarred}).success(function(b){e.$broadcast("service:messages:favorite",{messages:a})})},markAsRead:function(a){return this.operation({oper:"setread"}).success(function(b){e.$broadcast("service:messages:read",{messages:a})})},markAsUnread:function(a){return this.operation({oper:"setunread"}).success(function(b){e.$broadcast("service:messages:unread",{messages:a})})},touch:function(a){return b=a,this.operation({oper:"touch",folderId:a})},restorepopped:function(){return this.operation({oper:"restorepopped"})},getFlatFoldersList:function(){return d.get("/folder",{transformResponse:function(b){return b.data=a(b.data,""),b}})},getAdditionalSystemsFolderInfo:function(a){return k(a)},getCachedFolderById:function(a){for(var b=i.get("Folder").data,c=0;c<b.length;c++){var d=b[c];if(d.id==a)return k(b[c]);if(d.subfolders)for(var e=0;e<d.subfolders.length;e++)if(d.subfolders[e].id==a)return k(d.subfolders[e])}return j.send({message:"Proba pobrania nieistniejacego folderu: "+a}),{id:1,isShopping:!1,isSocial:!1,isSystem:!0,name:"",parentId:0,read:0,subfolders:!1,total:0,unread:0,unseen:0}}}}]}),angular.module("nxt-folder").factory("MessageCommander",["Folder","Messages","Message",function(a,b,c){"use strict";var d=function(){this.currentState=null,this.defaultState=this.STATE_MESSAGES,this.setNextActionState(this.defaultState)};return d.prototype={STATE_FOLDER:"state-folder",STATE_MESSAGES:"state-messages",STATE_MESSAGE:"state-message",setNextActionState:function(d){switch(d){case"state-folder":this.currentState=a;break;case"state-messages":this.currentState=b;break;case"state-message":this.currentState=c;break;default:throw new Error("Unknow state ["+d+"]!")}},markAsRead:function(a){var b=this.currentState.markAsRead(a);return this.setNextActionState(this.defaultState),b},markAsUnread:function(a){var b=this.currentState.markAsUnread(a);return this.setNextActionState(this.defaultState),b},markAsFavorite:function(a){var b=this.currentState.markAsFavorite(a);return this.setNextActionState(this.defaultState),b},moveToFolder:function(a,b){var c=this.currentState.moveToFolder(a,b);return this.setNextActionState(this.defaultState),c},moveToUnSpam:function(a){var b=this.currentState.moveToUnSpam(a);return this.setNextActionState(this.defaultState),b},deleteMessages:function(a){var b=this.currentState.deleteMessages(a);return this.setNextActionState(this.defaultState),b},listUnsubscribe:function(a){var b=this.currentState.listUnsubscribe(a);return this.setNextActionState(this.defaultState),b}},new d}]),angular.module("nxt-folder").provider("Messages",function(){"use strict";function a(a,b){var c,d=a.length;for(c=0;c<d&&(a[c].longpollMessage&&a[c].rawDate>b);c+=1);return c}var b,c=1,d=1,e=1,f=25,g=50,h=[];this.$get=["$http","$rootScope","$q","Notification","ApplicationConfig","Contact","$stateParams","Offer","Track",function(i,j,k,l,m,n,o,p,q){return{PACK_SIZE:f,PACK_SIZE_REQUEST:g,query:function(a){var c=this,h=[];c.isActiveBuffer(a)&&(a.id!=b&&(c.clearBuffer(),b=a.id),a.psize=g,h=c.getFromBuffer(a.page,f),e=a.page,a.page=d),a.disableCache||c.clearBuffer();var k=function(){return h&&0===h.length};return k()?(m.env.device.isMobile&&(a.withTreading=0),a.ver=2,a.id==m.folders.SHOPPING&&1==a.page&&(a.isOffer=1),i.get("/folder/:id/mails",{params:a,transformResponse:function(b){return b&&b.data?(b.meta&&j.$broadcast("service:messages:pagination",b.meta.pagination),a.isOffer&&b.data.offers&&b.data.offers.length&&p.setHotOffers(b.data.offers),b.data.messages&&(b.data=b.data.messages),c.isActiveBuffer(a)?(1===a.page&&c.clearBuffer(),c.saveToBuffer(b.data),d++,c.getFromBuffer(e,f)):b.data):b}})):c.preparePromise(h)},search:function(a,b){var c=angular.copy(b);c.isSearch=!0;return a.search&&(c.subject=a.search),a.ver=2,i.postPreserveCache("/folder/:id/mails",c,{params:a,transformResponse:function(a){return a.meta&&j.$broadcast("service:messages:pagination",a.meta.pagination),a.data&&a.data.messages&&(a.data=a.data.messages),d++,a.data}})},createFromLongPollResponse:function(a){var b=new Date(1e3*a.rawDate);return n.search(a.fromEmail).success(function(b){b?a.avatarList=b.avatar:a.avatarList=n.createAvatar(a.fromName||a.fromEmail)}),a.unseen=!0,a.date=b.getHours()+":"+((b.getMinutes()<10?"0":"")+b.getMinutes()),a.formatDate="dziś, "+a.date,a.hasAtta=a.attachments,a.priority=a.priority==c&&"high",a},operation:function(a){return i.put("/mails/oper",a,{transformRequest:function(a){return a.messages=a.messages.map(function(a){return{id:a.id,folderId:a.folderId,threadId:a.threadId}}),a}})},deleteMessages:function(a){var b={oper:"delmail",messages:a};return a.every(function(a){return a.folderId===m.folders.SPAM||a.folderId===m.folders.TRASH})&&(b.real=!0),this.operation(b).success(function(){l.success("service:messages:delete"),j.$broadcast("controller:folder:update:delete",{messages:a})})},moveToFolder:function(a,b){return this.operation({oper:"movemesg",destinationId:a,messages:b}).success(function(){a==m.folders.TRASH?l.success("service:messages:move-to-trash"):l.success("service:messages:move"),j.$broadcast("controller:folder:update",{folderId:a,messages:b}),j.$broadcast("service:message:move",{messages:b})})},moveToUnSpam:function(a){return this.moveToFolder(m.folders.INBOX,a)},markAsFavorite:function(a){return this.operation({oper:"star",isStarred:!a[0].isStarred,messages:a,folderId:o.folderId}).success(function(b){j.$broadcast("service:messages:favorite",{messages:a})})},markAsRead:function(a){return this.operation({oper:"setread",messages:a}).success(function(b){j.$broadcast("service:messages:read",{messages:a})})},markAsUnread:function(a){return this.operation({oper:"setunread",messages:a}).success(function(b){j.$broadcast("service:messages:unread",{messages:a})})},generateUniqueIds:function(a){return a.data&&angular.isArray(a.data)?a.data.map(this.generateUniqueId):a},generateUniqueId:function(a){return a.id?a.uniqueId="m"+a.id:a.threadId&&a.threadId!=-1?a.uniqueId="t"+a.threadId:a.uniqueId="r"+Math.floor(1e11*Math.random()),a},saveToBuffer:function(a){var b=h.slice(0,a.length);a&&angular.isArray(a)&&!angular.equals(b,a)&&(h=h.concat(a))},preparePromise:function(a){var b=k.defer(),c=b.promise;return c.success=function(b){return b(a),c},c},getFromBuffer:function(a,b){if(h){var c=a>1?(a-1)*b:0,d=a>1?a*b:b;return h.slice(c,d)}return[]},clearBuffer:function(){h=[],d=1},clearBufferPage:function(){d=1},isActiveBuffer:function(a){return!(a.search&&""!==a.search||a.extaccId)},unShiftMessage:function(a){h.length&&h.unshift(a)},insertMessageByDate:function(b,c){if(c.length){var d=a(c,b.rawDate);c.splice(d,0,b),h=c}else c.length||c.push(b);return c},getUniqueId:function(a){return a.threadId&&a.threadId!=-1?"t"+a.threadId:"m"+a.id},listUnsubscribe:function(a){return this.operation({oper:"unsubscribe",messages:a})},deleteMailings:function(){return i.put("/folder/oper",{oper:"delmailings"})}}}]}),angular.module("nxt-folder").factory("Search",["$stateParams","$state","$q","$http","$rootScope","Track","Messages",function(a,b,c,d,e,f,g){"use strict";var h=[],i=!0,j={phrase:a.search,historyPhrase:a.searchf,filters:null},k=function(a){return Object.keys(a).forEach(function(b){a[b]||delete a[b]}),a};return e.$on("$stateChangeStart",function(a,b,c,d,e){j.phrase=c.search,j.historyPhrase=c.searchf,e.folderId!=c.folderId&&(j.filters=null)}),{search:function(a,b){j.phrase=a||null,j.historyPhrase=null,j.filters=b?k(b):{},a&&h.indexOf(a)===-1&&(i=!0),this.refresh()},isSearch:function(){return!!(this.getPhrase()||this.getHistoryPhrase()||this.isAdvanced())||!(!this.isSearchInContent()||!this.getPhrase())},searchInContent:function(a,b){b=b||{},b.isSearchInContent=!0,this.search(a,b)},searchHistory:function(a){j.phrase=null,j.historyPhrase=a,j.filters=null,this.refresh()},refresh:function(){a.search!=j.phrase||j.historyPhrase||a.searchf?(b.go("folder",{sort:null,filter:null,mode:null,search:j.phrase,searchf:j.historyPhrase,page:null}),e.$broadcast("folder:refresh",{refreshCache:!0,forceRefresh:!0})):b.reload()},getPhrase:function(){return j.phrase},getHistoryPhrase:function(){return j.historyPhrase},isAdvanced:function(){return!this.areFiltersEmpty()},isSearchInContent:function(){return!!this.getFilter("isSearchInContent")},getFilters:function(){return j.filters||{}},getFilter:function(a){var b=this.getFilters();return b[a]},areFiltersEmpty:function(){var a=this.getFilters();return!a||angular.equals(a,{})||angular.equals(a,{isSearchInContent:!0})},clearAll:function(){g.clearBuffer(),this.clearPhrase(),this.clearHistoryPhrase(),this.clearFilters()},clearPhrase:function(){j.phrase=null},clearHistoryPhrase:function(){j.historyPhrase=null},clearFilters:function(){j.filters={}},suggestions:function(){var a=c.defer(),b=a.promise;return i?(d.get("/search-history",{cache:!1}).success(function(b){h=b,a.resolve(b)}),i=!1):a.resolve(h),b},removeSuggestion:function(a){return f.pushCode("delSuggestItem"),d["delete"]("/search-history",{ph:a})}}}]),angular.module("nxt-message").provider("Message",function(){"use strict";function a(a,b){var c,d;return a.headers&&(c=a.headers.filter(function(a){return 0===a.indexOf(b)}),c&&c.length&&(d=c.pop().split(": ").pop()),d)?d:null}this.$get=["$http","$rootScope","Notification","ApplicationConfig","Blacklist","$stateParams","FileClassFinder","VideoEmbed",function(b,c,d,e,f,g,h,i){function j(b){var c,d,f,g,i,j,k,l,m={},n=[],o=[],p=[],q=b,r=0,s=0,t=0,u=[];q.fullRecipientsTooltipText="",q.originalRecipients=[],k=[q.mimeParts||[],q.mimePartsThumb||[]],k.forEach(function(a,b){if(angular.isArray(a)&&a.length)for(c=0;c<a.length;c++)g=a[c].name.match(/(.+)\.([^\.]+)/),g&&3===g.length?(i=g[1],j=g[2]):(i=a[c].name,j=""),m[a[c].mpid]={name:a[c].name,shortName:i,className:h.getFileClass(j),size:a[c].size,url:a[c].url,urlDownload:a[c].urlDownload,isImage:!1,extension:j.toLowerCase(),mid:a[c].mid,mpid:a[c].mpid},e.env.device.isPc&&"pdf"!=m[a[c].mpid].extension&&(m[a[c].mpid].url=a[c].urlDownload),1===b&&(m[a[c].mpid].isImage=h.isImage(j),m[a[c].mpid].thumbnail=a[c].thumbUrl)}),k.forEach(function(a){if(angular.isArray(a)&&a.length)for(c=0;c<a.length;c++)m[a[c].mpid].isImage?o.push(m[a[c].mpid]):p.push(m[a[c].mpid])}),n=o.concat(p);for(d in m)m.hasOwnProperty(d)&&r++;return q.subject&&q.subject.length?(f=decodeURIComponent(q.subject.replace(/[^a-zA-Z _0-9ąćęłńóśżźĄĆĘŁŃÓŚŻŹäöüÄÖÜß]+/g,"")),f.length||(f="załączniki")):f="załączniki",[{list:q.to,name:"Do"},{list:q.cc,name:"DW"},{list:q.bcc,name:"UDW"}].forEach(function(a,b){angular.isArray(a.list)&&(u=u.concat(a.list.map(function(a){return a.name||a.email})),q.fullRecipientsTooltipText+=(q.fullRecipientsTooltipText.length>0?"\n":"")+a.name+": ",q.fullRecipientsTooltipText+=a.list.map(function(a){return a.name&&a.name!==a.email?a.name+" ("+a.email+")":a.email}).join(", "))}),q.from&&(q.fromTooltipText=q.from.name?q.from.name+" ("+q.from.email+")":q.from.email),angular.isArray(q.to)&&(s=q.to.length),angular.isArray(q.cc)&&(t=q.cc.length),s&&(q.originalRecipients=q.originalRecipients.concat(q.to.map(function(a){return a.email}))),t&&(q.originalRecipients=q.originalRecipients.concat(q.cc.map(function(a){return a.email}))),l=a(q,"X-Multipop-Account"),q.envelopeTo=a(q,"X-IPL-Envelope-To"),q.isSent=q.folderId===e.folders.SENT,q.getAllAttachmentsUrl=e.env.uploadUrl+"/html/getattach,mid,"+q.id+",all,1,fid,undefined,uid,"+e.env.uid+"?f="+f+".zip",q.attachments=n,q.attachmentsLength=r,q.recipientsString=u.join(", "),q.senderConfig={fromEmail:q.from&&q.from.email,recipientsEmails:q.originalRecipients,multipopAccountHeader:l,envelopeToHeader:q.envelopeTo,isSent:q.isSent},l?(q.originalRecipients.push(l),q):0===s&&0===t&&q.envelopeTo?(q.originalRecipients.push(q.envelopeTo),q):1===s&&0===t&&!l&&q.envelopeTo&&q.envelopeTo!==q.to[0].email?(q.originalRecipients=[q.envelopeTo],q.to[0].ommitInReply=!0,q):q}return{get:function(a){return b.get("/mail/:id",{params:a,transformResponse:function(a){if(a&&a.data){a.data=j(a.data);var b=i.find(a.data.content||"");b.length>0&&(a.data.videoEmbeds=[],b.forEach(function(b){i.query(b).then(function(b){b=b.map(function(a){return a.data}),a.data.videoEmbeds=a.data.videoEmbeds.concat(b)})})),a.data.atta=[],a.data.mimeParts&&(a.data.atta=a.data.atta.concat(a.data.mimeParts)),a.data.mimePartsThumb&&(a.data.atta=a.data.atta.concat(a.data.mimePartsThumb))}return a}})},getThread:function(a){return b.get("/thread/"+a+"?sorder=asc&folderId="+g.folderId)},operation:function(a){return b.put("/mails/oper",a,{transformRequest:function(a){return a.messages=[{id:a.message.id,folderId:a.message.folderId,threadId:a.message.threadId}],delete a.message,a}})},moveToFolder:function(a,b){return b.threadId=null,this.operation({oper:"movemesg",destinationId:a,message:b}).success(function(){a===e.folders.TRASH?d.success("service:message:move-to-trash"):d.success("service:message:move"),c.$broadcast("controller:folder:update",{folderId:a,messages:[b]}),c.$broadcast("service:message:move",{messages:[b]})})},moveToUnSpam:function(a){return this.moveToFolder(e.folders.INBOX,a)},deleteMessage:function(a){return this.operation({oper:"delmail",real:!0,message:a}).success(function(){d.success("service:message:delete"),c.$broadcast("controller:folder:update:delete",{messages:[a]})})},markAsFavorite:function(a){return this.operation({oper:"star",isStarred:!a.isStarred,message:a}).success(function(){c.$broadcast("service:message:favorite",{message:a})})},showImages:function(a){return b.post("/logunblock",{email:a.from.email}).success(function(){c.$broadcast("service:message:show-images")})},alwaysShowImages:function(a){return f.addToWhitelist({email:a.from.email}).then(function(){a.imgProtect=!1,c.$broadcast("service:message:show-images-always")})},messageUnsubscribe:function(a){return this.operation({oper:"unsubscribe",message:a})}}}]}),angular.module("nxt-message").factory("VideoEmbed",["$q","$http","$sce",function(a,b,c){"use strict";function d(a){return a.replace(/H(\d)M/,"H0$1M").replace(/M(\d)S/,"M0$1S").replace(/[HM]/g,":").replace(/[^\d\:]/g,"")}var e=NXT_CONFIG.env.googleApiKey||"AIzaSyCfCCQsyehWuEt8RmAEG5d1Qtd8houD_Z",f=[{name:"YouTube",url:"https://www.googleapis.com/youtube/v3/videos?part=snippet,player,contentDetails&id=:url&key="+e,regexp:/(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v\=(?:[a-zA-Z0-9_\-]+)/gi},{name:"YouTubeShort",url:"https://www.googleapis.com/youtube/v3/videos?part=snippet,player,contentDetails&id=:url&key="+e,regexp:/(?:https?:\/\/)?youtu\.be\/(?:[a-zA-Z0-9_\-]+)/gi}];return{query:function(e){var f=[];return e.items.forEach(function(a){var g=b.get(e.url,{cache:!0,params:{url:a},transformResponse:function(a){return a&&a.items&&a.items.length&&(a.thumbnail_url=a.items[0].snippet.thumbnails.high.url,a.html=a.items[0].player.embedHtml,a.htmlSafe=c.trustAsHtml(a.html),a.duration=d(a.items[0].contentDetails.duration),a.name=a.items[0].snippet.title,a.thumbUrl=a.thumbnail_url,a.title=a.name),a}});f.push(g)}),a.all(f)},find:function(a){var b=[],c={};return f.forEach(function(d){var e=a.match(d.regexp);e&&("YouTube"===d.name&&(e=e.map(function(a){var b=a.match(/v\=(?:[a-zA-Z0-9_\-]*)/).pop().substr(2);if(!c[b])return c[b]=!0,b})),"YouTubeShort"===d.name&&(e=e.map(function(a){var b=a.match(/youtu.be\/(?:[a-zA-Z0-9_\-]*)/).pop().substr(9);if(!c[b])return c[b]=!0,b})),d.items=e.filter(function(a){return void 0!==a}),b.push(d))}),b}}}]),angular.module("nxt-notification").provider("Notification",function(){"use strict";this.$get=["$rootScope","ApplicationMessage","$timeout",function(a,b,c){var d,e={};return{TYPE_SUCCESS:"success",TYPE_INFO:"info",TYPE_ERROR:"error",notify:function(d,e,f,g,h){var i,j,k={};return f&&a.$broadcast(d,f),j=b.get(d,this.getReplaceParams())||d,g&&(k=b.getOptions(g)),i=k&&k.broadcast?k.broadcast:"service:notification:new",c(function(){a.$apply(function(){a.$broadcast(i,{type:e,messageId:d,message:j,title:k&&k.title?k.title:"",noClose:h})})},0,!1),this},success:function(a,b){return this.notify(a,this.TYPE_SUCCESS,b)},successNoClose:function(a,b){return this.notify(a,this.TYPE_SUCCESS,b,void 0,!0)},info:function(a,b){return this.notify(a,this.TYPE_INFO,b)},error:function(a,b,c){return this.notify(a,this.TYPE_ERROR,b,c)},setReplaceParams:function(a){d=a},getReplaceParams:function(){var a=d;return d="",a},setOnClickCallback:function(a,b){e[a]=b},getOnClickCallback:function(a){return e[a]?e[a]:function(){}},close:function(b){a.$broadcast("service:notification:close",{messageId:b})},on:function(b,c){c=c||function(){},b.forEach(function(b){a.$on(b,function(a,b){c(b,a)})})}}}]}),angular.module("nxt-offer").provider("Offer",function(){"use strict";var a=!1,b=[],c=[];this.$get=["$http",function(d){return{getVoucher:function(a){return d.get("/offer/",{params:{offerHash:a},transformResponse:function(a){return a}})},setHotOffers:function(a){b=a},getHotOffers:function(){return b},setAlreadyDownload:function(b){a=b},isAlreadyDownload:function(){return a},removeDuplicateHotOffer:function(a){return a.filter(function(a){return c.indexOf(a.uniqueId)==-1})},removeCache:function(){a=!1,b=[],c=[]}}}]}),angular.module("nxt-public-gallery").provider("Gallery",function(){"use strict";this.$get=["$http",function(a){return{changeState:function(a,b){var c={mId:a,state:b};return this.update(c)},update:function(b){return a.put("/gallery",b)}}}]}),angular.module("nxt-settings").provider("Theme",function(){"use strict";this.$get=["$http","ApplicationConfig",function(a,b){return{query:function(){return a.get("/theme")},get:function(b){return a.get("/theme/:id",{params:b})},select:function(b){var c={id:b};return a.put("/theme",{jsonParams:JSON.stringify(c)})},cropUserTheme:function(c,d,e,f,g,h){return a.post(b.env.pocztaApiUrl+"/v1/attachment/crop",{attachmentId:c,x:d,y:e,width:f,height:g,uid:h,sid:NXT_CONFIG.env.sid},{withCredentials:!0})},selectUserThemeJSON:function(b){var c={id:b.id,attachment:b.attachment,attachmentCropped:b.attachmentCropped,attachmentExt:b.attachmentExt,x:b.x||0,y:b.y||0,width:b.width,height:b.height};return a.put("/theme",{jsonParams:JSON.stringify(c)})},changeSkin:function(a){var c,d=document.getElementById("theme-stylesheet"),e=document.getElementById("userBackground");e&&2!=a.type&&(e.innerHTML=""),null===d&&(d=document.createElement("link"),d.id="theme-stylesheet",d.rel="stylesheet","ds"===b.env.name?(d.type="text/less",less.sheets.push(d)):d.type="text/css",document.querySelector("head").appendChild(d)),d.setAttribute("href",b.env.staticUrl+"/css/"+a.cssFile),"ds"===b.env.name&&(less.sheets.length&&(c=less.sheets[0].nextSibling,c&&c.parentNode.removeChild(c)),less.refresh())}}}]}),angular.module("nxt-settings").provider("ThemeUploader",function(){"use strict";var a=!1;this.$get=["FileUploader","$http","$rootScope","$timeout","ApplicationConfig","FileClassFinder","Theme",function(b,c,d,e,f,g,h){function i(){var a,b=f.env.uploadPortal,c={};for(a in b)if(b.hasOwnProperty(a)){if("url"===a)continue;c["__"+a]=b[a]}return c.uid=f.env.uid,c.sid=f.env.sid,c}var j=f.env.pocztaApiUrl+"/v1/attachment/fileUpload",k=i();return{getUploader:function(c){return k=i(),c.uploader=new b({scope:c,url:j,method:"POST",queueLimit:1,autoUpload:!1,withCredentials:!0,formData:[k]}),c.uploadUrl=j,c.uploader.fileInputClick=function(b,c){if(!a){a=!0;var d;document.createEvent&&(d=document.createEvent("MouseEvent"),d.initMouseEvent("click",!0,!0,window,null,0,0,0,0,!1,!1,!1,!1,0,null),c.dispatchEvent(d)),e(function(){a=!1},1e3,!1)}},c.uploader.queueLength=0,c.uploader.MAX_TOTAL_SIZE=10,c.uploader.MAX_ITEMS_COUNT=1,c.uploader.updateTotalSize=function(){c.uploader.queueLength=c.uploader.queue.length,c.uploader.queueLength?c.uploader.totalSize=c.uploader.queue.map(function(a){return a.file.size}).reduce(function(a,b){return a+b})/1048576:c.uploader.totalSize=0,c.uploader.isTotalSizeExceeded=c.uploader.totalSize>c.uploader.MAX_TOTAL_SIZE,c.uploader.isItemsCountExceeded=c.uploader.queue.length>c.uploader.MAX_ITEMS_COUNT},c.uploader.updateUploadedSize=function(){c.uploader.queueLength=c.uploader.queue.length,c.uploader.queueLength?c.uploader.uploadedSize=c.uploader.queue.map(function(a){return a.file.size*(a.progress/100)}).reduce(function(a,b){return a+b})/1048576:c.uploader.uploadedSize=0},c.uploader.updateUploadedCount=function(){c.uploader.uploadedCount=c.uploader.queue.filter(function(a){return a.isUploaded}).length},c.uploader.onAfterAddingFile=function(a){var b=a.file.name.split(".").pop();b&&(a.extension=b,a.className=g.getFileClass(b)),c.uploader.updateTotalSize(),a.batchNumber=0,c.afterAddingFile&&c.afterAddingFile()},c.uploader.onAfterAddingAll=function(a){c.uploader.queue.forEach(function(a,b,c){c[b].batchNumber++}),c.uploader.isItemsCountExceeded||c.uploader.isTotalSizeExceeded?c.afterAddingAll&&c.afterAddingAll(c.uploader.isItemsCountExceeded,c.uploader.isTotalSizeExceeded):(c.uploader.uploadAll(),c.afterAddingAll&&c.afterAddingAll())},c.uploader.onProgressItem=function(a,b){c.uploader.updateUploadedSize(),c.afterProgress&&c.afterProgress()},c.uploader.onProgressAll=function(a){c.uploader.updateUploadedCount(),c.afterProgressAll&&c.afterProgressAll()},c.uploader.onSuccessItem=function(a,b,d,e){if(b&&b.result&&b.result.data&&b.result.data.id){var f=b.result.data.id,g=b.result.data.ext;c.afterSuccess&&c.afterSuccess(f,g)}else c.afterError&&c.afterError(b)},c.uploader.onCompleteAll=function(a){c.uploader.updateUploadedCount(),c.afterCompleteAll&&c.afterCompleteAll()},c.showUploader=!0,c.uploader},getUserThemeMiniature:function(a){return c.get("/theme/:id",{params:a})}}}]}),angular.module("nxt-avatar").directive("nxtAvatar",["ApplicationConfig","$rootScope","Profile","$timeout",function(a,b,c,d){"use strict";function e(a){var b,c={};return angular.isString(a)?(b=a.split("|"),1===a.indexOf("|")?(c.type=2,c.initial=b[0],c.data=parseInt(b[1])):(c.type=1,c.data={id:b[0],ext:b[1]})):c=a,c}return{restrict:"A",scope:{avatars:"=?nxtAvatarList",contactName:"=?nxtAvatarContactName",contactEmail:"=?nxtAvatarContactEmail",senderInfo:"=?nxtMessageSenderInfo",options:"=?nxtAvatarOptions"},controller:["$scope",function(b){return b.options=b.options||{},b.IMG_CLASS=b.options.imgClass||a.env.avatarBaseImgClass,b.AVATAR_TYPE=c.AVATAR_TYPE,b.BASE_URL=a.env.avatarBaseUrl,b.options.isOwnAvatar&&(b.avatars=c.getAvatarFromCookie()),b.avatars=e(b.avatars),b.$watch("avatars",function(a){a&&!Array.isArray(a)&&(b.avatars=[a])}),Array.isArray(b.avatars)?b.avatar=b.avatars[0]:b.avatar=b.avatars,a.env.avatarType=b.avatars.type,b}],link:function(c,e,f){function g(d){if(c.contactName&&c.contactName&&c.options.isCardEnabled&&a.env.device.isPc){d.stopPropagation();var f=e[0].getBoundingClientRect(),g={top:f.top,left:f.left};b.$broadcast("directive:avatar:toggleAvatarCard",{position:g,avatars:c.avatars,senderInfo:c.senderInfo,contact:{name:c.contactName,email:c.contactEmail}})}}var h;c.toggleAvatarCard=function(a){"click"==a.type?g(a):h=d(function(){g(a)},600)},c.leaveAvatarCard=function(){d.cancel(h)}},templateUrl:function(b,c){return c.nxtAvatarIsThread&&a.env.threading?"/avatar/views/avatar.html":a.env.device.isMobile?"/avatar/views/avatarSimpleMobile.html":"/avatar/views/avatarSimple.html"}}}]),angular.module("nxt-avatar").directive("nxtAvatarCard",["$rootScope","Folder","ApplicationData","$stateParams","Track",function(a,b,c,d,e){"use strict";var f=1;return{restrict:"A",replace:!0,scope:{contact:"=?nxtAvatarContact"},controller:["$scope","Compositions","Search","Contact","Blacklist","$filter",function(b,c,d,g,h,i){return b.getContactInfo=function(){g.search(b.contact.email).success(function(a){a&&(b.contactId=a.id,a.id===-666&&(a.isReadonly="true"),b.contact.isReadonly=a.isReadonly),b.isOnContactlist=!!a}),h.search(b.contact.email).success(function(a){b.isOnBlacklist=!!a})},b.createNewMessage=function(){c.addComposition({toActive:b.contact,allowOwnEmails:!0}),e.pushCode("avatarCardNewMessage")},b.showMailingHistory=function(){d.searchHistory(b.contact.email),e.pushCode("avatarCardShowMessages")},b.addContact=function(){a.$broadcast("directive:contact:new-form",{name:b.contact.name,email:b.contact.email,avatar:b.avatars}),e.pushCode("avatarCardAddToContactsList")},b.deleteContact=function(){g.deleteContact({id:b.contactId}).success(function(){b.isOnContactlist=!1})},b.addToBlacklist=function(){h.addToBlacklist(b.contact).success(function(){b.isOnBlacklist=!0}),e.pushCode("avatarCardBlockThisUser")},b.removeFromBlacklist=function(){h.removeFromBlacklist(b.contact).success(function(){b.isOnBlacklist=!1})},b.addNewFilter=function(){a.$broadcast("controller:filter:quickdialog",{email:b.contact.email}),e.pushCode("avatarCardFilterMessages")},b.goToContact=function(){a.$broadcast("controller:contact:goto",{id:b.contactId})},b.quickFilterInBox=function(){a.$broadcast("controller:filter:quick",{email:b.contact.email,folderId:f})},b}],link:function(a,b,f){a.$on("directive:avatar:toggleAvatarCard",function(b,c){a.senderInfo=c.senderInfo,a.show(c)}),a.$watch("isShow",function(a){a||b.css({opacity:"0"})}),a.show=function(f){var g;setTimeout(function(){g=b[0].offsetHeight,f.position.top+g>=document.body.offsetHeight?(a.isMenuDown=!0,b.css({top:f.position.top-g+54+"px",left:f.position.left+5+"px"})):(a.isMenuDown=!1,b.css({top:f.position.top-4+"px",left:f.position.left+5+"px"})),b.css({opacity:"1"}),a.$apply()},0),f.contact.id===-666&&(f.contact.isReadonly="true"),a.contact=f.contact,a.avatars=f.avatars,a.getContactInfo(),a.isShow=!0;var h=c.get("Folder");a.isMove=!0;var i=d.folderId;e.pushCode("avatarCardShow");for(var j=0;j<h.data.length;j++)if(i==h.data[j].id&&(h.data[j].isSocial===!0||h.data[j].isShopping===!0))return a.isMove=!1,a}},templateUrl:"/avatar/views/avatarCard.html"}}]),angular.module("nxt-common").directive("nxtAdPlace",["$location","$rootScope",function(a,b){"use strict";return{restrict:"A",scope:{placement:"@nxtAdPlace",isDeviceDependent:"=?nxtAdDeviceDependent"},controller:["$scope","ApplicationConfig",function(a,b){var c=b.getConfigAppModule("ads");return c&&c.actions&&c.actions&&c.actions.adsSlotEnabled===!1?(a.adsSloatsOff=!0,a):(a.isPremiumAcc=!!b.env.accountType,a.isDeviceDependent=void 0===a.isDeviceDependent||a.isDeviceDependent,a.getUrl=function(){return"/"+b.env.baseUrl+"/adv,advKeyword,"+b.env.advKeyword+",adType,"+a.getPlacement()},a.getUrlForPremium=function(){return a.getUrl()+"_premium"},a.getPlacement=function(){var c=a.placement,d=b.env.device;return a.isDeviceDependent&&d.isPc&&(c+="_web"),!d.isMobile||"box300x250"!=c&&"box600x450"!=c||(c+="_tablet"),NXT_CONFIG.env.isMobileApp&&(c+="_app"),c},a)}],link:function(c,d,e){function f(e){var f=document.createElement("iframe");f.setAttribute("frameBorder",0),f.setAttribute("id",c.placement),f.setAttribute("allowTransparency","true"),f.onload=function(){b.$broadcast("adplace:onload:"+c.placement)},a.hash()&&(e+="#"+a.hash()),f.src=e;var g=document.createElement("div");g.appendChild(f),d.append(g)}if(d.addClass("ad ad--"+c.placement),!c.adsSloatsOff){var g=c.isPremiumAcc?c.getUrlForPremium():c.getUrl();f(g)}}}}]),angular.module("nxt-common").directive("nxtAdvClose",["Track","ApplicationConfig","Profile","Notification",function(a,b,c,d){"use strict";function e(a){return a[Math.floor(Math.random()*a.length)]}var f=3;return{restrict:"A",link:function(g,h,i){function j(){var a=(h[0].offsetWidth,k[0].offsetWidth);a<=700&&a>648?h.css("width","650px"):a<=648?h.css("width","500px"):h.css("width","700px")}var k=h.parent(),l=i.nxtAdvCloseName,m=1;g.premiumTest=function(){a.pushGA(["Oznaczanie_reklam","klik","aktywacja_premium_"+l]),c.updateAccountType(f).success(function(a){1==a.status?(g.premiumTestReady=!0,b.env.accountType=0,b.isShowAdDescription=!1):d.error(a.msg)})},g.closeAd=function(){b.env.premiumInfo.premiumInPast?(m=e([1,3]),g.isClose=m,a.pushGA(["Oznaczanie_reklam","klik-X",l]),a.pushGA(["Oznaczanie_reklam","wyswietlenie",l+"-v"+m])):(g.$parent.isPremiumTest=!0,g.isClose=!0,m=0,a.pushGA(["Oznaczanie_reklam","wyswietlenie","aktywacja_premium_"+("giga"==l?"big":"small")]));var c=angular.element(document.getElementById(h[0].parentElement.getAttribute("nxt-ad-place")));c.css("visibility","hidden")},g.click=function(){switch(m){case 2:a.pushGA(["Oznaczanie_reklam","klik_wylacz_je",l+"-v2"]);break;case 1:case 3:a.pushGA(["Oznaczanie_reklam","klik_spr",l+"-v"+m])}},i.nxtAdvCloseColumnResize&&g.$on("directive:column-resize:change-size",function(){j()})}}}]),angular.module("nxt-common").directive("nxtAutofocus",["$parse","$timeout",function(a,b){"use strict";return{restrict:"A",link:function(c,d,e){function f(){b(function(){var a=d.val().length,b=d[0];b.selectionStart=a,b.selectionEnd=a,b.focus()})}var g=a(e.nxtAutofocus);c.$watch(g,function(a){a!==!1&&f()})}}}]),angular.module("nxt-common").directive("nxtAutoresize",function(){"use strict";var a=document.body;return{require:"ngModel",restrict:"A",link:function(b,c,d,e){var f=window.getComputedStyle(c[0]),g=angular.element("<span></span>").css({"border-left-style":f.getPropertyValue("border-left-style"),"border-left-width":f.getPropertyValue("border-left-width"),"border-right-style":f.getPropertyValue("border-right-style"),"border-right-width":f.getPropertyValue("border-right-width"),"font-size":f.getPropertyValue("font-size"),"padding-left":f.getPropertyValue("padding-left"),"padding-right":f.getPropertyValue("padding-right"),visibility:"hidden",position:"absolute"})[0];b.$watch(function(){return e.$modelValue},function(b){
g.textContent=b,a.appendChild(g),c.css("width",g.getBoundingClientRect().width+"px"),a.removeChild(g)})}}}),angular.module("nxt-common").directive("nxtBindHtmlCompile",["$compile",function(a){return{restrict:"A",link:function(b,c,d){b.$watch(function(){return b.$eval(d.nxtBindHtmlCompile)},function(d){c.html(d),a(c.contents())(b)})}}}]),angular.module("nxt-common").directive("nxtBubble",["ApplicationConfig","Bubble","$compile","$state","$timeout","$templateRequest",function(a,b,c,d,e,f){"use strict";var g=a.env.device.isMobile,h=function(a,b,c){var d=a[0].getBoundingClientRect(),e=b[0].getBoundingClientRect(),f=document.body.offsetWidth,g=document.body.offsetHeight,h=10,i=25;c||(c=[0,0]);var j=c[0],k=c[1];e.right+h>f?b.css({left:d.width/2-e.width+i+j+"px"}).removeClass("bubble--right").addClass("bubble--left"):b.css({left:d.width/2-i+j+"px"}),e.bottom+h>g?b.css({top:-(e.height+h+k)+"px"}).removeClass("bubble--bottom").addClass("bubble--top"):b.css({top:d.height+h+k+"px"}),b.addClass("bubble--set")};return{restrict:"A",replace:!1,terminal:!1,scope:{bubbleId:"@nxtBubble",bubbleExtraPaddings:"=nxtBubbleExtraPadd"},controller:["$scope",function(a){a.templateParams={}}],link:function(a,d){g||(a.bubbleData=b.getBubbleToShow(a.bubbleId),a.bubbleData&&(a.bubbleData.options.showOnlyOnce=parseInt(a.bubbleData.options.showOnlyOnce),a.bubbleData.options.updateSettingAfterShow=parseInt(a.bubbleData.options.updateSettingAfterShow),f(a.bubbleData.options.template).then(function(f){var g=angular.element(f);d.append(g),c(g)(a),e(function(){h(d,g,a.bubbleExtraPaddings),a.bubbleData.options.updateSettingAfterShow&&b.updateSettingAsVisible(a.bubbleId)},0,!1)})),a.close=function(){a.templateParams.closedBubble=!0,(a.bubbleData.options.showOnlyOnce||a.templateParams.notInform)&&b.updateSettingAsVisible(a.bubbleId)},a.$on("$destroy",function(){!a.bubbleData||a.templateParams.closedBubble||a.bubbleData.options&&a.bubbleData.options.updateSettingAfterShow||b.showNotClosed(a.bubbleId)}))}}}]),angular.module("nxt-common").directive("nxtCheckboxWrapper",["$rootScope","$timeout",function(a,b){"use strict";return{restrict:"A",link:function(b,c,d){function e(a){g=a}function f(a){a=[].concat(a);var c=a.join(";");b.$select.items.map(function(a){return c.indexOf("cities-ids-to-search"===d.nxtCheckboxWrapper?a.name:a.id)!==-1&&(a.isChecked=!0),a}),b.updateSelected(!0)}var g,h={};b.selectedCount=0;var i=function(){var a=[];return b.$select.items.filter(function(b){b.isChecked&&a.push(b.id)}),a};b.$select.select=!1,b.updateSelected=function(c,e){h=i(),b.selectedCount=h.length,0===b.selectedCount?b.$select.selected=null:b.$select.selected=!0,c||a.$broadcast("selected:"+d.nxtCheckboxWrapper,h,e)};var j=b.$watch("$select.items",function(){b.$select.items.length&&("undefined"!=typeof g&&f(g),j())});b.$on("update-selected-counter:"+d.nxtCheckboxWrapper,function(a,c){b.selectedCount=c}),b.$on("select-init:"+d.nxtCheckboxWrapper,function(a,c){b.$select.items.length?f(c):e(c)}),a.$broadcast("checkboxwrapper-init",d.nxtCheckboxWrapper)}}}]),angular.module("nxt-common").directive("nxtColumnsResize",["$document","$rootScope","$timeout","ApplicationConfig",function(a,b,c,d){"use strict";var e,f,g,h,i,j=85,k=90,l=j+k,m=285,n=430,o=m+n,p=l+o,q=432,r=332,s=545,t=234;return{restrict:"A",replace:!0,templateUrl:"/common/views/columnsResize.html",controller:["$scope",function(a){function k(){C=a.getLeftColumn().offsetWidth<=r,I=a.getRightColumn().offsetWidth<=s,O=a.getLeftColumn().offsetWidth<=q,B!==C&&(b.$broadcast("directive:column-resize:left-column-"+(C?"min":"greater")),d.env.isLeftColumnMin=C,B=C),H!==I&&(b.$broadcast("directive:column-resize:right-column-"+(I?"min":"greater")),d.env.isRightColumnMin=I,H=I),N!==O&&(b.$broadcast("directive:column-resize:left-pre-column-"+(O?"min":"greater")),d.env.isLeftPreColumnMin=O,N=O)}function o(){g=document.querySelector(".section--message-list"),h=document.querySelector(".section--message"),i=document.querySelector(".column-size-change-slider")}function u(){f=document.documentElement.clientWidth;var b=Math.max(f,p),d=b-l,g=e/100*d,h=(100-e)/100*d,i=e,j="%",k=100-e,o="%";g<=m?(k=Math.max(d-m,0),o="px"):h<=n&&(i=Math.max(d-n,0),j="px"),angular.element(document.body).addClass("on-resizing"),a.setStyles(i,j,k,o),c(function(){angular.element(document.body).removeClass("on-resizing")},500)}var v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O;return a.setStyles=function(b,c,d,e){function h(){v=document.querySelector("#columns-style"),null===v&&(v=document.createElement("style"),v.type="text/css",v.id="columns-style",document.querySelector("head").appendChild(v))}function i(){if("%"===c?x=z:"px"===c&&(x=A),"%"===e?D=F:"px"===e&&(D=G),0!==b&&(b=b||x),c=c||y,0!==d&&(d=d||D),e=e||E,"%"===c){var a=(f-l)*b/100;L=Math.max(a,m)+j+"px"}else L=b+j+"px"}function n(){v.innerHTML=".section--message-list {width: "+b+c+";} .section--message {width: "+d+e+";} .ad--box600x450 {left: "+L+";}",f=document.documentElement.clientWidth,M=Math.max(f,p),g&&a.getLeftColumn().getBoundingClientRect().top>10&&u()}function o(){"%"===c?z=b:"px"===c&&(A=b),"%"===e?F=d:"px"===e&&(G=d),x=b,y=c,D=d,E=e}J=K,K=""+b+c+d+e,K!==J&&(h(),i(),n(),o(),k())},a.getLeftColumn=function(){return g||o(),g},a.getRightColumn=function(){return h?h=document.querySelector(".section--message")||h:o(),h},a.resizeHandler=function(){if(null!==e){angular.element(document.body).addClass("on-resizing"),f=document.documentElement.clientWidth;var d=a.getLeftColumn().offsetWidth;d<=m?(d=d<t?t:d,a.setStyles(null,null,Math.max(f-d-l,0),"px")):a.setStyles(null,null,100-parseFloat(z),"%");var g=a.getRightColumn.offsetWidth;g<=n?a.setStyles(Math.max(f-g-l,0),"px",null,null):a.setStyles(100-parseFloat(F),"%",null,null),c.cancel(w),w=c(function(){angular.element(document.body).removeClass("on-resizing"),b.$broadcast("service:message:resize-handler"),b.$broadcast("directive:column-resize:change-size")},500)}else k()},localStorage&&c(function(){e=localStorage.getItem("savedLeftWidthInPers"),o(),null!==e&&(u(),b.$broadcast("service:message:resize-handler"),b.$broadcast("directive:column-resize:change-size"))},1e3),angular.element(window).on("resize",a.resizeHandler),a}],link:function(d,g){function h(b){b.stopPropagation(),a.off("mousemove",i),a.off("mouseup",h),angular.element(document.body).removeClass("on-moving")}function i(a){0!==a.which&&0!==a.buttons||h(a),a.stopPropagation(),j(a),k()}function j(a){x=Math.max(m,Math.min(u+(a.clientX-v),w)),e=x/(s-l)*100;var f=d.getLeftColumn().offsetWidth,g=d.getRightColumn().offsetWidth;f+g!==o&&(d.setStyles(e,"%",100-e,"%"),c.cancel(q),q=c(function(){if(localStorage)try{localStorage.setItem("savedLeftWidthInPers",e),b.$broadcast("service:message:resize-handler")}catch(a){}},1e3))}function k(){c.cancel(r),r=c(function(){b.$broadcast("directive:column-resize:change-size")},50)}var q,r,s,t,u,v,w,x;g.on("mousedown",function(b){angular.element(document.body).addClass("on-moving"),f=document.documentElement.clientWidth,u=d.getLeftColumn().offsetWidth,v=b.clientX,s=Math.max(f,p),t=s-l,w=s-n-l,a.on("mousemove",i),a.off("mouseup",h),a.on("mouseup",h)})}}}]),angular.module("nxt-common").directive("nxtDropdown",["$rootScope","ApplicationConfig","$timeout",function(a,b,c){"use strict";function d(a,b){var c=a[0].querySelectorAll(b),d=[];try{d=[].slice.call(c)}catch(e){for(var f=0;f<c.length;f++)d.push(c[f])}return d}function e(a){d(a,"ul").forEach(function(a){var b=a.parentNode,c=angular.element(b);angular.element(a).hasClass("ui-select-choices")||angular.element(a).hasClass("ui-select-choices--single")||c.addClass("dropdown-nav dropdown-nav--next").attr("data-label",g(b)).off()})}function f(a,b,c){if(c=c||function(){return!0},a[0].hasChildNodes())for(var d,e=a.children(),f=0;f<e.length;f++)d=angular.element(e[f]),c(d)&&(b?angular.element(d).addClass("isHidden"):angular.element(d).removeClass("isHidden"))}function g(a){var b=a.firstChild;return"#text"===b.nodeName?b.nodeValue.trim():""}function h(a,b){var c=a.firstChild;"#text"===c.nodeName&&(c.nodeValue=b)}var i="Wróć",j=angular.element(document.body);return j.on("click",function(d){(!b.env.device.isMobile&&!angular.element(d.target).hasClass("dropdown-nav--prev")||b.env.device.isMobile&&!angular.element(d.target).hasClass("scroll-no-hide"))&&c(function(){a.$broadcast("directive:dropdown:hideAll")},0,!1)}),a.$on("message:iframe:touch",function(){c(function(){a.$broadcast("directive:dropdown:hideAll")},0,!1)}),{restrict:"EA",scope:{dropdown:"@nxtDropdown",dropdownIcon:"@nxtDropdownIcon",dropdownStyle:"@?nxtDropdownStyle",dropdownChange:"=?nxtDropdownChange",dropdownOnclose:"@nxtDropdownOnclose"},controller:["$scope",function(a){return a.dropdownIcon=a.dropdownIcon||"arrowdown",a}],link:function(g,k,l){var m,n;k.addClass("dropdown non-selectable").parent().addClass("dropdown-icon dropdown-icon--"+g.dropdownIcon),"right"===g.dropdown&&k.addClass("dropdown--right"),g.dropdownStyle&&k.addClass("dropdown--"+g.dropdownStyle),g.$on("directive:dropdown:hideAll",function(){k.hasClass("dropdown--mouseover")||(k.hasClass("dropdown--active")&&g.dropdownOnclose&&a.$broadcast(g.dropdownOnclose),k.removeClass("dropdown--active"),k.parent().removeClass("dropdown-icon--arrowup"))}),g.$watch("dropdownChange",function(a){a&&setTimeout(function(){e(k)},100)}),b.env.device.isMobile&&g.$on("directive:dropdown:hideAll-force",function(){k.removeClass("dropdown--active"),k.parent().removeClass("dropdown-icon--arrowup")}),e(k),k.on("click",function(a){n||(n=k[0].getBoundingClientRect().top),m||(m=90*(document.body.offsetHeight-n)/100);var d=angular.element(a.target);d.css("max-height",m+"px");var e=d.hasClass("force-no-hide");if(d.hasClass("dropdown-nav")){var g=d.parent();if(d.hasClass("dropdown-nav--next")?(e?(g.children().addClass("isHidden"),f(k,!0,function(a){return a.hasClass("no-hidden")})):f(g,!0,function(a){return!a.hasClass("no-hidden")}),h(d[0],i),b.env.device.isMobile&&(k.addClass("dropdown--mouseover"),c(function(){k.removeClass("dropdown--mouseover")},500,!1))):(e&&f(k,!1,function(a){return a.hasClass("no-hidden")}),g.children().removeClass("isHidden"),h(d[0],d.attr("data-label"))),d.toggleClass("dropdown-nav--next dropdown-nav--prev").removeClass("isHidden"),!g.hasClass("dropdown")){var j=g.parent();j.hasClass("dropdown-nav--inactive")?h(j[0],i):h(j[0],""),j.toggleClass("dropdown-nav--inactive")}var l=d.children(),o=l.eq(l.length-1);o.toggleClass("isVisible")}}).parent().on("click",function(e){var f=angular.element(e.target);"FORM"===f.prop("nodeName")||f.prop("form")||f.hasClass("ui-select-match")||f.hasClass("ui-select-match-chosen")||f.hasClass("ui-select-choices-row-inner")||f.parent().hasClass("ui-select-match-chosen")||f.parent().hasClass("ui-select-choices-row-inner")||(k.hasClass("dropdown--active")||(d(k,".isVisible").forEach(function(a){a.className=a.className.replace("isVisible","").trim()}),d(k,".isHidden").forEach(function(a){a.className=a.className.replace("isHidden","").trim()}),d(k,".dropdown-nav--inactive").forEach(function(a){a.className=a.className.replace("dropdown-nav--inactive","").trim()}),d(k,".dropdown-nav--prev").forEach(function(a){a.className=a.className.replace("dropdown-nav--prev","dropdown-nav--next"),h(a,a.getAttribute("data-label"))})),f.hasClass("dropdown-nav")||(k.toggleClass("dropdown--active"),b.env.device.isMobile&&(f.parent().parent().hasClass("force-no-hide")||f.parent().hasClass("force-no-hide"))&&k.addClass("dropdown--active"),k.parent().toggleClass("dropdown-icon--arrowup")),k.hasClass("dropdown--active")?(j.triggerHandler("dropdownopen",f[0]),b.env.device.isMobile||a.$broadcast("tooltip:hide")):(g.dropdownOnclose&&a.$broadcast(g.dropdownOnclose),j.triggerHandler("dropdownclose",f[0])),b.env.device.isMobile&&f[0].className.indexOf("dropdown-icon")>-1&&k.addClass("dropdown--mouseover")),b.env.device.isMobile&&(f[0].className.indexOf("dropdown-icon")>-1||f[0].className.indexOf("dropdown-nav--next")>-1)&&c(function(){k.removeClass("dropdown--mouseover")},500,!1)}),k.on("touchend",function(a){var b=angular.element(a.target);b.hasClass("dropdown-nav--next")||b.hasClass("dropdown-nav--prev")||b.hasClass("scroll-no-hide")||(c(function(){k.removeClass("dropdown--active")},100,!1),k.parent().removeClass("dropdown-icon--arrowup"))}),b.env.device.isMobile||(k.parent().on("mouseenter",function(){k.addClass("dropdown--mouseover")}).on("mouseleave",function(){k.removeClass("dropdown--mouseover")}),k.on("mouseover",function(a){"LI"===a.target.nodeName?angular.element(a.target).addClass("is-active"):"LI"===a.target.parentNode.nodeName&&angular.element(a.target.parentNode).addClass("is-active")}).on("mouseout",function(a){"LI"===a.target.nodeName?angular.element(a.target).removeClass("is-active"):"LI"===a.target.parentNode.nodeName&&angular.element(a.target.parentNode).removeClass("is-active")})),g.$on("$destroy",function(){k.off(),k.parent().off()})}}}]),angular.module("nxt-common").directive("nxtFocusin",["$parse","$timeout",function(a,b){return{scope:!1,link:function(c,d,e){var f=a(e.nxtFocusin),g=null,h=function(){b(function(){c.$apply(function(){f(c)})},0,!1)};navigator.userAgent.toLowerCase().indexOf("firefox")!==-1?d[0].addEventListener("focus",h,!0):d.on("focusin",h),d.on("click",function(){document.activeElement!==document.body?g=document.activeElement:g&&g.focus()}),c.$on("$destroy",function(){navigator.userAgent.toLowerCase().indexOf("firefox")!==-1?d[0].removeEventListener("focus",h,!0):d.off()})}}}]),angular.module("nxt-common").directive("nxtFocusout",["$parse",function(a){return{scope:!1,link:function(b,c,d){var e=a(d.nxtFocusout),f=!1,g=function(a){f||b.$apply(function(){e(b)})};c.on("mouseenter",function(){f=!0}).on("mouseleave",function(){f=!1}).on("keyup",function(a){var b=a?a.keyCode:window.event.which;27===b&&(f=!1,document.activeElement.blur())}),navigator.userAgent.toLowerCase().indexOf("firefox")!==-1?c[0].addEventListener("blur",g,!0):c.on("focusout",g),b.$on("$destroy",function(){navigator.userAgent.toLowerCase().indexOf("firefox")!==-1?c[0].removeEventListener("blur",g,!0):c.off()})}}}]),angular.module("nxt-common").directive("nxtInjectAttr",function(){"use strict";return{restrict:"A",scope:{attrKey:"@nxtInjectAttr",attrValue:"=?nxtInjectAttrValue",showIf:"=nxtInjectAttrIf"},link:function(a,b){a.showIf&&b.attr(a.attrKey,a.attrValue)}}}),angular.module("nxt-common").directive("nxtLoadingIndicator",["$timeout","ApplicationConfig",function(a,b){return LOADER_TIME_DELAY=b.env.device.isMobile?0:300,{restrict:"A",scope:{isLoading:"=nxtLoadingIndicator"},link:function(b,c,d){var e,f,g,h;b.$watch("isLoading",function(b){b?h=a(function(){e||(e=angular.element(document.createElement("div")).addClass("nxt-loading-indicator").css({display:"block"}),f=angular.element(document.createElement("div")).addClass("indicator"),e.append(f),g=angular.element(document.createElement("div")).addClass("indicator-text").css({display:"none"}),e.append(g),c.append(e)),d.nxtLoadingIndicatorText&&d.nxtLoadingIndicatorText.length?g.css({display:"block"}).text(d.nxtLoadingIndicatorText):g.css({display:"none"}).text(""),e.css({display:"block"})},LOADER_TIME_DELAY,!1):(a.cancel(h),e&&e.css({display:"none"}))}),b.$on("$destroy",function(){a.cancel(h),e=f=g=null})}}}]),angular.module("nxt-common").directive("nxtMeter",function(){"use strict";var a=75,b=90,c=100;return{restrict:"A",replace:!0,templateUrl:"/common/views/meter.html",scope:{value:"=nxtMeterValue",max:"=nxtMeterMax"},controller:["$scope",function(d){d.percent=0,d.$watch("max",function(e){d.value&&d.max&&(d.percent=100*d.value/d.max),d.percent>c?d.level="max":d.percent>b?d.level="normal":d.percent>a?d.level="optimum":d.level="min"})}]}}),angular.module("nxt-common").directive("nxtPickadate",["$rootScope","$timeout","ApplicationConfig",function(a,b,c){"use strict";return{restrict:"A",link:function(a,d,e){function f(){for(var c=angular.element(d[0].querySelector(".pickadate"))[0].isolateScope(),f=0;f<c.dates.length;f++)new Date(c.dates[f].date)>=new Date(a.filters.date_from)&&new Date(c.dates[f].date)<=new Date(a.filters.date_to)?c.dates[f].classNames[0]="check-dates":("pickadate-disabled"!==c.dates[f].classNames[0]&&(c.dates[f].classNames[0]="pickadate-enabled"),"filters.date_to"===e.ngModel&&new Date(a.filters.date_from)>new Date(c.dates[f].date)&&(c.dates[f].classNames[0]="pickadate-disabled"),"filters.date_from"===e.ngModel&&new Date(a.filters.date_from)<new Date(c.dates[f].date)&&new Date(a.filters.date_from)<new Date(a.filters.date_to)&&(c.dates[f].classNames[0]="pickadate-disabled"));b(function(){a.$digest()},0,!1)}function g(){"filters.date_from"===e.ngModel?a.datePickerToShow=!1:a.datePickerFromShow=!1,b(function(){a.$digest()},0,!1)}var h,i;d.on("click",function(b){if(g(),a.isMobile&&angular.element(event.target).hasClass("input--date")&&(angular.element(event.target).attr("type","text"),blur()),c.hacks.isIpad){var d=document.getElementsByClassName("pickadate-wrapper");angular.element(d[0]).addClass("pickadate-wrapper--ipad"),angular.element(d[1]).addClass("pickadate-wrapper--ipad")}new Date(a.filters.date_from)>new Date(a.filters.date_to)&&(a.filters.date_from=i),new Date(a.filters.date_to)<new Date(a.filters.date_from)&&(a.filters.date_to=h),h=a.filters.date_to,i=a.filters.date_from,f()}),a.focusElement=function(a){b(function(){document.querySelector(a).focus()},100,!1)},d.on("keydown",function(c){if(173===c.keyCode||189===c.keyCode){if("filters.date_from"===e.ngModel){var d=document.getElementById("search-date-from");d.value=d.value+"-"}if("filters.date_to"===e.ngModel){var f=document.getElementById("search-date-to");f.value=f.value+"-"}c.preventDefault()}8!==c.keyCode&&46!==c.keyCode||("filters.date_from"===e.ngModel?a.filters.date_from="undefined":a.filters.date_to="undefined",b(function(){a.$digest()},0,!1),c.preventDefault())}),a.today=function(b){var c=new Date;c=c.toISOString().substring(0,10),a.filters[b]=c},a.closePicker=function(c){b(function(){a[c]=!1,a.focusElement("#search"),a.$digest()},400,!1)},a.$on("$destroy",function(){d.off()})}}}]),angular.module("nxt-common").directive("nxtQuickEdit",function(){"use strict";var a,b="27",c=["INPUT","SELECT","TEXTAREA"],d=angular.element(document.body),e=function(b){var d=b.target;c.indexOf(d.nodeName)!==-1&&d.hasAttribute("nxt-quick-edit")?(a&&a.save(),a=angular.element(d).isolateScope(),a.edit()):a&&(a.save(),a=null)},f=function(c){a&&c.keyCode==b&&(a.reset(),a=null)};return navigator.userAgent.toLowerCase().indexOf("firefox")!==-1?d[0].addEventListener("focus",e,!0):d.on("focusin",e),d.on("click",e),d.on("keypress",f),{require:"ngModel",restrict:"A",scope:{quickEdit:"=nxtQuickEdit"},controller:["$scope",function(a){a.toggleReadonly=function(){a.$apply(function(){a.readonly=a.quickEdit!==!0&&!a.readonly})},a.$watch("quickEdit",function(b){a.readonly=a.quickEdit!==!0})}],link:function(a,b,c,d){var e;a.edit=function(){e=d.$viewValue,a.toggleReadonly()},a.save=function(){a.toggleReadonly(),a.readonly&&d.$dirty&&d.$valid&&(a.$emit("nxt-quick-edit:save",{name:d.$name,label:d.$viewValue,value:d.$modelValue}),d.$setPristine())},a.reset=function(){d.$setViewValue(e),d.$setPristine(),b.val(e),a.toggleReadonly()},a.$watch("readonly",function(a){b.attr("readonly",a)})}}}),angular.module("nxt-common").directive("nxtRemarketing",["$stateParams","$timeout","$state","$rootScope","ApplicationConfig",function(a,b,c,d,e){"use strict";var f;return{restrict:"A",replace:!0,templateUrl:function(a,b){return"item"==b.remarketingTemplate?"/common/views/remarketingMsgListItem.html":"message"==b.remarketingTemplate?"/common/views/remarketingMessage.html":void 0},controller:["$scope","ApplicationConfig",function(a,b){}],link:function(g){g.remarketingData=f,g.openRemarketingMessage=function(){c.go("message",{isRemarketing:!0})},g.close=function(){d.$broadcast("message:auto-open-message"),g.activeRemarketing=!1},d.$on("ads:create:message",function(h,i){b(function(){g.activeRemarketing=!0,g.remarketingData=i.response,f=g.remarketingData,g.$digest(),a.folderId==e.folders.SHOPPING?c.go("message",{isRemarketing:!0}):d.$broadcast("message:auto-open-message")},0,!1)})}}}]),angular.module("nxt-common").directive("nxtScrollDetector",["$timeout","ApplicationConfig","$window",function(a,b,c){"use strict";var d=b.env.device.isMobile?0:300;return{restrict:"A",link:function(e,f,g){function h(){var f;a.cancel(j),j=a(function(){f=b.hacks.AndroidVersion<4.1?c.scrollY+300:l.scrollTop,f+l.offsetHeight>=l.scrollHeight-3&&e.$emit(k+":bottom")},d,!1)}var i=[];if(!f.attr("nxt-attached-scroll-detectors")||!g.nxtScrollDetector||(i=f.attr("nxt-attached-scroll-detectors").split(" "),i.indexOf(g.nxtScrollDetector)===-1)){var j,k=g.nxtScrollDetector||"scroll-detector",l=f[0];g.nxtScrollDetector&&(i.push(g.nxtScrollDetector),f.attr("nxt-attached-scroll-detectors",i.join(" "))),f.on("scroll",h),b.hacks.AndroidVersion<4.1&&(f.css("overflow","inherit"),f.off("scroll",h)),e.$on("$destroy",function(){f.off("scroll",h)})}}}}]),angular.module("nxt-common").directive("nxtScrollToFocus",["$timeout","ApplicationConfig",function(a,b){"use strict";var c=300,d=30;return{restrict:"A",link:function(e,f,g){if(b.env.device.isMobile&&!b.hacks.isIOS){var h=document.getElementsByClassName(g.nxtScrollToFocus);f.on("focus",function(){var e=f[0].offsetTop;a(function(){b.hacks.isAndroidDefault&&angular.element(h[0]).css("padding-bottom",c+"px"),h[0].scrollTop=e-d},500,!1)}),b.hacks.isAndroidDefault&&f.on("focusout",function(){angular.element(h[0]).css("padding-bottom","")}),e.$on("$destroy",function(){f.off()})}}}}]),angular.module("nxt-common").directive("nxtSearchFollow",["$rootScope","$timeout",function(a,b){"use strict";return{restrict:"A",link:function(c,d,e){var f;c.$watch("$select.search",function(){b.cancel(f),f=b(function(){a.$broadcast("update-search:"+e.nxtSearchFollow,c.$select.search)},300,!1)})}}}]),angular.module("nxt-common").directive("nxtSelectState",["$rootScope","$timeout",function(a,b){"use strict";return{restrict:"A",link:function(b,c,d){b.$watch("$select.open",function(){b.$select.open||a.$broadcast("employee:update-filters-link")})}}}]),angular.module("nxt-common").directive("nxtStopTouchPropagation",function(){return{restrict:"A",link:function(a,b){b.on("touchstart touchmove touchend",function(a){a.stopPropagation(),a.preventDefault()}),a.$on("$destroy",function(){b.off()})}}}).directive("nxtStopTouchPropagationBrowser",function(){return{restrict:"A",link:function(a,b,c){var d=c.nxtStopTouchPropagationBrowser;navigator.userAgent.toLowerCase().indexOf(d)>-1&&b.on("touchstart touchmove touchend",function(a){a.stopPropagation(),a.preventDefault()}),a.$on("$destroy",function(){b.off()})}}}).directive("nxtStopClickPropagation",function(){return{restrict:"A",link:function(a,b){b.on("click touchend",function(a){a.stopPropagation(),a.preventDefault()}),a.$on("$destroy",function(){b.off()})}}}),angular.module("nxt-common").directive("nxtTabs",function(){"use strict";return{restrict:"A",controller:["$scope",function(a){this.tabs=a.tabs={}}]}}).directive("nxtTab",function(){"use strict";return{require:"^nxtTabs",restrict:"A",link:function(a,b,c,d){var e=c.nxtTab;if(d.tabs[e])d.tabs[e].isVisible||b.addClass("ng-hide"),d.tabs[e].elements.push(b);else{var f=!0;void 0!==a.filters.hidden?f=a.filters.hidden.indexOf(e)===-1:a.filters.hidden=[],f||b.addClass("ng-hide"),d.tabs[e]={isVisible:f,isDisable:!!c.nxtTabDisable,label:c.nxtTabLabel||b.text(),elements:[b],toggle:function(){this.isVisible?a.filters.hidden.push(e):a.filters.hidden.splice(a.filters.hidden.indexOf(e),1),this.isVisible=!this.isVisible,this.elements.forEach(function(a){a.toggleClass("ng-hide",!this.isVisible)},this)}}}}}}).directive("nxtTabsManager",function(){"use strict";return{require:"^nxtTabs",restrict:"A",link:function(a,b,c,d){a.tabs=[],Object.keys(d.tabs).forEach(function(b){a.tabs.push(d.tabs[b])})},template:"<ul class='tabs-manager' nxt-dropdown nxt-dropdown-icon='gearwheel' nxt-dropdown-onclose='employee:update-filters-link'><li class='tabs-manager-item' ng-repeat='tab in tabs' ng-click='$event.stopPropagation();' ng-show='!tab.isDisable'><input type='checkbox' id='tab_{{$index}}' ng-checked='tab.isVisible' ng-click='tab.toggle()'><label for='tab_{{$index}}' ng-bind='tab.label'></label></li></ul>"}}),angular.module("ui.tinymce",[]).value("uiTinymceConfig",{}).directive("uiTinymce",["uiTinymceConfig","Tools",function(a,b){a=a||{};var c=0;return{priority:10,require:"ngModel",link:function(d,e,f,g){var h,i,j,k=function(){g.$setViewValue(e.val()),d.$root.$$phase||d.$apply()};b.setElementIsolateScope(e,d),f.id||f.$set("id","uiTinymce"+c++),h=f.uiTinymce?d.$eval(f.uiTinymce):{},i={setup:function(a){a.on("init",function(a){g.$render()}),d.$on("ui-tinymce:update-model",function(){a.save(),k()}),a.on("ExecCommand",function(b){a.save(),k()}),h.setup&&(d.$eval(h.setup),delete h.setup)},mode:"exact",elements:f.id},angular.extend(i,a,h),setTimeout(function(){tinymce.init(i)}),g.$render=function(){j||(j=tinymce.get(f.id)),j&&j.setContent(g.$viewValue||"")}}}}]),angular.module("nxt-common").directive("nxtTooltip",function(){"use strict";var a=500,b=15,c=null;return{restrict:"A",replace:!0,template:"<div class='tooltip'></div>",scope:{},controller:["$scope","ApplicationConfig",function(a,b){a.isMobile=b.env.device.isMobile}],link:function(d,e,f){function g(){clearTimeout(c),e.removeClass("tooltip--active tooltip--right tooltip--left tooltip--top")}d.isMobile||(angular.element(document.body).on("mouseover",function(d){var f=d.target;if(f.hasAttribute("data-tooltip-in-parents"))do if(f=f.parentNode,f===document.body||f.hasAttribute("data-tooltip-stop-propagation"))return;while(!f.getAttribute("data-tooltip"));var g,h,i=f.getBoundingClientRect(),j=(f.getAttribute("data-tooltip")||"").trim(),k=f.hasAttribute("data-tooltip-instant"),l=f.getAttribute("data-tooltip-fixed-position")||"",m=document.body.offsetWidth,n=document.body.offsetHeight,o=f.hasAttribute("data-tooltip-top"),p=f.hasAttribute("data-tooltip-right"),q=f.hasAttribute("data-tooltip-left"),r=parseInt(f.getAttribute("data-tooltip-horizontal-offset"))||0;j.length&&(clearTimeout(c),c=setTimeout(function(){if(e.html(j).css({left:"auto",right:"auto",top:"auto","max-width":"none"}).addClass("tooltip--active"),m-i.left<e[0].offsetWidth+r||p?(g="right",e.css("right",m-i.right+r+"px").addClass("tooltip--right")):m-i.left===m||q?(g="left",e.css("left",i.left-e[0].offsetWidth/2+i.width+r+"px").addClass("tooltip--left")):(g="center",e.css("left",i.left-e[0].offsetWidth/2+i.width/2+r+"px")),h=e[0].getBoundingClientRect(),"right"===g?e.css("max-width",h.right-b+"px"):e.css("max-width",m-h.left-b+"px"),o||i.bottom+e[0].offsetHeight>n?e.css("top",i.top-e.prop("offsetHeight")+"px").addClass("tooltip--top"):e.css("top",i.bottom+"px"),l){var a=parseInt(l.split(",")[0],10),c=parseInt(l.split(",")[1],10);e.css("left",i.left+a+"px").css("top",i.top+c+"px"),e.removeClass("tooltip--right tooltip--left tooltip--top")}},k?0:a))}).on("mouseout",g).on("wheel",g),d.$on("tooltip:hide",g))}}}),angular.module("nxt-common").directive("nxtTooltipBubble",["TooltipBubble",function(a){"use strict";var b=15;return{restrict:"A",replace:!0,templateUrl:"/common/views/tooltipBubble.html",controller:["$scope","ApplicationConfig",function(a,b){a.isMobile=b.env.device.isMobile}],link:function(c,d){function e(a){if(f){var b=d[0].getBoundingClientRect(),e=g?b.top:b.top-35,h=g?b.bottom+35:b.bottom,i=b.left,j=b.right;(a.clientX<i||a.clientX>j||a.clientY<e||a.clientY>h)&&c.close()}}var f=!1,g=!1;c.close=function(){d.css({opacity:0,display:"none"}).removeClass("bubble--top"),f=!1},c.$on("ui-events:click",function(){c.close()}),c.isMobile||angular.element(document.body).on("mouseover",function(e){var h,i,j=e.target,k=j.getBoundingClientRect(),l=(j.getAttribute("data-tooltip-bubble")||"").trim(),m=a.getTooltipBubbleToShow(l),n=document.body.offsetWidth,o=document.body.offsetHeight;m&&(c.close(),d.css({display:"block",left:"auto",right:"auto",top:"auto","max-width":"none",zIndex:115,opacity:1}),f=!0,n-k.left<d[0].offsetWidth?(h="right",d.css("right",n-k.right+"px").addClass("tooltip--right")):n-k.left===n?(h="left",d.css("left",k.left-d[0].offsetWidth/2+k.width+"px").addClass("tooltip--left")):(h="center",d.css("left",k.left-20+"px")),i=d[0].getBoundingClientRect(),"right"===h?d.css("max-width",i.right-b+"px"):d.css("max-width",n-i.left-b+"px"),k.bottom+d[0].offsetHeight>o?(d.css("top",k.top-d.prop("offsetHeight")+"px").addClass("bubble--top"),g=!0):(d.css("top",k.bottom+15+"px"),g=!1),c.$apply(function(){c.bubbleContent=m.desc,c.bubbleTitleIcon=m.icon,c.bubbleTitle=m.title,c.bubbleLinkHref=m.href},!1))}).on("mouseout",e).on("wheel",c.close)}}}]),angular.module("nxt-common").directive("nxtTrack",["Track","ApplicationConfig",function(a,b){return{restrict:"A",replace:!0,scope:!1,controller:["$scope","Track",function(a,b){a.pushTrackCode=function(a){b.pushCode(a)}}],link:function(b,c,d){var e=function(b){c.on(b,function(c,d){var e=d||c.target,f=(e.getAttribute("data-track-"+b)||"").trim(),g="",h=e.getAttribute("data-track-"+b+"-iwa-folder");f.length>0&&(g=(e.getAttribute("data-track-"+b+"-att")||"").trim(),g.length>0&&(g=g.split("^")),a.pushCode(f,g)),h&&a.pushIWAFolder(h)})};e("click"),NXT_CONFIG.env&&!NXT_CONFIG.env.isMobileApp&&e("change"),e("dropdownopen"),b.$on("$destroy",function(){c.off()})}}}]),angular.module("nxt-common").directive("nxtUiEvents",["$rootScope",function(a){"use strict";var b={27:"Escape",37:"Left",38:"Up",39:"Right",40:"Down"},c=Object.keys(b);return{restrict:"A",controller:["$scope",function(a){return this.events=a.events=["click","keydown"],a}],link:function(d,e,f){d.events.forEach(function(d){e.on(d,function(d){var e=d.__UiEvents__||{},f=d.keyCode+"";if(c.indexOf(f)!==-1){var g=b[f];a.$broadcast("ui-events:"+d.type+":"+g,e)}else"click"==d.type&&a.$broadcast("ui-events:click",{})})}),d.$on("$destroy",function(){e.off()})}}}]),angular.module("nxt-common").directive("nxtUiEventsData",function(){"use strict";return{require:"^nxtUiEvents",restrict:"A",scope:{data:"=?nxtUiEventsData"},link:function(a,b,c,d){d.events.forEach(function(c){b.on(c,function(b){b.__UiEvents__=a.data})}),a.$on("$destroy",function(){b.off()})}}}),angular.module("nxt-common").directive("nxtUploadButtonHover",["$window","$timeout","ApplicationConfig",function(a,b,c){"use strict";var d=500,e="notHover";return{restrict:"A",scope:{},link:function(f,g){c.env.device.isMobile||(g.on("click",function(){g.addClass(e);var c=a.onfocus;a.onfocus=function(){b(function(){g.removeClass(e)},d,!1),a.onfocus=c}}),f.$on("$destroy",function(){g.off()}))}}}]),angular.module("nxt-common").directive("nxtValidEmail",["$parse",function(a){"use strict";var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return{require:"ngModel",restrict:"A",link:function(c,d,e,f){var g,h=a(e.nxtValidEmail),i=function(){var a=h(c);return a&&a.hasOwnProperty("$viewValue")&&(a=a.$viewValue),a};c.$watch(i,function(a){g=a});var j=e.nxtValidEmailId||"validEmail";f.$validators[j]=function(a){return!a||(a.indexOf("@")===-1&&(a+="@"+g),b.test(a))}}}}]),angular.module("nxt-common").directive("nxtValidPassword",function(){"use strict";var a=5,b={numbers:/[0-9]/,letters:/[a-z]/i,specialChars:/[-+\*=_!@#$%^&\(\)\{\}\[\]\|:;,\.<>\?\/\\\"\'`~]/};return{require:"ngModel",restrict:"A",link:function(c,d,e,f){e.nxtValidPasswordMinLength&&(a=e.nxtValidPasswordMinLength),f.$validators.validPassword=function(){if(f.$viewValue){if(f.$viewValue.length<a)return!1;var c=b.numbers.test(f.$viewValue),d=b.letters.test(f.$viewValue),e=b.specialChars.test(f.$viewValue);return c+d+e>1}return!0}}}}),angular.module("nxt-common").directive("nxtValidPasswordEqual",["$parse",function(a){"use strict";return{require:"ngModel",restrict:"A",link:function(b,c,d,e){var f=a(d.nxtValidPasswordEqual),g=function(){var a=f(b);return a&&a.hasOwnProperty("$viewValue")&&(a=a.$viewValue),
a};e.$validators.validPasswordEqual=function(){return e.$viewValue===g()},b.$watch(g,function(){e.$validate()})}}}]),angular.module("nxt-common").directive("nxtValidPhone",function(){"use strict";var a=/^[(]{0,1}[0-9]{3}[)\.\- ]{0,1}[0-9]{3}[\.\- ]{0,1}[0-9]{3}$/;return{require:"ngModel",restrict:"A",link:function(b,c,d,e){e.$validators.validPhone=function(){return!e.$viewValue||a.test(e.$viewValue)}}}}),angular.module("nxt-common").directive("nxtValidUrl",function(){"use strict";var a=/^([a-zA-Z0-9\-\/]+(\.[a-zA-Z0-9\-\/]+)*)$/;return{require:"ngModel",restrict:"A",link:function(b,c,d,e){e.$validators.validUrl=function(){return!e.$viewValue||a.test(e.$viewValue)}}}}),angular.module("nxt-composition").directive("nxtAutoCenterVertically",["ApplicationConfig",function(a){return{restrict:"A",link:function(b,c,d){function e(){var a,b=c[0].getBoundingClientRect(),d=document.documentElement.clientHeight;b.bottom>d&&(a=(d-b.height)/2,c.css({top:a+"px"}))}a.env.device.isMobile||b.$on("ac:update",e)}}}]),angular.module("nxt-composition").directive("nxtAutoGrow",["$timeout",function(a){var b=15,c=65;return{restrict:"A",link:function(d,e,f){function g(){l=e.prop("scrollHeight"),m=e.prop("offsetHeight"),l>m&&(k=l+b,e.css({height:k+"px"}),d.$emit("composition:updateSize"))}function h(){a.cancel(n),n=a(g,200,!1)}function i(){k||(k=c,e.css({height:k+"px"})),g(),e.on("change",h)}function j(){e.css(""),e.off("change",h)}var k,l,m,n;f.$observe("nxtAutoGrow",function(a){a===!0||"true"===a?i():a!==!1&&"false"!==a||j()}),d.$on("$destroy",j),d.$on("auto-grow:grow",g)}}}]),angular.module("nxt-composition").directive("nxtAutogrowInput",["$timeout","$rootScope","ApplicationConfig",function(a,b,c){var d=130,e=25,f=5;return{restrict:"A",link:function(c,g){function h(){t=s.getBoundingClientRect(),o=s.querySelectorAll(".email-input-plain-element"),o.length&&(p=o[o.length-1]),q=r.getBoundingClientRect(),q&&q.left&&(q=q.left)}function i(){u=1,r.style.width=t.right-q-d+"px",r.style.height=u*e+f+"px",v=!1}function j(){r.style.width=t.width-d+"px",v=!0}function k(){u++,r.style.height=u*e+f+"px"}function l(){a(function(){r.offsetHeight<r.scrollHeight?(h(),v?k():j()):""===r.value&&(h(),i())},350,!1)}function m(){r.style.width=t.width-d+"px",a(function(){h(),i()},350,!1)}function n(){g[0].blur(),scrollTo(0,0),a(function(){l()},400,!1)}var o,p,q,r=g[0],s=r.parentNode,t=s.getBoundingClientRect(),u=1,v=!0;m(),g.on("keyup paste",l),angular.element(window).on("orientationchange",n),c.$on("eip:reset-input",m),b.$on("service:message:resize-handler",function(){m()}),c.$on("$destroy",function(){angular.element(window).off("orientationchange",n)})}}}]),angular.module("nxt-composition").directive("nxtCthumbnail",["ApplicationConfig",function(a){return{restrict:"A",scope:{cthumbnail:"=nxtCthumbnail"},link:function(b,c,d){if(window.CanvasRenderingContext2D&&(window.URL||window.webkitURL)){var e=c[0].querySelector("canvas"),f=e.getContext("2d"),g=new Image;e.width=155,e.height=136,g.onload=function(){var a,b,c,d,h,i=e.width,j=e.height;g.width>i||g.height>j?(h=Math.max(i/g.width,j/g.height),a=Math.round(h*g.width),b=Math.round(h*g.height)):(a=g.width,b=g.height),c=Math.round((i-a)/2),d=Math.round((j-b)/2),f.fillStyle="#ffffff",f.fillRect(0,0,i,j),f.drawImage(g,c,d,a,b)},b.$watch("cthumbnail",function(){b.cthumbnail&&b.cthumbnail.remote&&/\.(jpe?g|gif|png)$/i.test(b.cthumbnail.name)?g.src=a.env.uploadUrl+"/html/getattach,mid,"+b.cthumbnail.mid+",mpid,"+b.cthumbnail.mpid+",uid,"+a.env.uid+",min,1,nc,1?f="+b.cthumbnail.name:b.cthumbnail&&b.cthumbnail.type&&b.cthumbnail.type.match("image.*")&&(window.URL?g.src=URL.createObjectURL(b.cthumbnail):window.webkitURL&&(g.src=webkitURL.createObjectURL(b.cthumbnail)))})}else b.$watch("cthumbnail",function(){b.cthumbnail&&b.cthumbnail.remote&&/\.(jpe?g|gif|png)$/.test(b.cthumbnail.name)&&c.css({"background-image":"url("+a.env.uploadUrl+"/html/getattach,mid,"+b.cthumbnail.mid+",mpid,"+b.cthumbnail.mpid+",uid,"+a.env.uid+",min,1,nc,1?f="+b.cthumbnail.name+")"})})},template:"<canvas></canvas>"}}]),angular.module("nxt-composition").directive("nxtComposition",["Compositions","Uploader","Notification","$timeout","ApplicationConfig","Track","$state","$rootScope","Tools","$stateParams","$interval","Contact","Sender","ExternalAccount",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=48;return{restrict:"A",scope:{mode:"@nxtMode",dialogid:"@nxtDialogid",defaults:"=nxtDefaults"},link:function(p,q){function r(){p.sender=m.autoSelectSender({accounts:p.accounts,senderConfig:V,setIfChangingSenderAllowed:function(a){fa=a},setFilteredAccounts:function(a){p.filteredAccounts=a}})}function s(a){if(p.$parent&&p.$parent.$parent&&p.$parent.$parent.params&&p.$parent.$parent.params.compositionConfig&&!angular.isUndefined(p.$parent.$parent.params.compositionConfig[a]))return p.$parent.$parent.params.compositionConfig[a]}function t(){p.$emit("directive:emailinput:focus",{addEmailFn:null})}function u(){return!ka.some(function(a){return a})}function v(a){ka[a]=!0,p.isSendingEnabled=u()}function w(a){ka[a]=!1,p.isSendingEnabled=u()}function x(){return Z?p.isSimplified?Z.innerHTML:Z.value:""}function y(a){return p.isSimplified?void(Z.innerHTML+="<br><br>"+a):p.isHTML?void p.$broadcast("tinymce:insert-content","<br><br>"+a):(Z.value+="\n\n"+i.stripTagsFormatBlockQuotes(a),void p.$broadcast("auto-grow:grow"))}function z(a){c.success("composition:message-sent"),a&&a.mid&&parseInt(a.mid)>0&&p.$emit("composition:sent",{originalMessageId:p.defaults&&p.defaults.mesg,newMessageId:a.mid,threadId:a.thId})}function A(){return{recipients:p.recipients,subject:p.subject,selectedSignature:p.selectedSignature,isHTML:p.isHTML,originalContent:p.originalContent,originalMessageRevealed:p.originalMessageRevealed,selectedStationery:p.selectedStationery,attachments:p.attachments,compositionId:p.compositionId,sender:p.sender,important:p.isImportant,rawContent:x()}}function B(){var a=b.getUploader(p);p.uploader||(p.uploader=a.uploader),p.inlineUploader||(p.inlineUploader=a.inlineUploader),d(function(){$=da.querySelector(".composition-upload-button--normal"),_=da.querySelector(".composition-upload-button--inline"),aa=da.querySelector(".composition-wrapper"),ba=angular.element(aa.parentNode)},0,!1)}function C(){a.sendMessage("send",{onBeforeStart:function(){ba.addClass("sending")},onSuccess:function(b){p.dialogid?(a.removeComposition(p.dialogid),c.success("composition:message-sent"),p.$emit("dialog:remove-shadow")):z(b),h.$broadcast("tooltip:hide"),parseInt(j.folderId)===parseInt(e.folders.DRAFTS)&&"e"===p.opt&&h.$broadcast("folder:refresh",{refreshCache:!0}),p.sending=!1},onError:function(){ba.removeClass("sending"),c.error("composition:sending-error"),p.$emit("dialog:remove-shadow"),p.sending=!1},config:A()})}function D(){a.sendMessage("reply",{onBeforeStart:function(){ba.addClass("sending")},onSuccess:function(b){p.dialogid?(a.removeComposition(p.dialogid),c.success("composition:message-sent"),p.$emit("dialog:remove-shadow")):z(b),e.env.device.isMobile||h.$broadcast("tooltip:hide"),parseInt(j.folderId)===parseInt(e.folders.DRAFTS)&&"e"===p.opt&&h.$broadcast("folder:refresh",{refreshCache:!0}),p.sending=!1},onError:function(){ba.removeClass("sending"),c.error("composition:sending-error"),p.$emit("dialog:remove-shadow"),p.sending=!1},config:A()})}function E(a){var b;p.singleTo=a.to,b=l.mapCompositionContacts(a,p.sender),p.to=b.to,p.cc=b.cc,p.bcc=b.bcc,p.isReplyingToSingle===!0&&F()}function F(){p.allTo=p.to,p.allCc=p.cc,p.to=p.singleTo,p.cc=null}function G(a){var b=a.body,c="<blockquote",d=b.indexOf(c),e=b.substring(0,d),f=b.substring(d),g=f.substring(0,70);return g.indexOf("nxt-original-message-notrevealed")!==-1&&(a.body=e,f=f.replace(/ class="nxt-original-message-notrevealed"/,""),a.originalContent=f,a.originalMessageRevealed=!1),a}function H(b){e.env.isSpammer&&p.dialogid&&a.removeComposition(p.dialogid),a.get(b).then(function(a){var c=a.data;p.isCompositionActive=!0,p.$emit("composition:activated"),angular.isObject(b.relatedDraft)?N(angular.extend(b.relatedDraft,{mid:c.mid})):"ra"===b.opt?(c.to&&delete c.to,c.replyTo&&delete c.replyTo,c.cc&&delete c.cc,c.bcc&&delete c.bcc,N(c)):N("e"===b.opt?G(c):b.opt?c:angular.extend(c,b))},function(){p.dialogid&&a.removeComposition(p.dialogid)})}function I(a){var b={to:"to",cc:"cc",bcc:"bcc",subject:"subject",body:"content",originalContent:"originalContent",compositionId:"compositionId",opt:"opt",autoFocusContent:"autoFocusContent"};a=a||{},a.signatureId&&e.signatures[a.signatureId]&&(p.selectedSignature=e.signatures[a.signatureId]);for(var c in b)a.hasOwnProperty(c)&&(a[c]&&a[c].length||angular.isObject(a[c])||"boolean"==typeof a[c])&&(p[b[c]]=a[c]);angular.isObject(a.senderConfig)&&!angular.isObject(V)&&(V=a.senderConfig,r()),d(function(){"embeded"!==p.mode&&("ra"===p.opt||p.autoFocusContent?p.focusEditor():(Y||(Y=da.querySelector('[nxt-name="composition-to"] .email-input-plain-input')),Y&&Y.focus())),p.updateTitle()},150)}function J(a){var b,c=p.isHTML?"<br>":"\n";return b=["","<div style='display:none' data-inpl-forward-mark></div>","------ Wiadomość oryginalna ------","Temat: "+i.getTextOnly(a.org_subject),"Data: "+i.getTextOnly(a.org_date),"Nadawca: "+a.org_from,"Adresat: "+a.org_to],a.org_cc&&b.push("DW: "+a.org_cc),b.push(c),b.join(c)}function K(a){var b=p.isHTML?"<br>":"\n";return["Od: "+a.org_from.replace("<","&lt;").replace(">","&gt;"),"Do: "+a.org_to.replace("<","&lt;").replace(">","&gt;"),"Wysłane: "+i.formatDateForReply(a.org_date),"Temat: "+i.getTextOnly(a.org_subject),b].join(b)}function L(a){return['<div class="inpl-collapsed">',a,"</div>"].join("")}function M(a){var b,c,d=a;return"ra"!==d.opt||d.noParamsRequest?"f"===d.opt?(b=document.createElement("div"),b.innerHTML=d.body,c=b.querySelector("blockquote"),c.className="noHidden",c.insertAdjacentHTML("beforebegin",J(d)),d.body=b.innerHTML):"e"===d.opt&&d.from&&(d.senderConfig={fromEmail:d.from,isDraft:!0},delete d.from):(d.to=d.replyTo,e.prefs.attachOnReply&&(p.originalContent=L(K(d)+d.body)),d.body=""),d}function N(a){if(void 0!==a.gallery&&(p.isGalleryState=a.gallery.state),p.compositionId=a.messageId||a.mid,I(M(a)),B(),p.uploader.loadAttachments(a),ia=p.attachments.length,e.env.isMobileApp){p.attachmentsFullSize+=1048576*p.uploader.totalSize||0;try{MobileAppConnector.onCompositionComplete(p.compositionId,e.env.uid)}catch(b){console.log("MobileAppConnector.onChooseFiles - only to use in mobileApp")}}}function O(a,b){var c=angular.copy(b);return c.allowOwnEmails||[c.cc,c.bcc,c.from,c.to].forEach(function(a,b,c){c[b]=l.filterOutOwnContacts(a,U)}),c.senderConfig&&(V=c.senderConfig),r(),c.noActivation===!0?void E(c):("undefined"==typeof c.noActivation&&E(c),void(c.noParamsRequest?(p.isCompositionActive=!0,N(c)):H(c)))}function P(){p.isModified&&!W&&p.save(),la&&clearInterval(la)}function Q(){p.isSimplified&&angular.element(document.body).addClass("displaying-simplified-composition"),p.accounts=a.getStoredExternalAccounts(),angular.isArray(p.accounts)&&(U=p.accounts.map(function(a){return a.email.toLowerCase()})),angular.isObject(p.defaults)?p.$watchCollection("defaults",function(a){O(null,a)}):(r(),p.$on("composition:defaultsProvided",O)),angular.isObject(p.defaults)||p.$emit("composition:getDefaults")}function R(){p.isSaving=!0}function S(){p.isSaving=!1,h.$broadcast("directive:composition:saved-finish")}function T(a){if(sessionStorage)try{var b=sessionStorage.getItem("extAccReq");if(null!==b){var c=JSON.parse(b).accs;return c.indexOf(a)!==-1}}catch(d){}return!1}var U,V,W,X,Y,Z,$,_,aa,ba,ca,da=q[0],ea={UPLOADING:1,NO_COMPOSITION_ID:2},fa=!1,ga=!1,ha=!1,ia=0,ja=p.$parent&&p.$parent.$parent&&p.$parent.$parent.params&&p.$parent.$parent.params.compositionConfig&&p.$parent.$parent.params.compositionConfig.singleInstanceId,ka=[],la=null;p.isSimplified=e.env.device.isMobile,p.isMobile=e.env.device.isMobile,p.managerError=!0,e.env.device.isMobile&&(p.$on("composition:enableAutosave",function(a){ca=!1,p.markCompositionAsModified()}),p.$on("resizeCanvas",function(a,b){p.uploader.addToQueue(b,{url:p.uploadUrl})}),p.$on("document",function(a,b){p.uploader.addToQueue(b,{url:p.uploadUrl})})),p.markCompositionAsModified=function(){ca||(p.isModified=!0,k.cancel(X),X=k(function(){p.isModified&&!W&&p.save({showError:!1})},3e4))},p.markCompositionAsUnmodified=function(){p.isModified=!1,k.cancel(X)},p.markCompositionAsUnmodified(),p.isHTML=!0,p.isSendingEnabled=!0,p.isImportant=0,p.recipients=[],p.isSaving=!1,p.attachmentsFullSize=0,p.publicGalleryEnabled=1==e.env.publicGalleryEnabled,p.isReplyingToSingle=s("isReplyingToSingle"),p.isReplyingToSingle=angular.isUndefined(p.isReplyingToSingle)?e.env.replyOption:p.isReplyingToSingle,p.focusEditor=function(a){p.compositionId?d(function(){p.isHTML?e.env.device.isMobile?(Z.focus(),Z.focus()):p.$broadcast("tinymce:focus"):Z.focus(),"undefined"!=typeof a&&a!==!0||da.scrollIntoView(!1),e.env.device.isMobile&&(document.body.scrollTop=document.documentElement.scrollTop=Z.offsetTop-(e.hacks.isIOS?0:o))},0,!1):ha=!0},p.mobileFocus=function(a){var b=document.documentElement.scrollTop,c=0;la=window.setInterval(function(){c++,(b!=document.documentElement.scrollTop||c>=50)&&(document.documentElement.scrollTop=b,clearInterval(la))},10)},p.popOutComposition=function(){var b;p.compositionId?b={noParamsRequest:p.isCompositionActive,messageId:p.compositionId,from:p.sender,to:p.recipients.to,cc:p.recipients.cc,bcc:p.recipients.bcc,subject:p.subject,prior:p.isImportant,body:x(),originalContent:p.originalContent,isHTML:p.isHTML,uploaderQueue:p.uploader&&p.uploader.queue,attachments:p.attachments,opt:p.opt,originalRecipients:p.defaults&&p.defaults.originalRecipients,singleInstanceId:p.defaults&&p.defaults.mesg}:(b=angular.copy(p.defaults),"undefined"!=typeof b.noActivation&&delete b.noActivation),a.addComposition(b)},p.toggleImportant=function(){return p.isImportant^=1,1===parseInt(p.isImportant)&&f.pushCode("mailToggleImportant"),p.isImportant},p.sendButtonClickHandler=function(){!e.env.device.isMobile&&p.isHTML&&p.$broadcast("ui-tinymce:update-model"),k.cancel(X),W=!0,p.$broadcast("composition:validateAndAddContact"),d(function(){p.isSendingEnabled&&(l.countContacts(p.recipients)>0?(p.sending=!0,e.hacks.isIOS&&(da.querySelector('[nxt-name="composition-to"] .email-input-plain-input').blur(),p.scrollToTop()),"ra"===p.opt?D():C(),f.pushCode("sendMail")):(c.error("composition:no-recipients"),da.querySelector('[nxt-name="composition-to"] .email-input-plain-input').focus())),p.$digest()},0,!1)},p.save=function(b){if(!e.env.device.isMobile&&p.isHTML&&p.$broadcast("ui-tinymce:update-model"),p.isSendingEnabled){b=b||{};var d=void 0===b.showError||b.showError;R(),a.sendMessage("save",{onSuccess:function(a){if(a.attach.list){p.attachments=[];for(var b=0;b<a.attach.list.length;b++)p.attachments.push(a.attach.list[b].mpid),p.uploader.queue[b].mimePartIndex=a.attach.list[b].mpid}a.mid&&(p.compositionId=a.mid),d&&c.success("composition:message-saved"),p.markCompositionAsUnmodified(),"e"!==p.opt&&(h.$broadcast("directive:newcomposition:save"),p.opt="e"),ja&&h.$broadcast("composition:saved",ja),parseInt(j.folderId)===parseInt(e.folders.DRAFTS)&&h.$broadcast("folder:refresh",{refreshCache:!0}),S()},onError:function(){d&&c.error("composition:saving-error"),S()},config:A()})}},p.updateTitle=function(){p.$emit("dialog:update-title",p.subject||"Nowa wiadomość")},p.emailInputsBlurred=function(){p.$broadcast("directive:emailinput:blur"),t()},p.revealOriginalMessage=function(){p.originalMessageRevealed=!0,y(p.originalContent)};var ma=function(a){if(sessionStorage)try{var b=sessionStorage.getItem("extAccReq");if(null!==b){var c=JSON.parse(b).accs,d=c.indexOf(a);d!==-1&&c.splice(d,1),sessionStorage.setItem("extAccReq",JSON.stringify({accs:c}))}}catch(e){}};if(p.setSender=function(b){1===parseInt(b.allowSend)?(p.sender=b,p.markCompositionAsModified(),h.$broadcast("hideAllPanels")):T(b.email)?n.query(1,!0).success(function(d){var e=d.filter(function(a){return b.email===a.email})[0];e&&1===parseInt(e.allowSend)?(a.updateExternalAccounts(),p.setSender(e),ma(b.email)):c.error("external-account::noactive")}):c.error("external-account::noactive")},p.activateComposition=function(){if(!p.isCompositionActive&&angular.isObject(p.defaults)){var a=angular.copy(p.defaults);p.isCompositionActive=!0,a.noActivation=!1,O(null,a)}},p.scrollToUploadManager=function(){if(aa){var a=aa.scrollHeight;(p.uploader.isItemsCountExceeded||p.uploader.isTotalSizeExceeded)&&(a-=aa.getElementsByClassName("upload-manager")[0].offsetHeight),aa.scrollTop=a}},p.scrollToTop=function(){aa&&d(function(){aa.scrollTop=0},150,!1)},p.loopFocus=function(){var a;da.querySelector(".composition-all-recipients.ng-hide")?a=da.querySelector('[nxt-name="composition-to"] .email-input-plain-input'):p.$parent.id&&(a=da.querySelector(".composition-subject")),a?a.focus():p.focusEditor(!1)},p.replyToSingle=function(){p.$broadcast("composition:removeAllContacts"),p.isReplyingToSingle=!0,p.singleTo&&F()},p.replyToAll=function(){p.$broadcast("composition:removeAllContacts"),p.isReplyingToSingle=!1,p.allTo&&(p.to=p.allTo),p.allCc&&(p.cc=p.allCc)},p.addAccount=function(){p.$emit("dialog:demaximize"),a.waitForNewAccount(),ga=!0,g.current.name.indexOf(".external-account.configure")==-1&&g.go(".external-account.configure")},p.fileUploadClick=function(){if($||($=da.querySelector(".composition-upload-button--normal")),b.fakeFileInputClick($,p),e.env.isMobileApp){k.cancel(X),ca=!0;try{MobileAppConnector.onChooseFiles(p.compositionId,e.env.uid,p.attachmentsFullSize)}catch(a){console.log("MobileAppConnector.onChooseFiles - only to use in mobileApp")}}},p.inputMobileButton=function(){if(e.env.isMobileApp){k.cancel(X),ca=!0;try{MobileAppConnector.onChooseFiles(p.compositionId,e.env.uid,p.attachmentsFullSize)}catch(a){console.log("MobileAppConnector.onChooseFiles - only to use in mobileApp")}}else e.hacks.isIOS?p.fileUploadClick():document.getElementById("fakeMobileInput").click()},p.close=function(){p.managerError=!1},e.hacks.isIOS)var na=angular.element(document.querySelectorAll(".dialog-header")),oa=angular.element(document.querySelectorAll(".composition-simplified-toolbar"));p.absoluteHeader=function(){e.env.device.isMobile&&e.hacks.isIOS&&(na.css("position","absolute"),oa.css("position","absolute"))},p.fixedHeader=function(){e.env.device.isMobile&&e.hacks.isIOS&&(na.css("position","fixed"),oa.css("position","fixed"))},p.$on("directive:dialog:close",function(){p.isModified&&f.pushCode("mailAutosaveClose")}),e.env.device.isMobile||(p.$on("tinymce:stationerySelected",function(a,b){p.selectedStationery=b}),p.$on("tinymce:button:inlineimage",function(){b.fakeFileInputClick(_),h.$broadcast("tooltip:hide")}),p.$on("tinymce:content:focus",function(){p.activateComposition(),ba.addClass("focus"),p.emailInputsBlurred(),h.$broadcast("hideAllPanels")}),p.$on("tinymce:content:blur",function(){ba.removeClass("focus")}),p.$on("tinymce:switched-editor-mode",function(a,b){d(function(){p.isHTML=b.isHTML,p.isHTML||(p.originalMessageRevealed||(p.originalContent=i.stripTagsFormatBlockQuotes(p.originalContent)),p.$broadcast("auto-grow:grow")),p.markCompositionAsUnmodified(),p.$digest()},0,!1)}),p.$on("directive:dialog:toggle",function(){d(function(){p.focusEditor(),p.$broadcast("tinymce:autoresize")},150,!1)})),e.env.device.isMobile?p.close=function(){h.$broadcast("directive:dialog:close-composition")}:(p.$on("composition:scroll-to-top",p.scrollToTop),p.$on("composition:popout",p.popOutComposition),p.$on("composition:forced-focus",p.focusEditor)),p.$on("composition:save",function(){p.isModified&&p.save()}),p.$on("composition:mark-as-modified",p.markCompositionAsModified),p.$on("compositions:update-sender",function(b,c){var d;if(p.accounts=a.getStoredExternalAccounts(),p.filteredAccounts=p.accounts,d=p.accounts.some(function(a){p.sender.email=a.email}),d||r(),c&&(c.isGlobal&&fa||ga))for(var e=0;e<p.filteredAccounts.length;e++)p.filteredAccounts[e].email===c.addedAccountEmail&&(p.sender=p.filteredAccounts[e])}),p.$on("composition:updateRecipients",function(a,b){p.recipients=b}),p.$on("composition:disableSending",function(){v(ea.UPLOADING)}),p.$on("composition:enableSending",function(){w(ea.UPLOADING)}),p.$on("$destroy",function(){k.cancel(X),p.isModified&&!W&&p.save(),t(),angular.element(document.body).removeClass("displaying-simplified-composition")}),p.$watch("compositionId",function(a){return a?(w(ea.NO_COMPOSITION_ID),ha&&d(function(){p.focusEditor(!1)},300,!1),Z=da.querySelector(".composition-content"),angular.element(Z).one("change",p.markCompositionAsModified),void p.uploader.updateUploadUrls()):void v(ea.NO_COMPOSITION_ID)}),NXT_CONFIG.env.isMobileApp&&(p.$on("composition:add:attachment",function(a,b){p.attachmentsFullSize+=b.attach.totalSize,b.mid=p.compositionId,h.$apply(function(){p.uploader&&(p.uploader.loadAttachments(b),ia=b.attach.list.length)})}),p.isUploadOnlyImages=e.hacks.isIOS),angular.element(window).on("beforeunload",P),Q()},templateUrl:function(){return e.env.device.isMobile?"/composition/views/composition_mobile.html":"/composition/views/composition.html"}}}]),angular.module("nxt-composition").directive("nxtContextAwareOverflow",["$timeout",function(a){var b=2;return{restrict:"A",scope:{params:"=nxtContextAwareOverflow"},link:function(a,c){var d=c[0],e=d,f=Math.ceil;a.params.checkParent&&(e=d.parentNode),a.$watchCollection("params",function(a){if(a&&a.string){var c,g=angular.copy(a),h=angular.copy(a.string),i=g.string.length,j=f(i/2);if(d.innerHTML="",d.appendChild(document.createTextNode(g.string+" "+g.suffix)),c=e.offsetWidth,g.string.length>3&&c+b<e.scrollWidth){d.innerHTML="",d.appendChild(document.createTextNode(h+"... "+g.suffix));do c<e.scrollWidth?i-=j:i+=j,j=f(j/2),d.innerHTML="",d.appendChild(document.createTextNode(h.substring(0,i)+"... "+g.suffix));while(j>1||c<e.scrollWidth)}}})}}}]),angular.module("nxt-composition").directive("nxtEmailInputPlain",["$timeout","Contact","ContactGroup","Track","ApplicationConfig","ApplicationData",function(a,b,c,d,e,f){return{restrict:"A",scope:{name:"@nxtName",basevalue:"=nxtBasevalue",isEditing:"=nxtIsEditing"},link:function(c,g){function h(a){if(a)for(var b=0;b<K.length;b++)if(K[b][c.ContactKeys.EMAIL]===a){if(K[b][c.ContactKeys.EMAIL]===K[b][c.ContactKeys.NAME])break;return K[b][c.ContactKeys.NAME]}return null}function i(a){if(a)for(var b=0;b<K.length;b++)if(K[b][c.ContactKeys.EMAIL]===a)return K[b][c.ContactKeys.ID];return null}function j(a){if(a)for(var b=0;b<K.length;b++)if(K[b][c.ContactKeys.EMAIL]===a)return K[b][c.ContactKeys.TYPE]||1;return null}function k(b){a(function(){c.selectedContacts.forEach(function(a){a.email===b.email&&(a.isAnimationEnabled=!0,a.isNewlyAdded=!1)}),c.$digest()},300,!1),a(function(){c.selectedContacts.forEach(function(a){a.email===b.email&&(a.isAnimationEnabled=!1)})},700,!1)}function l(a,b,e){var f,g=angular.copy(a);if((!b||"users@interia.pl"!=g.email)&&g.email){for(g.isAnimationEnabled=!1,c.isSuggestHidden=!0,f=0;f<c.selectedContacts.length;f++)if(c.selectedContacts[f].email===g.email)return void(b||(c.selectedContacts[f].isNewlyAdded=!0,k(g),c.focusInput()));for(b||(g.isNewlyAdded=!0),g.name=g.name||h(g.email),g.id=g.id||i(g.email),g.type=g.type||j(g.email),c.selectedContacts.push(g),f=0;f<K.length;f++)K[f][c.ContactKeys.EMAIL]===g.email&&(K[f][c.ContactKeys.IS_FORCED_HIDDEN]=!0);if(c.$emit("directive:emailinput:recipientsupdated"),c.$emit("emailinput:contactAdded",{listName:c.name.split("-").pop(),contact:g}),b||(k(g),c.$emit("composition:mark-as-modified")),!e)switch(c.name.split("-").pop()){case"cc":d.pushCode("newMailDW");break;case"bcc":d.pushCode("newMailUDW")}}}function m(a){var b=a.replace(/^mailto:|^\s+|\s+$/g,"").replace(/[,;]$/g,"");if(b.indexOf("<")===-1&&b.indexOf("(")===-1)/^\S+@\S+\.\S+$/.test(b)&&(l({email:b}),c.resetInput());else{var d,e=b.match(/^(.*)[<\(](\S+@\S+\.\S+)[\>\)]$/);null!==e&&e[2].length&&(d={email:e[2]},e[1].length&&(d.name=e[1].replace(/^\s+|\s+$/g,"")),l(d),c.resetInput())}}function n(){var a=G.val().replace(/,/g,";").replace(/^\s+|\s+$/g,"").split(";");a.forEach(m)}function o(){var a=G.val().replace(/^\s+|\s+$/g,"");m(a)}function p(a,b){angular.isArray(a)?a.forEach(function(a){l(a,b,!0)}):angular.isObject(a)&&l(a,b,!0),c.$broadcast("eip:reset-input")}function q(){c.contacts&&c.contacts.length?(c.selectedContactIndex=0,c.selectedGroupIndex=null):(c.selectedGroupIndex=0,c.selectedContactIndex=null)}function r(){var a=0,d=G.val().toLowerCase(),e=30;c.inputNodeLength=d.length,d.length&&(K.forEach(function(b,e,f){!b[c.ContactKeys.IS_FORCED_HIDDEN]&&b[c.ContactKeys.WORDS].some(function(a){return a.indexOf(d)!==-1})?(f[e][c.ContactKeys.IS_HIDDEN]=!1,a++):f[e][c.ContactKeys.IS_HIDDEN]=!0}),c.suggestLength=a,c.isContactFromSuggestSelected=!!a,c.isSuggestHidden=!1,c.contacts=[],c.contacts=K.filter(function(a){return!a[c.ContactKeys.IS_FORCED_HIDDEN]&&!a[c.ContactKeys.IS_HIDDEN]&&e>0&&(e--,!0)}),c.groups=[],L.forEach(function(a){a.words.some(function(a){return a.indexOf(d)!==-1})&&b.isNotEmpty(K,a.id)&&c.groups.push(a)}),q())}function s(){null!==c.selectedContactIndex?c.selectedContactIndex==c.contacts.length-1&&c.groups.length?(c.selectedContactIndex=null,c.selectedGroupIndex=0):c.selectedContactIndex=(c.selectedContactIndex+1)%c.contacts.length:c.selectedGroupIndex==c.groups.length-1&&c.contacts.length?(c.selectedGroupIndex=null,c.selectedContactIndex=0):c.selectedGroupIndex=(c.selectedGroupIndex+1)%c.groups.length}function t(){null!==c.selectedContactIndex?0===c.selectedContactIndex&&c.groups.length?(c.selectedContactIndex=null,c.selectedGroupIndex=c.groups.length-1):c.selectedContactIndex=(c.selectedContactIndex-1)%c.contacts.length:0===c.selectedGroupIndex&&c.contacts.length?(c.selectedGroupIndex=null,c.selectedContactIndex=c.contacts.length-1):c.selectedGroupIndex=(c.selectedGroupIndex-1)%c.groups.length}function u(){return c.selectedContacts.length&&c.selectedContacts[c.selectedContacts.length-1].isHighlighted}function v(){c.selectedContacts.length&&(c.selectedContacts[c.selectedContacts.length-1].isHighlighted=!0)}function w(){c.selectedContacts.length&&(c.selectedContacts[c.selectedContacts.length-1].isHighlighted=!1)}function x(){c.selectedContacts.length&&""===G.val()&&(u()?(G.val(c.removeContact(c.selectedContacts.length-1).email),c.focusInput()):v())}function y(a){if(e.env.device.isMobile){var b=a.val();a.val(""),a.val(b)}}function z(a){var b=a.charCodeAt(a.length-1);switch(b){case 59:b=e.keyCodes.SEMICOLON;break;case 44:b=e.keyCodes.COMMA}return b}function A(a){a.stopPropagation(),a.preventDefault();var b,d=a.target;do{if(b=d.getAttribute("data-email"),d.hasAttribute("nxt-simple-dropdown-content"))return;d=d.parentNode}while(!b);G.val(b),o(),c.focusInput()}function B(b){a.cancel(J),J=a(function(){A(b)},200,!1)}function C(){a.cancel(J)}function D(){var a;if(c.selectedContacts&&c.selectedContacts.length)for(a=c.selectedContacts.length-1;a>=0;a--)c.removeContact(a)}function E(a){var b;for(b=0;b<c.selectedContacts.length;b++)c.selectedContacts[b].email===a&&c.removeContact(b,!0)}function F(a){var b;for(b=0;b<c.selectedContacts.length;b++)a.indexOf(c.selectedContacts[b].email)!==-1&&c.removeContact(b,!0)}var G,H,I,J,K=[],L=[];if(c.ContactKeys=e.ContactKeys,b.cachedQuery().then(function(a){angular.isArray(a)&&a.forEach(function(a){e.env.isCorp?b.isNotEmployeeFilter(a)&&K.push(a.slice()):K.push(a.slice())})}),L=f.get("ContactGroup").data,G=angular.element(g[0].querySelector("textarea.email-input-plain-input")),c.selectedContactIndex=null,c.selectedGroupIndex=null,c.selectedContacts=[],c.groups=[],c.contacts=[],c.resetInput=function(){G.val(""),c.$broadcast("eip:reset-input")},c.focusInput=function(){a(function(){g[0].querySelector(".email-input-plain-input").focus(),y(G)},100,!1)},c.inputChange=function(a){var b=a.keyCode;if(e.hacks.isAndroid&&(0!=b&&229!=b||(b=z(G.val()))),b!==e.keyCodes.TAB){if(b===e.keyCodes.ARROW_DOWN)return void s();if(b===e.keyCodes.ARROW_UP)return void t();b===e.keyCodes.SPACE||b===e.keyCodes.COMMA||b===e.keyCodes.NEWLINE||b===e.keyCodes.SEMICOLON?(a.preventDefault(),null!==c.selectedGroupIndex&&c.groups[c.selectedGroupIndex]?c.addGroupContacts(c.groups[c.selectedGroupIndex].id):(c.isContactFromSuggestSelected&&G.val(c.contacts[c.selectedContactIndex][c.ContactKeys.EMAIL]),o(),w())):b===e.keyCodes.BACKSPACE?x():w(),r(),c.$broadcast("simpleDropDown:updateDropdownPosition")}},c.inputTab=function(a){var b=a.keyCode;b===e.keyCodes.TAB&&G.val().length&&(a.preventDefault(),c.isContactFromSuggestSelected&&G.val(c.contacts[c.selectedContactIndex][c.ContactKeys.EMAIL]),o(),w(),r(),c.$broadcast("simpleDropDown:updateDropdownPosition"))},c.pasteHandler=function(){a(function(){n()},50)},e.hacks.isIOS){var M=angular.element(document.querySelectorAll(".dialog-header")),N=angular.element(document.querySelectorAll(".composition-simplified-toolbar"));angular.element(window).on("resize",function(){a(function(){var a=window.innerWidth>0?window.innerWidth:screen.width;M[0].style.width=a+"px",N[0].style.left=a-8+"px",N[0].style.right="initial"},100,!1)})}c.blurHandler=function(){a.cancel(H),H=a(function(){o(),c.$digest()},300,!1),c.$emit("directive:emailinput:blur"),e.env.device.isMobile&&e.hacks.isIOS&&(M.css("position","fixed"),N.css("position","fixed"))},c.focusHandler=function(){c.isEditing=!0,a.cancel(H),y(G),c.$emit("directive:emailinput:focus",{addEmailFn:p}),e.env.device.isMobile&&e.hacks.isIOS&&(M.css("position","absolute"),N.css("position","absolute"))},c.removeContact=function(a,b){var e=c.selectedContacts[a];w(),c.selectedContacts.splice(a,1);for(var f=0;f<K.length;f++)K[f][c.ContactKeys.EMAIL]===e.email&&(K[f][c.ContactKeys.IS_FORCED_HIDDEN]=!1);return c.$emit("emailinput:contactRemoved",{listName:c.name.split("-").pop(),contact:e}),d.pushCode("newMailDelContact"),b||c.focusInput(),e},c.suggestHoverHandler=function(a){c.selectedContactIndex=a,c.selectedGroupIndex=null},c.suggestGroupHoverHandler=function(a){c.selectedGroupIndex=a,c.selectedContactIndex=null},c.addGroupContacts=function(a){for(var d=b.getContactByGroup(K,a),e=0;e<d.length;e++)m(d[e][c.ContactKeys.NAME]+" <"+d[e][c.ContactKeys.EMAIL]+">")},c.$on("composition:removeAllContacts",D),c.$on("composition:removeContactByEmail",function(a,b){E(b)}),c.$on("composition:removeContactsByEmails",function(a,b){F(b)}),c.$on("composition:validateAndAddContact",function(a,b){o()}),I=g[0].querySelector("[nxt-simple-dropdown-content]"),I&&(angular.element(I).on("click",A),angular.element(I).on("touchstart",B),angular.element(I).on("touchmove",C)),c.$watch("basevalue",function(){p(c.basevalue,!0)}),g.on("copy",function(){try{var a,c=window.getSelection(),d=c+"",e=document.createElement("div"),f="",g=b.contactArraysToObjects(K);d=d.replace(/ /gi,";"),d=d.split(";"),a=!1;for(var h=0;h<d.length;h++)if(/\S+@\S+\.\S+/.test(d[h]))f+=d[h]+";";else{for(var i=0;i<g.length;i++)if(g[i].name==d[h]){f+=g[i].email+";",a=!0;break}a||(f+=d[h]+";")}e.style.position="absolute",e.style.left="-99999px",document.body.appendChild(e),e.innerHTML=f,c.selectAllChildren(e),window.setTimeout(function(){document.body.removeChild(e)},100)}catch(j){}}),c.$on("$destroy",function(){g.off("copy"),angular.element(window).off("resize")})},templateUrl:"/composition/views/emailInputPlain.html"}}]),angular.module("nxt-composition").directive("nxtEmailInputPlainGroup",["$timeout","Contact","ApplicationConfig",function(a,b,c){return{restrict:"A",transclude:!0,scope:{to:"=nxtTo",cc:"=nxtCc",bcc:"=nxtBcc",embeded:"=nxtEmbeded"},link:function(d,e){function f(a,b){["to","cc","bcc"].indexOf(a)!==-1&&(d.allRecipients[a].some(function(a){return a.email===b.email})||d.allRecipients[a].push(b))}function g(a,b){if(["to","cc","bcc"].indexOf(a)!==-1){var c,e=d.allRecipients[a];for(c=0;c<e.length;c++)e[c].email===b.email&&e.splice(c,1)}}function h(a){var b=[];return a.forEach(function(a){b.push(a.name||a.email)}),b.join("; ")}function i(){var a=d.allRecipients,b=[h(a.to),h(a.cc),h(a.bcc)].filter(function(a){return!!a}).join("; ");
return b}function j(b,c,f){d[b]=!0,a(function(){if(f){var a=e[0].querySelector("."+c+" .email-input-plain-input");a&&a.focus()}d.$emit("composition:updateSize")},50,!1)}function k(){d.allRecipients.cc.length||(d.isCCShown=!1),d.allRecipients.bcc.length||(d.isBCCShown=!1)}function l(){return b.countContacts(d.allRecipients)>0}var m,n=e[0].querySelector(".composition-all-recipients");d.allRecipients={to:[],cc:[],bcc:[]},d.focusInputEmail=function(){var b=e[0].querySelector(".email-input-plain-input");c.hacks.isIpad?b.focus():a(function(){b.focus()},100,!1)},d.focusInputEmail=function(){document.querySelector(".email-input-plain-input").focus()},d.showCC=function(a){j("isCCShown","composition-cc",a)},d.showBCC=function(a){j("isBCCShown","composition-bcc",a)},d.startEditing=function(){d.isEditing=!0},d.save=function(){d.$emit("composition:save")},d.popOut=function(){d.$emit("composition:popout")},d.$on("directive:emailinput:blur",function(){var f=5;a.cancel(m),m=a(function(){l()&&(d.isEditing=!1,k(),c.env.device.isPc&&a(function(){n||(n=e[0].querySelector(".composition-all-recipients")),n.offsetWidth<n.scrollWidth-f?d.recipientsCounter=b.countContacts(d.allRecipients):d.recipientsCounter=0,d.$digest()},0,!1)),d.$digest()},500,!1)}),d.$on("directive:emailinput:focus",function(){a.cancel(m)}),d.$watch("cc",function(a){a&&a.length&&d.showCC(!1)}),d.$watch("bcc",function(a){a&&a.length&&d.showBCC(!1)}),d.$on("emailinput:contactAdded",function(b,c){f(c.listName,c.contact),d.recipients=i(),a.cancel(m),d.isEditing=!0,d.$emit("composition:updateRecipients",d.allRecipients)}),d.$on("emailinput:contactRemoved",function(b,c){g(c.listName,c.contact),d.recipients=i(),a.cancel(m),d.isEditing=!0,d.$emit("composition:updateRecipients",d.allRecipients)}),d.startEditing()},templateUrl:function(){return c.env.device.isMobile?"/composition/views/emailInputPlainGroup_mobile.html":"/composition/views/emailInputPlainGroup.html"}}}]),angular.module("nxt-composition").directive("nxtInfoBar",["Compositions","$timeout",function(a,b){"use strict";return{restrict:"A",controller:["$scope","$rootScope",function(c,d){var e=c.message;c.isLoadingOpenMessage=!1,c.resendMail=function(){c.isLoadingOpenMessage=!0,c.$on("composition:save",function(){c.isLoadingOpenMessage=!1}),b(function(){d.$apply(function(){a.addComposition({opt:"e",mesg:c.message.deliveryReport.msgId,folder:e.folderId}),c.isLoadingOpenMessage=!1})},0)},c.openComposition=function(b,c){var d=[];return b.stopPropagation(),b.preventDefault(),c&&c.length?(c=c.split(";"),angular.forEach(c,function(a){d.push({email:a,name:a})}),a.addComposition({to:d})):a.addComposition(),!0}}],link:function(a,c){var d,e=function(){var e=a.message.deliveryReport;a.deliveryReport=e,a.deliveryReport.multiAddress=!1,a.deliveryReport.isDate=!1,e.failures&&e.failures.addresses&&e.addresses.length>1&&(a.deliveryReport.multiAddress=!0),e.date&&e.hour&&(a.deliveryReport.isDate=!0),b(function(){var b=c[0].querySelector(".message-failed-resend");b&&(d=angular.element(b),d.on("click",function(b){a.resendMail(),b.stopPropagation(),b.preventDefault()}))},0)};a.message.deliveryReport&&(e(),a.$on("$destroy",function(){c.off(),d&&d.off()}))},templateUrl:function(a){return a.templateUrl||"/composition/views/failureBar.html"}}}]),angular.module("nxt-composition").directive("nxtMobileInputChange",["UploaderResize","$rootScope","Notification",function(a,b,c){"use strict";return{require:"ngModel",restrict:"A",link:function(d,e,f,g){function h(d){d.target.files.length>1&&c.successNoClose("uploader:adding-attachments");var e=Array.from(d.target.files);document.getElementById("fakeMobileInput").value=null,e.forEach(function(c,d,f){c.name.match(/.(jpg|jpeg|png|gif)$/i)?(a.resize(c),delete e[d]):(b.$broadcast("document",c),delete e[d])})}e.bind("change",h),d.$watch(function(){return g.$viewValue},function(a){a||e.val("")}),d.$on("$destroy",function(a){e.unbind("change",h)})}}}]),angular.module("nxt-composition").directive("nxtMovable",["$document","$timeout","$rootScope","ApplicationConfig",function(a,b,c,d){var e=120,f=[60,45,30,15,0],g=0,h=3,i=0;return{restrict:"A",link:function(j,k,l){function m(b){b.stopPropagation(),a.off("mousemove",n),a.off("mouseup",m),angular.element(document.body).removeClass("on-moving"),k.removeClass("moving"),j.$broadcast("movable:moved")}function n(a){0!==a.which&&0!==a.buttons||m(a),a.stopPropagation(),k.css({top:Math.max(h,Math.min(s+(a.clientY-u),w-h))+"px",left:Math.max(h,Math.min(t+(a.clientX-v),x-h))+"px"}),E=k[0].getBoundingClientRect()}function o(){var a,b,c,d;F=!0,a=E.left,b=E.width,c=E.top,d=E.height,z=(a+b/2)/B,A=(c+d/2)/C}function p(){var a,b,c;F=!1,a=k[0].getBoundingClientRect(),b=a.width,c=a.height,B=document.documentElement.clientWidth,C=document.documentElement.clientHeight,k.css({left:Math.max(h,Math.min(B-b-h,B*z-b/2))+"px",top:Math.max(h,Math.min(C-c-h,C*A-c/2))+"px"}),E=k[0].getBoundingClientRect()}function q(){F||o(),clearTimeout(y),y=setTimeout(p,500)}if(!d.env.device.isMobile){var r,s,t,u,v,w,x,y,z,A,B,C,D,E,F=!1,G=f.pop()||0,H="false"!==l.nxtMovable,I=++e,J=++g;if(i=J,r=k[0].querySelectorAll("[nxt-movable-handler]")||k,r=angular.element(r),b(function(){B=document.documentElement.clientWidth,C=document.documentElement.clientHeight,D=k[0].getBoundingClientRect(),E={top:.5*(C-D.height)+G,right:D.right,bottom:D.bottom,left:.5*(B-D.width)+G,width:D.width,height:D.height},k.css({"z-index":I,top:E.top+"px",left:E.left+"px"}),b(function(){j.$broadcast("composition:loaded")},50,!1)},150,!1),H){r.on("mousedown",function(b){c.$broadcast("hideAllPanels"),k.hasClass("maximized")||k.hasClass("minimized")||(angular.element(document.body).addClass("on-moving"),k.addClass("moving"),s=parseInt(k.css("top"),10)||k.prop("offsetTop"),t=parseInt(k.css("left"),10)||k.prop("offsetLeft"),u=b.clientY,v=b.clientX,w=document.documentElement.clientHeight-k.prop("offsetHeight"),x=document.documentElement.clientWidth-k.prop("offsetWidth"),a.on("mousemove",n),a.off("mouseup",m),a.on("mouseup",m))});var K=function(){i!==J&&(c.$broadcast("movable:blur",J),I=e,k.css("z-index",I),i=J,c.$broadcast("movable:all-move-back"))};k.on("mousedown",K),j.$on("movable:show-on-top",K),j.$on("movable:all-move-back",function(){i!==J&&I===e&&(I--,k.css("z-index",I))}),a.on("mouseup",m)}angular.element(window).on("resize",q),j.$on("movable:blur",function(a,b){J===b&&c.$broadcast("composition:save")}),j.$on("$destroy",function(){f.push(G),a.off("mousemove",n),a.off("mouseup",m),r.off(),k.off(),angular.element(window).off("resize",q),e--})}}}}]),angular.module("nxt-composition").directive("nxtScrollIntoViewOnFocus",["ApplicationConfig",function(a){var b=5;return{restrict:"A",link:function(c,d){function e(){f=d[0].getBoundingClientRect(),f&&window.scrollTo(0,f.top+b)}var f;a.env.device.isMobile&&(d.on("focus",e),c.$on("$destroy",function(){d.off("focus",e)}))}}}]),angular.module("nxt-composition").directive("nxtSignature",["Tools","Compositions","Notification","Track","ApplicationConfig","$timeout",function(a,b,c,d,e,f){return{scope:{selectedSignature:"=nxtSelectedSignature"},restrict:"A",link:function(g,h){function i(){g.setSignature()}var j=h[0],k=j.querySelector(".composition-signature-add textarea"),l=j.querySelector(".composition-signature-add-name-input");g.signatureAllow=e.getConfigAppModule("composition")&&e.getConfigAppModule("composition").actions.signature,g.isEditingSignature=!1,g.signatures=e.signatures||{},g.editSignature=function(){g.isEditingSignature=!0,f(function(){k.focus()},50,!1)},g.clearSignature=function(){g.isEditingSignature=!1,l.value="",k.value=""},g.saveSignature=function(e){g.isTooLong&&e.stopPropagation();var f={name:a.getTextOnly(l.value),value:a.getTextOnly(k.value)};return f.value.length?f.name.length?(g.signatures[Date.now()]=f,g.changeSignature(f),g.clearSignature(),void b.addSignature(f).success(function(){c.success("composition:signature-saved"),d.pushCode("addSignature")}).error(function(){c.error("composition:saving-signature-error")})):(c.error("composition:empty-signature-name"),void l.focus()):(c.error("composition:empty-signature"),void k.focus())},g.setSignature=function(){for(var a in g.signatures)g.signatures.hasOwnProperty(a)&&parseInt(a,10)===e.defaultSignatureId&&(g.selectedSignature=g.signatures[parseInt(a,10)])},g.changeSignature=function(a){g.selectedSignature=a,d.pushCode("selectSignature"),g.$emit("composition:mark-as-modified")},g.$on("directive:dialog:toggle",function(a,b){f(function(){j.scrollIntoView()},150,!1)}),g.updateName=function(){g.isTooLong=g.signatureName.length>=50},i()},templateUrl:"/composition/views/signature.html"}}]),angular.module("nxt-composition").directive("nxtSimpleDropdown",["$document","$rootScope","$timeout","ApplicationConfig",function(a,b,c,d){"use strict";return{restrict:"A",scope:{nxtSimpleDropdownOpened:"="},link:function(e,f,g){function h(){A||(a.on("click",m),A=!0)}function i(){A&&(a.off("click",m),A=!1)}function j(){B||(w.on("click",l),B=!0)}function k(){B&&(w.off("click"),B=!1)}function l(a){b.$broadcast("hideAllPanels"),z=!0,o(),f.addClass("nxt-simple-dropdown-opened"),C||(h(),k()),a&&a.stopPropagation()}function m(a){z=!1,f.removeClass("nxt-simple-dropdown-opened"),C||(i(),j()),a&&a.stopPropagation()}function n(){"undefined"!=typeof g.nxtSimpleDropdownOpened&&(C=!0),m()}function o(){if(z&&(r||(r=Math.max(document.documentElement.clientHeight,window.innerHeight||0)),t=v.getBoundingClientRect(),x.css({width:v.offsetWidth+"px","max-height":r-t.bottom-y+"px"}),null!==v.getAttribute("data-position-absolute")?(s=v.offsetParent,s&&x.css({position:"absolute",top:s.offsetHeight+"px",left:s.offsetLeft+"px"})):d.env.device.isMobile||x.css({top:t.bottom+"px",left:t.left+"px"}),d.env.device.isMobile&&window.screen&&window.screen.height)){var a=48,b=window.screen.height-window.screen.height%a;x.css({"max-height":b+"px"})}}function p(){c.cancel(u),o()}function q(){c.cancel(u),u=c(function(){o(),e.$digest()},150,!1)}var r,s,t,u,v=f[0].querySelector("[nxt-simple-dropdown-activator]")||f[0],w=angular.element(v),x=angular.element(f[0].querySelector("[nxt-simple-dropdown-content]")),y=5,z=!1,A=!1,B=!1,C=!1;e.$on("hideAllPanels",function(){m()}),e.$on("movable:moved",p),e.$on("simpleDropDown:updateDropdownPosition",p),angular.element(window).on("scroll orientationchange",q),e.$watch("nxtSimpleDropdownOpened",function(a){a?l():m()}),e.$on("$destroy",function(){w.off(),a.off("click",m),angular.element(window).off("scroll orientationchange",q)}),n()}}}]),angular.module("nxt-composition").directive("nxtSimpleDropdownUpdateOnScroll",function(){"use strict";return{restrict:"A",link:function(a,b){b.on("scroll",function(){a.$broadcast("simpleDropDown:updateDropdownPosition")}),a.$on("$destroy",function(){b.off("scroll")})}}}),angular.module("nxt-composition").directive("nxtUpdateCompositionSize",["ApplicationConfig","$timeout",function(a,b){return{restrict:"A",link:function(c,d){function e(){if(!c.isSimplified&&!a.env.device.isMobile){var e,f,g,i,j,k,l,m,n,o,p=5,q=.9,r=!c.isFloatWindow&&c.rightColumnMin&&c.isHTML?102:64,s=document.documentElement.clientHeight,t=150,u=0;h&&(c.isSimplified?(e=null,r=0,f=h.querySelector(".simplified-content-input"),g=h.querySelector(".composition-subject-wrapper"),q=1,t=a.env.device.isMobile?80:130):(e=h.querySelector(".mce-toolbar-grp"),f=h.querySelector("iframe"),g=h.querySelector(".composition-subject-wrapper")),c.dialogid&&(k=document.querySelector("[nxt-id='"+c.dialogid+"']"),k&&(l=k.getBoundingClientRect(),o=angular.element(k).hasClass("maximized")),m=document.querySelector("[nxt-id='"+c.dialogid+"'] .dialog-header"),n=m&&m.offsetHeight||65),e&&(f&&g&&o?(i=e.getBoundingClientRect(),j=g.getBoundingClientRect(),Array.prototype.forEach.call(h.querySelectorAll("[nxt-count-height]"),function(a){u+=a.offsetHeight}),f.style.minHeight=i.top-j.bottom-u-p+"px"):f&&f.style.minHeight&&(f.style.minHeight=null),t=r+n,angular.element(e).css({height:!c.isFloatWindow&&c.rightColumnMin?71:r+"px"}),d.css({"margin-bottom":r+"px"}))),"embeded"!==c.mode&&(d.css("max-height",q*s-t+"px"),a.env.device.isMobile&&d.css("max-height",s-r+"px"),l&&b(function(){l.bottom>s&&c.$emit("ac:update")},0,!1))}}function f(){var a;c.isFloatWindow||(a=c.rightColumnMin&&c.isHTML?102:64,d.css({"margin-bottom":a+"px"}))}function g(a){b(function(){c.isFloatWindow||(c.rightColumnMin=a,f(),c.$digest())},0,!1)}var h=d[0];c.isFloatWindow="embeded"!==c.mode,c.rightColumnMin=a.env.isRightColumnMin,a.env.device.isSmarthpone||(c.$on("composition:onchange",e),c.$on("directive:dialog:toggle",function(){b(e,100,!1)}),c.$on("tinymce:switched-editor-mode",function(a,d){b(function(){c.isHTML=d.isHTML,f(),d.isHTML&&e(),c.$digest()},0,!1)}),c.$on("tinymce:init",function(){e(),b(e,1500,!1)}),c.$on("composition:updateSize",e),c.$on("directive:column-resize:right-column-min",function(){g(!0)}),c.$on("directive:column-resize:right-column-greater",function(){g(!1)})),c.$on("$destroy",function(){angular.element(window).off("resize",e)}),angular.element(window).on("resize",e),e()}}}]),angular.module("nxt-contact").directive("nxtContact",["Contact","Blacklist","ContactGroup","ApplicationConfig","Search","$rootScope","Compositions","Folder","Track",function(a,b,c,d,e,f,g,h,i){"use strict";var j=[{id:a.EMAIL_TYPE_WORK,name:"Prywatny"},{id:a.EMAIL_TYPE_BUSINESS,name:"Służbowy"},{id:a.EMAIL_TYPE_OTHER,name:"Inny"}],k=[{id:a.PHONE_TYPE_PRIVATE,name:"Prywatny"},{id:a.PHONE_TYPE_BUSINESS,name:"Służbowy"},{id:a.PHONE_TYPE_OTHER,name:"Inny"}];return{restrict:"EA",replace:!0,scope:{contact:"=?nxtContactData",isExpanded:"=?nxtContactIsExpanded",isGroupEdited:"=?nxtContactIsGroupEdited",selectedGroup:"=?nxtContactSelectedGroup",isModeExpanded:"=?nxtContactIsModeExpanded",isModeSelect:"=?nxtContactIsModeSelect"},templateUrl:"/contact/views/contact.html",controller:["$scope",function(d){return d.isModeExpanded=void 0===d.isModeExpanded||d.isModeExpanded,c.query().success(function(a){d.groups=a}),b.query().success(function(a){d.contact.isOnBlacklist=a.indexOf(d.contact.email)!==-1}),d.edit=function(){f.$broadcast("directive:contact:edit",d.contact)},d.createNewMessage=function(){g.addComposition({to:d.contact,allowOwnEmails:!0})},d.newMessage=function(a){i.pushCode("contactListClick"),g.addComposition({toActive:a,allowOwnEmails:!0})},d.showMailingHistory=function(){e.searchHistory(d.contact.email)},d.addNewFilter=function(){f.$broadcast("controller:filter:quickdialog",{email:d.contact.email})},d.addToBlacklist=function(){b.addToBlacklist(d.contact).success(function(){d.contact.isOnBlacklist=!0})},d.removeFromBlacklist=function(){b.removeFromBlacklist(d.contact).success(function(){d.contact.isOnBlacklist=!1})},d.deleteContact=function(){a.deleteContact(d.contact)},d.getEmailType=function(a){var b="";return j.some(function(c){return c.id==a.type&&(b=c.name,!0)}),b},d.getGroupName=function(a){var b="";return d.groups.some(function(c){return c.id==a&&(b=c.name,!0)}),b},d.getPhoneType=function(a){var b="";return k.some(function(c){return c.id==a.type&&(b=c.name,!0)}),b},d.addToSelectedGroup=function(){void 0===d.contact.originalGroups&&(d.contact.originalGroups=d.contact.groups.slice()),d.contact.groups.push(d.selectedGroup.id),d.$emit("contact:add-to-selected-group",d.contact),i.pushCode("contactAddToGroup")},d.removeFromSelectedGroup=function(){void 0===d.contact.originalGroups&&(d.contact.originalGroups=d.contact.groups.slice());var a=d.contact.groups.indexOf(d.selectedGroup.id);d.contact.groups.splice(a,1),d.$emit("contact:remove-from-selected-group",d.contact)},d.$watch("isExpanded",function(b){b&&!d.contact.isLoaded&&d.contact.id&&a.get({id:d.contact.id,type:d.contact.type}).success(function(a){d.contact=angular.extend(d.contact,a),d.contact.isLoaded=!0})}),d.$watch("isGroupEdited",function(a){a&&(d.isExpanded=!1,d.isInSelectedGroup=d.contact.groups.indexOf(d.selectedGroup.id)!==-1)}),d.$on("controller:contact:group-edit:cancel",function(){d.contact.originalGroups&&(d.contact.groups=d.contact.originalGroups)}),d.$on("controller:contact:goto",function(a,b){b.id===d.contact.id&&(d.isExpanded=!0)}),d}]}}]),angular.module("nxt-contact").directive("nxtContactEdit",["Contact","ContactGroup","ApplicationConfig","Notification",function(a,b,c,d){"use strict";var e=[{id:a.EMAIL_TYPE_WORK,name:"Prywatny"},{id:a.EMAIL_TYPE_BUSINESS,name:"Służbowy"},{id:a.EMAIL_TYPE_OTHER,name:"Inny"}],f=[{id:a.PHONE_TYPE_PRIVATE,name:"Prywatny"},{id:a.PHONE_TYPE_BUSINESS,name:"Służbowy"},{id:a.PHONE_TYPE_OTHER,name:"Inny"}];return{restrict:"EA",replace:!0,scope:{contact:"=?nxtContactData"},templateUrl:"/contact/views/edit.html",controller:["$scope",function(g){function h(){var a,b=g.contact.emails.length;for(a=0;a<b;a++)if(g.contact.emails[a].id===-666)return!0;return!1}var i=angular.copy(g.contact,i),j=i.emails.filter(function(a){return i.email==a.value}).pop(),k={email:!1,groups:!1,tel:!1};return g.emailPattern=c.patterns.email,g.phonePattern=c.patterns.phone,g.specialCharsPattern=c.patterns.specialChars,g.isCorp=c.env.isCorp,g.contact.newEmail||(g.contact.newEmail={}),g.contact.newGroup||(g.contact.newGroup=null),g.contact.newPhone||(g.contact.newPhone={}),g.groups=[],g.EMAIL_GROUPS=[],b.query().success(function(a){g.groups=a,g.EMAIL_GROUPS=a,g.EMAIL_GROUPS=[{id:null,name:"Brak wybranej grupy"}].concat(g.EMAIL_GROUPS)}),g.$on("service:contact-group:save",function(a,b){g.groups.push(b)}),g.getEmailType=function(a){var b="";return e.some(function(c){return c.id==a.type&&(b=c.name,!0)}),b},g.getGroupName=function(a){var b="";return g.groups.some(function(c){return c.id==a&&(b=c.name,!0)}),b},g.getPhoneType=function(a){var b="";return f.some(function(c){return c.id==a.type&&(b=c.name,!0)}),b},g.setDefaultEmail=function(a){g.contact.email=g.contact.emails[a].value,j=g.contact.emails[a]},g.deleteEmail=function(a){g.contact.emails.splice(a,1)},g.deletePhone=function(a){g.contact.phones.splice(a,1)},g.addNewEmail=function(){void 0!==g.contact.newEmail.type&&g.contact.newEmail.value&&(g.contact.emails.push(g.contact.newEmail),g.contact.newEmail={})},g.addToGroup=function(){g.contact.newGroup&&(g.contact.groups.push(g.contact.newGroup),g.contact.newGroup=null)},g.addNewPhone=function(){void 0!==g.contact.newPhone.type&&g.contact.newPhone.value&&(g.contact.phones.push(g.contact.newPhone),g.contact.newPhone={})},g.removeFromGroup=function(a){g.contact.groups.splice(a,1)},g.submit=function(){return g.addNewEmail(),g.addToGroup(),g.addNewPhone(),!g.isCorp&&h()?(d.error("service:contact:save:specialContact"),!1):void a.save(g.contact).success(function(a){g.contact=angular.extend(g.contact,a),delete g.contact.newEmail,delete g.contact.newGroup,delete g.contact.newPhone,g.$emit("directive:contact:edit-save",g.contact)})},g.selectClose=function(a,b){k[b]&&(a.focusser=angular.element('<span style="display:none;"></span>'),a.close(!0)),k[b]=!k[b]},g.reset=function(){g.$emit("directive:contact:close"),g.contact.id&&(g.contact=angular.copy(i,g.contact))},g.$on("controller:contact:edit-cancel",function(){g.reset()}),g.$on("controller:contact:has-contact-change",function(){var a=!angular.equals(i,g.contact);g.$emit("directive:contact:has-contact-change",a)}),g.$watch("contact",function(a){a.avatar[0].initial=(a.name||"").substr(0,1),a.emails&&(a.email=a.emails.filter(function(a){return!!j&&a.type==j.type}).pop(),a.email?a.email=a.email.value:a.emails[0]&&(a.email=a.emails[0].value),g.EMAIL_TYPES=e.filter(function(b){return!a.emails.some(function(a){return b.id===a.type})})),g.EMAIL_TYPES.length&&void 0===g.contact.newEmail.type&&(g.contact.newEmail.type=g.EMAIL_TYPES[0].id),a.phones&&(g.PHONE_TYPES=f.filter(function(b){return!a.phones.some(function(a){return b.id===a.type})})),g.PHONE_TYPES.length&&void 0===g.contact.newPhone.type&&(g.contact.newPhone.type=g.PHONE_TYPES[0].id),a.groups&&(g.EMAIL_GROUPS=g.groups.filter(function(b){return a.groups.indexOf(b.id)===-1}),g.EMAIL_GROUPS=[{id:null,name:"Brak wybranej grupy"}].concat(g.EMAIL_GROUPS))},!0),g}]}}]),angular.module("nxt-crop").directive("nxtImgCrop",["$timeout","CropHost","CropPubSub",function(a,b,c){"use strict";return{restrict:"E",scope:{image:"=",resultImage:"=",changeOnFly:"=",areaType:"@",resultImageWidth:"=",resultImageHeight:"=",resultImageFormat:"@",resultImageQuality:"=",resultDoNotUpdate:"=",cropX:"=",cropY:"=",cropWidth:"=",cropHeight:"=",cropDataInPercentage:"=",cropResetWrapperSelector:"=",onChange:"&",onLoadBegin:"&",onLoadDone:"&",onLoadError:"&"},template:"<canvas></canvas>",controller:["$scope",function(a){a.events=new c}],link:function(c,d){var e=c.events;c.cropInitParams={cropX:c.cropX,cropY:c.cropY,cropWidth:c.cropWidth||190,cropHeight:c.cropHeight||95,cropDataInPercentage:c.cropDataInPercentage||!1,cropResetWrapperSelector:c.cropResetWrapperSelector||"",resultImageWidth:c.resultImageWidth||180,resultImageHeight:c.resultImageHeight||90};var f,g=new b(d.find("canvas"),{},e,c.cropInitParams),h=function(a){var b={};if(a.resultDoNotUpdate)return b={resultImage:null,cropData:g.getCropData()},void a.onChange({$dataURI:b});var c=g.getResultImageDataURI();if(f!==c){f=c,angular.isDefined(a.resultImage)&&(a.resultImage=c);var d=g.getCropData();b={resultImage:a.resultImage,cropData:d},a.onChange({$dataURI:b})}},i=function(b){return function(){a(function(){c.$apply(function(a){b(a)})})}};e.on("load-start",i(function(a){a.onLoadBegin({})})).on("load-done",i(function(a){a.onLoadDone({})})).on("load-error",i(function(a){a.onLoadError({})})).on("area-move area-resize",i(function(a){a.changeOnFly&&h(a)})).on("area-move-end area-resize-end image-updated",i(function(a){h(a)})),c.$watch("image",function(){g.setNewImageSource(c.image)}),c.$watch("areaType",function(){g.setAreaType(c.areaType),h(c)}),c.$watch("resultImageHeight",function(){g.setResultImageSize(c.resultImageWidth,c.resultImageHeight),h(c)}),c.$watch("resultImageFormat",function(){g.setResultImageFormat(c.resultImageFormat),h(c)}),c.$watch("resultImageQuality",function(){g.setResultImageQuality(c.resultImageQuality),h(c)}),c.$watch(function(){return[d[0].clientWidth,d[0].clientHeight]},function(a){a[0]>0&&a[1]>0&&(g.setMaxDimensions(a[0],a[1]),h(c))},!0),c.$on("$destroy",function(){g.destroy()})}}}]),angular.module("nxt-composition").directive("nxtAutoHeight",["$timeout",function(a){var b=112;return{restrict:"A",link:function(c,d,e){function f(){a(function(){var a=d.parent().parent()[0].getBoundingClientRect().height-b;d.css({height:a+"px"})},50,!1)}function g(){a.cancel(b);var b=a(function(){f()},100)}f(),angular.element(window).on("resize",g),c.$on("$destroy",g)}}}]),angular.module("nxt-dialog").directive("nxtDialog",["DialogManager","$rootScope","$timeout","ApplicationConfig","$state","Track","$window",function(a,b,c,d,e,f,g){return{restrict:"A",transclude:!0,scope:{params:"=nxtParams",title:"@nxtTitle",template:"@nxtTemplate",id:"@nxtId"},link:function(h,i,j){function k(){i.parent().removeClass("maximized-wrapper")}function l(){i.parent().toggleClass("maximized-wrapper")}function m(){c(function(){i.addClass("moving")},200),c(function(){i.removeClass("moving")},400),c(function(){i.addClass("moving")},600),c(function(){i.removeClass("moving")},800),h.$broadcast("composition:forced-focus")}switch(h.links=d.links,h.isCorp=d.env.isCorp,h.data={},h.minimized=!1,h.maximized=!1,h.params.additionalClasses&&i.addClass(h.params.additionalClasses),h.params.isModal&&i.parent().addClass("maximized-wrapper"),h.$on("composition:getDefaults",function(){var a=h.params.compositionConfig||{opt:"n"};h.$broadcast("composition:defaultsProvided",a)}),h.params.dialogType){case a.DialogTypes.CONFIRM:i.addClass("dialog--confirm");break;case a.DialogTypes.SPECIAL_BOARD:i.addClass("dialog--special-board")}h.remove=function(){h.$broadcast("directive:dialog:close"),i.parent().removeClass("maximized-wrapper"),a.remove(j.nxtId)},h.close=function(){b.$broadcast("tooltip:hide"),h.remove(),h.params.callbackClose()},h.cancel=function(){h.remove(),h.params.callbackCancel()},h.success=function(){h.params.success?h.params.success.call(h,h.data):(h.remove(),h.params.callback.call(null,h.data))},h.folderConfirmSuccess=function(a,b,c,d){h.params.callback(a,b,c,d),h.close()},h.toggleMaximize=function(){i.toggleClass("maximized"),l(),i.removeClass("minimized"),h.$broadcast("directive:dialog:toggle",i.hasClass("maximized")),h.$broadcast("simpleDropDown:updateDropdownPosition"),h.maximized=i.hasClass("maximized"),h.minimized=i.hasClass("minimized"),b.$broadcast("hideAllPanels"),h.params.callbackMaximize(i),h.$broadcast("composition:scroll-to-top")},h.toggleMinimize=function(){i.toggleClass("minimized"),i.removeClass("maximized"),k(),h.$broadcast("directive:dialog:toggle",i.hasClass("maximized")),h.$broadcast("simpleDropDown:updateDropdownPosition"),h.maximized=i.hasClass("maximized"),h.minimized=i.hasClass("minimized"),b.$broadcast("hideAllPanels"),h.params.callbackMinimize(i)},h.unMinimize=function(){h.minimized&&h.toggleMinimize()},h.pushStat=function(a,b){b&&("iwa"==a?(b=b.split("|"),f.pushIWA(b)):"ga"==a?(b=b.split("|"),f.pushGA(b)):"gemius"==a&&f.pushGemius(b))},h.openNewTab=function(a){d.hacks.isIOS&&a.indexOf("itunes.apple.com/app/apple-store/")!=-1?g.open(a,"_self"):g.open(a,"_blank")},h.$on("dialog:update-title",function(a,b){h.title=b}),h.$on("composition:loaded",function(){i.removeClass("loading")}),d.env.device.isMobile||(h.$on("dialog:demaximize",function(){h.maximized&&h.toggleMaximize()}),h.$on("dialog:remove-shadow",k),h.$on("dialog:blink",function(a,b){h.params&&h.params.id===b&&(m(),h.$emit("movable:show-on-top"))})),h.$on("directive:dialog:close-composition",function(){h.close()}),h.$on("frame-login:success",function(g,i){i.login!==d.env.ownEmail?location.href=location.href.split("?")[0]:h.params.dialogType===a.DialogTypes.SESSION_EXPIRED&&c(function(){d.env.uid=i.uid,d.env.sid=i.sid,d.cacheTime=Date.now(),b.$broadcast("frame-login:success-ready"),e.go(e.current,{iwa_source:"log_sesja"},{reload:!0}),f.pushIWA(["plansza","wygasla_sesja","klik","zaloguj"]),h.close()},0)}),h.$on("frame-login:failed",function(){i.addClass("frame-login-failed")})},templateUrl:function(){return d.env.device.isMobile?"/dialog/views/dialog_mobile.html":"/dialog/views/dialog.html"}}}]),angular.module("nxt-dialog").directive("nxtDialogList",function(){"use strict";return{restrict:"A",scope:{},controller:["$scope","DialogManager","ApplicationConfig",function(a,b,c){return a.dialogs=b.getList(),a.isMobile=c.env.device.isMobile,a}],templateUrl:"/dialog/views/dialogList.html"}}),angular.module("nxt-folder").directive("nxtAttachments",["$q","$rootScope","$timeout","ApplicationConfig","ApplicationData","Attachments","FileClassFinder",function(a,b,c,d,e,f,g){"use strict";function h(a,b){var c=a/(b/p),d=2*p;return c>d&&(c=d),c}function i(a,b){var c;a.thumbsCnt?(c=document.createElement("img"),c.className="msglist-attachments-thumbnail",d.env.device.isMobile||c.setAttribute("data-tooltip",a.name),c.onload=function(){b.resolve(!0)},c.src=a.thumbUrl,c.style.width=h(a.imgWidth,a.imgHeight)+"px",c.__attachmentName__=a.name):(c=document.createElement("div"),c.className="msglist-attachments-thumbnail msglist-attachments-thumbnail--icon icon-file-image",d.env.device.isMobile||c.setAttribute("data-tooltip",a.name),c.setAttribute("data-extension",a.extension),c.__attachmentName__=a.name);var e=document.createElement("li");e.className="msglist-attachments-item";var f=e.appendChild(c);return f.parentNode.style.width=f.style.width,e}var j=5,k=["p7s"],l=42,m=30,n=d.env.device.isMobile?-4:2,o="-33px",p=40;return{restrict:"EA",replace:!0,templateUrl:"/folder/views/attachments.html",scope:{message:"=nxtAttachmentsData",attachmentsCollapsed:"=nxtAttachmentsCollapsed"},controller:["$scope","$state",function(a,b){return a.attachments=a.message.atta,a.isCollapsed=void 0===a.attachmentsCollapsed||a.attachmentsCollapsed,a.isMoreAttachments=!1,a.attachments=a.attachments.map(function(a){if(a.extension=a.name.split(".").pop().toLowerCase(),a["class"]=g.getFileClass(a.extension),d.env.device.isPc&&"pdf"!==a.extension&&(a.url=a.urlDownload),k.indexOf(a.extension)!==-1&&(a.isHidden=!0),a.imgInfo){var b=a.imgWidth,c=a.imgHeight;switch(a.imgInfo.orientation){case 5:case 6:case 7:case 8:a.imgWidth=c,a.imgHeight=b}}return a}),a.images=a.attachments.filter(function(a){return"image"==a.type}),a.openSlideshow=function(c){var d=c.target;if(d.__attachmentName__){var e=a.message.atta.filter(function(a){return"image"===a.type});b.go(".slideshow",{attachments:e,attachmentName:d.__attachmentName__}),c.preventDefault(),c.stopPropagation()}},a.openAtt=function(a,b){f.openAtt(a,b)},a.stopDownload=function(a){d.hacks.isFirefox&&e.getIsRequesting()&&(a.preventDefault(),a.stopPropagation())},a}],link:function(e,f){function g(){var a=angular.element(f[0].lastElementChild),b=(f[0].scrollWidth-m)%l+n;a.css("right",b+"px")}function h(){c.cancel(q),q=c(function(){e.loadImages()},100)}var k=f.children()[0],p=null;e.isOverflow=function(){return f[0].offsetHeight<k.offsetHeight},e.loadImages=function(){var b,c,h=0,l=[];if(e.isOverflow()===!1){for(;e.images.length&&(h<j||e.isCollapsed===!1);)c=a.defer(),l.push(c.promise),b=i(e.images.shift(),c),p=p?k.insertBefore(b,p.nextSibling):k.insertBefore(b,k.firstChild),h++;l.length&&a.all(l).then(function(){e.loadImages()}),e.isCollapsed&&(e.isMoreAttachments=!1)}else e.isMoreAttachments=!0;d.hacks.isAndroidDefault&&angular.element(f[0]).css({"margin-right":o}),e.isMoreAttachments===!0&&g()};var q;angular.element(window).on("resize",h),b.$on("service:message:resize-handler",function(){h()}),e.$watch("isCollapsed",function(a){a===!1&&c(function(){e.loadImages()},0)}),e.loadImages(),e.$on("$destroy",function(){angular.element(window).off("resize",h)})}}}]),angular.module("nxt-folder").directive("nxtListAdv",["$timeout","ApplicationConfig",function(a,b){"use strict";var c=1e4;return{restrict:"A",link:function(d,e,f){function g(){b.env.isBlockDisplayListAdv=!0,e.remove()}b.env.isBlockDisplayListAdv&&e.remove(),a(function(){g()},c,!1)}}}]),angular.module("nxt-folder").directive("nxtMobileCalendarInput",["DialogManager",function(a){"use strict";return{restrict:"A",scope:{ngModel:"=",nxtMobileCalendarMax:"=",nxtMobileCalendarMin:"="},link:function(b,c,d){function e(){a.mobileCalendar({additionalData:{date:b.ngModel,inputName:d.nxtMobileCalendarInput,maxDate:b.nxtMobileCalendarMax,minDate:b.nxtMobileCalendarMin}})}c.on("click",function(){e()}),b.$on("$destroy",function(){c.off()})}}}]).directive("nxtMobileCalendar",["$rootScope",function(a){"use strict";var b=["styczeń","luty","marzec","kwiecień","maj","czerwiec","lipiec","sierpień","wrzesień","październik","listopad","grudzień"];return{restrict:"A",scope:{},link:function(c,d,e){function f(){c.day=o.getDate(),c.month=b[o.getMonth()],c.year=o.getUTCFullYear()}function g(a){var b=angular.copy(o);return b.setDate(o.getDate()+a),b}function h(a){var b=angular.copy(o);return b.setMonth(o.getMonth()+a),b}function i(a){var b=angular.copy(o);return b.setYear(o.getFullYear()+a),b}function j(a,b){var d=m(p),e=a(-1);e<d?c.inactiveArrows[b]=!0:c.inactiveArrows[b]=!1}function k(a,b){var d=m(q),e=new Date,f=a(1);f>d||f>e?c.inactiveArrows[b]=!0:c.inactiveArrows[b]=!1}function l(){p&&(j(g,"dayDown"),j(h,"monthDown"),j(i,"yearDown")),k(g,"dayUp"),k(h,"monthUp"),k(i,"yearUp")}function m(a){var b=a.split("-");return new Date(b[0],b[1]-1,b[2])}function n(){return o.getFullYear()+"-"+("0"+(o.getMonth()+1)).slice(-2)+"-"+("0"+o.getDate()).slice(-2)}var o,p=e.nxtMobileCalendarMin,q=e.nxtMobileCalendarMax;c.inactiveArrows={dayUp:!1,dayDown:!1,monthUp:!1,monthDown:!1,yearUp:!1,yearDown:!1},o=e.nxtMobileCalendarDate?m(e.nxtMobileCalendarDate):q?m(q):new Date,f(),l(),c.changeDay=function(a){o=g(a),l(),f()},c.changeMonth=function(a){o=h(a),l(),f()},c.changeYear=function(a){o=i(a),l(),f()},c.success=function(){"dateFrom"==e.nxtMobileCalendar?a.$broadcast("directive:mobile-caledar:set-date-from",n()):"dateTo"==e.nxtMobileCalendar&&a.$broadcast("directive:mobile-caledar:set-date-to",n()),
c.$parent.success()}},templateUrl:"/folder/views/mobile_calendar.html"}}]),angular.module("nxt-folder").directive("nxtScrollToPage",["$timeout",function(a){"use strict";return{restrict:"A",link:function(b,c){var d=c[0];b.$on("folder:scroll:page",function(c,e){a(function(){var a=document.getElementById("message-"+e.id);a?(d.scrollTop=a.parentElement.parentElement.offsetTop,b.$broadcast("scrollToPage:ready")):d.scrollTop=d.scrollHeight},0)}),b.$on("$destroy",function(){})}}}]),angular.module("nxt-folder").directive("nxtSearch",["Folder","Search","Track","ApplicationConfig","$rootScope","$timeout","$stateParams","$filter","Messages",function(a,b,c,d,e,f,g,h,i){"use strict";var j=d.env.device.isMobile&&d.hacks.isIE?150:0;return{restrict:"EA",replace:!0,scope:{isExpanded:"=?nxtSearchIsExpanded"},templateUrl:function(){return d.env.device.isMobile?"/folder/views/search_mobile.html":"/folder/views/search.html"},controller:["$scope",function(i){function k(){return h("filter")(i.suggestions,i.phrase)}function l(){return k().length<i.phraseLimit?k().length:i.phraseLimit}function m(){i.selectedSuggestIndex=(i.selectedSuggestIndex+1)%l()}function n(){i.selectedSuggestIndex=i.selectedSuggestIndex>0?(i.selectedSuggestIndex-1)%l():l()-1}var o=!1;return i.datePattern=d.patterns.date,i.isMobile=d.env.device.isMobile,i.phrase=b.getPhrase(),i.historyPhrase=b.getHistoryPhrase(),i.filters=b.getFilters(),i.suggestions=[],i.selectedSuggestIndex=-1,i.phraseLimit=5,i.folders=[],i.historyPhrase&&(i.filters.from=i.historyPhrase,i.filters.to=i.historyPhrase),i.isSearchFormActive=!1,i.areFiltersEmpty=b.areFiltersEmpty(),i.isSearchAdvanced=i.historyPhrase||!i.areFiltersEmpty,i.isExpanded=i.isExpanded||i.phrase||i.historyPhrase||!i.areFiltersEmpty,i.leftColumnMin=d.env.isLeftColumnMin,i.leftPreColumnMin=d.env.isLeftPreColumnMin,i.open=function(){i.isExpanded===!1&&f(function(){document.querySelector("#search").focus()},250,!1),f(function(){i.isSearchFormActive=!0,i.isExpanded=!0,d.isSearchExpanded=!0,i.loadSuggestions()},0,!1)},i.labelClick=function(a){i.isExpanded?(i.search(),a.preventDefault()):i.open()},i.close=function(){f(function(){i.isSearchFormActive=!1,d.env.device.isMobile||(i.datePickerToShow=!1),i.isSearchAdvanced&&i.isSearchFormActive?(i.isSearchAdvanced=!1,c.pushCode("searcherAdvanceClose")):(i.isSearchFormActive=!1,i.isExpanded=!1,d.isSearchExpanded=!1,i.clearAll(),c.pushCode("searcherClose"))},j)},i.focusOut=function(){d.env.device.isMobile&&!d.hacks.isIE?(i.isSearchFormActive=!1,i.phrase||angular.equals(i.filters,{})===!1||(i.isExpanded=!1,d.isSearchExpanded=!1)):(g.search||(i.phrase="",i.filters={}),i.phrase||(i.isExpanded=!1,d.isSearchExpanded=!1),i.isSearchFormActive=!1),d.env.device.isMobile||(i.datePickerToShow=!1,i.datePickerFromShow=!1)},a.query().success(function(a){var b=a.filter(function(a){return"Wszystkie foldery"==a.name});b&&a.unshift({name:"Wszystkie foldery",folder:null,id:null}),i.folders=a}),i.loadSuggestions=function(){b.suggestions().success(function(a){i.suggestions=a})},d.env.device.isMobile||(e.$on("directive:column-resize:left-column-min",function(){i.leftColumnMin=!0}),e.$on("directive:column-resize:left-column-greater",function(){i.leftColumnMin=!1}),e.$on("directive:column-resize:left-pre-column-min",function(){i.leftPreColumnMin=!0}),e.$on("directive:column-resize:left-pre-column-greater",function(){i.leftPreColumnMin=!1})),d.env.device.isMobile&&(e.$on("directive:mobile-caledar:set-date-from",function(a,b){i.filters.date_from=b}),e.$on("directive:mobile-caledar:set-date-to",function(a,b){i.filters.date_to=b}),e.$on("directive:search:close",function(){i.close()})),i.search=function(){b.clearFilters(),i.isSearchAdvanced&&angular.equals(i.filters,{})===!1?b.search(i.phrase,i.filters):i.filters.isSearchInContent?b.search(i.phrase,{isSearchInContent:!0}):angular.equals(i.filters,{})===!1?b.search(i.phrase,i.filters):b.search(i.phrase)},i.searchSuggestion=function(a){i.phrase=a,i.search()},i.searchFrom=function(a){i.filters={from:a},i.searchSuggestion()},i.searchTo=function(a){i.filters={to:a},i.searchSuggestion()},i.clearAll=function(){i.phrase=b.getPhrase(),(i.isSearchAdvanced||i.phrase||i.historyPhrase||angular.equals(i.filters,{})===!1)&&(b.clearAll(),b.refresh())},i.removeSuggestion=function(a){var c=i.suggestions[a];b.removeSuggestion(c).success(function(){i.suggestions.splice(a,1)})},i.selectSearchFolder=function(a){o&&(a.focusser=angular.element('<span style="display:none;"></span>'),a.close(!0)),o=!o},i.keyUp=function(a){var b=a.keyCode;return b===d.keyCodes.ARROW_DOWN?void m():b===d.keyCodes.ARROW_UP?void n():void 0},i.keyDown=function(a){var b=a.keyCode;b===d.keyCodes.NEWLINE&&i.selectedSuggestIndex!=-1&&(a.preventDefault(),i.searchSuggestion(k()[i.selectedSuggestIndex]))},i}],link:function(a,b,c){var d=b[0].querySelector("#search");a.blur=function(){d.blur()},a.$watchCollection("filters",function(){var b="Szukaj",c=[];a.phrase||angular.equals(a.filters,{})||(a.filters.from&&c.push("Od: "+a.filters.from),a.filters.to&&c.push("Do: "+a.filters.to),c.length||!a.filters.date_from&&!a.filters.date_to||(c.push("Zakres dat:"),a.filters.date_from&&c.push(a.filters.date_from),a.filters.date_to&&c.push("- "+a.filters.date_to)),!c.length&&a.filters.folder&&a.folders.some(function(b){return b.id==a.filters.folder&&(c.push("Szukaj w: "+b.name),!0)}),b=c.join(" ")),a.placeholder=b})}}}]),angular.module("nxt-message").directive("nxtAddClassWhenOverflowed",["$timeout",function(a){"use strict";return{restrict:"A",link:function(b,c,d){a(function(){c.prop("offsetHeight")<c.prop("scrollHeight")&&c.addClass(d.nxtAddClassWhenOverflowed)},50,!1)}}}]),angular.module("nxt-message").directive("nxtMessageIframe",["$rootScope","$timeout","ApplicationConfig","InfoBoards","DialogManager","Track","Offer","Compositions",function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l="inpl-get-voucherCode",m="inpl-offer-link",n="inpl-get-adjustMailbox-links",o="inpl-get-adjustMailbox",p="inpl-get-adjustMailbox-img",q="inpl-get-adjustMailbox-map",r=[];return{restrict:"EA",replace:!0,template:'<iframe src="about:blank" frameBorder="0"></iframe>',scope:{message:"=?nxtMessageIframeData"},link:function(s,t){function u(){return R||(N=M.contentDocument||M.contentWindow.document,Array.prototype.forEach.call(N.body.querySelectorAll("[data-inpl-src]"),function(a){S.push(angular.element(a))}),R=!0),S}function v(){M.style.width="100%",c.env.device.isMobile&&(M.style.height="100%"),b(function(){N&&N.body&&(M.style.height=N.body.scrollHeight+"px",b(function(){if(N&&N.body){M.style.width=N.body.scrollWidth+"px";for(var b=N.getElementsByTagName("table"),c=[],d=0;d<b.length;d++)c.push(b[d].scrollWidth);var e=Math.max.apply(null,c);N.body.scrollWidth<e&&(M.style.width=e+"px")}a.$broadcast("directive:scale-image")},0,!1))},0,!1)}function w(a){b.cancel(K),a=a||100,K=b(v,a,!1)}function x(){var a,b;O||(O=!0,J=N.querySelector(".inpl-collapsed"),J&&(b=J.querySelector("blockquote")),J&&b&&b.classList.contains("nxt-original-message-notrevealed")&&(a=J.getBoundingClientRect(),J=angular.element(J),!J||J.hasClass("noHidden")||s.message.forwardedFrom||(Q=J.attr("style"),J.removeAttr("style"),J.attr("title","Wyświetl treść wiadomości"),J.addClass("hiddenBlockquote"),M.style.height=a.top+30+"px",J.on("click",function(){var a=angular.element(this);J.off("click"),a.removeClass("hiddenBlockquote"),a.attr("style",Q),a.attr("title",""),w()}))))}function y(b){if("UPDATE_SIZE"===b.data&&N){var d=c.env.currentThemeSaved||c.env.themeSelected,e=102===d.id&&!c.env.device.isMobile;angular.element(window).off("message",y);var f=N.querySelector("head"),g=angular.element(f),h=N.getElementsByTagName("base").length>=1;h||g.append('<base target="_blank" />');var i=N.querySelector("#iframe-outside-style");null===i&&(i=document.createElement("style"),i.type="text/css",i.id="iframe-outside-style",f.appendChild(i));var j=""+e+"_"+a.isGallery+"_"+s.message.msgType;if(j!==L){var k,l="body.inpl-mailing{background-color:rgba(255,255,255,.7)}";try{var m=window.getComputedStyle(N.querySelector("body"),null).backgroundColor.match(/\d{1,3}/g);angular.isArray(m)&&m.length>=3||(m=[0,0,0,0]),k=.299*m[0]+.587*m[1]+.114*m[2]}catch(b){k=0}var n=230;k<n&&(l+="body.inpl-not-mailing{color:#FFF}body.inpl-not-mailing a{color:#318FCD}body.inpl-not-mailing .content1,body.inpl-not-mailing .content2{color:black;background-color:#f7f8f9}");var o="html{overflow-y:hidden;word-wrap:break-word;white-space: normal;}";o+=e?l:"",o+='body.inpl-not-mailing{font-family:Roboto,sans-serif;font-size:14px;line-height:1.4em;margin:1px}pre{white-space:pre-wrap;word-wrap:break-word}.hiddenBlockquote>*{display:none!important}.hiddenBlockquote{margin:5px 0 0;overflow:hidden;height:16px;width:23px}.hiddenBlockquote:before{display:block!important;border:1px solid #D7D7D7;background-color:#F7F7F7;color:#757575;width:21px;height:14px;line-height:14px;font-size:14px;text-align:center;cursor:pointer;cursor:hand;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px;content:"•••"}[data-nxt-blocked-image] {cursor: default !important;}',o+=2===a.isGallery?".public_gallery_body{-webkit-filter:grayscale(1);filter:grayscale(1)}":"",o+="voucher"==s.message.msgType?".voucher-code {background:#28A0FD;color:#FFF;display:block;line-height:53px;font-size:16px;height:53px;margin-top:29px;font-weight:bold;width:331px;padding-left:33px;letter-spacing: 2.4px;position:relative}.barcode-container{background:#fff;border-radius:1px;display:inline-block;width:187px;height:51px;position:absolute;right:1px;top:1px}.barcode.code128{float:left;height:22px;margin-top:15px;margin-left:39px}.barcode.code128>div.b{background:#000;float:left;height:100%}.barcode.code128>div.w{background:#FFF;float:left;height:100%}.barcode.code128 .w20{width:20px}.barcode.code128 .w1{width:1px}.barcode.code128 .w2{width:2px}.barcode.code128 .w3{width:3px}.barcode.code128 .w4{width:4px}.barcode.code128 .w5{width:5px}.barcode.code128 .w6{width:6px}.barcode.code128 .w7{width:7px}.barcode.code128 .w8{width:8px}.barcode.code128 .w9{width:9px}.barcode.code128 .w10{width:10px}.barcode.code128 .b1{width:1px}.barcode.code128 .b2{width:2px}.barcode.code128 .b3{width:3px}.barcode.code128 .b4{width:4px}.barcode.code128 .b5{width:5px}.barcode.code128 .b6{width:6px}.barcode.code128 .b7{width:7px}.barcode.code128 .b8{width:8px}.barcode.code128 .b9{width:9px}.barcode.code128 .b10{width:10px}":"",o+="@media screen and (max-width:605px){body.inpl-mailing{-webkit-text-size-adjust:none}.inpl-mailing table.tableC{width:100%;height:auto}.inpl-mailing table{max-width:100%}.inpl-mailing table:first-of-type{width:100%;height:auto}}",i.innerHTML=o}L=j,x(),w()}}function z(a){a.stopPropagation(),a.preventDefault()}function A(){var a;P||(a=u(),a.forEach(function(a){a.on("click",z)}))}function B(){for(var a=N.getElementsByTagName("a"),b=0;b<a.length;b++){var c=a[b];c.getAttribute("href")&&"mailto:"==c.getAttribute("href").substring(0,7).toLowerCase()&&(c.onclick=function(a){var b=a.target.getAttribute("href").substring(7);h.addComposition({to:{email:b},autoFocusContent:!0}),a.preventDefault()})}}function C(a){var b=r.indexOf(a);b!==-1&&r.splice(b,1)}function D(a){var b,d=u(),e=[],f=[];if(a=a||!1,P)d.forEach(function(a){a.removeAttr("src"),a.attr("data-nxt-blocked-image")}),P=!1,a&&C(s.message.id),M.style.height=0,w();else{for(d.forEach(function(a){a.on("load",function(){c.env.device.isMobile?w(500):w()}),a.attr("src",a.attr("data-inpl-src")),a.removeAttr("data-nxt-blocked-image"),a.off("click",z)}),document.querySelectorAll&&(e=N.body.querySelectorAll("[data-inpl-style]"),f=N.body.querySelectorAll("[data-inpl-background]")),b=0;b<e.length;b++)e[b].setAttribute("style",e[b].getAttribute("data-inpl-style")),e[b].removeAttribute("data-inpl-style");for(b=0;b<f.length;b++)f[b].setAttribute("background",f[b].getAttribute("data-inpl-background")),f[b].removeAttribute("data-inpl-background");a&&r.push(s.message.id),P=!0}s.$emit("message:forced-show-images",P)}function E(){w(500)}var F,G,H,I,J,K,L,M=t[0],N=null,O=!1,P=!1,Q="",R=!1,S=[],T=null,U=null,V=null,W=null,X=null,Y=null;s.messageIframe=s.message.content,s.$watch("messageIframe",function(b){if(b&&(M.contentDocument||M.contentWindow)&&(M.onload=function(){w(),A();var b=M.contentDocument||M.contentWindow.document;if(j=function(){var a=document.getElementsByClassName("sticky")[0],b=angular.element(document.getElementsByClassName("message-section-container"))[0],c=b.scrollTop,d=angular.element(a).parent(),e=d.prop("offsetTop");a&&c>e?document.getElementsByClassName("sticky")[0].classList.add("active"):a&&document.getElementsByClassName("sticky")[0].classList.remove("active")},b.body.addEventListener("touchmove",j,!1),b.body.onclick=function(b){a.$broadcast("ui-events:click",{panel:"message",target:b.currentTarget}),b.target.className.indexOf("nxt-slideshow")===-1&&b.target.parentNode.className.indexOf("nxt-slideshow")===-1||(b.preventDefault(),s.$emit("message:content:open-slideshow"),f.pushCode("welcomeMailingDetails")),a.$broadcast("message:iframe:touch")},b.body.querySelector("a.nxt-slideshow")&&f.pushCode("welcomeMailingShow"),angular.element(b.body).addClass(s.message&&s.message.isMailing?"inpl-mailing":"inpl-not-mailing"),s.message.isMailing){var d=M.contentWindow.document.querySelectorAll(".inpl-inline-attachment");1==d.length&&(d[0].style.maxWidth="100%",d[0].style.height="initial",c.hacks.isIE&&(d[0].style.width="100%",d[0].style.height="auto"))}if(c.env.isMobileApp)for(var e=M.contentWindow.document.querySelectorAll("a"),g=0;g<e.length;g++)e[g].setAttribute("target","_top")},angular.element(window).on("message",y),M.style.height=0,N=M.contentDocument||M.contentWindow.document,r.indexOf(s.message.id)!==-1?(P=!0,N.write(b.replace(/<img ([^>]* )?src="(.*?)"([^>]* )?data-inpl-src="(.*?)"/g,'<img $1src="$4"$2data-inpl-src="$4"')),s.$emit("message:forced-show-images",!0)):N.write(b.replace(/<img ([^>]* )?data-inpl-src="(.*?)"/g,'<img $1data-inpl-src="$2" data-nxt-blocked-image')),N.write("<script>if (parent && parent.postMessage) {parent.postMessage('UPDATE_SIZE', '*');}</script>"),N.close(),B(),"voucher"==s.message.msgType&&(T=N.getElementById(l),T&&(T.onclick=function(b){var c=T.href.split("/"),d=c[c.length-1];g.getVoucher(d).success(function(b){var c=angular.element(T),d=b.code,e=barcode(d,"code128"),f=document.createElement("div"),g=document.createElement("div");a.$broadcast("message:iframe:voucher-open",{code:d}),f.className="voucher-code",f.innerHTML=d,g.className="barcode-container",g.appendChild(e),f.appendChild(g),c.after(f),c.remove()}),b.preventDefault()})),"offer"==s.message.msgType&&(U=N.getElementById(m),U&&(U.onclick=function(){f.pushIWA(["Kody_rabatowe","Oferty","klik_w_mail","kody",U.getAttribute("href")])})),V=N.getElementById(n),V&&(function(){if(c.env.device.isMobile&&c.hacks.isIOS&&!c.env.device.isMobileApp)for(var a=N.getElementsByTagName("a"),b=0;b<a.length;b++){var d=a[b];d.href.startsWith("https://itunes.apple.com/app/")&&(d.onclick=function(a){window.location="https://itunes.apple.com/app/apple-store/id1141842988?pt=584558&ct=mail_powitalny_but&mt=8&ls=1",a.preventDefault()})}}(),V.style.display="block",W=N.getElementById(o)))){c.env.device.isMobile||(W.onclick=function(a){d.getBoardConfById(210).success(function(a){e.multiBoards(a.options)}),a.preventDefault()});try{X=N.getElementById(p),X.removeAttribute("usemap"),Y=N.getElementById(q),Y.parentNode.removeChild(Y)}catch(h){}}}),F=a.$on("service:message:show-images",function(a,b){D(!0)}),H=a.$on("service:message:show-images-always",function(){P=!1,D(!0)}),G=a.$on("service:message:resize-handler",function(a,b){E()}),I=a.$on("settings:theme:adjust-iframe-style",function(){var a={data:"UPDATE_SIZE"};y(a)}),angular.element(window).on("resize",E),s.$on("$destroy",function(){var a;R&&(a=u(),a.forEach(function(a){a.off("click"),a.off("load")})),t.unbind(),N&&N.body&&(N.body.onclick=null,N.body.removeEventListener("touchstart",i),N.body.removeEventListener("touchmove",j),N.body.removeEventListener("touchend",k)),M.onload=null,N=null,T&&(T.onclick=null,T=null),U&&(U.onclick=null,U=null),F(),H(),G(),I(),angular.element(window).off("message"),J&&"function"==typeof J.off&&J.off("click"),angular.element(window).off("resize",E)})}}}]),angular.module("nxt-message").directive("nxtScaleMessage",["ApplicationConfig","$timeout","$interval","$window",function(a,b,c,d){"use strict";var e,f,g,h,i,j,k,l,m=!1,n=150,o=5e3;return{restrict:"A",link:function(p,q,r){function s(){j=(new Date).getTime(),g=e[0].offsetWidth,h=e[0].scrollWidth,g<h&&(m||(i=angular.element("<div></div>"),i.addClass("scale-button"),e.parent().append(i)),m=!0,u())}function t(c){var g;a.hacks.isAndroidDefault&&e.css({position:"",overflow:"","-webkit-transform":"",transform:"","-webkit-transform-origin":"","transform-origin":"",height:"","min-height":""}),b(function(){g=f[0].offsetHeight*c,e.css({position:"relative",overflow:"","-webkit-transform":"scale("+c+")",transform:"scale("+c+")","-webkit-transform-origin":"top left","transform-origin":"top left",height:g+"px","min-height":g+"px"}),(a.env.device.isPc||a.env.device.isIOS&&d.screen.width>=768)&&(e.css({width:h+"px",height:""}),e.next().css({"margin-top":-f[0].offsetHeight+g+"px"})),l=f[0].offsetHeight},0)}function u(a){w();var b=g/h;l=f[0].offsetHeight,t(b),k=c(function(){var a=(new Date).getTime()-j>o;f[0].offsetHeight==l?a&&w():t(b)},n,k),i.removeClass("scale-button--zoomout"),i.off().on("click",v),NXT_CONFIG.isMessageScaleUp=!1,a&&a.stopPropagation()}function v(b){w(),e.css({"-webkit-transform":"",transform:"",height:e[0].scrollHeight+"px","min-height":e[0].scrollHeight+"px",overflow:"scroll"}),(a.env.device.isPc||a.env.device.isIOS&&d.screen.width>=768)&&(e.css({"min-height":e[0].scrollHeight+15+"px","overflow-y":"hidden",width:""}),e.next().css({"margin-top":0})),a.hacks.isAndroidDefault&&(e.css({height:"","min-height":"",overflow:""}),a.hacks.AndroidVersion>4.3&&e.css({"overflow-x":"scroll","overflow-y":"scroll"})),i.addClass("scale-button--zoomout"),i.off().on("click",u),NXT_CONFIG.isMessageScaleUp=!0,b&&b.stopPropagation()}function w(){k&&c.cancel(k)}p.firstFullMessage.isMailing||(e=angular.element(q[0]),f=e[0].getElementsByTagName("iframe"),p.$on("directive:scale-image",function(a,c){f?s():b(function(){f=e[0].getElementsByTagName("iframe"),f&&s()},1e3)}),p.$on("$destroy",function(){i&&i.off(),m=!1,w(),NXT_CONFIG.isMessageScaleUp=!1}))}}}]),angular.module("nxt-notification").directive("nxtInfoNotification",["$timeout","$rootScope","Notification",function(a,b,c){"use strict";return{restrict:"A",replace:!0,scope:!1,link:function(a,b,d){var e=function(a){b.on(a,function(b,d){var e=d||b.target,f=(e.getAttribute("data-notyfi-"+a)||"").trim(),g="";f.length>0&&(g=(e.getAttribute("data-notyfi-"+a+"-att")||"").trim(),g.length>0&&(g=g.split("^")),"success"==g[0]?c.success(f):(c.error(f),b.stopPropagation()))})};e("click")}}}]),angular.module("nxt-notification").directive("nxtMailNotification",["$interval","$rootScope","$timeout","ApplicationConfig","Messages",function(a,b,c,d,e){"use strict";function f(){!j&&h&&(j=!0,h.play(),h.addEventListener("ended",g))}function g(){j=!1,h.removeEventListener("ended",g)}var h,i=d.folders.SPAM,j=!1;return{restrict:"A",replace:!0,templateUrl:"/notification/views/mailNotification.html",scope:{},controller:["$scope","Folder","Message",function(a,b,c){return a.messages=[],a.$on("service:longpoll:success",function(b,d){d.inLastHour&&c.get({id:d.id,leaveAsUnread:!0}).success(function(b){b.folderId!==i&&(a.messages.push(b),f())})}),a.$on("folder:controller:showAvatars",function(b){a.avatarsShowed=d.env.showAvatars}),b.queryAsMap().success(function(b){a.foldersMap=b.all}),a}],link:function(f,i,j){function k(a){for(var b=0;b<f.messages.length;b++)a.uniqueId==e.getUniqueId(f.messages[b])&&f.messages.splice(b,1)}f.activeIndex=0,f.avatarsShowed=d.env.showAvatars,f.prev=function(){f.activeIndex=f.activeIndex-1,f.activeIndex<0&&(f.activeIndex=f.messages.length-1)},f.next=function(){f.messages.length&&(f.activeIndex=(f.activeIndex+1)%f.messages.length)},f.remove=function(){f.messages=[],f.activeIndex=0},f.openMessage=function(a){f.$emit("controller:folder:open-message",a),f.remove()},f.markAsFavorite=function(a){f.$emit("controller:folder:mark-as-favorite",a),f.$emit("message-to-folder:star-message-on-list",a)},f.$on("service:messages:move-to-trash",function(a,b){k(b.messages[0])}),b.$on("ui-events:click",function(){f.messages.length&&c(f.remove,5e3)}),a(f.next,5e3),f.audioNotification=d.env.audioNotificationId,f.audioNotification&&(f.audioFile=d.env.staticUrl+"/au/"+f.audioNotification,c(function(){h=document.getElementById("audioNotification"),h||c(function(){h=document.getElementById("audioNotification")},500)},0)),f.$on("$destroy",function(){h&&(h.removeEventListener("ended",g),h=null)})}}}]),angular.module("nxt-notification").directive("nxtMainNotification",["$interval","$timeout","$rootScope","DialogManager","$http","ApplicationConfig","MobileApp","Notification","$state",function(a,b,c,d,e,f,g,h,i){"use strict";function j(){function a(){i.go("^")}b(function(){d.confirm({message:'Przekroczono limit transferu.<br> Skontaktuj się z <a href="mailto:pomoc@firma.interia.pl" class="link">Biurem Obsługi Klienta</a>',callback:a,callbackClose:a,additionalClasses:"transferLimit",confirm:"Zamknij"}),c.$digest()},0,!1)}var k=2,l=0,m=document.title,n={2602:j,2603:j};return c.$on("ui-events:click",function(){l&&(l=0,document.title=m)}),{restrict:"A",replace:!0,templateUrl:"/notification/views/mainNotification.html",scope:{},controller:["$scope","$timeout","Notification",function(b,c,d){b.notifications=[],b.removeNotification=function(a){b.notifications.splice(a,1)},b.removeNotificationByMessageId=function(a){for(var c=0;c<b.notifications.length;c++)if(b.notifications[c].messageId===a){b.notifications.splice(c,1);break}},f.env.device.isMobile&&b.$on("notification:remove:all",function(){b.notifications=[]}),b.$on("http:response:error",function(a,b){b.error&&404!==b.error.code?200===b.error.code||b.error.message?d.error(b.error.message):d.error("Błąd połączenia z serwerem"):404!==b.status&&(b.data&&b.data.msg?f.env.isMobileApp&&Object.keys(n).indexOf(b.data.code.toString())!=-1?n[b.data.code]():d.error(b.data.msg,!1,b.data.code):f.env.isMobileApp?g.connectionError():d.error("Problem z połączeniem internetowym, proszę odświeżyć stronę"))}),b.stopInterval=function(){void 0!==b.interval&&(a.cancel(b.interval),b.interval=void 0)},b.timeToClose=function(a){c(function(){b.removeNotificationByMessageId(a)},6e3)}}],link:function(a,b,c){a.$on("service:notification:new",function(b,c){a.callback=h.getOnClickCallback(c.messageId);var d=a.notifications.some(function(a){return a.message==c.message});d===!1&&(a.notifications.length>k&&(a.stopInterval(),a.notifications.shift()),f.env.device.isMobile&&document.getElementsByClassName("section--folder")[0]&&(document.getElementsByClassName("notification-container")[0].style.top=0),a.notifications.push(c),c.noClose||a.timeToClose(c.messageId))}),a.$on("service:notification:info",function(a,b){d.info({title:b.title,message:b.message.split("\n").join("<br>"),confirm:"Zamknij",additionalClasses:"notification-info"})}),a.$on("service:notification:close",function(b,c){a.removeNotificationByMessageId(c.messageId)})}}}]),angular.module("nxt-composition").directive("nxtBarcode",function(){return{restrict:"A",scope:{code:"=?nxtBarcode"},link:function(a,b){a.barcode=barcode(a.code,"code128"),b.append(a.barcode)}}}),angular.module("nxt-public-gallery").directive("nxtPublicGallery",["ApplicationConfig","$rootScope","Gallery","Track","$timeout",function(a,b,c,d,e){"use strict";var f=0,g=1;return{restrict:"A",scope:{message:"=?nxtPublicGalleryMessage",options:"=?nxtPublicGalleryOptions"},controller:["$scope",function(b){if(a.env.device.isPc){switch(b.options=b.options||{},b.isGallery=!0,b.galleryOn=!0,b.stateCss="",b.env=a.env,b.links=a.links,b.message&&(b.message.folderId!=a.folders.SENT&&(b.galleryOn=!1),b.isGallery=b.message.gallery.state,b.isContent=b.message.gallery.content),void 0!==b.$parent.isGalleryState&&(b.isGallery=b.$parent.isGalleryState,b.isGalleryDraft=!0),b.isGallery){case 0:b.stateCss="disabled";break;case 2:b.stateCss="block"}return b}}],link:function(a,h){var i=!1,j=!1;a.compositionId=a.$parent.compositionId||a.message.id,a.isSaving=!1,e(function(){if(a.isGallery&&a.message){var b=document.createElement("div");document.getElementById("public-gallery-content").appendChild(b).innerHTML=a.message.gallery.content,d.pushGemius("16LrQGMyZMOkG555zOOOKPUIzXaRwKcS3ijYddoo46..L7")}},0,!1),a.changeState=function(d){if(d==g&&c.changeState(a.compositionId,g).success(function(){}),a.message)c.changeState(a.message.id,d).success(function(){a.isGallery=d;var b=angular.element(h[0].querySelector(".public-gallery-panel"));1==d&&b.hasClass("disabled")&&b.removeClass("disabled"),0===d&&b.addClass("disabled")});else{a.isGallery=d;var e=angular.element(h[0].querySelector(".public-gallery-panel"));1==d&&e.hasClass("disabled")&&(e.removeClass("disabled"),b.$broadcast("directive:publicGallery:isGallery",d)),0===d&&(c.changeState(a.compositionId,f).success(function(){}),e.addClass("disabled"),b.$broadcast("directive:publicGallery:isGallery",d))}},a.hitGemius=function(a){d.pushGemius(a)},a.openMenu=function(){if(!i){a.compositionId=a.$parent.compositionId||a.message.id;var d=angular.element(h[0].querySelector(".public-gallery-panel-options")).hasClass("dropdown-icon--arrowup");d&&0!==a.isGallery&&(c.changeState(a.compositionId,g).success(function(){}),i=!0)}j&&(a.isSaving=!0,j=!1,b.$broadcast("composition:save"))},b.$on("directive:publicGallery:completeUpload",function(){a.isSaving=!1}),b.$on("directive:publicGallery:progressall",function(){a.isSaving=!0}),b.$on("directive:publicGallery:removeAttachment",function(){j=!0}),b.$on("directive:composition:saved-finish",function(){a.compositionId=a.$parent.compositionId||a.message.id,a.isSaving=!1})},templateUrl:function(){return"/public-gallery/views/main.html"}}}]),angular.module("nxt-settings").directive("nxtCarousel",["$rootScope","$state","$timeout","ApplicationConfig","ApplicationData","Theme",function(a,b,c,d,e,f){return{restrict:"A",transclude:!0,templateUrl:"/settings/views/carousel.html",link:function(a,g,h){function i(){a.carouselMode||a.isWizard||(a.fakeThemes=[],c.cancel(s),s=c(function(){for(var b=t.querySelector(".settings-skin:last-child"),c=b.offsetWidth,d=b.offsetHeight,e=parseInt(window.getComputedStyle(b).marginRight,10),f=t.offsetWidth,g=t.offsetHeight,h=t.querySelectorAll(".settings-skin").length+1,i=Math.floor(f/(c+e))*Math.floor(g/d)-h,j=0;j<i;j++)a.fakeThemes[j]=j},50))}function j(){var a=parseInt(l());k(!1,a,!1),i()}function k(b,c,d){if(q){var e=q.offsetWidth*z-2*y,f=v+c-(e-50),g=f>=-w;a.disabledPrev=c>=0,a.disabledNext=f<=0,a.withoutButtons=a.disabledPrev&&a.disabledNext,d&&(b?c<=0&&r.css({"margin-left":c+"px"}):g&&r.css({"margin-left":c+"px"}))}}function l(){return r.css("margin-left")||"0px"}function m(){c(function(){q=document.querySelector(".settings-container"),p=t.querySelector(".settings-skins"),o=t.querySelector(".settings-skins-carousel"),r=angular.element(o),k(!1,0,!1),i(),angular.element(window).on("resize",j),a.$digest()},0,!1)}function n(){c(function(){angular.element(window).off("resize",j),a.$digest()},0,!1)}var o,p,q,r,s,t=g[0],u=0,v=0,w=134,x=d.env.device.isPc;a.isWizard=a.$parent.isWizard=h.nxtCarouselWizard,a.carouselMode=!d.env.device.isMobile&&!a.isWizard;var y=x?39:19,z=x?.52:1;d.env.currentThemeSelected=d.env.currentThemeSelected||d.env.themeSelected,d.env.lastThemeSelected=d.env.lastThemeSelected||d.env.themeSelected,d.env.currentThemeSaved=d.env.currentThemeSaved||d.env.themeSelected,d.env.currentUserThemeSaved=d.env.currentUserThemeSaved||d.env.themesUser[0],a.themeSelected=d.env.currentUserThemeSaved,a.activeId=d.env.currentThemeSelected.id,a.carouselWithoutButtons=!1,a.disabledPrev=!0,a.disabledNext=!1,a.withoutButtons=a.disabledPrev&&a.disabledNext,a.isIOS=d.hacks.isIOS,a.isIpad=d.hacks.isIpad,a.isCorp=d.env.isCorp,a.hideUserSkinSelect=a.isCorp,a.fakeThemes=[],a.hasUserHadOwnSkin=function(){return void 0!==a.themeSelected},a.themeBaseUrl=d.env.attachBaseUrl,a.themeSelected&&(a.themeSelected.thClass="C422",a.themeSelected.thXLClass="C459"),f.query().success(function(b){a.themes=b,d.env.userThemes=a.themes.filter(function(a){return"2"===a.type}),a.themes=a.themes.filter(function(a){return"2"!==a.type}),u=a.themes.length,v=(u+(a.hideUserSkinSelect?0:1))*w,m()}),a.addTheme=function(){a.$broadcast("controller:settings:addTheme")},a.selectTheme=function(c){a.activeId=c.id,d.env.currentThemeSelected=c,a.isWizard&&(a.$parent.selectedTheme=c),a.$broadcast("controller:settings:selectTheme",{theme:c,isSave:!a.isWizard}),a.isWizard||b.go("^")},a.selectDefaultTheme=function(){a.selectTheme(a.themes[0])},a.selectPreviousUserTheme=function(){angular.extend(a.themeSelected,e.getUserSkinMainObject(a.themeSelected.id)[0]),a.$emit("controller:settings:setAndSaveUserTheme",a.themeSelected),b.go("^")},a.$on("settings:close",function(){n()}),a.prev=function(){var a=parseInt(l())+w;k(!0,a,!0)},a.next=function(){var a=parseInt(l())-w;k(!1,a,!0)}}}}]),angular.module("nxt-settings").directive("nxtTheme",["$rootScope","$state","$timeout","ApplicationData","ApplicationConfig","Notification","Theme","ThemeUploader","Track","DialogManager",function(a,b,c,d,e,f,g,h,i,j){"use strict";var k,l={cFullHD:"C124",c640px:"C117",c480px:"C121"};return{restrict:"A",controller:["$scope",function(b){return b.$on("controller:settings:selectTheme",function(c,d){g.changeSkin(d.theme),d.isSave&&(g.select(d.theme.id).success(function(){b.clearAllUserThemesSelected(),e.env.currentThemeSaved=d.theme,a.$broadcast("settings:theme:adjust-iframe-style")}),i.pushCode("settingPanelChangeSkin",[d.theme.name]))}),b.$on("controller:settings:setAndSaveUserTheme",function(a,c){b.setUserTheme(c.id,c.attachment,c),g.changeSkin(c),b.updateUserBackground(),b.saveUserTheme(c)}),b}],link:function(h){function i(a){return e.env.attachBaseUrl+"/-/"+(e.env.currentThemeSelected.attachmentCropped||e.env.currentThemeSelected.attachment)+"-"+a+"."+e.env.currentThemeSelected.attachmentExt}function m(){c(function(){n=document.querySelector("#userBackground")},0,!1)}var n;h.openUserThemeWindow=function(){return h.isWizard?void(h.$parent.userThemeStep=1):(j.userTheme({title:"Prześlij swoje zdjęcie tła"}),h.$broadcast("settings:close"),void b.go("^"))},h.saveUserTheme=function(b,c){g.selectUserThemeJSON(b).success(function(){c&&f.success("uploader:theme-added"),h.clearPreviousUserThemeSelected(),e.env.currentThemeSaved=e.env.currentThemeSelected,e.env.currentUserThemeSaved=e.env.currentThemeSelected,a.$broadcast("settings:theme:adjust-iframe-style")})},h.setUserTheme=function(a,b,c){var f=d.getUserSkinMainObject(a)[0];e.env.currentThemeSelected={name:f.name,id:a,cssName:f.cssName,cssFile:f.cssFile,type:"2",attachment:b||e.env.currentThemeSelected.attachment,attachmentCropped:c?c.attachmentCropped:e.env.currentThemeSelected.attachmentCropped,x:c?c.x:e.env.currentThemeSelected.x,y:c?c.y:e.env.currentThemeSelected.y,width:c?c.width:e.env.currentThemeSelected.width,height:c?c.height:e.env.currentThemeSelected.height,attachmentExt:"jpg"};var h=101===e.env.currentThemeSelected.id?"white":"black",j=101===e.env.currentThemeSelected.id?"-F10":"-F9",m=i(l.cFullHD+j);return k="body, .contact-new-form, .contact-container, .settings-user-info:before, .isMobile .msglist-section-container, .isMobile .message-header { background: url('"+i(l.cFullHD+j)+"') no-repeat left top !important; background-size: cover !important; background-attachment: fixed !important; background-color: "+h+" !important; }",k+="@media (min-width: 890px) { .isMobile .msglist-section-container { background: transparent; }}",k+="body.isAndroidBrowser, .isAndroidBrowser .contact-new-form, .isAndroidBrowser .contact-container, .isAndroidBrowser .settings-user-info:before, .isAndroidBrowser.isMobile .msglist-section-container, .isAndroidBrowser.isMobile .message-header { background-attachment: scroll !important; }",
k+="@media (max-width: 640px) { body.isMobile, .isMobile .contact-new-form, .isMobile .contact-container, .isMobile .settings-user-info:before, .isMobile .msglist-section-container, .isMobile .message-header { background: url('"+i(l.c640px+j)+"') no-repeat left top !important; background-size: cover !important; background-attachment: fixed !important; background-color: "+h+" !important; }}",k+="@media (max-width: 640px) { body.isMobile.isAndroidBrowser, .isMobile.isAndroidBrowser .contact-new-form, .isMobile.isAndroidBrowser .contact-container, .isMobile.isAndroidBrowser .settings-user-info:before, .isMobile.isAndroidBrowser .msglist-section-container, .isMobile.isAndroidBrowser .message-header { background-attachment: scroll !important; }}",k+="@media (max-width: 480px) { body.isMobile, .isMobile .contact-new-form, .isMobile .contact-container, .isMobile .settings-user-info:before, .isMobile .msglist-section-container, .isMobile .message-header { background: url('"+i(l.c480px+j)+"') no-repeat left top !important; background-size: cover !important; background-attachment: fixed !important; background-color: "+h+" !important; }}",k+="@media (max-width: 480px) { body.isMobile.isAndroidBrowser, .isMobile.isAndroidBrowser .contact-new-form, .isMobile.isAndroidBrowser .contact-container, .isMobile.isAndroidBrowser .settings-user-info:before, .isMobile.isAndroidBrowser .msglist-section-container, .isMobile.isAndroidBrowser .message-header { background-attachment: scroll !important; }}",e.env.lastThemeSelected=e.env.currentThemeSelected,b||g.changeSkin(e.env.currentThemeSelected),m},h.updateUserBackground=function(){var a=document.createTextNode(k);n.appendChild(a)},h.clearPreviousUserThemeSelected=function(){for(;n.childNodes.length>=2;)n.removeChild(n.firstChild)},h.clearAllUserThemesSelected=function(){for(;n.childNodes.length>=1;)n.removeChild(n.firstChild)},h.clearCurrentUserThemeSelected=function(){for(var a="2"===e.env.currentThemeSaved.type?1:0;n.childNodes.length>a;)n.removeChild(n.lastChild);g.changeSkin(e.env.currentThemeSaved)},h.showLoader=function(){a.$broadcast("directive:theme:showLoader")},m()}}}]),angular.module("nxt-settings").directive("nxtUserTheme",["$rootScope","$state","$timeout","ApplicationData","ApplicationConfig","Theme","ThemeUploader","DialogManager","Notification",function(a,b,c,d,e,f,g,h,i){"use strict";var j,k={cFullHD:"C124",c640px:"C117",c480px:"C121"};return{restrict:"A",controller:["$scope",function(a){return a}],link:function(b,l,m){function n(){c(function(){t=v.querySelector(".upload-butt"),u=document.querySelector("#userBackground"),b.$digest()},0,!1),o()}function o(){b.uploader=g.getUploader(b)}function p(a){return e.env.attachBaseUrl+"/-/"+(e.env.currentThemeSelected.attachmentCropped||e.env.currentThemeSelected.attachment)+"-"+a+"."+e.env.currentThemeSelected.attachmentExt}function q(){c(function(){b.showLoadingIndicator=!0,b.$digest()},0,!1)}function r(){c(function(){b.showLoadingIndicator=!1,b.$digest()},0,!1)}function s(a){if("undefined"==typeof a)return a;var b=d.getUserSkinMainObject(a.id)[0],c={name:b.name,id:a.id,cssName:b.cssName,cssFile:b.cssFile,type:"2",attachment:a.attachment,attachmentCropped:a.attachmentCropped,attachmentExt:a.attachmentExt,x:a.x,y:a.y,width:a.width,height:a.height,thXLClass:"C306"};return c}var t,u,v=l[0];b.themeMiniatureExt="jpg",b.USER_THEME_LIGHT_TYPE=101,b.USER_THEME_DARK_TYPE=102,b.selectedUserThemeId=b.USER_THEME_DARK_TYPE,b.previewTheme=s(e.env.currentUserThemeSaved)||{},b.cropData={x:b.previewTheme.x,y:b.previewTheme.y,width:b.previewTheme.width,height:b.previewTheme.height,boxWidth:173,boxHeight:98},b.isWizard&&(b.cropData.boxWidth=137,b.cropData.boxHeight=89),b.userThemeId=b.previewTheme.id||b.USER_THEME_LIGHT_TYPE,b.themeBaseUrl=e.env.attachBaseUrl,b.cropFullBackgroundImage=b.themeBaseUrl+"/-/"+b.previewTheme.attachment+"-"+b.previewTheme.thXLClass+"."+b.previewTheme.attachmentExt+"|"+b.previewTheme.attachment,b.afterCropImage="",b.changeSkinPhase=0,b.onChange=function(a){b.afterCropImage=a.resultImage,b.cropData=a.cropData},b.hasUserHadOwnSkin=function(){return Boolean(b.previewTheme.attachment)},b.$watch("userThemeId",function(a,c){angular.equals(a,c)||b.setUserTheme(a)}),b.addUserTheme=function(){b.uploader.fileInputClick(v.querySelector(".skin-upload-frame--normal"),t)},b.setUserTheme=function(a,c){var e=d.getUserSkinMainObject(a)[0];b.previewTheme={name:e.name,id:a,cssName:e.cssName,cssFile:e.cssFile,type:"2",attachment:c||b.previewTheme.attachment,attachmentExt:"jpg",thXLClass:"C306"},b.cropFullBackgroundImage=b.themeBaseUrl+"/-/"+b.previewTheme.attachment+"-"+b.previewTheme.thXLClass+"."+b.previewTheme.attachmentExt+"|"+b.previewTheme.attachment},b.goToFirstSkinPhase=function(){b.changeSkinPhase=0},b.goToSecondSkinPhase=function(){b.changeSkinPhase=1},b.cropAndSaveUserTheme=function(){var a={};a.id=b.userThemeId,a.attachment=b.userThemeAttachment||b.previewTheme.attachment,a.attachmentExt=b.themeMiniatureExt,b.cropUserTheme(a),b.isWizard&&b.nextStep(!0)},b.cropUserTheme=function(a){var c=~~b.cropData.x,d=~~b.cropData.y,g=~~b.cropData.width,h=~~b.cropData.height;f.cropUserTheme(a.attachment,c,d,g,h,e.env.uid).success(function(c){var d=c.cropped.attachmentId,e=c.cropped.x||e,f=c.cropped.y||f,g=c.cropped.width||g,h=c.cropped.height||h;d&&(b.previewTheme.attachmentCropped=a.attachmentCropped=d,b.previewTheme.x=a.x=e,b.previewTheme.y=a.y=f,b.previewTheme.width=a.width=g,b.previewTheme.height=a.height=h,b.saveUserTheme(a))}).error(function(a){b.close()})},b.saveUserTheme=function(c){f.selectUserThemeJSON(c).success(function(c){i.success("uploader:theme-added"),e.env.currentThemeSelected=b.previewTheme,e.env.currentThemeSaved=e.env.currentThemeSelected,e.env.currentUserThemeSaved=e.env.currentThemeSelected;var d=101===e.env.currentThemeSelected.id?"white":"black",f=101===e.env.currentThemeSelected.id?"-F10":"-F9";j="body, .contact-new-form, .contact-container, .settings-user-info:before, .isMobile .msglist-section-container, .isMobile .message-header { background: url('"+p(k.cFullHD+f)+"') no-repeat left top; background-size: cover; background-attachment: fixed; background-color: "+d+"; }",j+="@media (min-width: 890px) { .isMobile .msglist-section-container { background: transparent; }}",j+="body.isAndroidBrowser, .isAndroidBrowser .contact-new-form, .isAndroidBrowser .contact-container, .isAndroidBrowser .settings-user-info:before, .isAndroidBrowser.isMobile .msglist-section-container, .isAndroidBrowser.isMobile .message-header { background-attachment: scroll; }",j+="@media (max-width: 640px) { body.isMobile, .isMobile .contact-new-form, .isMobile .contact-container, .isMobile .settings-user-info:before, .isMobile .msglist-section-container, .isMobile .message-header { background: url('"+p(k.c640px+f)+"') no-repeat left top; background-size: cover; background-attachment: fixed; background-color: "+d+"; }}",j+="@media (max-width: 640px) { body.isMobile.isAndroidBrowser, .isMobile.isAndroidBrowser .contact-new-form, .isMobile.isAndroidBrowser .contact-container, .isMobile.isAndroidBrowser .settings-user-info:before, .isMobile.isAndroidBrowser .msglist-section-container, .isMobile.isAndroidBrowser .message-header { background-attachment: scroll; }}",j+="@media (max-width: 480px) { body.isMobile, .isMobile .contact-new-form, .isMobile .contact-container, .isMobile .settings-user-info:before, .isMobile .msglist-section-container, .isMobile .message-header { background: url('"+p(k.c480px+f)+"') no-repeat left top; background-size: cover; background-attachment: fixed; background-color: "+d+"; }}",j+="@media (max-width: 480px) { body.isMobile.isAndroidBrowser, .isMobile.isAndroidBrowser .contact-new-form, .isMobile.isAndroidBrowser .contact-container, .isMobile.isAndroidBrowser .settings-user-info:before, .isMobile.isAndroidBrowser .msglist-section-container, .isMobile.isAndroidBrowser .message-header { background-attachment: scroll; }}",e.env.lastThemeSelected=e.env.currentThemeSelected,b.changeSkin(e.env.currentThemeSelected.cssFile),b.updateUserBackground(),b.clearPreviousUserThemeSelected(),a.$broadcast("settings:theme:adjust-iframe-style")}),b.close()},b.changeSkin=function(a){var b,c=document.getElementById("theme-stylesheet");null===c&&(c=document.createElement("link"),c.id="theme-stylesheet",c.rel="stylesheet","DS"===e.env.name?(c.type="text/less",less.sheets.push(c)):c.type="text/css",document.querySelector("head").appendChild(c)),c.setAttribute("href",e.env.staticUrl+"/css/"+a),"DS"===e.env.name&&(less.sheets.length&&(b=less.sheets[0].nextSibling,b&&b.parentNode.removeChild(b)),less.refresh())},b.updateUserBackground=function(){var a=document.createTextNode(j);u.appendChild(a)},b.clearPreviousUserThemeSelected=function(){for(;u.childNodes.length>=2;)u.removeChild(u.firstChild)},b.cancelUserTheme=function(){return b.isWizard?void(b.$parent.userThemeStep=0):void b.close()},b.close=function(){h.removeUserTheme()},b.afterAddingFile=function(){q()},b.afterAddingAll=function(a,c){c&&(b.uploader.clearQueue(),i.error("uploader:theme-size-exceeded"),r())},b.afterProgress=function(){},b.afterProgressAll=function(){},b.afterSuccess=function(a){var d=b.selectedUserThemeId;b.setUserTheme(d,a),b.userThemeAttachment=a,b.userThemeId=d,r(),c(function(){b.uploader.clearQueue(),b.$digest()},0,!1)},b.afterError=function(d){d.response&&d.response.code?(d=d.response,401===d.code?a.$broadcast("http:response:error:sessionExpired",d):403===d.code&&i.error("uploader:theme-token-error")):i.error("uploader:theme-other-error"),r(),c(function(){b.uploader.clearQueue(),b.$digest()},0,!1)},b.afterCompleteAll=function(){},a.$on("frame-login:success-ready",function(a){o()}),n()},templateUrl:function(){return e.env.device.isPc?"/settings/views/user_theme.html":"/settings/views/user_theme_mobile.html"}}}]),angular.module("nxt-slideshow").directive("nxtSlideshowImages",["$timeout","ApplicationData",function(a,b){"use strict";function c(a,b){var c,d=Math.atan(a.offsetWidth/a.offsetHeight),e=Math.sqrt(Math.pow(a.offsetHeight,2)+Math.pow(a.offsetWidth,2)),f=b*Math.PI/180;return c=b<90?f-d:b<180?f+d:b<270?f-d:f+d,a.offsetHeight/Math.cos(c)/e}function d(a,b){var c=a.indexOf("?f="),d=a.substring(0,c),e=a.substring(c);return angular.forEach(b,function(a,b){d+=","+b+","+a}),a=d+e}function e(){var a={maxwidth:window.innerWidth||document.documentElement.clientWidth,maxheight:window.innerHeight||document.documentElement.clientHeight};return window&&window.devicePixelRatio&&window.devicePixelRatio>1&&(a={maxwidth:a.maxwidth*window.devicePixelRatio,maxheight:a.maxheight*window.devicePixelRatio}),a}return{restrict:"A",scope:{images:"=nxtSlideshowImages"},link:function(f,g){function h(a,b){if(f.images[b]){var d=f.images[b].rotationAngle,e=Math.abs(c(f.images[b],d));a.style.cssText="-webkit-transform: rotate("+d+"deg) scale("+e+");-ms-transform: rotate("+d+"deg) scale("+e+");transform: rotate("+d+"deg) scale("+e+");"}}function i(a){if(!f.images[a].isLoaded){var b=document.createElement("img"),c=angular.element(g[0].children[a]);b.className="slideshow-photo-image",b.onload=function(){f.$apply(function(){f.images[a].offsetWidth=b.offsetWidth,f.images[a].offsetHeight=b.offsetHeight,f.images[a].isLoaded=!0,h(b,a)})};var i=e();l=i,f.images[a].originalUrl||(f.images[a].originalUrl=f.images[a].url),b.src=d(f.images[a].url,i),c.html("").append(b)}}function j(){a.cancel(m),m=a(function(){var b=e(),c=f.images[k];g.addClass("block-animate"),f.$parent.screenWidth=window.innerWidth||document.documentElement.clientWidth,g.css("width",(f.images.length+1)*f.$parent.screenWidth+"px"),g.css("left",-k*f.$parent.screenWidth+"px"),a(function(){g.removeClass("block-animate")},600);for(var h=0;h<f.images.length;h++)f.images[h].isLoaded=!1;c&&(l.maxwidth<b.maxwidth||l.maxheight<b.maxheight)&&(c.url=d(c.originalUrl,b),i(k))},100)}f.$parent.screenWidth=window.innerWidth||document.documentElement.clientWidth;var k,l,m,n=b.get("slideshowRotates");f.images=f.images.map(function(a){return n&&n[a.mid]&&n[a.mid][a.mpid]&&(a.rotationAngle=n[a.mid][a.mpid]),a}),g.css("width",(f.images.length+1)*f.$parent.screenWidth+"px"),f.$parent.$watch("currentIndex",function(a){k=a,g.css("left",-k*f.$parent.screenWidth+"px"),i(k),k>0&&i(k-1),k<f.images.length-1&&i(k+1)}),f.$on("slideshow:image:rotate",function(a,c){var d="left"==c.direction?-90:90,e=angular.element(g[0].children[c.currentIndex]).children()[0];f.images[c.currentIndex].rotationAngle=f.images[c.currentIndex].rotationAngle+d;var i=b.get("slideshowRotates");i||(i={}),i[c.mid]||(i[c.mid]={}),i[c.mid][f.images[c.currentIndex].mpid]=f.images[c.currentIndex].rotationAngle,b.put("slideshowRotates",i),h(e,c.currentIndex)}),angular.element(window).on("resize",j),f.$on("$destroy",function(){angular.element(window).off("resize",j);for(var a=0;a<f.images.length;a++)f.images[a].isLoaded=!1})}}}]),angular.module("nxt-slideshow").directive("nxtSlideshowScroller",["ApplicationConfig",function(a){"use strict";var b=a.env.device.isMobile?83:72;return{restrict:"A",scope:{isLast:"=nxtSlideshowScroller",index:"=nxtSlideshowScrollerIndex"},link:function(a,c,d){function e(c,d){var e,f,j=c*b,k=parseInt(i.css("left"),10)||0,l=i.prop("offsetWidth")+k;d=d||1,j?(h/2-k/2<j&&(d=-1),f=Math.abs(j-(Math.floor(h/2)-k))):f=Math.floor(h/2),e=g<h?0:d<0?Math.min(l-h,f):Math.min(-k,f);var m=k+d*e;i.css("left",m+"px"),a.$emit("slideshow:leftrightbuttons",{left:m<0,right:m+g-h>0})}var f,g,h=c.prop("offsetWidth"),i=c.children();a.$watch("isLast",function(c){c&&(f=i.children(),g=f.length*b,i.css("width",g+"px"),e(a.index))}),a.$on("controller:slideshow:previousPack",function(){e(null,1)}),a.$on("controller:slideshow:nextPack",function(){e(null,-1)}),a.$on("controller:slideshow:changephoto",function(a,b){e(b.index)})}}}]),angular.module("nxt-slideshow").directive("nxtSlideshowThumbnail",["$parse",function(a){return{restrict:"A",replace:!0,scope:{selected:"@nxtSelected"},link:function(a,b,c){a.$watch("selected",function(){"true"===a.selected&&a.$emit("directives:slideshowthumbnail:changed",{element:b})})}}}]),angular.module("nxt-common").filter("abs",function(){"use strict";return function(a){return Math.abs(a)}}),angular.module("nxt-common").filter("capacity",function(){"use strict";var a="MB";return function(b,c){if(b)switch(c=c||a){case"GB":b/=1024;case"MB":b/=1024;case"KB":b/=1024}return b}}),angular.module("nxt-common").filter("destroy",function(){"use strict";return function(a){return Array.isArray(a)?a.filter(function(a){return a._destroy!==!0}):a}}),angular.module("nxt-common").filter("firstletter",function(){"use strict";return function(a){return a&&a.length?a[0]:""}}),angular.module("nxt-common").filter("time",function(){"use strict";return function(a){a=a.toString(),a=a.replace(/\s+/,"");var b=Math.floor(a/60),c=a%60,d='<span class="hour">'+b+'</span><span class="min">'+c+"</span>";return d}}),angular.module("nxt-contact").filter("filterContacts",function(){"use strict";return function(a,b,c,d){return Array.isArray(a)?(d=d||"reverse"===d,b&&(a=a.filter(function(a){return a.name.indexOf(b)!==-1||a.email.indexOf(b)!==-1})),c&&(a=a.filter(function(a){var b=a.groups.indexOf(c);return d?b===-1:b!==-1})),a):a}}),angular.module("nxt-webmail").config(["$provide",function(a){"use strict";a.decorator("$animate",["$delegate","ApplicationConfig",function(a,b){return b.env.device.isPc&&(a.__enter__=a.enter,a.enter=function(b,c,d,e){var f=a.__enter__.apply(a,arguments);return b.attr("ui-view")&&b.hasClass("section--animate")&&(b.addClass("isInvisible"),setTimeout(function(){b.html()&&b.removeClass("isInvisible")},10)),f}),a}])}]),angular.module("nxt-common").config(["$provide",function(a){"use strict";a.decorator("nxtQuickEditDirective",["$delegate","$rootScope",function(a,b){var c=a[0],d=c.link;return angular.element(document.body).on("click",function(a){var c=a.target;c.className.indexOf&&c.className.indexOf("pickadate")===-1&&b.$broadcast("nxt-quick-edit-hide-datepicker",a.target)}),c.compile=function(a,e){return e.name.indexOf("Date")!==-1&&a.after("<div class='ng-hide' ng-model='"+e.ngModel+"' pickadate></div>"),function(a,e,f,g){if(a.show=function(){a.$apply(function(){h.removeClass("ng-hide")})},a.hide=function(){a.$apply(function(){h.addClass("ng-hide")})},f.name.indexOf("Date")!==-1){e.on("focus",a.show.bind(a)),a.$watch(function(){return g.$modelValue},function(b){g.$touched&&a.$emit("nxt-quick-edit:save",{name:g.$name,label:g.search,value:b})});var h=e.next();h.on("click",function(b){b.target.className.indexOf("pickadate-enabled")!==-1&&a.hide()}),b.$on("nxt-quick-edit-hide-datepicker",function(b,c){c!==e[0]&&a.hide()})}return d.apply(c,arguments)}},a}])}]),angular.module("nxt-contact").config(["$provide",function(a){"use strict";a.decorator("Contact",["$delegate","$q","ApplicationData","ApplicationConfig","Tools",function(a,b,c,d,e){var f=c.get("Contact"),g=d.ContactKeys;if(f&&f.data)for(var h=0;h<f.data.length;h++)f.data[h][g.SORT_NAME]=e.getSortString(f.data[h][g.NAME]);return a.__query__=a.query,a.query=function(e){if(f&&f.data&&f.time===d.cacheTime&&void 0===e){f.data=f.data.map(function(b){return b[g.IS_READONLY]=b[g.TYPE]==a.CONTACT_TYPE_CORPORATE||b[g.TYPE]==a.CONTACT_TYPE_EMPLOYEE,b});var h=b.when(f.data);return h.success=function(a){return h.then(a),h},h.error=function(a){return h.then(null,a),h},h}return a.__query__(e).success(function(a){c.put("Contact",{time:d.cacheTime,data:a})}).then(function(a){return a.data})},a}])}]),angular.module("nxt-contact").config(["$provide",function(a){"use strict";a.decorator("ContactGroup",["$delegate","$q","ApplicationData","ApplicationConfig","Contact",function(a,b,c,d,e){var f=c.get("ContactGroup");return f&&f.data&&(f.data=f.data.map(function(a){return a.words=e.getContactDictionary(a.name),a})),a.__query__=a.query,a.query=function(){if(f&&f.data&&f.time===d.cacheTime){var e=b.when(f.data);return e.success=function(a){return e.then(a),e},e.error=function(a){return e.then(null,a),e},e}return a.__query__().success(function(a){c.put("ContactGroup",{time:d.cacheTime,data:a})})},a.__get__=a.get,a}])}]),angular.module("nxt-exception").config(["$provide",function(a){"use strict";a.decorator("$exceptionHandler",["$delegate","$injector","ApplicationConfig",function(a,b,c){return function(c,d){var e=(b.get("$http"),b.get("Bugtracker"));return e.send({exception:c,message:c?c.message:"empty exception",cause:d}),a.apply(a,arguments)}}])}]),angular.module("nxt-external-account").config(["$provide",function(a){"use strict";a.decorator("ExternalAccount",["$delegate","$q","ApplicationData","ApplicationConfig",function(a,b,c,d){var e=c.get("ExternalAccount");return 0===d.prefs.defaultAccount&&(d.prefs.defaultAccount=d.env.ownEmail),a.__query__=a.query,a.query=function(f,g){if(f=f||d.folders.INBOX,e&&e.data&&e.time===d.cacheTime&&f==d.folders.INBOX&&!g){e.data=e.data.map(function(b){return b.service=a.getService(b.email),b.unread=b.totalMsg-b.readMsg,b.defaultSent=b.email==d.prefs.defaultAccount,b});var h=b.when(e.data);return h.success=function(a){return h.then(a),h},h.error=function(a){return h.then(null,a),h},h}return a.__query__(f,g).success(function(a){c.put("ExternalAccount",{time:d.cacheTime,data:a})})},a}])}]),angular.module("nxt-filter").config(["$provide",function(a){"use strict";a.decorator("Blacklist",["$delegate","$q","ApplicationData","ApplicationConfig",function(a,b,c,d){var e=c.get("Blacklist");return a.__query__=a.query,a.query=function(){if(e&&e.data&&e.time===d.cacheTime){var f=b.when(e.data);return f.success=function(a){return f.then(a),f},f.error=function(a){return f.then(null,a),f},f}return a.__query__().success(function(a){c.put("Blacklist",{time:d.cacheTime,data:a})})},a}])}]),angular.module("nxt-folder").config(["$provide",function(a){"use strict";a.decorator("Folder",["$delegate","$q","$stateParams","ApplicationData","ApplicationConfig","$rootScope","DialogManager",function(a,b,c,d,e,f,g){function h(a,b){for(var c=a.length;c--;){if(a[c].id==b)return a[c];if(a[c].subfolders){var d=h(a[c].subfolders,b);if(d)return d}}}var i=d.get("Folder");return a.__query__=a.query,a.query=function(){if(i&&i.data&&i.time===e.cacheTime){var c=b.when(i.data);return c.success=function(a){return c.then(a),c},c.error=function(a){return c.then(null,a),c},c}return a.__query__().success(function(a){d.put("Folder",{time:e.cacheTime,data:a})})},a.__queryAsMap__=a.queryAsMap,a.queryAsMap=function(){if(i&&i.data&&i.time===e.cacheTime){var c={all:e.folders,system:e.folders,user:{}};i.data.forEach(function(a){c.all[a.id]=a,a.isSystem||a.isShopping||a.isSocial?(c.system[a.id]=a,a.isShopping&&(c.all.SHOPPING=a.id,c.system.SHOPPING=a.id),a.isSocial&&(c.all.SOCIAL=a.id,c.system.SOCIAL=a.id)):(c.user[a.id]=a,Array.isArray(a.subfolders)&&a.subfolders.forEach(function(a){c.all[a.id]=a,c.user[a.id]=a}))});var d=b.when(c);return d.success=function(a){return d.then(a),d},d.error=function(a){return d.then(null,a),d},d}return a.__queryAsMap__()},a.__get__=a.get,a.get=function(c){if(i&&i.data&&i.time===e.cacheTime){var d=h(i.data,c.id);if(d){d.isInbox=d.id===e.folders.INBOX,d.isSent=d.id===e.folders.SENT,d.isDrafts=d.id===e.folders.DRAFTS,d.isTrash=d.id===e.folders.TRASH,d.isSpam=d.id===e.folders.SPAM;var f=b.when(d);return f.success=function(a){return f.then(a),f},f.error=function(a){return f.then(null,a),f},f}return a.__get__(c)}return a.__get__(c)},a.isFrozen=d.isFrozen,a.__operation__=a.operation,a.operation=function(h,i){var j=b.defer();if(j.promise.success=function(a){return j.promise.then(a),j.promise},j.promise.error=function(a){return j.promise.then(null,a),j.promise},["create","update","delete","touch"].indexOf(h.oper)===-1){var k=c.folderId;e.env.device.isMobile&&"purge"==h.oper&&(k=h.folderId),a.get({id:k}).success(function(b){b.total>d.MESSAGE_OPERATION_LIMIT?g.confirmFolderFreeze(function(){d.freeze(k),f.$broadcast("application:freeze",k),a.__operation__.call(a,h,i).success(function(){j.resolve.apply(j,arguments),d.unfreeze(k),f.$broadcast("application:unfreeze:success",k)}).error(function(){j.reject.apply(j),d.unfreeze(k),f.$broadcast("application:unfreeze:error",k)})},function(){j.reject.apply(j)}):a.__operation__.call(a,h,i).success(function(){j.resolve.apply(j,arguments)}).error(function(){j.reject.apply(j,arguments)})})}else a.__operation__.call(a,h,i).success(function(){j.resolve.apply(j,arguments)}).error(function(){j.reject.apply(j,arguments)});return j.promise},a}])}]),angular.module("nxt-folder").config(["$provide",function(a){"use strict";a.decorator("Messages",["$delegate","$q","ApplicationData","$rootScope","DialogManager",function(a,b,c,d,e){return a.__operation__=a.operation,a.operation=function(f){var g=f.messages[0],h=b.defer();return h.promise.success=function(a){return h.promise.then(a),h.promise},h.promise.error=function(a){return h.promise.then(null,a),h.promise},f.messages.length>c.MESSAGE_OPERATION_LIMIT?e.confirmFolderFreeze(function(){c.freeze(g.folderId),d.$broadcast("application:freeze",g.folderId),a.__operation__.call(a,f).success(function(){h.resolve.apply(h,arguments),c.unfreeze(g.folderId),d.$broadcast("application:unfreeze:success",g.folderId)}).error(function(){h.reject.apply(h),c.unfreeze(g.folderId),d.$broadcast("application:unfreeze:error",g.folderId)})},function(){h.reject.apply(h)}):a.__operation__.call(a,f).success(function(){h.resolve.apply(h,arguments)}).error(function(){h.reject.apply(h,arguments)}),h.promise},a}])}]),angular.module("nxt-framework").config(["$provide",function(a){"use strict";a.decorator("$http",["$delegate",function(a){function b(a){return angular.extend(a||{},{headers:{"X-CACHE-IS-VALID":!0}})}return a.__delete__=a["delete"],a["delete"]=function(b,c,d){return d=angular.extend(d||{},{method:"delete",url:b,data:c}),a(d)},a.postPreserveCache=function(c,d,e){return e=b(e),a.post(c,d,e)},a.putPreserveCache=function(c,d,e){return e=b(e),a.put(c,d,e)},a.deletePreserveCache=function(c,d,e){return e=b(e),a["delete"](c,d,e)},a}])}]),angular.module("nxt-framework").config(["$provide",function(a){"use strict";var b=function(a){return a.success=function(b){return a.then(b)},a.error=function(b){return a.then(null,b)},a};a.decorator("$q",["$delegate",function(a){var c=function(){return b(a.apply(a,arguments))};return c.all=function(){return b(a.all.apply(a,arguments))},c.defer=function(){var c=a.defer.apply(arguments);return c.promise=b(c.promise),c},c.reject=function(){return b(a.reject.apply(a,arguments))},c.when=function(){return b(a.when.apply(a,arguments))},c}])}]),angular.module("nxt-framework").config(["$provide",function(a){"use strict";a.decorator("$templateCache",["$delegate",function(a){var b=function(a){return a=a||"",a.replace(/.*\/js/,"")};return a._put=a.put,a._get=a.get,a.put=function(c,d){return a._put(b(c),d)},a.get=function(c){return a._get(b(c))},a}])}]),angular.module("nxt-settings").config(["$provide",function(a){"use strict";a.decorator("Theme",["$delegate","$q","ApplicationData","ApplicationConfig",function(a,b,c,d){var e=c.get("Theme");return a.__query__=a.query,a.query=function(){if(e&&e.data&&e.time===d.cacheTime){var f=b.when(e.data);return f.success=function(a){return f.then(a),f},f.error=function(a){return f.then(null,a),f},f}return a.__query__().success(function(a){c.put("Theme",{time:d.cacheTime,data:a})})},a}])}]),angular.module("nxt-webmail").config(["$stateProvider","ApplicationConfigProvider",function(a,b){"use strict";var c=b.$get(),d={};c.env.device.isMobile||(d=angular.extend(d,{"navigation@":{controller:"NavigationMainCtrl",templateUrl:"/navigation/views/main.html"},"contact@":{controller:"ContactMainCtrl",templateUrl:"/contact/views/main.html"}})),a.state("abstract",{"abstract":!0,views:d})}]),angular.module("nxt-webmail").config(["uiSelectConfig",function(a){a.theme="selectize",a.searchEnabled=!1}]),angular.module("nxt-composition").config(["$stateProvider",function(a){"use strict";a.state("composition",{url:"/composition",onEnter:["$state","$location",function(a,b){try{a.transitionTo("folder",{folderId:1,withComposition:!0,recipients:b.hash()},{reload:!0,inherit:!0,notify:!0})}catch(c){}}]})}]),angular.module("nxt-contact").config(["$stateProvider",function(a){"use strict";["folder","message","thread","messageEml"].forEach(function(b){a.state(b+".contact",{views:{"contact@":{controller:"ContactMainCtrl",templateUrl:"/contact/views/main.html"}}}).state(b+".contact.settings",{onEnter:["$state",function(a){a.go(b+".settings")}]})})}]),angular.module("nxt-external-account").config(["$stateProvider",function(a){"use strict";["folder","message","thread","messageEml"].forEach(function(b){a.state(b+".external-account",{"abstract":!0,views:{"external-account@":{controller:"ExternalAccountMainCtrl",templateUrl:"/external-account/views/main.html"}}}).state(b+".external-account.configure.folder-edit",{onEnter:["$state",function(a){a.go(b+".navigation.folder-edit")}]}).state(b+".external-account.configure.folder-list",{onEnter:["$state",function(a){a.go(b+".navigation.folder-list")}]}).state(b+".external-account.configure.settings",{onEnter:["$state",function(a){a.go(b+".settings")}]}).state(b+".external-account.configure.slideshow",{onEnter:["$state",function(a){a.go(b+".slideshow")}]}).state(b+".external-account.configure",{params:{accountId:null,aliasEmail:null,currentSentEmail:null,accountMessage:null},views:{"external-account-configure":{controller:"ExternalAccountConfigureCtrl",templateUrl:"/external-account/views/configure.html"}}}).state(b+".external-account.statement.folder-edit",{onEnter:["$state",function(a){a.go(b+".navigation.folder-edit")}]}).state(b+".external-account.statement.folder-list",{onEnter:["$state",function(a){a.go(b+".navigation.folder-list")}]}).state(b+".external-account.statement.settings",{onEnter:["$state",function(a){a.go(b+".settings")}]}).state(b+".external-account.statement.slideshow",{onEnter:["$state",function(a){a.go(b+".slideshow")}]}).state(b+".external-account.statement",{params:{isAlias:null,aliasEmail:null,email:null,accountId:null},views:{"external-account-statement":{controller:"ExternalAccountStatementCtrl",templateUrl:"/external-account/views/statement.html"}}}).state(b+".external-account.list.folder-edit",{onEnter:["$state",function(a){a.go(b+".navigation.folder-edit")}]}).state(b+".external-account.list.folder-list",{onEnter:["$state",function(a){a.go(b+".navigation.folder-list")}]}).state(b+".external-account.list.settings",{onEnter:["$state",function(a){a.go(b+".settings")}]}).state(b+".external-account.list.slideshow",{onEnter:["$state",function(a){a.go(b+".slideshow")}]}).state(b+".external-account.list",{views:{"external-account-list":{controller:"ExternalAccountListCtrl",templateUrl:"/external-account/views/list.html"}}})})}]),angular.module("nxt-folder").config(["$stateProvider","$urlRouterProvider",function(a,b){"use strict";a.state("folder",{parent:"abstract",url:"/folder/:folderId?sort&search&filter&extaccId&searchf&mode&iwa_source&iwa_testab&iwa_url&board&boardType",params:{withComposition:null,recipients:null,openFromNotification:null},onEnter:["$state","$stateParams",function(a,b){b.folderId&&!isNaN(Number(b.folderId))||(b.folderId=1,a.go("folder",{folderId:1}))}],views:{"message-list@":{controller:"FolderMainCtrl",templateUrl:function(){return NXT_CONFIG.env.device.isMobile?"/folder/views/main_mobile.html":"/folder/views/main.html"}}}}),b.otherwise(function(a,b){var c=b.path();return c="?"+c.substring(1),"/folder/1"+c})}]),angular.module("nxt-framework").config(["$httpProvider",function(a){"use strict";var b=function(a,b){var d=a.map(function(a,d){d=b+"["+d+"]";var e={};return e[d]=a,c(e)});return d.join("&")},c=function(a,d){var e=[],f=null;for(var g in a)a.hasOwnProperty(g)&&g.indexOf("$$")===-1&&(f=a[g],Array.isArray(f)?f=b(f,g):f instanceof Object?f=c(f,g):(d&&(g=d+"["+g+"]"),f=encodeURIComponent(g)+"="+encodeURIComponent(f)),e.push(f));return e.join("&")};a.defaults.transformRequest.unshift(function(a){if(a)return c(a)})}]),angular.module("nxt-framework").config(["$sceDelegateProvider",function(a){a.resourceUrlWhitelist(["self","**"])}]),angular.module("nxt-message").config(["$stateProvider",function(a){"use strict";a.state("message",{parent:"folder",url:"/message/:messageId",params:{leaveAsUnread:null,messageId:null,isRemarketing:null},views:{"message@":{controller:"MessageMainCtrl",templateUrl:"/message/views/main.html"}}}).state("messageEml",{parent:"folder",url:"/message/:messageId/:mpid/",params:{leaveAsUnread:null,messageId:null,mpid:null},views:{"message@":{controller:"MessageMainCtrl",templateUrl:"/message/views/main.html"}}}).state("thread",{parent:"folder",url:"/thread/:threadId",params:{leaveAsUnread:null,threadId:null},views:{"message@":{controller:"MessageMainCtrl",templateUrl:"/message/views/main.html"}}})}]),angular.module("nxt-navigation").config(["$stateProvider",function(a){"use strict";["folder","message","thread","messageEml"].forEach(function(b){a.state(b+".navigation",{views:{"navigation@":{controller:"NavigationMainCtrl",templateUrl:"/navigation/views/main.html"}}}).state(b+".navigation.navigation",{onEnter:["$state",function(a){a.go(b+".navigation")}]}).state(b+".folder-list",{onEnter:["$state",function(a){a.go(b+".navigation.folder-list")}]}).state(b+".navigation.folder-list.folder-list",{onEnter:["$state",function(a){a.go(b+".navigation.folder-list")}]}).state(b+".settings.folder-list",{onEnter:["$state",function(a){a.go(b+".navigation.folder-list")}]}).state(b+".navigation.folder-list.settings",{onEnter:["$state",function(a){a.go(b+".settings")}]}).state(b+".navigation.folder-list.slideshow",{onEnter:["$state",function(a){a.go(b+".slideshow")}]}).state(b+".navigation.folder-list",{views:{"folder-list":{controller:"NavigationMainCtrl",templateUrl:"/navigation/views/folder-list.html"}}}).state(b+".folder-edit",{onEnter:["$state",function(a){a.go(b+".navigation.folder-edit")}]}).state(b+".navigation.folder-edit.folder-edit",{onEnter:["$state",function(a){a.go(b+".navigation.folder-edit");
}]}).state(b+".navigation.folder-edit.folder-list",{onEnter:["$state",function(a){a.go(b+".navigation.folder-list")}]}).state(b+".navigation.folder-edit.settings",{onEnter:["$state",function(a){a.go(b+".settings")}]}).state(b+".navigation.folder-edit.slideshow",{onEnter:["$state",function(a){a.go(b+".slideshow")}]}).state(b+".navigation.folder-edit",{params:{folderEditId:null},views:{"folder-edit":{controller:"NavigationFolderEditCtrl",templateUrl:"/navigation/views/folder-edit.html"}}})})}]),angular.module("nxt-settings").config(["$stateProvider",function(a){"use strict";["folder","message","thread","messageEml"].forEach(function(b){a.state(b+".settings",{views:{"settings@":{controller:"SettingsMainCtrl",templateUrl:function(){return NXT_CONFIG.env.device.isMobile?"/settings/views/main_mobile.html":"/settings/views/main.html"}}}}).state(b+".settings.slideshow",{onEnter:["$state",function(a){a.go(b+".slideshow")}]}).state(b+".settings.settings",{onEnter:["$state",function(a){a.go(b+".settings")}]}).state(b+".settings.folder-edit",{onEnter:["$state",function(a){a.go(b+".navigation.folder-edit")}]})})}]),angular.module("nxt-slideshow").config(["$stateProvider",function(a){"use strict";["folder","message","thread","messageEml"].forEach(function(b){a.state(b+".slideshow",{url:"/slideshow",params:{attachments:null,attachmentName:null,isForVideos:null},views:{"slideshow@":{controller:"SlideshowMainCtrl",templateUrl:"/slideshow/views/main.html"}}})})}]),angular.module("nxt-contact").controller("ContactMainCtrl",["$location","$rootScope","$scope","$state","$timeout","ApplicationConfig","Contact","ContactGroup","DialogManager","Compositions","Notification","Counter","ApplicationData",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";function n(a,b){return angular.isArray(a[E.GROUPS])&&a[E.GROUPS].indexOf(b)!==-1}function o(a,b){return angular.isArray(a[E.WORDS])&&a[E.WORDS].some(function(a){return 0===a.indexOf(b.toLowerCase())})}function p(a){return a[E.TYPE]===g.CONTACT_TYPE_FAKE}function q(a,b){return a[E.NAME].indexOf(b.toLowerCase())!=-1&&!p(a)||a[E.NAME].indexOf(b.toLowerCase())==-1}function r(a,b){return a&&b?function(c){return n(c,a)&&o(c,b)}:a?function(b){return n(b,a)}:b?function(a){return o(a,b)&&q(a,b)}:!c.isCorp||a||c.isContactEdited?function(a){return!p(a)}:function(a){return g.isNotEmployeeFilter(a)}}function s(a){a.sort(c.sortOrder===c.SORT_POPULARITY?g.popularitySorter:g.alphabeticSorter)}function t(a){var b=[],d=r(c.selectedGroup&&c.selectedGroup.id,c.data.search);if(a&&a.length)for(var e=0;e<a.length;e++)d(a[e])&&b.push(a[e]);return b}function u(){m.put("Contact",{time:f.cacheTime,data:x})}function v(a){return c.contacts.filter(function(b){return b.groups.indexOf(a.id)!==-1})}function w(a,b){x=a,b&&s(x),y=t(a),c.contacts=g.contactArraysToObjects(y.slice(0,F)),c.contactIsLoading=!1}var x,y,z,A,B=15,C=50,D=500,E=f.ContactKeys,F=C;c.isCorp=f.env.isCorp,c.data={},c.employeeGroup={id:g.EMPLOYEE_GROUP_ID,name:"Pracownicy"},c.env=f.env,c.isMobile=f.env.device.isMobile,c.isExpanded=c.isMobile,c.ContactKeys=f.ContactKeys,c.contactIsLoading=!1,c.isSearchVisible=!0,c.isGroupsVisible=!1,c.isMobile||c.$watch("isExpanded",function(a){a===!1&&(c.isSearchVisible=!0,c.isGroupsVisible=!1,c.isContactEdited=!1,c.selectedGroup=null,c.isGroupAdd=!1,c.isGroupEdited=!1,c.panel=null,c.$broadcast("controller:contact:edit-cancel"),y=t(x),F=C,c.contacts=g.contactArraysToObjects(y.slice(0,F)))}),c.toggleExpand=function(){c.isExpanded&&c.isContactEdited?c.$broadcast("controller:contact:has-contact-change"):(c.isExpanded=!c.isExpanded,c.isGroupsVisible=!1,c.isContactEdited=!1,c.isSearchVisible=!0)},c.$on("directive:contact:has-contact-change",function(a,b){b?i.confirm({title:"Zakończ dodawanie kontaktu",message:"Nie dokończono dodawania kontaktu (wszystkie dane zostaną utracone) czy chcesz kontynuować?",confirm:"Zakończ",callback:function(){c.isExpanded=!c.isExpanded}}):c.isExpanded=!c.isExpanded}),c.escape=function(){c.isMobile?c.close():c.isExpanded=!1},f.env.device.isPc&&(c.$on("ui-events:keydown:Escape",c.escape),c.$on("ui-events:click",function(a,b){b.panel&&"contact"!==b.panel&&c.escape()})),c.$on("directive:contact:edit-save",function(a,b){if(c.contactEdited=null,c.isContactEdited=!1,c.isSearchVisible=!0,b.words=g.getContactDictionary(b.name,b.email),b.isNew)x.push(g.contactObjectToArray(b));else for(var d=0;d<x.length;d++)if(x[d][E.ID]===b.id){x[d]=g.contactObjectToArray(b);break}y=t(x),F=C,c.contacts=g.contactArraysToObjects(y.slice(0,F))}),c.$on("service:contact:delete",function(a,b){x=x.filter(function(a){return a[E.ID]!=b.id}),y=t(x),c.contacts=g.contactArraysToObjects(y.slice(0,F)),u()}),c.$on("service:composition:autoinsert-contact",function(a,b){b.forEach(function(a){if("pomoc@firma.interia.pl"!==a.email){a.name=a.email.substr(0,a.email.indexOf("@")),a.score=9.89009141411e-7,a.type=g.CONTACT_TYPE_AUTOINSERT;var b=g.create(a);c.contacts.push(b),x.push(g.contactObjectToArray(b))}})}),c.$on("controller:contact:goto",function(b,d){c.isExpanded=!0,e(function(){a.hash(d.id)},300)}),c.$on("directive:contact:edit",function(a,b){c.contactEdited=b,c.isContactEdited=!0}),c.$on("directive:contact:new-form",function(a,b){c.contactEdited=g.create(b),c.isExpanded=!0,c.isContactEdited=!0}),c.$on("directive:contact:close",function(){c.isContactEdited=!1,c.isSearchVisible=!0}),c.isMobile||g.query().then(function(a){w(a)}),g.isCachedQueryAlreadyResolved()?w(m.get("Contact").data):g.cachedQuery().then(function(a){w(a)}),h.query().success(function(a){c.groups=a}),c.createContact=function(){c.contactEdited&&!c.contactEdited.id||(c.contactEdited=g.create()),c.isContactEdited=!0,c.isGroupsVisible=!1,c.isSearchVisible=!1,c.panel=null},c.close=function(){d.go("^.navigation")},c.activate=function(a){c.panel=a},c.deactivate=function(){c.panel=null},c.showSettings=function(){c.isExpanded=!1,d.go(".settings")},c.addGroup=function(){c.selectedGroup=h.create(),c.isGroupAdd=!0,c.isGroupEdited=!0,y=t(x),F=C,c.contacts=g.contactArraysToObjects(y.slice(0,F)),z=x.filter(function(a){return!(p(a)||angular.isArray(a[E.GROUPS])&&a[E.GROUPS].indexOf(c.selectedGroup.id)!==-1)}),c.otherContacts=g.contactArraysToObjects(z.slice(0,F))},c.selectGroup=function(a){c.selectedGroup=a,c.isGroupEdited=!1,y=t(x),F=C,c.contacts=g.contactArraysToObjects(y.slice(0,F))},c.clearSelectedGroup=function(){c.selectedGroup=null,c.isGroupEdited=!1,y=t(x),F=C,c.contacts=g.contactArraysToObjects(y.slice(0,F))},c.newMessageForGroup=function(a){j.addComposition({toActive:v(a),allowOwnEmails:!0})},c.editGroup=function(a){c.selectGroup(a),c.isGroupEdited=!0,c.contacts=g.contactArraysToObjects(t(x)),z=x.filter(function(b){return!angular.isArray(b[E.GROUPS])||b[E.GROUPS].indexOf(a.id)===-1}),F=C,c.otherContacts=g.contactArraysToObjects(z.slice(0,F))},c.cancelEditGroup=function(){c.$broadcast("controller:contact:group-edit:cancel"),c.isGroupAdd&&(c.selectedGroup=null,F=C,c.contacts=g.contactArraysToObjects(y.slice(0,F))),c.isGroupAdd=!1,c.isGroupEdited=!1},c.saveGroup=function(){if(c.isCorp&&c.isGroupAdd&&c.selectedGroup.name===c.employeeGroup.name)return void k.error("Ups, coś poszło nie tak. Spróbuj za chwilę.");var a=v(c.selectedGroup);h.save(c.selectedGroup,a).success(function(b){b.isNew&&(a.forEach(function(a){var d=a.groups.indexOf(c.selectedGroup.id);a.groups.splice(d,1),a.groups.push(b.id)}),c.selectedGroup=b,F=C,c.contacts=g.contactArraysToObjects(y.slice(0,F)),c.selectGroup(b)),h.query().success(function(a){c.groups=a}),c.isGroupEdited=!1,c.isGroupAdd=!1})},c.deleteGroup=function(a){h["delete"]({id:a.id}).success(function(){a._destroy=!0,c.selectedGroup&&c.selectedGroup.id==a.id&&c.clearSelectedGroup(),y=t(x),F=C,c.contacts=g.contactArraysToObjects(y.slice(0,F))})},c.SORT_ALPHABETICALLY="alphabetically",c.SORT_POPULARITY="popularity",c.sortOrder=c.SORT_POPULARITY,c.isSortReverse=!0,c.sortAlphabetically=function(){c.sortOrder!==c.SORT_ALPHABETICALLY&&(c.sortOrder=c.SORT_ALPHABETICALLY,s(x),y=t(x),c.contacts=g.contactArraysToObjects(y.slice(0,F)))},c.sortByPopularity=function(){c.sortOrder!==c.SORT_POPULARITY&&(c.sortOrder=c.SORT_POPULARITY,s(x),y=t(x),c.contacts=g.contactArraysToObjects(y.slice(0,F)))},c.importFilename="",c.isMobile||c.$on("service:contacts:import:addfile",function(a,b){c.importFilename=b.name}),c.$on("contact-list:scroll:bottom",function(a,b){e(function(){c.isGroupEdited?c.otherContacts.push.apply(c.otherContacts,g.contactArraysToObjects(z.slice(F,F+B))):c.contacts.push.apply(c.contacts,g.contactArraysToObjects(y.slice(F,F+B))),F+=B,c.$digest()})}),c.$on("contact:add-to-selected-group",function(a,b){var d=0;for(d=0;d<x.length;d++)if(x[d][E.ID]===b.id){x[d]=g.contactObjectToArray(b),c.contacts=g.contactArraysToObjects(t(x));break}for(d=0;d<z.length;d++)if(z[d][E.ID]===b.id)return z.splice(d,1),void(c.otherContacts=g.contactArraysToObjects(z.slice(0,F)))}),c.$on("contact:remove-from-selected-group",function(a,b){var d=0;for(d=0;d<x.length;d++)if(x[d][E.ID]===b.id){x.splice(d,1),c.contacts=g.contactArraysToObjects(t(x));break}for(d=0;d<z.length;d++)if(z[d][E.ID]===b.id)return z[d]=g.contactObjectToArray(b),void(c.otherContacts=g.contactArraysToObjects(z.slice(0,F)))}),c.importContacts=function(){g.importContacts().success(function(){g.query().then(function(a){x=a,g.convertSpecialContactsToArrays(x),x=g.initDictionary(x),y=t(x),s(y),c.contacts=g.contactArraysToObjects(y.slice(0,F))}),c.deactivate()})},c.uploader=g.getUplouder(),c.searchChange=function(){x&&x.length&&(e.cancel(A),A=e(function(){F=C,y=t(x),b.$apply(function(){c.contacts=g.contactArraysToObjects(y.slice(0,F))})},D,!1))},c.$on("controller:wizard:ownNameUpdate",function(){c.env.ownName=f.env.ownName}),c.isMobile&&(c.$on("controller:counters:update",function(){c.unseenMessageCount=l.getSumAllCounters()}),l.updateWithoutFolders()),c.$on("controller:wizard:avatarChange",function(){c.isUpdatingAvatar=!0,e(function(){c.isUpdatingAvatar=!1},0,!1)})}]),angular.module("nxt-dialog").controller("MultiBoardsCtrl",["$scope","Profile",function(a,b){"use strict";function c(b){!b&&a.cancelCallback&&(a.cancelCallback(),a.cancelCallback=null)}var d=a.$parent.params.boards,e=2!=b.getAvatarFromCookie().type,f=[],g=0;a.activePage=0,a.paginationLength=[];for(var h in d)h=d[h],"changeAvatarBoard"==h.boardName&&e||(h.boardId=g,f.push(h),h.pagination.skipInPagination||a.paginationLength.push({id:g}),g++);a.changeStep=function(b,d){return a.board=f[b],b>=f.length?void a.$parent.close():(d&&(document.getElementById("step-"+a.activePage).className+=" complete"),c(d),a.activePage=b,void a.pushStat(a.board.stat.type,a.board.stat.display))},a.nextStep=function(b){a.changeStep(a.activePage+1,b),c(b)},a.prevStep=function(b){a.changeStep(a.activePage-1,b)},a.close=function(){a.$parent.close()},a.pushStat=a.$parent.pushStat,a.changeStep(0)}]),angular.module("nxt-external-account").controller("ExternalAccountConfigureCtrl",["$scope","$rootScope","Compositions","$state","$stateParams","ExternalAccount","ApplicationConfig","Track","$timeout",function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){function b(a){return a.toUpperCase()!=a.toLowerCase()}var c=a.split("@")[0].toLowerCase();return c.length>2&&b(c.charAt(0))}a.emailPattern=g.patterns.email,a.isShowMore=!1,a.isPending=!1,a.isSaving=!1,a.accountMessage=e.accountMessage,a.formData={port:110,deleteMessage:0},a.suggestions=[],a.ports=[110,995],a.actions=[{id:0,name:"Pozostaw kopie na koncie"},{id:1,name:"Usuń po pobraniu"}],a.isMobile=g.env.device.isMobile,0===g.prefs.defaultAccount&&(g.prefs.defaultAccount=g.env.ownEmail),a.$watch("formData.port",function(b){a.formData.secure=995==b?"1":"0"}),e.accountId?(a.isPending=!0,a.isShowMore=!0,a.isEdit=!0,f.get({id:e.accountId}).success(function(b){a.isPending=!1,angular.extend(a.formData,b),a.formData.isAvailable=!0,a.formData.isExternalDomain=!0})):e.aliasEmail&&(a.isEdit=!0,a.formData={email:e.aliasEmail,isAlias:!0,defaultSent:e.aliasEmail==g.prefs.defaultAccount?"1":"0"}),a.checkEmail=function(){a.formData.isOwner=void 0,a.formData.suggestion=void 0,a.formData.isAvailable=void 0,a.formData.isExternalDomain=f.isExternalDomain(a.formData.email),a.formData.domain=f.getMainDomain(a.formData.email),a.isInvalidInteriaMail=!1,a.isMainInteriaMail=!1,a.formData.email.toLowerCase()===g.env.ownEmail.toLowerCase()?a.isMainInteriaMail=!0:a.formData.isExternalDomain?(a.formData.isAvailable=!0,a.getSettings()):(a.isSupported=!0,j(a.formData.email)?(a.isPending=!0,f.checkAliasAvailability(a.formData.email).success(function(b){a.isPending=!1,a.suggestions=b,a.formData.isAvailable=null===b})):a.isInvalidInteriaMail=!0)},a.$watch("formData.suggestion",function(b){b&&(a.formData.email=b)});var k;a.getSettings=function(){i.cancel(k),k=i(function(){f.settings(a.formData.email).success(function(b){a.isSupported=b.supported,a.isShowMore=!a.isSupported,angular.extend(a.formData,b)})},300)},a.submit=function(){var b=a.formData.isExternalDomain||a.formData.isOwner,c=b?"saveAccount":"saveAlias",d=a.formData.email===g.env.ownEmail,h=angular.copy(a.formData);if(g.env.device.isMobile||(a.successMessage=a.isEdit?"external-account:service:save":"external-account:service:add"),a.isWizard&&a.isShowMore&&0===a.externalAccountStep)return void(a.externalAccountStep=1);if(d)if("1"==a.formData.defaultSent){var i=e.currentSentEmail.type&&"alias"===e.currentSentEmail.type;b=!i,b?f.get({id:e.currentSentEmail.id}).success(function(a){h=a,h.defaultSent="0",h.isAvailable=!0,h.isExternalDomain=!0,c="saveAccount",m(h,c,b)}):(h={email:e.currentSentEmail.email,isAlias:!0,defaultSent:"0"},c="saveAlias",m(h,c,b))}else a.close();else m(h,c,b)};var l=function(a){if(sessionStorage){var b;try{var c=sessionStorage.getItem("extAccReq");null===c?(b=[a],sessionStorage.setItem("extAccReq",JSON.stringify({accs:b}))):(b=JSON.parse(c).accs,b.push(a),sessionStorage.setItem("extAccReq",JSON.stringify({accs:b})))}catch(d){}}},m=function(b,e,g){a.isSaving=!0,f[e](b,a.successMessage).success(function(e){if(a.isSaving=!1,g&&l(b.email),c.updateExternalAccounts({addedAccountEmail:b.email,isGlobal:1===parseInt(b.defaultSent),forceUpdate:!0}),a.isEdit)h.pushCode("extAccAddWithChanges",[b.domain]),d.go("^.list");else{if(a.isWizard)return void a.wizardSuccess();h.pushCode("extAccAdd",[b.domain]),d.go("^.statement",{isAlias:!g,accountId:e.id,accountMessage:e.accountMessage,email:b.email})}}).error(function(){a.isSaving=!1})}}]),angular.module("nxt-external-account").controller("ExternalAccountListCtrl",["$scope","$rootScope","$state","$stateParams","ExternalAccount","ApplicationConfig","Folder","DialogManager","Compositions","Notification","ApplicationData","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(){for(var b=0;b<a.externaAccounts.length;b++)if(a.externaAccounts[b].id===parseInt(a.activeExternalAccountId))return a.externaAccounts[b]}function n(){k.put("ExternalAccount",{time:f.cacheTime,data:a.externaAccounts}),l(function(){i.updateExternalAccounts()},0,!1)}a.mainAccountEmail=f.env.ownEmail,a.isAdmin=f.env.is_admin,a.isCorp=f.env.isCorp,a.folder=g.getCachedFolderById(d.folderId),a.activeExternalAccountId=d.extaccId,a.navExternalSelect=!1;var o=k.get("ExternalAccount").data;a.hasExternalAccounts=o&&o.length>1,f.env.device.isMobile?(a.externaAccounts=k.get("ExternalAccount").data,a.externaAccounts=a.externaAccounts.map(function(a){return angular.extend(a,{service:e.getService(a.email)})}),n()):e.query(d.folderId).success(function(b){a.externaAccounts=b,n()}),a.addExternalAccount=function(){f.env.device.isMobile?c.go("^.external-account.configure"):c.go("^.configure")},a.editExternalAccount=function(b,d){!a.navExternalSelect&&f.env.device.isMobile||(f.env.device.isMobile?c.go("^.external-account.configure",{accountId:b,accountMessage:d}):c.go("^.configure",{accountId:b,accountMessage:d}))},a.editAlias=function(b){var d=a.externaAccounts.filter(function(a){return a.defaultSent||a.vsmtpId&&a.vsmtpId==f.prefs.defaultAccount});f.env.device.isMobile?c.go("^.external-account.configure",{aliasEmail:b,currentSentEmail:d[0]}):c.go("^.configure",{aliasEmail:b,currentSentEmail:d[0]})},a.toggleNavExternalSelect=function(){a.navExternalSelect=!a.navExternalSelect},f.env.device.isMobile&&(a.activeExternalAccount=m()),a.deleteExternalAccount=function(c){var d=function(d){e.deleteAccount(c.id,d).success(function(){a.externaAccounts=a.externaAccounts.filter(function(a){return c.id!=a.id}),n(),b.$broadcast("controller:list:del-ext-acc",{accountId:c.id,accountMessage:accountMessage})})};h.confirm({title:"Usuń adres e-mail",message:"Czy chcesz usunąć adres "+c.email+"?<br><b>Uwaga!</b><br>Wszystkie wiadomości z tego konta zostaną usunięte.<br>Nie będzie można wysyłać i odbierać wiadomości z adresu "+c.email+".",confirm:"Usuń",template:"/dialog/views/dialog_confirm_del_ext_acc.html",additionalClasses:"dialog--confirm-del-ext-acc",additionalData:{isRemove:1,success:function(a){a&&c.totalMsg>1e3?h.confirmFolderFreeze(d(!0),function(){}):d(a)}}})},a.showErrorExternalAccountNotification=function(a){j.setOnClickCallback("external-account:service:edit",function(){c.go(".external-account.configure",{accountId:a.id,accountMessage:a.message})}),j.setReplaceParams([a.message]),j.error("external-account:service:edit")},a.deleteAlias=function(b){h.confirm({title:"Usuń adres e-mail",message:"Czy chcesz usunąć adres "+b.email+" ? Nie będzie można wysyłać i odbierać wiadomości z tego adresu.",confirm:"Usuń",callback:function(){e.deleteAlias(b.email).success(function(){a.externaAccounts=a.externaAccounts.filter(function(a){return b.email!=a.email}),n()})}})}}]),angular.module("nxt-external-account").controller("ExternalAccountMainCtrl",["$scope","$state","ExternalAccount","Track","ApplicationConfig",function(a,b,c,d,e){"use strict";a.addExternalAccount=function(){b.go("^.configure")},a.close=function(){d.pushCode("extAccClosePanel"),b.go("^.^")},a.$on("ui-events:keydown:Escape",function(){a.close()}),a.$on("ui-events:click",function(b,c){c.panel&&"external-account"!==c.panel&&a.close()}),a.$on("external-account:close",function(){a.close()}),e.aliasDomains.length||c.getInteriaDomains().success(function(a){e.aliasDomains=a.data})}]),angular.module("nxt-external-account").controller("ExternalAccountStatementCtrl",["$scope","$state","$stateParams","ApplicationConfig",function(a,b,c,d){"use strict";a.isAlias=c.isAlias,a.accountId=c.accountId,a.accountMessage=c.accountMessage,a.email=c.email,a.isGmail=/.*gmail.com$/.test(a.email),a.links=d.links,a.goToList=function(){b.go("^.list")}}]),angular.module("nxt-folder").controller("FolderMainCtrl",["$q","$scope","$rootScope","$state","$stateParams","Folder","Messages","Message","MessageCommander","Search","$filter","ApplicationConfig","Compositions","ExternalAccount","DialogManager","Track","Setting","$timeout","Counter","ApplicationData","InfoBoards","$cookies","Offer","MobileApp","$window","Notification","LongPoll",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A){"use strict";function B(){if(b.isMobile&&s.init(),g.clearBufferPage(),b.folderIsFrozen=f.isFrozen(e.folderId),b.folder=f.getCachedFolderById(e.folderId),b.folder.isShopping&&(NXT_INIT_DATA.hotOffersCounter=0),D(),b.$on("folders:refresh",D),J(),e.withComposition&&b.openComposition(e.recipients),l.incrementSessionVisits(),b.refresh(),b.lastCheckedMessage=null,b.lastCheckedMessageWithShift=null,b.checkedMessagesCount=0,b.activeFilter=b.filter?b.filter:"all",l.env.mailto&&(m.addComposition({to:{email:l.env.mailto,name:l.env.mailto},autoFocusContent:!0}),l.env.mailto=""),b.isMobile&&(b.swipeMsgId=!1,b.swipeAnimate=null,b.swipe=function(a,c){b.swipeMsgId&&b.swipeMsgId==a.uniqueId?(delete b.swipeMsgId,delete b.swipeAnimate):(delete b.swipeAnimate,b.swipeMsgId=a.uniqueId,r(function(){b.swipeAnimate=c,b.$digest()},50,!1))},r(function(){c.$broadcast("controller:folder:seen",e.folderId)},0,!1)),e.board?(u.clearInfoboardsQueque(),"isTrigger"==e.boardType?u.displayById(e.board,!0):u.getBoardConfById(e.board).success(function(a){210==e.board&&o.multiBoards(a.options)}),d.go(".",{board:null,boardType:null})):u.init(),l.env.offerError&&(o.confirm({title:"Ups. Brak oferty.",message:"Nie możemy znaleźć wybranej oferty.<br>Sprawdź aktualne vouchery w folderze Oferty.",confirm:"Oferty",additionalClasses:"offer-error",callback:function(){d.go("folder",{folderId:b.foldersMap.SHOPPING,sort:null,search:null,searchf:null,filter:null,mode:null,withComposition:null})}}),l.env.offerError=!1),l.env.voucher&&l.env.voucher.code&&(o.voucheInfo({additionalClasses:"voucher-info",additionalData:{code:l.env.voucher.code,title:l.env.voucher.title,date:l.env.voucher.date,foot:l.env.voucher.foot}}),l.env.voucher=!1),!b.isMobile&&b.folder.isShopping&&(b.isRevealHotOffers=v.getObject(W)!=l.env.ownEmail,b.revealHotOffers=function(){if(b.isRevealHotOffers){b.isRevealHotOffers=!1;var a=new Date;a.setDate(a.getDate()+30),v.putObject(W,l.env.ownEmail,{expires:a})}else b.isRevealHotOffers=!0,v.remove(W)}),l.hacks.AndroidVersion<4.1&&(b.isOldAndroid=!0),r(function(){if(NXT_CONFIG.env.isMobileApp)try{MobileAppConnector.renderReady()}catch(a){console.log("Only to use in mobileApp - renderReady")}},0,!1),l.hacks.isIOS&&localStorage)try{var a=new Date;localStorage.setItem("nxtLogin",JSON.stringify({result:l.env.ownEmail,timestamp:a.getTime()+31536e4}))}catch(h){}l.env.longPollUrl&&A.connect(),b.$on("http:response:error:sessionExpired",function(a,b){A.disconnect("Sesja wygasła")}),b.$on("frame-login:success-ready",function(){NXT_CONFIG.blockRequest=!1,A.connect()})}function C(a){Z.uniqueId=a}function D(){f.query().success(function(a){b.userFolders=a.filter(function(a){return!a.isSystem&&!a.isShopping&&!a.isSocial}),b.selectedUserFolders=[{id:null,name:"Brak folderu nadrzędnego"}].concat(b.userFolders)})}function E(){l.env.isMobileApp&&x.refreshFolder()}function F(){l.env.device.isMobile&&c.$broadcast("notification:remove:all")}function G(){l.env.isMobileApp&&(delete b.swipeMsgId,delete b.swipeAnimate)}function H(){Array.isArray(b.messages)&&(b.isAnyMessageChecked=b.messages.some(function(a){return a.checked}),b.isAnyMessageChecked||(b.lastCheckedMessage=null,b.lastCheckedMessageWithShift=null),l.env.isMobileApp&&(c.isAnyMessageChecked=b.isAnyMessageChecked)),b.folder.isShopping&&!b.isAnyMessageChecked&&Array.isArray(b.hotOffers)&&(b.isAnyMessageChecked=b.hotOffers.some(function(a){return a.checked}))}function I(){for(var a=0,c=0;c<b.messages.length;c++)b.messages[c].checked&&a++;return a}function J(){var a=t.get("ExternalAccount").data,c=l.env.service?l.env.service.name:"interia";b.hasExternalAccounts=a&&a.length>1,null!==e.extaccId&&a&&("-1"==e.extaccId?b.activeAccount={email:l.env.ownEmail,service:c}:b.activeAccount=a.filter(function(a){return a.id==e.extaccId}).pop())}function K(a){angular.forEach(b.messages,function(c,d){c.uniqueId==g.getUniqueId(a)&&(b.messages[d].isForceHidden=!0)})}function L(a){return b.isTolPushMessage.indexOf(a)!==-1}function M(){for(var a=0;a<b.messages.length;a++)0===a&&d.go("folder",{folderId:d.params.folderId}),a>0&&b.messages[a].id==d.params.messageId&&b.openMessage(b.messages[a-1])}function N(){for(var a=0;a<b.messages.length;a++)b.messages[a].id==d.params.messageId&&(a<b.messages.length-1?b.openMessage(b.messages[a+1]):b.isMoreMessages?b.loadMoreMessages(!1,function(){b.openMessage(b.messages[a+1])}):d.go("folder",{folderId:d.params.folderId}))}function O(){return Z.initPage&&(b.currentPage<Z.initPage||Z.uniqueId&&b.currentPage<Z.initPage+1)}function P(){var a=b.messages;return!b.isMobile&&b.folder.isShopping&&(a=b.messages.concat(b.hotOffers)),a.filter(function(a){return a.checked})}function Q(a){var b=!1;return a.forEach(function(a){a.fUnsubscribable&&(b=!0)}),b}function R(a){var b,c=[];return a=a||P(),a.forEach(function(a){a.threadId&&a.threadId!=-1?a.msgCount>0&&(b=a.fromEmail.split(";"),b.forEach(function(a){a=a.trim(),c.indexOf(a)==-1&&a!=l.env.ownEmail&&c.push(a)})):c.indexOf(a.fromEmail)==-1&&a.fromEmail!=l.env.ownEmail&&c.push(a.fromEmail)}),c}function S(a){o.confirm({title:"Zgłoszenie niechcianej wiadomości",message:"Ten nadawca umożliwia automatyczne wypisanie się z listy adresatów, dzięki temu nie będziesz otrzymywać od niego tego typu wiadomości. Czy chcesz skorzystać z tej opcji?",confirm:"wypisz mnie",template:"/dialog/views/dialog_unsubscribe.html",additionalData:a,callback:function(){i.listUnsubscribe(a)}})}var T,U,V,W="inpl_mail_offer_hide",X=a.defer(),Y=[],Z={initPage:void 0!==e.page?parseInt(e.page):0,uniqueId:!1};b.isFolderScrollToPage=!1,b.sort=e.sort,b.filter=e.filter,b.newFolder={},b.isMobile=l.env.device.isMobile,b.isThreadingOn=!b.isMobile&&l.env.threading,b.hasSocialFolder=l.env.hasSocialFolder,b.hasShoppingFolder=l.env.hasShoppingFolder,b.isSelectAllView=!1,b.isAnyMessageChecked=!1,b.isSearch=j.isSearch(),b.isSearchInContent=j.isSearchInContent(),b.isAddQuickFilter=!1,b.showQuickFilterCheckbox=!0,b.currentPage=1,b.isMoreMessages=!0,b.avatarsShowed=l.env.showAvatars,b.leftColumnMin=l.env.isLeftColumnMin,b.leftPreColumnMin=l.env.isLeftPreColumnMin,b.hotOffersCount=NXT_INIT_DATA.hotOffersCounter,b.isModeAttachments="attachments"===e.mode,b.movePending=!1,b.lastMovedMsgIndex=null,b.env=l.env,b.isTolPushMessage=[],b.hotOffers=[],b.moduleConfigAds=l.getConfigAppModule("ads");var $=l.getConfigAppModule("folder");b.offerPromoEnabled=$&&$.actions&&$.actions.offerPromoEnabled,d.params.threadId&&b.isThreadingOn?b.activeUniqueId="t"+d.params.threadId:d.params.messageId&&(b.activeUniqueId="m"+d.params.messageId),r(function(){if(NXT_CONFIG.env.isMobileApp)try{l.env.appSupportedOpenFiles=MobileAppConnector&&MobileAppConnector.getNativeAppIdent}catch(a){console.log("Only to use in mobileApp - getNativeAppIdent")}},0,!1),b.$on("service:messages:pagination",function(a,c){b.pagination=c;var d=!(c.total%g.PACK_SIZE_REQUEST)||c.total%g.PACK_SIZE_REQUEST>g.PACK_SIZE;b.isMoreMessages=c.total>(c.pack-(d?1:0))*c.size}),f.queryAsMap().success(function(a){b.foldersMap=a.all,b.isMobile&&s.update(a)});var _=function(a){var c={};c.goTo=a&&a.goTo?a.goTo:"folder";var f=function(){i.setNextActionState(i.STATE_FOLDER),i.deleteMessages(a).success(function(){var f=e.folderId;a.folderId&&(e.folderId=a.folderId,b.refresh(!1,!0,!0)),a.folderId&&(e.folderId=f),d.go(c.goTo),g.clearBuffer(),b.refresh(!1,!0,!0)}).error(function(){b.clearSelection()})};return a?f:f()};b.$on("service:folder:deleted",function(a,c){b.userFolders=b.userFolders.filter(function(a){return a.id!=c.id}),b.selectedUserFolders=[{id:null,name:"Brak folderu nadrzędnego"}].concat(b.userFolders)}),l.env.device.isMobile||(b.$on("directive:column-resize:left-column-min",function(a,c){r(function(){b.leftColumnMin=!0,b.$digest()},0,!1)}),b.$on("directive:column-resize:left-column-greater",function(a,c){r(function(){b.leftColumnMin=!1,b.$digest()},0,!1)}),b.$on("directive:column-resize:left-pre-column-min",function(a,c){r(function(){b.leftPreColumnMin=!0,b.$digest()},0,!1)}),b.$on("directive:column-resize:left-pre-column-greater",function(a,c){r(function(){b.leftPreColumnMin=!1,b.$digest()},0,!1)})),b.$on("service:message:move",function(a,c){l.env.device.isMobile&&K(c.messages[0]),b.refresh()}),l.env.isMobileApp&&b.$on("isapp:message:pop",function(a,c){for(var e=b.messages.map(function(a){return parseInt(a.id)}),f=0;f<c.length;f++)L(c[f].mailId)||e.indexOf(c[f].mailId)===-1&&(b.isTolPushMessage.push(c[f].mailId),h.get({id:c[f].mailId,leaveAsUnread:!0}).success(function(a){a.folderId==d.params.folderId&&(a=g.generateUniqueId(a),b.messages.unshift(a),b.messages=k("orderBy")(b.messages,"-id"))}).error(function(a){a.isMobileAppPush=!0}))}),b.$on("service:longpoll:success",function(a,c){if(!b.isSearch&&c.folderId==e.folderId&&c.inLastHour&&(!e.extaccId||e.extaccId==-1)){if(l.env.isMobileApp){var d=b.messages.map(function(a){return parseInt(a.id)});if(d.indexOf(c.id)!==-1)return 0;if(L(c.id))return 0;b.isTolPushMessage.push(c.id)}h.get({id:c.id,leaveAsUnread:!0}).success(function(a){a.unseen=!0,a.longpollMessage=!0,a.threadId&&parseInt(a.threadId)>0&&(Y.push(parseInt(a.threadId)),delete a.threadId),b.isMoreMessages&&b.messages.splice(b.messages.length-1,1),b.messages&&(b.messages=g.insertMessageByDate(a,b.messages))})}}),b.$on("folder:refresh",function(a,c){c&&c.refreshCache&&g.clearBuffer(),c.filter&&(b.filter=c.filter),c&&c.forceRefresh?(c.page&&(Z.initPage=c.page-1,b.currentPage=c.page),b.refresh(!1,!0,!0,function(){},!0)):b.refresh()}),T=c.$on("message:getCachedThread",function(a,d){X.promise.then(function(){var a,e={isThreadFound:!1,threadId:d};for(a=0;a<b.messages.length;a++)if(b.messages[a].threadId===parseInt(d)&&Y.indexOf(parseInt(d))===-1){if(b.messages[a].longpollMessage)break;b.messages[a].msgs&&b.messages[a].msgs.length?(e.messages=b.messages[a].msgs,e.allMessagesCount=b.messages[a].msgCount,e.isThreadFound=!0):(e.messages=[b.messages[a]],e.allMessagesCount=1,e.isThreadFound=!0);break}c.$broadcast("message:cachedThreadProvided",e)})}),X.promise.then(function(){c.$broadcast("folder:getCachedThreadEventAttached")}),b.advancedSearch=function(){var a=j.getPhrase()||j.getHistoryPhrase(),b=j.getFilters();j.searchInContent(a,b)},b.$on("service:message:favorite",function(a,c){!b.isMobile&&b.folder.isShopping&&b.hotOffers.some(function(a){if(a.id==c.message.id)return a.isStarred=!c.message.isStarred,!0}),b.messages.some(function(a){return a.id==c.message.id&&(a.isStarred=!c.message.isStarred,!0)})}),b.$on("service:search:refresh",function(){b.refresh()}),b.$on("loadingIndicator:folderLoading",function(){b.isFolderLoading=!0}),b.$on("loadingIndicator:folderLoaded",function(){b.isFolderLoading=!1}),b.$on("scrollToPage:ready",function(){b.isFolderScrollToPage=!1,b.isFolderLoading=!1,Z.uniqueId=!1}),b.$on("application:freeze",function(a,c){e.folderId==c&&(b.folderIsFrozen=!0)}),b.$on("application:unfreeze:success",function(a,c){b.folderIsFrozen&&e.folderId==c&&(b.isFolderUnfreeze=!0,b.folderIsFrozen=!1)}),b.$on("application:unfreeze:error",function(a,c){b.folderIsFrozen&&e.folderId==c&&(b.isFolderUnfreeze=!1,b.folderIsFrozen=!1)}),b.$on("controller:list:del-ext-acc",function(a,c){b.activeAccount&&b.activeAccount.id==c.accountId&&(b.activeAccount=null,e.extaccId=null)}),l.env.isMobileApp&&b.$on("isapp:message:open",function(a,e){d.go("message",{folderId:e.folderId,messageId:e.msgId}),c.$apply(function(){h.get({id:e.messageId,leaveAsUnread:!0}).success(function(a){b.markMessageAsRead(a)})})}),b.openMessage=function(a,f,g){var h=s.getCounters();(h.folders[e.folderId]||h.userFolders[e.folderId])&&c.$broadcast("controller:folder:seen",e.folderId),a.unseen=!1,b.activeUniqueId=a.uniqueId,a.folderId==l.folders.DRAFTS?f||b.editDraft(a):(a.threadId&&a.threadId!==-1&&!a.longpollMessage?d.go("thread",{threadId:a.threadId,leaveAsUnread:f,openFromNotification:null,isRemarketing:null}):d.go("message",{messageId:a.id,leaveAsUnread:f,openFromNotification:null,isRemarketing:null}),f&&!l.env.isMobileApp||b.simulateMarkMessageAsRead(a)),b.isMobile&&(b.swipeMsgId=!1,b.selectAllView(!1)),g=void 0===g||g,g&&p.pushGFK(),l.hacks.AndroidVersion<4.1&&(document.body.scrollTop=0)},b.openMessageAndLeaveAsUnread=function(a,c){b.openMessage(a,!0,c)},b.autoOpenMessage=function(a){var c=b.folder.isShopping&&b.hotOffers.length?b.hotOffers:b.messages;V&&V(),U&&U();var f;if("message"!=d.current.name&&"thread"!=d.current.name||d.params.isRemarketing)if((l.env.device.isPc&&(l.visitCounter>1||b.isFirstShowAd||b.moduleConfigAds.actions&&!b.moduleConfigAds.actions.mainAutoPromoBoxEnabled)||b.isMobile)&&!e.search&&!e.searchf&&e.folderId!=l.folders.DRAFTS&&c&&c.length>0&&(b.isMobile&&y.screen.width>768&&y.screen.width>y.screen.height||l.env.device.isPc)){if(a)b.lastMovedMsgIndex=b.lastMovedMsgIndex||0,f=c.length>b.lastMovedMsgIndex?c[b.lastMovedMsgIndex]:0!==b.lastMovedMsgIndex?c[c.length-1]:c[0],b.lastMovedMsgIndex=null;else{for(var g=0,h=0;h<c.length;h++)if(c[h].uniqueId===b.activeUniqueId){g=h;break}f=c[g]}b.openMessageAndLeaveAsUnread(f,!1),b.isShowAd=!1,b.isFirstShowAd=!1}else b.isShowAd=!0,b.isShowAdDescription=l.isShowAdDescription,
b.isFirstShowAd=!0;V=b.$on("$stateChangeSuccess",function(a,c,d,g){"message"==c.name||"thread"==c.name?b.isShowAd=!1:"message"!=g.name&&"thread"!=g.name||"folder"!=c.name||d.folderId!=e.folderId?void 0!==f&&b.markMessageAsRead(f):b.isMobile||b.refresh(!1,!1)}),U=b.$on("$destroy",V)},b.$on("adplace:onload:box600x450",function(){if(b.isShowAdDescription){var a=window.frames.box600x450&&window.frames.box600x450.contentDocument&&window.frames.box600x450.contentDocument.getElementById("autopromoAd");b.isShowAdDescription=!(!b.isShowAdDescription||a)}}),b.openComposition=function(a){F(),a&&a.length?m.addComposition({ids:a.split(";")}):m.addComposition()},b.refresh=function(a,d,f,h,i){c.$broadcast("controller:folder:refresh",!0),E(),a||(b.currentPage=1,b.isSelectAllView=!1),h=h||function(){};var k,l={id:e.folderId,sort:b.sort,filter:b.filter,search:e.search,page:b.currentPage,extaccId:e.extaccId,searchf:e.searchf,disableCache:f};j.isAdvanced()||j.isSearchInContent()&&l.search?(k=g.search(l,j.getFilters()),j.isSearchInContent()&&p.pushCode("searcherInContent")):k=g.query(l),l.search&&p.pushCode("actionSearch"),k.success(function(f){b.isMoreMessagesLoading=!1,!b.isMobile&&b.folder.isShopping&&(f=w.removeDuplicateHotOffer(f)),!b.isMobile&&b.folder.isShopping&&(b.hotOffers=w.getHotOffers()),a?(b.messages=b.messages.concat(f),b.isMessagesLoading=!1):(b.messages=f,X.resolve(),"undefined"==typeof d&&(d=!0),b.autoOpenMessage(d)),b.pagination&&b.pagination.total===b.messages.length&&(b.isMoreMessages=!1),c.$broadcast("controller:folder:main",{folderId:e.folderId,isSearch:b.isSearch}),e.openFromNotification&&ba(e.openFromNotification,!0),H(),O()&&!i&&(b.isFolderLoading=!0,b.isFolderScrollToPage=!0,c.$broadcast("folder:scroll:page",{id:Z.uniqueId}),b.currentPage>Z.initPage&&(Z.initPage=b.currentPage)),h(),c.$broadcast("controller:folder:refresh",!1)}).error(function(){console.log("error"),aa(),c.$broadcast("controller:folder:refresh",!1)})};var aa=function(){b.isShowAd=!0,b.isMessagesLoading=!1,b.isMoreMessagesLoading=!1,b.isFolderLoading=!1,b.currentPage--,E()};b.openExternalAccount=function(){d.current.name.indexOf(".external-account.list")==-1&&(F(),G(),d.go(".external-account.list"))},b.addExternalAccount=function(){F(),G(),d.go(".external-account.configure")},b.openNavigation=function(){F(),G(),d.go(".navigation")},b.checkMessage=function(a,c){if(a.checked?b.checkedMessagesCount--:b.checkedMessagesCount++,a.checked=!a.checked,b.isSelectAllView=b.checkedMessagesCount===b.messages.length,c&&b.lastCheckedMessage){if(b.lastCheckedMessage){var d=!1,e=!1;b.messages.forEach(function(c){d=c==b.lastCheckedMessage||d,e=c==a||e,d!=e&&(c.checked=b.lastCheckedMessage.checked),e&&b.lastCheckedMessageWithShift&&(c.checked=!c.checked),c==b.lastCheckedMessageWithShift&&(b.lastCheckedMessageWithShift=null)}),b.lastCheckedMessageWithShift=a}}else b.lastCheckedMessage=a,b.lastCheckedMessageWithShift=null;a.checked===!0&&p.pushCode("checkSingleMessage"),H()},b.markAsRead=function(){var a=P();i.markAsRead(a).error(function(){a.map(function(a){a.seen=!1})}),b.isSelectAllView===!0?p.pushCode("mailMarkReadAllMenuMore"):p.pushCode("mailMarkReadSingleMenuMore"),a.map(function(a){a.seen=!0}),I()>1?p.pushIWAFolder("markReadAll"):p.pushIWAFolder("markRead"),b.clearSelection()},b.markAsUnread=function(){var a=P();i.markAsUnread(a).error(function(){a.map(function(a){a.seen=!0})}),b.isSelectAllView===!0?p.pushCode("mailMarkUnReadAllMenuMore"):p.pushCode("mailMarkUnReadSingleMenuMore"),a.map(function(a){a.seen=!1}),I()>1?p.pushIWAFolder("markUnreadAll"):p.pushIWAFolder("markUnread"),b.clearSelection()},b.$on("controller:folder:mark-as-favorite",function(a,c){b.markAsFavorite(c)}),b.markAsFavorite=function(a){var d=a?[a]:P(),e=[],f=[],g=!d[0].isStarred,h=g?"flagged":"unflagged";b.isMobile&&(b.swipeMsgId=!1),a&&C(a.uniqueId),d.forEach(function(a){parseInt(a.threadId)>0?e.push({threadId:a.threadId,folderId:a.folderId,isStarred:a.isStarred}):(e.push({id:a.id,folderId:a.folderId,isStarred:a.isStarred}),f.push(a.id)),a.isPreviouslyStarred=a.isStarred,a.isStarred=g}),d[0].isStarred&&(I()>1?p.pushIWAFolder("markFavouriteAll"):p.pushIWAFolder("markFavourite")),i.markAsFavorite(e).success(function(a){d.forEach(function(b,c,d){angular.isArray(b.msgs)&&b.msgs.forEach(function(b,c,d){angular.isArray(a.flagged)&&a.flagged.indexOf(b.id)!==-1?d[c].isStarred=!0:angular.isArray(a.unflagged)&&a.unflagged.indexOf(b.id)!==-1&&(d[c].isStarred=!1)})}),Array.isArray(a.flagged)||(a.flagged=[]),Array.isArray(a.unflagged)||(a.unflagged=[]),f.length&&(a[h]=a[h].concat(f)),c.$broadcast("folder-to-message:star-active",a),b.clearSelection(),b.isSelectAllView===!0?p.pushCode("setStarAll"):p.pushCode("setStarSingle"),G()}).error(function(){d.forEach(function(a){a.isStarred=a.isPreviouslyStarred,delete a.isPreviouslyStarred}),b.clearSelection()})},b.quickFilter=function(){b.isAddQuickFilter=!b.isAddQuickFilter},b.moveToInbox=function(){b.moveToFolder(l.folders.INBOX)},b.moveToSent=function(){b.moveToFolder(l.folders.SENT)},b.moveToDrafts=function(){b.moveToFolder(l.folders.DRAFTS)},b.moveToSocial=function(){b.moveToFolder(b.foldersMap.SOCIAL)},b.moveToShopping=function(){b.moveToFolder(b.foldersMap.SHOPPING)},b.moveToTrash=function(a,c){b.moveToFolder(l.folders.TRASH,a,c),G()},b.moveCheckedToTrash=function(){b.moveToFolder(l.folders.TRASH,!1,!1,!0),G()},b.moveToSpam=function(a,c){!a||"offer"!=a.msgType&&"voucher"!=a.msgType?b.moveToFolder(l.folders.SPAM,a,c):z.success('Ta wiadomość nie jest spamem.<br>Możesz wyłączyć folder Oferty w <a href="https://ustawienia.interia.pl/poczta/filtry" target="_blank">Ustawieniach<a>'),G()},b.moveToFolder=function(a,d,e,h){var i,j;l.env.device.isMobile&&c.$broadcast("directive:dropdown:hideAll-force"),g.clearBuffer();var k=P();if(d&&(k=[d]),I()>1?p.pushIWAFolder("moveAll",[f.getCachedFolderById(a).name]):p.pushIWAFolder("move",[f.getCachedFolderById(a).name]),a==l.folders.SPAM){var m=!1;for(j=!1,i=0;i<k.length;i++)"offer"!=k[i].msgType&&"voucher"!=k[i].msgType||(k.splice(i,1),i--,m=!0),"mailing"==k[i].msgType&&(j=!0);m&&z.success('Ta wiadomość nie jest spamem.<br>Możesz wyłączyć folder Oferty w <a href="https://ustawienia.interia.pl/poczta/filtry" target="_blank">Ustawieniach<a>'),j&&u.displayById(u.SPAM_MAILING_BOARD_ID,!0).success(function(a){a||Q(k)&&S(k)}),!j&&Q(k)&&S(k)}else if(a==l.folders.TRASH){for(j=!1,i=0;i<k.length;i++)"mailing"==k[i].msgType&&(j=!0);j&&u.displayById(u.REMOVE_MAILING_BOARD_ID,!0)}if(e)b.lastMovedMsgIndex=e,C(b.messages[e-1].uniqueId);else{var n=k.map(function(a){return a.uniqueId});if(b.lastCheckedMessage){var o=b.messages.map(function(a){return a.uniqueId}).indexOf(b.lastCheckedMessage.uniqueId),q=-1;for(i=o;i>=0;i--)if(b.messages[i-1]&&n.indexOf(b.messages[i-1].uniqueId)==-1){q=i-1;break}if(q==-1)for(i=o;i<b.messages.length;i++)if(b.messages[i+1]&&n.indexOf(b.messages[i+1].uniqueId)==-1){q=i+1;break}q!==-1&&b.messages[q]&&C(b.messages[q].uniqueId)}else b.messages[1]&&(C(b.messages[1].uniqueId),n.indexOf(b.messages[1].uniqueId)!==-1&&(C(!1),Z.initPage=0))}if(h){var r=[];for(i=0;i<k.length;i++)k[i].folderId==l.folders.TRASH&&(r.push(k[i]),k.splice(i,1),i--);r.length&&b.delegateDeleteMessages(r)}k.length&&b.delegateMoveToFolder(a,k)},b.delegateMoveToFolder=function(a,e){b.movePending||(b.movePending=!0,i.moveToFolder(a,e).success(function(){b.isAddQuickFilter&&!b.isSelectAllView&&(c.$broadcast("controller:filter:quick",{email:R(e),folderId:a}),b.isAddQuickFilter=!1);for(var f=0;f<e.length;f++)if(e[f]&&e[f].uniqueId===b.activeUniqueId){d.go("folder");break}b.hotOffers=[],w.removeCache(),b.refresh(),b.movePending=!1}).error(function(){b.clearSelection(),b.movePending=!1}))},b.moveToUnSpam=function(a,c){var d=P();g.clearBuffer(),a&&(d=[a]),c&&(b.lastMovedMsgIndex=c),b.delegateMoveToUnSpam(d)},b.delegateMoveToUnSpam=function(a){i.moveToUnSpam(a).success(function(){for(var c=0;c<a.length;c++)if(a[c]&&a[c].uniqueId===b.activeUniqueId){d.go("folder");break}b.refresh()}).error(function(){b.clearSelection()})},b.deleteMessages=function(a,c){g.clearBuffer();var d=P();a&&(d=[a]),c&&(b.lastMovedMsgIndex=c),b.delegateDeleteMessages(d)},b.delegateDeleteMessages=function(a){i.deleteMessages(a).success(function(){for(var c=0;c<a.length;c++)if(a[c]&&a[c].uniqueId===b.activeUniqueId){d.go("folder");break}b.refresh()}).error(function(){b.clearSelection()})},b.deleteFolderMessages=function(a){var b={};b.title="Usuń wiadomości",b.message="Czy chcesz usunąć wybrane wiadomości?",b.confirm="Usuń",b.callback=_,a&&(b=angular.extend(b,a)),o.confirm({title:b.title,confirm:b.confirm,message:b.message,callback:b.callback(b)})},b.selectAllView=function(a){b.isSelectAllView=void 0!==a?a:!b.isSelectAllView,p.pushCode("selectAllMessages"),b.isSelectAllView?b.checkedMessagesCount=b.messages.length:b.checkedMessagesCount=0,b.messages.forEach(function(a){a.checked=b.isSelectAllView}),!b.isMobile&&b.folder.isShopping&&b.hotOffers.forEach(function(a){a.checked=b.isSelectAllView}),H()},b.clearSelection=function(a){b.selectAllView(!1),a&&p.pushCode(a),H()},l.env.isMobileApp&&b.$on("isapp:message-list:clear-selection",function(){b.clearSelection()}),b.$on("controller:folder:open-message",function(a,b){b.folderId==e.folderId?ba(b,!1):d.go("message",{folderId:b.folderId,openFromNotification:b,messageId:b.id})}),b.$on("controller:folder:delete-all-folder-messages",function(a,c){var d={};d.goTo=".navigation",d.title="Opróżnij "+c.name,d.message="Czy chcesz usunąć wiadomości z folderu "+c.name+"?",d.confirm="Usuń",d.folderId=c.id;var e=_;d.callback=e,b.deleteFolderMessages(d)});var ba=function(a,c){a.threadId&&a.threadId!==-1&&!a.longpollMessage?a.uniqueId="t"+a.id:a.uniqueId="m"+a.id,b.activeUniqueId=a.uniqueId,c||(a.unseen=!0,b.openMessage(a,!1,a.folderId),a.seen=!1,b.markMessageAsRead(a)),b.messages.some(function(b){if(b.id==a.id)return b.unseen=!1,b.seen=!0,!0})};b.markMessageAsRead=function(a){a.seen||g.markAsRead([a]).success(function(){a.seen=!0})},b.simulateMarkMessageAsRead=function(a){a.seen||(a.seen=!0,l.cacheTime=Date.now())},b.editDraft=function(a){m.addComposition({opt:"e",mesg:a.id,folder:a.folder})},b.forward=function(){var a,c=P(),d=0;if(c){for(a=0;a<c.length;a++)parseInt(c[a].threadId)>0&&d++;c.length>1||d>0?m.addComposition({opt:"fmsg",messages:c.map(function(a){return parseInt(a.threadId)>0?{threadId:parseInt(a.threadId)}:{id:parseInt(a.id)}})}):c.length>0&&m.addComposition({opt:"f",mesg:c[0].id,folder:c[0].folder})}c.length>1?p.pushCode("mailForwardAllSelect"):p.pushCode("mailForwardSingle"),b.clearSelection()},b.createNewFolder=function(){f.save(b.newFolder).success(function(a){b.moveToFolder(a.id),b.foldersMap[a.id]=a,D()})},b.loadMoreMessages=function(a,c){b.currentPage++,b.currentPage>Z.initPage&&(Z.initPage=b.currentPage),b.isMoreMessagesLoading=!0,b.refresh(!0,!0,a,c),p.pushCode("messageListNextPack")},b.reply=function(){var a,b=P();if(b&&b.length){if(a=b[0],!a.id){if(!a.msgs||!a.msgs.length)return;if(a=a.msgs[a.msgs.length-1],!a.id)return}h.get({id:a.id,leaveAsUnread:!0}).success(function(a){m.addComposition({opt:"ra",mesg:a.id,to:a.replyTo||a.from,cc:a.cc,from:a.to,envelopeTo:a.envelopeTo,originalRecipients:a.originalRecipients})}),p.pushIWAFolder("reply")}},b.sendFeedback=function(){m.addComposition({to:{email:"pomoc@firma.interia.pl",name:"BOK"},subject:"Sugestie do nowego interfejsu",autoFocusContent:!0})},b.showAvatars=function(){b.avatarsShowed=!b.avatarsShowed,l.env.showAvatars=b.avatarsShowed,q.update({showAvatars:b.avatarsShowed}),c.$broadcast("folder:controller:showAvatars")},b.activeFilter=b.filter?b.filter:"all",b.changeFilter=function(a){b.isFolderLoading=!0,b.activeFilter=a,w.removeCache(),b.refresh()},b.openOffers=function(){p.pushIWA(["Kody_rabatowe","skrzynka_odbiorcza","klik_w_belke"]),d.go("folder",{folderId:b.foldersMap.SHOPPING,sort:null,search:null,searchf:null,filter:null,mode:null,withComposition:null})},b.$on("message:transform-to-thread",function(a,c){var d;if(c.threadId&&c.originalMessageId)for(d=0;d<b.messages.length;d++)b.messages[d].longpollMessage||b.messages[d].id!==c.originalMessageId||b.messages[d].threadId&&b.messages[d].threadId!==-1||(b.messages[d].threadId=parseInt(c.threadId),b.messages[d].msgCount=2)}),b.$on("thread:increase-counter",function(a,c){var d;for(d=0;d<b.messages.length;d++)parseInt(b.messages[d].threadId)===parseInt(c)&&b.messages[d].msgCount++}),b.$on("message-to-folder:star-message-on-list",function(a,c){var d,e=parseInt(c.threadId)>0?"threadId":"id";for(d=0;d<b.messages.length;d++)if(parseInt(b.messages[d][e])===parseInt(c[e])){b.messages[d].isStarred=c.isStarred;break}}),b.$on("msglist:scroll:bottom",function(a,c){b.isMoreMessages&&!b.isMoreMessagesLoading&&(d.go(".",{page:b.currentPage+1},{notify:!1}),r(function(){b.isMessagesLoading=!0,b.loadMoreMessages(!0),a.preventDefault()},0))}),b.clickMoreMessages=function(a){b.isMoreMessages&&!b.isMoreMessagesLoading&&r(function(){b.isMessagesLoading=!0,b.loadMoreMessages(!0),a.preventDefault()},0)},b.isMobile&&b.$on("controller:counters:update",function(){b.unseenMessageCount=s.getSumAllCounters()}),b.$on("msglist:mark-seen",function(a,c){angular.forEach(b.messages,function(a,d){g.getUniqueId(c.message)==a.uniqueId&&(b.messages[d].seen=!0)})}),l.env.device.isMobile&&b.$on("message:open-message:prev-next",function(a,b){"prev"==b?M():"next"==b&&N()}),B(),b.$on("$destroy",function(){var a=s.getCounters();a.folders[e.folderId]&&c.$broadcast("controller:folder:seen",e.folderId),T()})}]),angular.module("nxt-message").controller("MessageMainCtrl",["$scope","$rootScope","$stateParams","$state","Message","Folder","Notification","ApplicationData","ApplicationConfig","Attachments","$q","Compositions","Search","$timeout","$sce","DialogManager","Track","InfoBoards","$window",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";function t(a){if(angular.isArray(a)){var b,c=[],d=[];for(b=0;b<a.length;b++)a[b].id&&d.indexOf(a[b].id)===-1&&(c.push(a[b]),d.push(a[b].id));return c}return a}function u(a){var b;return a.attachmentsLength=0,b=a.mimeParts||[],a.attachmentsLength+=b.length,b=a.mimePartsThumb||[],a.attachmentsLength+=b.length,a}function v(a,b){var c,d,e=[];for(d="number"==typeof b?Math.min(b,a.length):a.length,c=0;c<d;c++)e.push(u(a[c]));return e}function w(a,b){var c;for(c=0;c<b.length;c++)b[c].id===a.id&&(b[c]=a,b[c].isFull=!0,b[c].seen=!0);return b}function x(b){var d=k.defer(),f={id:b,leaveAsUnread:c.leaveAsUnread};return a.isEml&&c.mpid&&(f.mpid=c.mpid),e.get(f).success(function(a){a?d.resolve(a):d.reject("Pusta zwrotka dla messageId = "+b)}),d.promise}function y(){c.threadId?(a.$emit("message:getCachedThread",c.threadId),a.threadId=c.threadId):c.messageId?x(c.messageId).then(function(b){a.firstFullMessage=b,a.threadId=b.threadId,b.threadId&&b.threadId!==-1?a.$emit("message:getCachedThread",b.threadId):B({isThreadFound:!0,allMessagesCount:1,messages:[b]})}):console.error("Brak parametru threadId lub messageId")}function z(b,c,d){var f=k.defer();return d=void 0===d||d,d&&(a.messagesToLoadCount=0),e.getThread(b).success(function(a){a&&a.length?f.resolve(v(a,c)):f.reject("Pusta zwrotka dla threadId = "+b)}),f.promise}function A(b){var c=k.defer();return a.firstFullMessage?(a.firstFullMessage.isMailing||(a.firstFullMessage.replyOpened=!0),c.resolve(w(a.firstFullMessage,b))):b.length&&"undefined"!=typeof b[0]?x(b[b.length-1].id).then(function(d){a.firstFullMessage=d,a.firstFullMessage.isMailing||(a.firstFullMessage.replyOpened=!0),c.resolve(w(d,b))}):(g.error("message:thread-error"),a.isMessageLoaded=!0),c.promise}function B(b){F=!0,b.isThreadFound?(a.messagesToLoadCount=b.allMessagesCount-b.messages.length,a.messagesToLoadCountPerm=a.messagesToLoadCount,A(b.messages).then(function(b){a.thread=t(b),a.isMessageLoaded=!0})):z(b.threadId).then(function(b){b=b.map(function(a,c){return a.isOld=c<b.length-E,a}),b.length>E&&(a.showOldMessages=!1,a.messagesToLoadCountPerm=b.length-E),A(b).then(function(b){a.thread=t(b),a.isMessageLoaded=!0})},function(){A([a.firstFullMessage]).then(function(b){a.thread=t(b),a.isMessageLoaded=!0})})}function C(){var a=[];return angular.forEach(i.folders,function(b){b.id&&b.parentId<=0&&a.push(b)}),a}function D(b){for(var c=0;c<G.length;c++)if(parseInt(G[c].id)===parseInt(b)){a.folder=f.getAdditionalSystemsFolderInfo(G[c]);break}a.userFolders=G.filter(function(a){return!a.isSystem&&!a.isShopping&&!a.isSocial})}var E=3,F=!1,G=[];if(a.isMobile=i.env.device.isMobile,a.isForcedShowImages=!1,a.rightColumnMin=i.env.isRightColumnMin,a.isHTML=!0,a.isIos8PlusOnIpad=i.hacks.isIpad&&i.hacks.iosVersion>=8,a.isIOSApp=i.hacks.isIOS&&i.env.isMobileApp,a.isInt="int"==i.env.service.name,a.avatarsShowed=i.env.showAvatars,a.isReplyingToSingle=1==i.env.replyOption,a.isEml=!!c.mpid,a.folders=i.folders,a.hasSocialFolder=i.env.hasSocialFolder,a.hasShoppingFolder=i.env.hasShoppingFolder,a.webmailLinks=i.links,a.safetySenderReadMoreUrl=a.webmailLinks.safetySenderReadMore.url,a.isShowAdDescription=i.isShowAdDescription,a.isMobileApp=i.env.isMobileApp,a.isAdv=!a.isMobile||s.screen.width>=768,a.isRemarketing=c.isRemarketing,a.isMobile){var H=function(){if(!d.is("message"))return void window.removeEventListener("touchmove",H);var a=document.getElementsByClassName("sticky")[0],b=angular.element(document.getElementsByClassName("message-section-container"))[0],c=b.scrollTop,e=angular.element(a).parent(),f=e.prop("offsetTop");a&&c>f?document.getElementsByClassName("sticky")[0].classList.add("active"):a&&document.getElementsByClassName("sticky")[0].classList.remove("active")};window.addEventListener("touchmove",H,!1),a.stickyMessageToolbar=function(){for(var b=0,c=0;c<a.thread.length;c++)a.thread[c].isFull&&b++;if(1===b)return!0}}a.isMobile||a.$on("tinymce:switched-editor-mode",function(b,c){n(function(){a.isHTML=c.isHTML,a.$digest()},0,!1)}),G=C(),0===G.length?f.query().success(function(a){G=a,D(c.folderId)}):D(c.folderId),a.thread=[],a.$on("service:messages:favorite",function(b,c){a.thread&&c.messages.some(function(b){return b.id===a.thread[a.thread.length-1]&&(a.thread[a.thread.length-1].isStarred=!a.thread[a.thread.length-1].isStarred,!0)})}),a.$on("composition:sent",function(f,g){if(!c.threadId&&g.threadId)d.go("thread",{threadId:g.threadId}),b.$broadcast("message:transform-to-thread",g);else{var h,i=a.thread.length-1;for(h=0;h<a.thread.length;h++)if(a.thread[h].relatedDraft&&a.thread[h].relatedDraft.id===g.originalMessageId||a.thread[h].id===g.originalMessageId){delete a.thread[h].relatedDraft,a.thread[h].replyOpened=!1;break}e.get({id:g.newMessageId}).success(function(b){var c=b;c.isFull=!0,c.isFullDownloaded=!0,c.body=angular.element(b.content).text(),a.thread.splice(i+1,0,c)}),g.threadId&&b.$broadcast("thread:increase-counter",g.threadId)}}),a.$on("composition:saved",function(b,c){var d;for(d=0;d<a.thread.length;d++)!a.thread[d].isFullDownloaded&&!a.thread[d].isFull||parseInt(a.thread[d].id)!==parseInt(c)&&parseInt(a.thread[d].relatedDraft&&a.thread[d].relatedDraft.id)!==parseInt(c)||!function(b){var c;x(a.thread[b].id).then(function(d){c=a.thread[b].isFull,a.thread[b]=d,a.thread[b].isFull=c})}(d)}),a.$on("folder-to-message:star-active",function(b,c){a.thread.forEach(function(a,b,d){c.flagged.indexOf(a.id)!==-1?d[b].isStarred=!0:c.unflagged.indexOf(a.id)!==-1&&(d[b].isStarred=!1)})}),i.env.device.isMobile||(a.$on("directive:column-resize:right-column-min",function(b,c){n(function(){a.rightColumnMin=!0,a.$digest()},0,!1)}),a.$on("directive:column-resize:right-column-greater",function(b,c){n(function(){a.rightColumnMin=!1,a.$digest()},0,!1)})),a.isMessageLoaded=!1,a.getMessageFromThread=function(c){var d,f;a.thread[c].isFullDownloaded?a.thread[c].isFull=!0:(d=a.thread[c].body,f=a.thread[c].isOld,e.get({id:a.thread[c].id}).success(function(e){if(a.thread[c]=e,a.thread[c].body=d,a.thread[c].isFull=!0,a.thread[c].isFullDownloaded=!0,a.thread[c].isOld=f,a.thread[c].seen=!0,!a.isMobile){a.isMessageLoaded&&a.messagesToLoadCount>0&&z(a.threadId,a.messagesToLoadCount,!1).then(function(b){b.forEach(function(a){a.isOld=!0}),a.thread=t(b.concat(a.thread))});for(var g=0,h=0;h<a.thread.length;h++)a.thread[h].seen||g++;0===g&&b.$broadcast("msglist:mark-seen",{message:a.thread[a.thread.length-1]})}}))},a.$on("message:cachedThreadProvided",function(a,b){B(b)}),y(),a.$on("folder:getCachedThreadEventAttached",function(){F||y()}),a.loadOldMessages=function(){a.oldMessagesLoaded||(a.isMessageLoaded=!1,z(a.threadId,a.messagesToLoadCount).then(function(b){b.forEach(function(a){a.isOld=!0}),a.thread=t(b.concat(a.thread)),a.isMessageLoaded=!0,a.oldMessagesLoaded=!0})),a.showOldMessages=!0},a.hideOldMessages=function(){a.showOldMessages=!1},a.collapseMessage=function(b){a.thread[b].isFull=!1},a.markAsFavorite=function(c){c=c||a.firstFullMessage,e.markAsFavorite({id:c.id,folderId:c.folderId,isStarred:c.isStarred}).success(function(d){c.isStarred?b.$broadcast("message-to-folder:star-message-on-list",{id:c.id,threadId:a.threadId,isStarred:c.isStarred}):angular.isArray(d.flagStatus)&&d.flagStatus.length&&angular.isObject(d.flagStatus[0])&&b.$broadcast("message-to-folder:star-message-on-list",{threadId:d.flagStatus[0].threadId,isStarred:!!d.flagStatus[0].isStarred})}).error(function(){c.isStarred=!c.isStarred}),c.isStarred=!c.isStarred},a.moveToSpam=function(){"mailing"==a.firstFullMessage.msgType&&r.displayById(r.SPAM_MAILING_BOARD_ID,!0),"offer"==a.firstFullMessage.msgType||"voucher"==a.firstFullMessage.msgType?g.success('Ta wiadomość nie jest spamem.<br>Możesz wyłączyć folder Oferty w <a href="https://ustawienia.interia.pl/poczta/filtry" target="_blank">Ustawieniach<a>'):(a.firstFullMessage.fUnsubscribable&&a.messageUnsubscribeConfirm(a.firstFullMessage),e.moveToFolder(i.folders.SPAM,a.firstFullMessage).success(function(){d.go("folder")})),q.pushIWAFolder("move",["spam"])},a.moveToUnSpam=function(){e.moveToUnSpam(a.firstFullMessage).success(function(){d.go("folder")})},a.forward=function(a){l.addComposition({opt:"f",mesg:a.id,folder:a.folder,originalRecipients:a.originalRecipients,senderConfig:a.senderConfig}),a.length>1&&q.pushCode()},a.showMailingHistory=function(){m.searchHistory(a.firstFullMessage.fromEmail)},a.moveToTrash=function(){e.moveToFolder(i.folders.TRASH,a.firstFullMessage).success(function(){d.go("folder")}),a.firstFullMessage.isMailing&&r.displayById(r.REMOVE_MAILING_BOARD_ID,!0),q.pushIWAFolder("removeThread")},a.moveMessageFromThreadToTrash=function(b){var c=a.thread[b];c&&(c.threadId=-1,e.moveToFolder(i.folders.TRASH,c).success(function(){a.thread.splice(b,1),a.thread.length<=0&&d.go("folder")}),c.isMailing&&r.displayById(r.REMOVE_MAILING_BOARD_ID,!0)),q.pushIWAFolder("move",["kosz"])},a.deleteMessage=function(b){var c=b?a.thread[b]:a.firstFullMessage;p.confirm({title:"Usuń wiadomość",message:"Czy chcesz usunąć wiadomość?",confirm:"Usuń",callback:function(){e.deleteMessage({id:c.id,folderId:c.folderId}).success(function(){d.go("folder")})}})},a.moveToFolder=function(c,g){i.env.device.isMobile&&n(function(){b.$broadcast("directive:dropdown:hideAll-force")},0,!1),g=g||a.firstFullMessage,e.moveToFolder(c,g).success(function(){d.go("folder")}),q.pushIWAFolder("move",[f.getCachedFolderById(c).name])},a.showImages=function(b){b=b||a.firstFullMessage,e.showImages(b)},a.alwaysShowImages=function(b){b=b||a.firstFullMessage,e.alwaysShowImages(b).then(function(){g.success("message:sender-marked-as-trusted")})},a.$on("folder:controller:showAvatars",function(b){a.avatarsShowed=i.env.showAvatars}),a.$on("message:content:open-slideshow",function(b){var c=a.firstFullMessage.attachments.map(function(a){return a.thumbUrl=a.thumbnail,a});a.openSlideshow(c,c[0].name)}),a.openSlideshow=function(a,b,c){d.go(".slideshow",{attachments:a,attachmentName:b,isForVideos:c})},a.openVideoSlideshow=function(b,c){a.openSlideshow(b,c,!0)},a.print=function(a){var b="/"+i.env.baseUrl+"/mail/"+a.id+"/print"+(I?",vc,"+I:"")+"?uid="+i.env.uid;window.open(b)},a.reply=function(b){1==i.env.replyOption?a.replyToSender(b):a.replyToAll(b)},a.replyToAll=function(a){l.addComposition({opt:"ra",mesg:a.id,to:a.replyTo||a.from,cc:a.cc,from:a.to,envelopeTo:a.envelopeTo,originalRecipients:a.originalRecipients,senderConfig:a.senderConfig,isReplyingToSingle:!1})},a.replyToSender=function(a){l.addComposition({opt:"ra",mesg:a.id,to:a.replyTo||a.from,envelopeTo:a.envelopeTo,originalRecipients:a.originalRecipients,senderConfig:a.senderConfig,isReplyingToSingle:!0}),q.pushIWAFolder("replyOnlySender")},a.$on("composition:popout",function(){a.compositionRemoved=!0}),a.$on("composition:activated",function(){a.isCompositionActive=!0}),a.$on("message:forced-show-images",function(b,c){a.isForcedShowImages=c}),a.$on("service:folder:deleted",function(b,c){a.userFolders=a.userFolders.filter(function(a){return a.id!=c.id})}),a.showDetails=function(a){if(!a.parsedHeaders){var b,c,d=[{find:"Cc",replace:"DW"},{find:"To",replace:"Do"},{find:"From",replace:"Od"},{find:"Date",replace:"Data"}];for(b=0;b<d.length;b++)for(c=0;c<a.headers.length;c++)0===a.headers[c].indexOf(d[b].find+": ")&&(a.headers[c]=a.headers[c].replace(d[b].find,d[b].replace),a.headers.unshift(a.headers.splice(c,1).pop()));a.parsedHeaders=a.headers.map(function(a){var b=a.split(": ");return{key:b.shift(),value:o.trustAsHtml(b.join(": "))}})}a.isDetailsVisible=!a.isDetailsVisible},a.stopDownload=function(a){i.hacks.isFirefox&&h.getIsRequesting()&&(a.preventDefault(),a.stopPropagation())},a.openAtt=function(a,b){j.openAtt(a,b)},a.messageUnsubscribeConfirm=function(a){p.confirm({title:"Zgłoszenie niechcianej wiadomości",message:"Ten nadawca umożliwia automatyczne wypisanie się z listy adresatów, dzięki temu nie będziesz otrzymywać od niego tego typu wiadomości. Czy chcesz skorzystać z tej opcji?",confirm:"wypisz mnie",template:"/dialog/views/dialog_unsubscribe.html",additionalData:a,callback:function(){e.messageUnsubscribe(a)}})};var I=!1;a.$on("message:iframe:voucher-open",function(a,b){I=b.code}),a.back=function(){d.go("^")}}]),angular.module("nxt-navigation").controller("NavigationFolderEditCtrl",["$scope","$state","$stateParams","Folder","ApplicationConfig","$rootScope","$filter",function(a,b,c,d,e,f,g){"use strict";function h(a,b){var c,d,e=!1;for(d=a.length;d--;)if(c=a[d],c.id==b.parentId?e=c:c.subfolders&&(e=h(c.subfolders,b)),e)return e;return e}function i(b,c){if(c.isNew)b.push(c),c.parentId||(a.$parent.selectUserFolders.push(c),a.$parent.selectUserFolders=g("orderBy")(a.$parent.selectUserFolders,"name"));else{var d,e;for(e=0;e<a.$parent.userFolders.length;e++)if(a.$parent.userFolders[e].id==c.id)a.$parent.userFolders.splice(e,1);else if(a.$parent.userFolders[e].subfolders)for(var f=0;f<a.$parent.userFolders[e].subfolders.length;f++)a.$parent.userFolders[e].subfolders[f].id==c.id&&a.$parent.userFolders[e].subfolders.splice(f,1);for(e=b.length;e--;)d=b[e],d.id==c.id&&(d.name=c.name,d.parentId=c.parentId);b.push(c)}}a.specialCharsPattern=e.patterns.specialChars,a.close=function(){a.env.device.isMobile?b.go("^"):a.userFolders.length?b.go("^.folder-list"):b.go("^.^")},c.folderEditId?(a.folder=e.folders[c.folderEditId],d.get({id:c.folderEditId}).success(function(b){a.folder=b})):a.folder={id:-1},a.submit=function(){d.save(a.folder).success(function(b){if(b.isNew=!c.folderEditId,b.parentId){var d=h(a.userFolders,b);d.subfolders=d.subfolders||[],i(d.subfolders,b)}else i(a.userFolders,b);f.$broadcast("folders:refresh"),a.close()})}}]),angular.module("nxt-navigation").controller("NavigationMainCtrl",["$scope","$rootScope","$location","$state","$stateParams","$filter","ApplicationConfig","Folder","Compositions","Notification","Counter","DialogManager","Track","MobileApp",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";a.env=g.env,a.links=g.links,a.isOldAndroid=g.hacks.AndroidVersion<4.3,a.isTouch=g.env.device.isMobile,a.isNavigationFolder=/(folder-list|folder.edit)$/.test(d.current.name),a.isSearch=/\?search/.test(c.url()),a.hasSocialFolder=g.env.hasSocialFolder,a.hasShoppingFolder=g.env.hasShoppingFolder;var o=g.env.isCorp;a.showSpamCounter=1===g.env.showSpamCounter||o&&g.env.showSpamCounter===-1,a.sendSuggestConf=!!g.getConfigAppModule("navigation")&&g.getConfigAppModule("navigation").data.sendSuggest,e.folderId&&(a.activeFolderId=e.folderId),k.init(),h.queryAsMap().success(function(b){k.update(b),a.folders=b.system,a.userFolders=[],Object.keys(b.user).forEach(function(c){var d=b.user[c];0===d.parentId&&a.userFolders.push(d)});var c=f("orderBy")(a.userFolders,"name");a.selectUserFolders=[{id:0,name:"Brak folderu nadrzędnego"}].concat(c)}),a.showSettings=function(){g.env.isMobileApp?n.showSettings():d.go("^.settings")},a.close=function(){g.env.device.isMobile?d.go("^"):a.isNavigationFolder&&d.go("^.^")},a.$on("ui-events:keydown:Escape",function(){"folder"!==d.current.name&&d.current.name.indexOf("slideshow")===-1&&a.close()}),a.$on("ui-events:click",function(b,c){c.panel&&"navigation"!==c.panel&&a.close()}),a.openComposition=function(){i.addComposition()},a.openFolderAdd=function(a){g.env.device.isMobile||a?d.go(".folder-edit"):d.go("^.folder-edit")},a.openFolderList=function(){g.cacheTime=Date.now(),d.go(".folder-list")},a.openContacts=function(){d.go("^.contact")},a.deleteFolderMessages=function(a,c){var d={};d.name=a,d.id=c,b.$broadcast("controller:folder:delete-all-folder-messages",d)},a.$on("controller:folder:main",function(b,c){a.activeFolderId=c.folderId,a.isSearch=c.isSearch}),a.openFolderEdit=function(a){g.env.device.isMobile?d.go(".folder-edit",{folderEditId:a.id}):d.go("^.folder-edit",{folderEditId:a.id})},a.deleteFolder=function(b){l.confirm({title:"Usuń folder",message:"Czy chcesz usunąć ten folder i przenieść jego zawartość do kosza?",confirm:"Usuń",callback:function(){b._destroy=!0,h.deleteFolder(b.id).success(function(){b.parentId?a.userFolders.forEach(function(a){a.id==b.parentId&&(a.subfolders=a.subfolders.filter(function(a){return a.id!=b.id}))}):(a.userFolders=a.userFolders.filter(function(a){return a.id!=b.id}),a.selectUserFolders=[{id:0,name:"Brak folderu nadrzędnego"}].concat(a.userFolders))}).error(function(){b._destroy=!1})}})},a.sendSuggest=function(){var b;b={to:{email:a.sendSuggestConf.email,name:"BOK"},subject:g.env.isMobileApp?a.sendSuggestConf.subjectApp:a.sendSuggestConf.subject,autoFocusContent:!0},i.addComposition(b)},a.openOffer=function(){m.pushIWA(["next","foldery","klik","oferty"])},a.openSocial=function(){m.pushIWA(["next","foldery","klik","spolecznosci"])},a.$on("service:folder:delete",function(b,c){a.folders[c].total=0}),a.$on("directive:newcomposition:save",function(b){a.folders[g.folders.DRAFTS].total++}),a.$on("controller:counters:update",function(){a.counters=k.getCounters()}),a.$on("$stateChangeSuccess",function(b,c,d,e,f){a.activeFolderId=d.folderId}),a.$on("controller:folder:refresh",function(b,c){a.isRefreshingCurrentFolder=c}),a.logout=function(a){a.stopPropagation(),n.logout()}}]),angular.module("nxt-settings").controller("SettingsMainCtrl",["$scope","$state","ApplicationConfig","Uploader","Theme","Compositions","Track","DialogManager","InfoBoards",function(a,b,c,d,e,f,g,h,i){"use strict";function j(){var b,d=a.moduleConfig.data.links,e=!0;c.env.device.isPc?b="isPc":c.env.device.isMobile&&(b="isMobile"),1!==c.env.adminBusinessPackType&&2!==c.env.adminBusinessPackType||(e=!1);for(var f=0;f<d.length;f++)!e&&d[f].hasOwnProperty("noAds")||d[f].hasOwnProperty(b)&&a.links.push(d[f])}a.moduleConfig=c.getConfigAppModule("settings"),a.env=c.env,a.webmailLinks=c.links,a.disableActions=a.moduleConfig.actions||{},a.isCorp=c.env.isCorp,a.isMobile=c.env.device.isMobile,a.isInt=a.env.service&&"int"==a.env.service.name,a.links=[],a.changeable=!a.isInt&&c.env.adminBusinessPackType!=c.ADMIN_BUSINESS_TYPE.SUBACCOUNT,j();var k=a.env.ownEmail.split("@");if(k[0].length>=13?a.breakLineOwnEmail=k[0]+"<br>@"+k[1]:a.breakLineOwnEmail=a.env.ownEmail,a.currentYear=(new Date).getFullYear(),1==c.env.accountType)a.autopromo=a.env.autoPromo.settings;else{var l=Math.floor(3*Math.random()+1);a.autopromo=a.env.autoPromo["settings"+l],
g.pushGA(["Autopromo_bez_reklam","wyswietlenie","v"+l])}a.mobileCopyright=a.env.autoPromo.mobileCopyright,a.close=function(){a.$broadcast("settings:close"),b.go("^")},a.openExternalPanel=function(){b.go("^.external-account.configure")},a.$on("ui-events:keydown:Escape",function(){a.close()}),a.$on("ui-events:click",function(b,c){c.panel&&"settings"!==c.panel&&a.close()}),a.$watch("env.device.isMobile",function(a){var b=a?"isMobilePhone":"nonMobileDevice",c=new Date;c.setDate(c.getDate()+14),document.cookie="inpl_mail_device_type="+escape(b)+";expires="+c.toUTCString()}),a.sendToBOK=function(b){f.addComposition({to:{email:"bok@firma.interia.pl",name:"BOK"},subject:"Poczta Firmowa - zgłoszenie do BOK",autoFocusContent:!0}),a.close(),b.preventDefault()},a.getLastLoginText=function(){return null===a.env.lastLogin?"Pierwsze logowanie":"Ostatnie logowanie:"+(c.env.device.isPc?"<br>":"")+a.env.lastLogin},a.wizard=function(b){i.getBoardConfById(210).success(function(b){h.multiBoards(b.options),a.close()}),b.preventDefault()},a.isMobile&&!c.hacks.isWindowsPhoneOS&&!c.env.isMobileApp&&a.webmailLinks.settingsAndroidTouch&&a.webmailLinks.settingsIOSTouch&&(c.env.device.isAndroid?a.linkToTouchApp=a.webmailLinks.settingsAndroidTouch.url:c.env.device.isIOS&&(a.linkToTouchApp=a.webmailLinks.settingsIOSTouch.url)),a.$on("controller:wizard:ownNameUpdate",function(){a.env.ownName=c.env.ownName})}]),angular.module("nxt-slideshow").controller("SlideshowMainCtrl",["$scope","$state","$stateParams","Message","$timeout","ApplicationConfig","Compositions",function(a,b,c,d,e,f,g){"use strict";function h(){return a.photos.filter(function(a){return a.checked})}function i(){if(a.photos)for(var b=0;b<a.photos.length;b++)a.photos[b].checked=!1}a.interval=3e3,a.isPlaying=!1,a.timeoutH=null,a.isPc=f.env.device.isPc,a.isMobile=f.env.device.isMobile,a.isForVideos=c.isForVideos,a.checkedPhotosCount=0,a.close=function(){i(),b.go("^")},c.attachments||a.close(),c.attachments&&(a.photos=c.attachments.map(function(b,d){b.name==c.attachmentName&&(a.currentPhoto=b,a.currentIndex=d);var e=b.name.match(/(.+)\.([^\.]+)/);return e&&3===e.length&&(b.extension=e[2]),b.rotationAngle=0,b}),a.isPrev=a.currentIndex>0,a.isNext=a.currentIndex<a.photos.length-1),a.changePhoto=function(){a.currentPhoto.selected=!1,a.currentPhoto=a.photos[a.currentIndex],a.currentPhoto.selected=!0,a.$broadcast("controller:slideshow:changephoto",{index:a.currentIndex}),a.isPrev=a.currentIndex>0,a.isNext=a.currentIndex<a.photos.length-1},a.previous=function(){a.currentIndex=Math.max(a.currentIndex-1,0),a.changePhoto(),a.$broadcast("controller:slideshow:changephoto",{index:a.currentIndex})},a.next=function(){a.currentIndex=Math.min(a.currentIndex+1,a.photos.length-1),a.changePhoto(),a.$broadcast("controller:slideshow:changephoto",{index:a.currentIndex})},a.previousPack=function(){a.$broadcast("controller:slideshow:previousPack")},a.nextPack=function(){a.$broadcast("controller:slideshow:nextPack")},a.play=function(){a.currentIndex=Math.min(a.currentIndex+1,a.photos.length-1),a.changePhoto(),a.isPlaying&&(a.timeoutH=e(function(){a.play()},a.interval))},a.rotateLeft=function(){a.$broadcast("slideshow:image:rotate",{currentIndex:a.currentIndex,direction:"left",mid:a.currentPhoto.mid,mpid:a.currentPhoto.mpid})},a.rotateRight=function(){a.$broadcast("slideshow:image:rotate",{currentIndex:a.currentIndex,direction:"right",mid:a.currentPhoto.mid,mpid:a.currentPhoto.mpid})},a.stop=function(){e.cancel(a.timeoutH)},a.selectPhoto=function(b){a.currentIndex=b,a.changePhoto()},a.togglePlay=function(){a.isPlaying?e.cancel(a.timeoutH):a.timeoutH=e(function(){a.play()},a.interval),a.isPlaying=!a.isPlaying},a.isShowNavigation=!1,a.showNavigationTimeout=null,a.showNavigation=function(){a.isShowNavigation=!0,a.cancelPreviousShowNavigationTimeout(),a.hideNavigation()},a.downloadPhoto=function(a){window.location=a},a.cancelPreviousShowNavigationTimeout=function(){e.cancel(a.showNavigationTimeout)},a.hideNavigation=function(){a.showNavigationTimeout=e(function(){a.isShowNavigation=!1},2e3)},a.changeSendMode=function(b){a.sendMode=b,b||i()},a.checkPhoto=function(b){b.checked?a.checkedPhotosCount--:a.checkedPhotosCount++,b.checked=!b.checked},a.sendMessage=function(){for(var b=h(),c=[],d=0;d<b.length;d++)c.push({mid:b[d].mid,mpid:b[d].mpid});a.close(),g.addComposition({mesg:c[0].mid,singleInstanceId:c[0].mid,opt:"att",attach:JSON.stringify(c)})},a.showNavigation(),f.env.device.isPc&&(a.$on("ui-events:keydown:Escape",function(){a.$apply(function(){a.isPlaying&&(a.stop(),a.isPlaying=!1)}),a.close()}),a.$on("ui-events:keydown:Left",function(){a.$apply(function(){a.previous()})}),a.$on("ui-events:keydown:Right",function(){a.$apply(function(){a.next()})})),a.$on("slideshow:leftrightbuttons",function(b,c){a.buttonLeftEnabled=c.left,a.buttonRightEnabled=c.right})}]),function(a){"use strict";function b(a,b){for(var c=b.parentNode;null!==c;){if(c===a)return!0;c=c.parentNode}return!1}var c=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};a.module("pickadate",[]).provider("pickadateI18n",function(){var a={prev:"prev",next:"next"};this.translations={},this.$get=function(){var b=this.translations;return{t:function(c){return b[c]||a[c]}}}}).factory("pickadateUtils",["$locale",function(b){function c(a){switch(a){case"dd":return"day";case"MM":return"month";case"yyyy":return"year"}}return{parseDate:function(b,d){if(b){if(a.isDate(b))return new Date(b);d=d||"yyyy-MM-dd";var e="(dd|MM|yyyy)",f=d.match(/[-|\/]/)[0],g=b.split(f),h=new RegExp([e,e,e].join(f)),i=d.match(h),j={};if(i.shift(),a.forEach(i,function(a,b){j[c(a)]=parseInt(g[b],10)}),!(isNaN(j.year)||isNaN(j.month)||isNaN(j.day)))return new Date(j.year,j.month-1,j.day,3)}},buildDates:function(a,b){var c=[],d=new Date(a.getFullYear(),a.getMonth()+1,0,3);for(b=b||{},a=new Date(a);a.getDay()!==b.weekStartsOn;)a.setDate(a.getDate()-1);for(var e=0;e<42&&!(b.noExtraRows&&a.getDay()===b.weekStartsOn&&a>d);e++)c.push(new Date(a)),a.setDate(a.getDate()+1);return c},buildDayNames:function(a){var c=b.DATETIME_FORMATS.SHORTDAY;if(a){c=c.slice(0);for(var d=0;d<a;d++)c.push(c.shift())}return c}}}]).directive("pickadate",["$locale","$sce","$compile","$document","$window","pickadateUtils","pickadateI18n","dateFilter","Tools",function(d,e,f,g,h,i,j,k,l){var m='<div class="pickadate" ng-show="displayPicker" ng-style="styles"><div class="pickadate-header"><div class="pickadate-controls"><a href="" class="pickadate-prev" ng-click="changeMonth(-1)" ng-show="allowPrevMonth">'+e.trustAsHtml(j.t("prev"))+'</a><a href="" class="pickadate-next" ng-click="changeMonth(1)" ng-show="allowNextMonth">'+e.trustAsHtml(j.t("next"))+'</a></div><h3 class="pickadate-centered-heading">{{currentDate | date:"MMMM yyyy"}}</h3></div><div class="pickadate-body"><div class="pickadate-main"><ul class="pickadate-cell"><li class="pickadate-head" ng-repeat="dayName in dayNames">{{dayName}}</li></ul><ul class="pickadate-cell"><li ng-repeat="d in dates" ng-click="setDate(d)" ng-class="classesFor(d)">{{d.dateObj | date:"d"}}</li></ul></div></div></div>';return{require:"ngModel",scope:{defaultDate:"=",minDate:"=",maxDate:"=",disabledDates:"=",weekStartsOn:"="},link:function(d,e,j,n){function o(){var a=new Date(d.currentDate.getFullYear(),d.currentDate.getMonth(),1,3),b=a.getMonth()+1,c=i.buildDates(a,{weekStartsOn:y,noExtraRows:w}),e=[],f=k(new Date,C),g=new Date(a);g.setMonth(b),d.allowPrevMonth=!u||a>u,d.allowNextMonth=!v||g<=v,d.dayNames=i.buildDayNames(y);for(var h=0;h<c.length;h++){var j=[],l=c[h],m=k(l,C),n=s(m);r(l)||n?j.push("pickadate-disabled"):j.push("pickadate-enabled"),n&&j.push("pickadate-unavailable"),m===f&&j.push("pickadate-today"),e.push({date:m,dateObj:l,classNames:j})}d.dates=e}function p(a,b){b=b||{},x?n.$setViewValue(a):n.$setViewValue(a[0]),b.skipRenderInput||e.val(n.$viewValue)}function q(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];s(d)||r(i.parseDate(d,C))||b.push(d)}return b}function r(a){return a<u||a>v||k(a,"M")!==k(d.currentDate,"M")}function s(a){return c.call(d.disabledDates||[],a)>=0}function t(a,b){var d=c.call(b,a);return d===-1?b.push(a):b.splice(d,1),b}l.setElementIsolateScope(e,d);var u,v,w=j.hasOwnProperty("noExtraRows"),x=j.hasOwnProperty("multiple"),y=d.weekStartsOn,z=[],A=e[0]instanceof HTMLInputElement,B=f(m)(d),C=(j.format||"yyyy-MM-dd").replace(/m/g,"M");d.displayPicker=!A,(!a.isNumber(y)||y<0||y>6)&&(y=0),d.setDate=function(a){r(a.dateObj)||s(a.date)||(z=x?t(a.date,z):[a.date],p(z),d.displayPicker=!A)};var D=n.$render=function(b){b=b||{},a.isArray(n.$viewValue)?z=n.$viewValue:n.$viewValue&&(z=[n.$viewValue]),d.currentDate=i.parseDate(d.defaultDate,C)||i.parseDate(z[0],C)||new Date,z=q(z),p(z,b),o()};if(d.classesFor=function(a){var b=c.call(z,a.date)>=0?"pickadate-active":null;return a.classNames.concat(b)},d.changeMonth=function(a){d.currentDate.setDate(1),d.currentDate.setMonth(d.currentDate.getMonth()+a),o()},d.$watch(function(){return a.toJson([d.minDate,d.maxDate,d.disabledDates])},function(){u=i.parseDate(d.minDate,C)||new Date(0),v=i.parseDate(d.maxDate,C)||new Date(99999999999999),D()}),A){var E=function(a){d.displayPicker=a,d.$apply()};e.on("focus",function(){var a=void 0!==h.pageXOffset,b="CSS1Compat"===(g.compatMode||""),c=a?h.pageXOffset:b?g.documentElement.scrollLeft:g.body.scrollLeft,f=a?h.pageYOffset:b?g.documentElement.scrollTop:g.body.scrollTop,i=h.innerWidth||g.documentElement.clientWidth||g.body.clientWidth;d.styles={top:f+e[0].getBoundingClientRect().bottom+"px"},i-e[0].getBoundingClientRect().left>=300?d.styles.left=c+e[0].getBoundingClientRect().left+"px":d.styles.right=i-e[0].getBoundingClientRect().right-c+"px",E(!0)}),e.on("keydown",function(a){c.call([9,13,27],a.keyCode)>=0&&E(!1)}),d.$watch(function(){return n.$viewValue},function(a){var b=i.parseDate(a,C);b&&D({skipRenderInput:!0}),n.$setValidity("date",!!b)}),g.on("click",function(a){b(B[0],a.target)||a.target===e[0]||E(!1)}),d.$$postDigest(function(){j.value&&(n.$viewValue=j.value,D())}),e.after(B.addClass("pickadate-modal"))}else e.append(B)}}}])}(window.angular),angular.module("nxt-dialog").controller("AccountNameWizardCtrl",["$scope","ApplicationConfig","Setting",function(a,b,c){"use strict";a.accountName=b.env.ownName,a.submit=function(){c.update({senderName:a.accountName}),b.env.ownName=a.accountName,a.$broadcast("controller:wizard:ownNameUpdate"),a.nextStep(!0)}}]),angular.module("nxt-dialog").controller("ExternalAccountWizardCtrl",["$scope",function(a){"use strict";a.$parent.isWizard=!0,a.$parent.externalAccountStep=0,a.$parent.wizardSuccess=function(){a.pushStat(a.board.stat.type,a.board.stat.go),a.nextStep(!0)},a.cancel=function(){a.$parent.externalAccountStep=0},a.$on("$destroy",function(){a.$parent.isWizard=!1})}]),angular.module("nxt-dialog").controller("UserAvatarWizardCtrl",["$scope","$rootScope","ApplicationConfig","$http","FileUploader","ThemeUploader","$timeout","Notification","Avatar","$cookies",function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(){g(function(){n=document.querySelector(".choose-avatar"),a.$digest()},0,!1),l()}function l(){a.uploader=f.getUploader(a)}function m(a){i.setAvatar({avatarId:a,sid:c.env.sid,uid:c.env.uid}).success(function(a){var d=new Date;d.setDate(d.getDate()+40),j.remove(a.data.profileCookie),j.putObject(a.data.profileCookie,JSON.parse(a.data.profileDataManager),{expires:d,domain:c.env.domainForCookie,path:"/"}),b.$broadcast("controller:wizard:avatarChange")}).error(function(a){console.log("err",a)})}var n;a.workId=!1,a.addUserAvatar=function(){a.uploader.fileInputClick(document.querySelector(".skin-upload-frame--normal"),n)},a.afterAddingAll=function(b,c){c&&(a.uploader.clearQueue(),h.error("uploader:avatar-size-exceeded"))},a.afterSuccess=function(b,d){var e=document.querySelector(".wizard-upload-avatar-box .avatar-simple-content"),f="url("+c.env.avatarBaseUrl+"/-/"+b+"-C435."+d+")";e.innerHTML="",e.style.backgroundImage=f,a.avatarId=b,i.addToAlbum({avatarId:b,ext:d,sid:c.env.sid,uid:c.env.uid}).success(function(b){a.workId=b.data.albumId}).error(function(a){console.log("err",a)}),g(function(){a.uploader.clearQueue(),a.$digest()},0,!1)},a.afterError=function(){h.error("uploader:avatar-other-error"),g(function(){a.uploader.clearQueue(),a.$digest()},0,!1)},a.saveAvatar=function(){m(a.workId),a.nextStep(!0)},k()}]),angular.module("nxt-dialog").controller("UserThemeWizardCtrl",["$scope","ApplicationConfig",function(a,b){"use strict";var c=document.querySelector("#userBackground");if(c)var d=c.textContent;a.userThemeStep=0,a.saveTheme=function(){a.selectedTheme&&a.$broadcast("controller:settings:selectTheme",{theme:a.selectedTheme,isSave:!0}),a.nextStep(!0)},a.$parent.$parent.cancelCallback=function(){c&&(c.innerHTML=d),a.$broadcast("controller:settings:selectTheme",{theme:b.env.currentThemeSaved,isSave:!1})}}]),angular.module("nxt-common").run(["$templateCache",function(a){"use strict";var b={choices:'<ul class="ui-select-choices ui-select-choices-content"><li class="ui-select-choices-group" ng-class="{\'ui-select-choices-group--with-children\': $select.choiceGrouped($group) }"><div ng-show="$select.choiceGrouped($group)" class="ui-select-choices-group-label" ng-bind-html="$group.name"></div><ul role="listbox" id="ui-select-choices-{{ $select.generatedId }}"ng-class="{\'ui-select-choices--sub\': $select.choiceGrouped($group), \'ui-select-choices--single\': !$select.choiceGrouped($group) }"><li role="option" id="ui-select-choices-row-{{ $select.generatedId }}-{{$index}}"class="ui-select-choices-row"ng-class="{\'ui-select-choices-row--highlighted\': $select.isActive(this) && !$select.isEmpty(), \'ui-select-choices-row--disabled\': $select.isDisabled(this)}"><div class="ui-select-choices-row-inner"></div></li></ul></li></ul>',match:'<a class="ui-select-match"ng-class="{\'ui-select-match--default\': $select.isEmpty()}"ng-click="$select.activate()" aria-label="{{ $select.baseTitle }} select"><span ng-show="$select.isEmpty()" class="ui-select-match-chosen ui-select-match-chosen--placeholder">{{$select.placeholder}}</span><span ng-hide="$select.isEmpty()" class="ui-select-match-chosen" ng-transclude></span><abbr ng-if="$select.allowClear && !$select.isEmpty()" class="ui-select-match-choice-close" ng-click="$select.select(undefined)"></abbr><span class="ui-select-toggle" ng-click="$select.toggle($event)"><b></b></span></a>',"match-multiple":'<span class="ui-select-match"><li class="ui-select-match-item" ng-repeat="$item in $select.selected"ng-class="{\'ui-select-match-item--focus\':$select.activeMatchIndex === $index, \'ui-select-match-item--locked\':$select.isLocked(this, $index)}"><span uis-transclude-append></span><a href="javascript:;" class="ui-select-match-close" ng-click="$select.removeChoice($index)" tabindex="-1"></a></li></span>',select:'<div class="ui-select-container"ng-class="{\'ui-select-container--active ui-select-container--open\': $select.open,\'ui-select-container--disabled\': $select.disabled,\'ui-select-container--active\': $select.focus,\'ui-select-container--allowclear\': $select.allowClear && !$select.isEmpty()}"><div class="ui-select-match"></div><div class="ui-select-dropdown ui-select-dropdown--active"ng-class="{\'ui-select-dropdown--with-searchbox\': $select.searchEnabled}"ng-show="$select.open"><div class="ui-select-search-field" ng-show="$select.searchEnabled"><input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"role="combobox"aria-expanded="true"aria-owns="ui-select-choices-{{ $select.generatedId }}"aria-label="{{ $select.baseTitle }}"aria-activedescendant="ui-select-choices-row-{{ $select.generatedId }}-{{ $select.activeIndex }}"class="ui-select-search"placeholder="Filtruj"ng-model="$select.search"></div><div class="ui-select-choices"></div></div></div>',"select-multiple":'<div class="ui-select-container ui-select-multiple"ng-class="{\'ui-select-container--active ui-select-container--open\': $select.open,\'ui-select-container--disabled\': $select.disabled}"><ul class="ui-select-match-list"><span class="ui-select-match"></span><li class="ui-select-search-field"><input type="text"autocomplete="off"autocorrect="off"autocapitalize="off"spellcheck="false"role="combobox"aria-expanded="true"aria-owns="ui-select-choices-{{ $select.generatedId }}"aria-label="{{ $select.baseTitle }}"aria-activedescendant="ui-select-choices-row-{{ $select.generatedId }}-{{ $select.activeIndex }}"class="ui-select-search"ng-disabled="$select.disabled"ng-hide="$select.disabled"placeholder="Filtruj"ng-model="$select.search"ng-click="$select.activate()"></li></ul><div class="ui-select-dropdown ui-select-dropdown--active"ng-class="{\'ui-select-dropdown--with-searchbox\': $select.searchEnabled}"ng-show="$select.open"><div class="ui-select-choices"></div></div></div>'};Object.keys(b).forEach(function(c){a.put("selectize/"+c+".tpl.html",b[c])})}]),angular.module("nxt-dialog").run(["$rootScope","DialogManager",function(a,b){"use strict";a.$on("dialog:open",function(a,c){b.confirm({template:"/dialog/views/"+c.template+".html",success:c.success})})}]),angular.module("nxt-filter").run(["$rootScope","QuickFilter","Folder","DialogManager",function(a,b,c,d){"use strict";var e,f,g=function(a,c){var d={email:e};c&&(d.folderName=c,d.parentFolderId=f),d.folderId=a,d.email.length>0&&b.create(d)};a.$on("controller:filter:quickdialog",function(a,b){e=b.email,c.getFlatFoldersList().success(function(a){d.folderConfirm({title:"Dodaj filtr",message:"Przenoś wszystkie nowe wiadomości od tego nadawcy do:",confirm:"Dodaj",folders:a,additionalClasses:"addFilter",callback:function(a,b,c,d){var e;b&&(e=b.id,f=d),g(e,c)}})})}),a.$on("controller:filter:quick",function(a,b){b.folderId&&b.email&&(e=b.email,g(b.folderId))})}]),angular.module("nxt-notification").run(["ApplicationConfig","$rootScope","Notification",function(a,b,c){"use strict";b.$on("notification:error",function(a,b){c.error.call(c,b)}),b.$on("notification:info",function(a,b){c.info.call(c,b)}),b.$on("notification:success",function(a,b){c.success.call(c,b)})}]);var barcode=function(){var a={settings:{barWidth:1,barHeight:22,moduleSize:5,showHRI:!1,addQuietZone:!0,marginHRI:5,bgColor:"#FFFFFF",color:"#000000",fontSize:10,posX:0,posY:0},intval:function(a){var b=typeof a;return"string"==b?(a=a.replace(/[^0-9-.]/g,""),a=parseInt(1*a,10),isNaN(a)||!isFinite(a)?0:a):"number"==b&&isFinite(a)?Math.floor(a):0},code128:{encoding:["11011001100","11001101100","11001100110","10010011000","10010001100","10001001100","10011001000","10011000100","10001100100","11001001000","11001000100","11000100100","10110011100","10011011100","10011001110","10111001100","10011101100","10011100110","11001110010","11001011100","11001001110","11011100100","11001110100","11101101110","11101001100","11100101100","11100100110","11101100100","11100110100","11100110010","11011011000","11011000110","11000110110","10100011000","10001011000","10001000110","10110001000","10001101000","10001100010","11010001000","11000101000","11000100010","10110111000","10110001110","10001101110","10111011000","10111000110","10001110110","11101110110","11010001110","11000101110","11011101000","11011100010","11011101110","11101011000","11101000110","11100010110","11101101000","11101100010","11100011010","11101111010","11001000010","11110001010","10100110000","10100001100","10010110000","10010000110","10000101100","10000100110","10110010000","10110000100","10011010000","10011000010","10000110100","10000110010","11000010010","11001010000","11110111010","11000010100","10001111010","10100111100","10010111100","10010011110","10111100100","10011110100","10011110010","11110100100","11110010100","11110010010","11011011110","11011110110","11110110110","10101111000","10100011110","10001011110","10111101000","10111100010","11110101000","11110100010","10111011110","10111101110","11101011110","11110101110","11010000100","11010010000","11010011100","11000111010"],getDigit:function(b){var c=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",d="",e=0,f=0,g=0,h=0,i=0;for(g=0;g<b.length;g++)if(-1==c.indexOf(b.charAt(g)))return"";var j=b.length>1,k="";for(g=0;3>g&&g<b.length;g++)k=b.charAt(g),j&=k>="0"&&"9">=k;for(e=j?105:104,d=this.encoding[e],g=0;g<b.length;){if(j)(g==b.length||b.charAt(g)<"0"||b.charAt(g)>"9"||b.charAt(g+1)<"0"||b.charAt(g+1)>"9")&&(j=!1,d+=this.encoding[100],e+=100*++f);else{for(h=0;g+h<b.length&&b.charAt(g+h)>="0"&&b.charAt(g+h)<="9";)h++;j=h>5||g+h-1==b.length&&h>3,j&&(d+=this.encoding[99],e+=99*++f)}j?(i=a.intval(b.charAt(g)+b.charAt(g+1)),g+=2):(i=c.indexOf(b.charAt(g)),g+=1),d+=this.encoding[i],e+=++f*i}return d+=this.encoding[e%103],d+=this.encoding[106],d+="11"}},bitStringTo2DArray:function(a){var b=[];b[0]=[];for(var c=0;c<a.length;c++)b[0][c]=a.charAt(c);return b},digitToCssRenderer:function(a,b,c,d,e,f,g){for(var h,i,j,k=c.length,l=c[0].length,m="",n="<div class='w w%s' ></div>",o="<div class='b b%s' ></div>",p=0;k>p;p++){for(h=0,i=c[p][0],j=0;l>j;j++)i==c[p][j]?h++:(m+=("0"==i?n:o).replace("%s",h*e),i=c[p][j],h=1);h>0&&(m+=("0"==i?n:o).replace("%s",h*e))}b.showHRI&&(m+='<div style="clear:both; width: 100%; background-color: '+b.bgColor+"; color: "+b.color+"; text-align: center; font-size: "+b.fontSize+"px; margin-top: "+b.marginHRI+'px;">'+d+"</div>");var q=document.createElement("DIV");return q.innerHTML=m,q.className="barcode "+g+" clearfix-child",q},digitToCss:function(b,c,d,e,f){var g=a.intval(c.barWidth),h=a.intval(c.barHeight);return this.digitToCssRenderer(b,c,this.bitStringTo2DArray(d),e,g,h,f)}},b=function(b,c,d){var e="",f="",g="",h=!0,i=!1,j=!1;if("string"==typeof b?g=b:"object"==typeof b&&(g="string"==typeof b.code?b.code:"",h="undefined"==typeof b.crc||b.crc,i="undefined"!=typeof b.rect&&b.rect),""==g)return!1;"undefined"==typeof d&&(d=[]);for(var k in a.settings)void 0==d[k]&&(d[k]=a.settings[k]);switch(c){case"std25":case"int25":e=a.i25.getDigit(g,h,c),f=a.i25.compute(g,h,c);break;case"ean8":case"ean13":e=a.ean.getDigit(g,c),f=a.ean.compute(g,c);break;case"upc":e=a.upc.getDigit(g),f=a.upc.compute(g);break;case"code11":e=a.code11.getDigit(g),f=g;break;case"code39":e=a.code39.getDigit(g),f=g;break;case"code93":e=a.code93.getDigit(g,h),f=g;break;case"code128":e=a.code128.getDigit(g),f=g;break;case"codabar":e=a.codabar.getDigit(g),f=g;break;case"msi":e=a.msi.getDigit(g,h),f=a.msi.compute(g,h);break;case"datamatrix":e=a.datamatrix.getDigit(g,i),f=g,j=!0}if(0==e.length)return this;!j&&d.addQuietZone&&(e="0000000000"+e+"0000000000");var l="digitToCss"+(j?"2D":"");return a[l](this,d,e,f,c)};return b}();
//# sourceMappingURL=application-1513253351243.min.js.map