/*!
 * @licstart
 * Copyright (C) 2010 Moxiecode Systems AB
 * Copyright (C) 2011 INTERIA.PL sp. z o.o.
 * 
 * This file is licensed under the GNU Lesser General Public License. 
 * A copy of this license may be found at http://www.gnu.org/licenses/lgpl.html
 * @licend  
 * 
 * @source: http://o.iplsc.com/p/js/punymce/puny_mce_src.js
 */
(function(q){var o,f,u,k,b,j,v,d,l;var a,i,h,s,n,t,g,m;m=navigator.userAgent;q.isOpera=s=window.opera&&opera.buildNumber;q.isWebKit=n=/WebKit/.test(m);q.isOldWebKit=t=n&&!window.getSelection().getRangeAt;q.isPre534WebKit=g=n&&(function(){var w=(/WebKit\/([\d.]+)/).exec(m);return(w?parseFloat(w[1]):0)<534}());q.isIE=i=!n&&!s&&(/MSIE/gi).test(m)&&(/Explorer/gi).test(navigator.appName);q.isGecko=h=!n&&/Gecko/.test(m);q.hasDOM2RangeSupport=document.createRange&&"commonAncestorContainer" in document.createRange();q.plugins={};function e(x,w){x=typeof(x);if(!w){return x!="undefined"}return x==w}function c(y,w,x){var z;if(!y){return 0}x=!x?y:x;if(e(y.length)){for(z=0;z<y.length;z++){if(w.call(x,y[z],z,y)===false){return 0}}}else{for(z in y){if(y.hasOwnProperty(z)){if(w.call(x,y[z],z,y)===false){return 0}}}}return 1}function p(x,w){c(w,function(y,z){x[z]=y});return x}p(q,{is:e,each:c,extend:p});q.I18n=l={bold:"Bold (Ctrl+B)",italic:"Italic (Ctrl+I)",underline:"Underline (Ctrl+U)",strike:"Striketrough",ul:"Insert unordered list",ol:"Insert ordered list",indent:"Indent",outdent:"Outdent",left:"Align left",center:"Align center",right:"Align right",style:"Font style",removeformat:"Remove format",increasefontsize:"Increase text size",decreasefontsize:"Decrease text size"};q.DOMUtils=o=function(x){this.files=[];try{x.execCommand("BackgroundImageCache",0,1)}catch(w){}p(this,{get:function(y){return y&&(!y.nodeType&&!y.location?x.getElementById(y):y)},add:function(C,D,y,A){var z=this,B;B=x.createElement(D);c(y,function(E,F){z.setAttr(B,F,E)});if(A){if(A.nodeType){B.appendChild(A)}else{B.innerHTML=A}}return C?C.appendChild(B):B},create:function(A,y,z){return this.add(0,A,y,z)},setAttr:function(z,A,y){z=this.get(z);if(!z){return 0}if(A=="style"){z.setAttribute("mce_style",y);z.style.cssText=y}if(A=="class"){z.className=y}if(y!=null&&y!=""){z.setAttribute(A,""+y)}else{z.removeAttribute(A)}return 1},getAttr:function(A,B,z){var y;A=this.get(A);if(!A){return false}if(!e(z)){z=""}if(/^(src|href|style)$/.test(B)){y=this.getAttr(A,"mce_"+B);if(y){return y}}y=A.getAttribute(B,2);if(B=="class"&&!y){y=A.className}if(B=="style"&&!y){y=A.style.cssText}else{if(!y){y=A.attributes[B];y=y&&e(y.nodeValue)?y.nodeValue:y}}if(n&&B=="class"&&y){y=y.replace(/(apple|webkit)\-[a-z\-]+/gi,"")}return(y&&y!="")?""+y:z},select:function(y,B,z){var A=[];B=this.get(B);B=!B?x:B;c(y.split(","),function(C){c(B.getElementsByTagName(C),function(D){if(!z||z(D)){A.push(D)}})});return A},getPos:function(E,D){var y=0,z=0,B,A,C;E=this.get(E);if(q.isIE&&E){A=E.getBoundingClientRect();C=document;E=C.compatMode=="CSS1Compat"?C.documentElement:C.body;return{x:A.left+(E.scrollLeft||0),y:A.top+(E.scrollTop||0)}}while(E&&E!=D){y+=E.offsetLeft||0;z+=E.offsetTop||0;E=E.offsetParent}return{x:y,y:z}},loadCSS:function(y){var z=this;if(y){c(y.split(","),function(B){var A=-1;c(z.files,function(D,C){if(D==B){A=C;return false}});if(A!=-1){return}z.files.push(B);if(!x.createStyleSheet){z.add(z.select("head")[0],"link",{rel:"stylesheet",href:B})}else{x.createStyleSheet(B)}})}},addClass:function(z,B,y){var A;z=this.get(z);if(!z){return 0}A=this.removeClass(z,B);return z.className=y?B+(A!=""?(" "+A):""):(A!=""?(A+" "):"")+B},removeClass:function(y,z){y=this.get(y);if(!y){return 0}z=y.className.replace(new RegExp("(^|\\s+)"+z+"(\\s+|$)","g")," ");return y.className=z!=" "?z:""},hasClass:function(z,y){z=this.get(z);return new RegExp("\\b"+y+"\\b","g").test(z.className)},getParent:function(A,z,y){while(A){if(A==y){return null}if(z(A)){return A}A=A.parentNode}return null},keep:function(y){if(h){y=y.replace(/<(\/?)strong>|<strong( [^>]+)>/gi,"<$1b$2>");y=y.replace(/<(\/?)em>|<em( [^>]+)>/gi,"<$1i$2>");y=y.replace(/<(\/?)del|<del( [^>]+)>/gi,"<$1strike$2>")}y=y.replace(/ (src|href|style)=\"([^\"]+)\"/gi,' $1="$2" mce_$1="$2"');return y}})};q.DOM=a=new o(document);q.Event=v={events:[],inits:[],unloads:[],add:function(B,C,A,z){var w,x=this,y=x.events;B=a.get(B);w=function(D){D=D||window.event;if(D&&!D.target&&i){D.target=D.srcElement}if(!z){return A(D)}return A.call(z,D)};if(C=="unload"){x.unloads.push(w);return w}if(C=="init"){if(x._init){w()}else{x.inits.push(w)}return w}y.push({obj:B,name:C,func:A,cfunc:w,scope:z});x._add(B,C,w);if(i&&y.length==1){v._add(window,"unload",x._unload,v)}return w},remove:function(z,A,y){var x=this,w=x.events;z=a.get(z);c(w,function(C,B){if(C.obj==z&&C.name==A&&(!y||C.func==y)){w.splice(B,1);x._remove(z,A,C.cfunc);return false}})},cancel:function(w){this.stop(w);return this.prevent(w)},stop:function(w){if(w.stopPropagation){w.stopPropagation()}else{w.cancelBubble=true}return false},prevent:function(w){if(w.preventDefault){w.preventDefault()}else{w.returnValue=false}return false},_unload:function(){var w=v;c(w.events,function(x){w._remove(x.obj,x.name,x.cfunc)});w._remove(window,"unload",w._unload);w.events=[];c(w.unloads,function(x){x()})},_add:function(x,y,w){if(x.attachEvent){x.attachEvent("on"+y,w)}else{if(x.addEventListener){x.addEventListener(y,w,false)}else{x["on"+y]=w}}},_remove:function(x,y,w){if(x.detachEvent){x.detachEvent("on"+y,w)}else{if(x.removeEventListener){x.removeEventListener(y,w,false)}else{x["on"+y]=null}}},_pageInit:function(){var w=v;w._remove(window,"DOMContentLoaded",w._pageInit);w._init=true;c(w.inits,function(x){x()});w.inits=[]},_wait:function(){var w;if(i&&document.location.protocol!="https:"){document.write("<script id=__ie_onload defer src=javascript:void(0)><\/script>");a.get("__ie_onload").onreadystatechange=function(){if(this.readyState=="complete"){v._pageInit();a.get("__ie_onload").onreadystatechange=null}}}else{v._add(window,"DOMContentLoaded",v._pageInit,v);if(i||n){w=setInterval(function(){if(/loaded|complete/.test(document.readyState)){clearInterval(w);v._pageInit()}},10)}}}};q.Dispatcher=j=function(w){var x=[];if(!w){w=this}p(this,{add:function(y,z){x.push({cb:y,scope:!z?w:z});return y},remove:function(y){c(x,function(A,z){if(y==A.cb){x.splice(z,1)}return false});return y},dispatch:function(){var z,y=arguments;c(x,function(A){return z=A.cb.apply(A.scope,y)});return z}})};q.Editor=k=function(D){var A,B,y=this;if(!q.baseURL){c(a.select("script"),function(E){if(/puny_mce/g.test(""+E.src)){q.baseURL=E.src.replace(/^(.+)\/puny_mce.+$/,"$1/")}})}this.settings=A=p({content_css:q.baseURL+"/css/content.css",editor_css:q.baseURL+"/css/editor.css",width:0,height:0,min_width:260,min_height:50,max_width:800,max_height:600,entities:"raw",spellcheck:0,resize:true,plugins:"",styles:[{title:"H1",cls:"h1",cmd:"FormatBlock",val:"<h1>"},{title:"H2",cls:"h2",cmd:"FormatBlock",val:"<h2>"},{title:"H3",cls:"h3",cmd:"FormatBlock",val:"<h3>"},{title:"Pre",cls:"pre",cmd:"FormatBlock",val:"<pre>"},{title:"Times",cls:"times",cmd:"FontName",val:"Times"},{title:"Arial",cls:"arial",cmd:"FontName",val:"Arial"},{title:"Courier",cls:"courier",cmd:"FontName",val:"Courier"}],toolbar:"bold,italic,underline,strike,increasefontsize,decreasefontsize,ul,ol,indent,outdent,left,center,right,style,removeformat"},D);y.tools={bold:{cmd:"Bold",title:l.bold},italic:{cmd:"Italic",title:l.italic},underline:{cmd:"Underline",title:l.underline},strike:{cmd:"Strikethrough",title:l.strike},ul:{cmd:"InsertUnorderedList",title:l.ul},ol:{cmd:"InsertOrderedList",title:l.ol},indent:{cmd:"Indent",title:l.indent},outdent:{cmd:"Outdent",title:l.outdent},left:{cmd:"JustifyLeft",title:l.left},center:{cmd:"JustifyCenter",title:l.center},right:{cmd:"JustifyRight",title:l.right},style:{cmd:"mceStyle",title:l.style},removeformat:{cmd:"RemoveFormat",title:l.removeformat},increasefontsize:{cmd:"IncreaseFontSize",title:l.increasefontsize},decreasefontsize:{cmd:"DecreaseFontSize",title:l.decreasefontsize}};a.loadCSS(A.editor_css);this.commands={mceStyle:function(L,K,J){var G,M=this,N=M.settings,E=N.id,F=a.getPos(J.target),H;if(M.hideMenu){return M.hideMenu()}function I(O){M.hideMenu=null;v.remove(document,"click",I);v.remove(M.getDoc(),"click",I);a.get(E+"_mstyle").style.display="none"}G=a.get(E+"_mstyle");if(!G){G=a.get(E+"_t");G=a.add(document.body,"div",{id:E+"_mstyle","class":"punymce_style punymce"});c(N.styles,function(O){v.add(a.add(G,"a",{href:"#","class":O.cls},O.title),"mousedown",function(P){I.call(M);M.execCommand(O.cmd,O.ui,O.val);if(s){M.getIfr().focus()}return v.cancel(P)})})}M.hideMenu=I;v.add(document,"click",I,M);v.add(M.getDoc(),"click",I,M);N=G.style;N.left=F.x+"px";N.top=(F.y+J.target.clientHeight+2)+"px";N.display="block"},FormatBlock:function(F,E,G){if(h&&/<(div|blockquote|code|dt|dd|dl|samp)>/gi.test(E)){E=E.replace(/[^a-z]/gi,"")}y.getDoc().execCommand("FormatBlock",0,E)},CreateLink:function(G,F){var H=y.dom,E="javascript:mox();";y.getDoc().execCommand("CreateLink",0,E);c(H.select("A"),function(I){if(H.getAttr(I,"href")==E){H.setAttr(I,"href",F);H.setAttr(I,"mce_href",F)}})},mceFontSizeDelta:function(G,F){var K=y.getDoc(),E,J,H,I=y.selection;E=parseInt(K.queryCommandValue("FontSize")||3);if(n){c([10,13,16,18,24,32,48],function(M,L){if(E==M){E=L+1;return false}})}if(E+F<=1){return}K.execCommand("FontSize",false,E+F)},IncreaseFontSize:function(){y.execCommand("mceFontSizeDelta",0,1)},DecreaseFontSize:function(){y.execCommand("mceFontSizeDelta",0,-1)},Indent:function(F,E,G){y.getDoc().execCommand("Indent",0,0);if(i){y.dom.getParent(y.selection.getNode(),function(H){if(H.nodeName=="BLOCKQUOTE"){H.dir=H.style.marginRight=""}})}},mceSetClass:function(F,E,H){var G=y.selection;if(e(E,"string")){E={element:"span","class":E}}if(G.isCollapsed()){y.dom.setAttr(G.getNode(),"class",E["class"])}else{G.setContent("<"+E.element+' class="'+E["class"]+'">'+G.getContent()+"</"+E.element+">")}},RemoveFormat:function(F,E,H){var G=y.selection;y.getDoc().execCommand("RemoveFormat",F,E);if(i){E=G.getContent();E=E.replace(/ (class|style)=\"[^\"]+\"/g,"");E=E.replace(/<\/?(font|strong|em|b|i|u|strike)>/g,"");E=E.replace(/<(font|strong|em|b|i|u|strike) [^>]+>/g,"");G.setContent(E)}}};function z(H){var I,G,E,F;I=a.get(A.id+"_c");E=I.clientWidth-2;F=I.clientHeight-2;G=a.get(A.id+"_p");G.style.width=E+"px";G.style.height=F+"px";I.style.display="none";G.style.display="block";y.resize={x:H.screenX,y:H.screenY,w:E,h:F};v.add(document,"mousemove",x,this);v.add(document,"mouseup",C,this);y.onResizeStart.dispatch(y,H,E,F)}function x(I){var G=y.resize,H,E,F;G.dx=I.screenX-G.x;G.dy=I.screenY-G.y;E=Math.max(A.min_width,G.w+G.dx);F=Math.max(A.min_height,G.h+G.dy);E=Math.min(A.max_width,E);F=Math.min(A.max_height,F);H=a.get(A.id+"_p");H.style.width=E+"px";H.style.height=F+"px";return v.cancel(I)}function C(F){var E=y.resize;v.remove(document,"mousemove",x,this);v.remove(document,"mouseup",C,this);a.get(A.id+"_c").style.display="";a.get(A.id+"_p").style.display="none";y.resizeBy(E.dx,E.dy);y.onResizeEnd.dispatch(y,F,E.dx,E.dy)}function w(){var E=a.get(A.id),F=y.getDoc();if(h){y.getDoc().designMode="On"}F.open();F.write('<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /></head><body id="punymce"></body></html>');F.close();y.dom=B=new o(y.getDoc());B.loadCSS(A.content_css);y.onPreInit.dispatch(y);if(!A.spellcheck){y.getBody().spellcheck=0}v.add(y.getDoc(),"mouseup",y.nodeChanged,y);v.add(y.getDoc(),"keyup",y.nodeChanged,y);v.add(h?y.getDoc():y.getWin(),"focus",function(H){var G;if((G=q.focusEditor)!=null){G.onBlur.dispatch(G,y)}y.onFocus.dispatch(y,G);q.focusEditor=y},this);if(!i){y.getDoc().designMode="On"}else{y.getBody().contentEditable=true}y.setContent(e(E.value)?E.value:E.innerHTML,{load:true});a.get(A.id+"_c").style.display=y.orgDisplay;a.get(A.id).style.display="none";y.onInit.dispatch(y)}p(this,{serializer:new d(y),selection:new b(y),plugins:[]});c(["onPreInit","onInit","onFocus","onBlur","onResizeStart","onResizeEnd","onPreProcess","onPostProcess","onSetContent","onBeforeGetContent","onGetContent","onNodeChange"],function(E){y[E]=new j(y)});p(this,{init:function(){var J=a.get(A.id),L=J.parentNode,N,H,M,K,F,E,I,G=["bold","italic","underline","left","center","right"];c(A.plugins.split(","),function(O){if(O){y.plugins.push(new q.plugins[O](y))}});y.onNodeChange.add(function(){c(G,function(Q){var P;try{P=y.getDoc().queryCommandState(y.tools[Q].cmd)?a.addClass:a.removeClass;P.call(a,A.id+"_"+Q,"active")}catch(O){}})});if(A.entities=="numeric"){y.onGetContent.add(function(O,P){if(P.format=="html"){P.content=P.content.replace(/[\u007E-\uFFFF]/g,function(Q){return"&#"+Q.charCodeAt(0)+";"})}})}N=!A.width?J.offsetWidth:A.width;H=!A.height?J.offsetHeight:A.height;y.orgDisplay=J.style.display;J.style.display="none";if(J.form){I=J.form;y._submit=I.submit;I.submit=function(){var P=a.get(A.id),O=P.form;y.save();O.submit=y._submit;O.submit()};v.add(0,"unload",function(){var O=a.get(A.id).form;y._submit=y.submit=null});v.add(I,"submit",y.save,y)}M='<div id="'+A.id+'_w" class="punymce"><table id="'+A.id+'_c" class="punymce"><tr class="mceToolbar">';M+='<td id="'+A.id+'_t"></td></tr><tr class="mceBody"><td></div><div id="'+A.id+'_b" class="mceBody">';if(A.resize){M+='<div id="'+A.id+'_r" class="mceResize"></div>'}M+="</td></tr></table>";M+='<div id="'+A.id+'_p" class="mcePlaceholder"></div></div>';if(!J.insertAdjacentHTML){E=J.ownerDocument.createRange();E.setStartBefore(J);L.insertBefore(E.createContextualFragment(M),J)}else{J.insertAdjacentHTML("beforeBegin",M)}F=a.get(A.id+"_t");K=a.add(F,"ul",{id:A.id+"_tb","class":"punymce"});c(A.toolbar.split(","),function(O){var P=y.tools[O];F=a.add(a.add(K,"li",{id:A.id+"_"+O,"class":O}),"a",{href:"javascript:void(0);","class":O,title:P.title,tabIndex:-1,onmousedown:"return false;"});v.add(F,"click",function(Q){if(!a.hasClass(Q.target.parentNode,"disabled")){y.execCommand(P.cmd,0,0,Q)}return v.cancel(Q)})});F=a.get(A.id+"_b");F=a.add(F,"iframe",{id:A.id+"_f",src:'javascript:""',frameBorder:"0","class":"punymce",style:"width:"+N+"px;height:"+H+"px"});y.resizeTo(N,H);if(g){v.add(F,"load",w,y);F.src="/blank.html"}else{w()}if(A.resize){v.add(A.id+"_r","mousedown",function(O){return z(O,A.id)},this)}K=I=J=F=null},getSize:function(){var E=a.get(A.id+"_f");return{w:E.clientWidth,h:E.clientHeight}},resizeTo:function(E,G){var F=a.get(A.id+"_f").style;E=Math.max(A.min_width,E);G=Math.max(A.min_height,G);E=Math.min(A.max_width,E);G=Math.min(A.max_height,G);y.width=E;y.height=G;F.width=E+"px";F.height=G+"px"},resizeBy:function(E,F){var G=y.getSize();y.resizeTo(G.w+E,G.h+F)},show:function(){a.get(A.id+"_w").style.display="block";a.get(A.id).style.display="none";y.load()},hide:function(){if(i){y.execCommand("SelectAll")}a.get(A.id+"_w").style.display="none";a.get(A.id).style.display=y.orgDisplay;y.save()},load:function(){var E=a.get(A.id);y.setContent(e(E.value)?E.value:E.innerHTML,{load:true})},save:function(){var F=a.get(A.id),E=y.getContent({save:true});E=E.replace(/<(\/?)html(\/?)>/gi,"");if(/TEXTAREA|INPUT/.test(F.nodeName)){F.value=E}else{F.innerHTML=E}},setUseCSS:function(E){var G=y.getDoc(),F;try{G.execCommand("styleWithCSS",0,false)}catch(F){try{G.execCommand("useCSS",0,true)}catch(F){}}},execCommand:function(J,G,F,I){var E=y.commands,H;y.getWin().focus();y.setUseCSS(0);if(E[J]){H=E[J].call(y,G,F,I)}else{H=y.getDoc().execCommand(J,G,F)}if(H!==false){y.nodeChanged()}},getContent:function(F){var E;F=F||{};F.format=F.format||"html";y.onBeforeGetContent.dispatch(this,F);E=y.serializer.serialize(y.getBody(),F);E=E.replace(/^\s*|\s*$/g,"");F.content=E;y.onGetContent.dispatch(this,F);return F.content},setContent:function(E,F){F=F||{};F.content=E;y.onSetContent.dispatch(this,F);E=F.content;E=a.keep(E);y.getBody().innerHTML=E;if(F.format!="raw"){y.setContent(E=y.getContent(F),{format:"raw"})}else{y.getBody().innerHTML=E}return E},getIfr:function(){return a.get(A.id+"_f")},getWin:function(){return y.getIfr().contentWindow},getDoc:function(){return y.getWin().document},getBody:function(){return y.getDoc().body},nodeChanged:function(){y.setUseCSS(0);y.onNodeChange.dispatch(y,y.selection.getNode())}});v.add(window,"init",y.init,this)};q.Selection=b=function(w){var x=this;p(x,{getContent:function(B){var y,z=x.getRng(),A=document.createElement("body");B=B||{};if(x.isCollapsed()){return""}if(z.cloneContents){A.appendChild(z.cloneContents())}else{if(e(z.item)||e(z.htmlText)){A.innerHTML=z.item?z.item(0).outerHTML:z.htmlText}else{A.innerHTML=z.toString()}}if(B.format!="raw"){B.content=y;w.serializer.serialize(A,B);B.content=B.content.replace(/^\s*|\s*$/g,"");w.onGetContent.dispatch(y,B);y=B.content}else{y=A.innerHTML}return y},getText:function(){var z=x.getRng(),y=x.getSel();if(t){return y}return x.isCollapsed()?"":z.text||y.toString()},createContextualFragment:function(B,y,A){var D,z=B.createElement("div"),C=B.createDocumentFragment();if(B.ownerDocument){B=B.ownerDocument}z.innerHTML=A;while(z.hasChildNodes()){D=z.firstChild;z.removeChild(D);C.appendChild(D)}z=null;return C},setContent:function(A,C){var B=x.getRng(),y,D,B,z;C=C||{format:"raw"};A=a.keep(A);if(C.format!="raw"){C.content=A;A=w.onSetContent.dispatch(this,C);A=C.content;y=w.dom.create("body");y.innerHTML=A}if(B.insertNode){B.deleteContents();B.insertNode(this.createContextualFragment(w.getDoc(),B,A+'<span id="__caret">_</span>'));D=w.dom.get("__caret");B=w.getDoc().createRange();B.setStartBefore(D);B.setEndBefore(D);z=x.getSel();z.removeAllRanges();z.addRange(B);D.parentNode.removeChild(D)}else{if(B.pasteHTML){B.pasteHTML(A)}else{B.item(0).outerHTML=A}}},select:function(C,B){var A=x.getRng(),z=x.getSel();if(A.moveToElementText){try{A.moveToElementText(C);A.select()}catch(y){}}else{if(z.addRange){B?A.selectNodeContents(C):A.selectNode(C);z.removeAllRanges();z.addRange(A)}else{z.setBaseAndExtent(C,0,C,1)}}return C},isCollapsed:function(){var y=x.getRng();if(y.item){return false}return y.boundingWidth==0||x.getSel().isCollapsed},collapse:function(y){var A=x.getRng(),z=x.getSel();if(A.select){A.collapse(y);A.select()}else{if(y){z.collapseToStart()}else{z.collapseToEnd()}}},getSel:function(){var y=w.getWin();return y.getSelection?y.getSelection():w.getDoc().selection},getRng:function(){var y=x.getSel(),E=w.getDoc(),A,C,D,z;if(!y){return null}try{return y.rangeCount>0?y.getRangeAt(0):(y.createRange?y.createRange():null)}catch(B){return E.body.createTextRange()}},setRng:function(z){var y=x.getSel();y.removeAllRanges();y.addRange(z)},setNode:function(y){x.setContent(w.dom.create("div",null,y).innerHTML)},getNode:function(){var z=x.getRng(),y=x.getSel(),A;if(q.hasDOM2RangeSupport){if(z){A=z.commonAncestorContainer;if(!z.collapsed){if(z.startContainer==z.endContainer){if(z.startOffset-z.endOffset<2){if(z.startContainer.hasChildNodes()){A=z.startContainer.childNodes[z.startOffset]}}}}}return a.getParent(A,function(B){return B.nodeType==1})}return z.item?z.item(0):z.parentElement()}})};q.Serializer=d=function(x){var z,A=0,B;function y(){var D=document.implementation;if(!D||!D.createDocument){try{return new ActiveXObject("MSXML2.DOMDocument")}catch(C){}try{return new ActiveXObject("Microsoft.XmlDom")}catch(C){}}else{return D.createDocument("","",null)}}z=y();this.settings=B=p({valid_nodes:0,invalid_nodes:/(BODY)/,valid_attrs:0,node_filter:0,root_node:0,pi:0,invalid_attrs:/(^mce_|^_moz_|^contenteditable$)/,closed:/(BR|HR|INPUT|META|IMG)/},x.settings.serializer);function w(E,H){var I,C,J,G,F,K,D,M,L;if((!B.valid_nodes||B.valid_nodes.test(E.nodeName))&&(!B.invalid_nodes||!B.invalid_nodes.test(E.nodeName))&&(!B.node_filter||B.node_filter(E,H))){switch(E.nodeType){case 1:if(i){if(E.mce_serialized==A){return}E.mce_serialized=A}I=E.hasChildNodes();C=z.createElement(E.nodeName.toLowerCase());D=E.attributes;for(G=D.length-1;G>-1;G--){M=D[G];if(M.specified){K=M.nodeName.toLowerCase();if(B.invalid_attrs&&B.invalid_attrs.test(K)){continue}if(B.valid_attrs&&!B.valid_attrs.test(K)){continue}L=a.getAttr(E,K);if(L!==""){C.setAttribute(K,L)}}}if(!I&&!B.closed.test(E.nodeName)){C.appendChild(z.createTextNode(""))}H=H.appendChild(C);break;case 3:return H.appendChild(z.createTextNode(E.nodeValue));case 8:return H.appendChild(z.createComment(E.nodeValue))}}else{if(E.nodeType==1){I=E.hasChildNodes()}}if(I){J=E.firstChild;while(J){w(J,H);J=J.nextSibling}}}p(this,{serialize:function(E,D){var C;A=""+(parseInt(A)+1);if(z.firstChild){z.removeChild(z.firstChild)}E=D.node=E.cloneNode(1);x.onPreProcess.dispatch(this,D);w(E,z.appendChild(z.createElement("html")));C=z.xml||new XMLSerializer().serializeToString(z);if(!B.pi){C=C.replace(/<\?[^?]+\?>/g,"")}if(!B.root_node){C=C.replace(/<html>|<\/html>/g,"")}D.content=C;x.onPostProcess.dispatch(this,D);return D.content}})};v._wait();window.punymce=q})({});(function(a){a.plugins.EditSource=function(c){var d=a.DOM,g=a.extend,f=a.each,e=a.isWebKit;var b=0;if(!c.settings.editsource||c.settings.editsource.skip_css){d.loadCSS(a.baseURL+"/plugins/editsource/css/editor.css")}c.onBeforeGetContent.add(function(h,i){if(i.save&&b){h.setContent(d.get(h.settings.id+"_editsourcearea").value,{load:true})}});g(c.commands,{mceEditSource:function(s,q,o){var k,j=c.getIfr(),i=c.settings.id,p=c.width,l=c.height,n,m=d.get(i+"_editsource");if(!b){d.addClass(m,"active");f(d.select("li",i+"_c"),function(h){if(h!=m){d.addClass(h,"disabled")}});k=d.add(j.parentNode,"textarea",{id:i+"_editsourcearea","class":"editsource",style:"width:"+p+"px;height:"+l+"px;"});k.value=c.getContent({save:true});k.focus();if(!e){d.add(j.parentNode,"div",{id:i+"_edspacer","class":"spacer",style:"width:"+p+"px;height:"+l+"px;"});j.style.display="none"}b=1;return false}b=0;d.removeClass(m,"active");if(!e){j.style.display="block";k=d.get(i+"_edspacer");k.parentNode.removeChild(k)}k=d.get(i+"_editsourcearea");c.setContent(k.value,{load:true});k.parentNode.removeChild(k);f(d.select("li",i+"_c"),function(h){d.removeClass(h,"disabled")});return false}});g(c.tools,{editsource:{cmd:"mceEditSource",title:a.I18n.editsource}})};a.extend(a.I18n,{editsource:"Edit HTML source"})})(punymce);(function(a){a.plugins.Image=function(b){var c=a.I18n;if(!b.settings.image||b.settings.image.skip_css){a.DOM.loadCSS(a.baseURL+"/plugins/image/css/editor.css")}a.extend(b.commands,{mceInsertImage:function(h,g,j){var d,i=b.selection.getNode();d=prompt(c.entersrc,i.nodeName=="IMG"?b.dom.getAttr(i,"src"):"");if(d){b.selection.setNode(b.dom.create("img",{src:d}))}}});a.extend(b.tools,{image:{cmd:"mceInsertImage",title:c.insertimage}})};a.extend(a.I18n,{insertimage:"Insert image",entersrc:"Enter the URL of the image"})})(punymce);(function(a){a.plugins.Link=function(b){var c=a.I18n;if(!b.settings.link||b.settings.link.skip_css){a.DOM.loadCSS(a.baseURL+"/plugins/link/css/editor.css")}a.extend(b.commands,{mceInsertLink:function(h,g,j){var d,i=b.selection.getNode();d=prompt(c.enterhref,i.nodeName=="A"?b.dom.getAttr(i,"href"):"");if(d){if(b.selection.isCollapsed()){b.selection.setContent('<a href="'+d+'">'+d+"</a>")}else{b.execCommand("CreateLink",0,d)}}}});a.extend(b.tools,{link:{cmd:"mceInsertLink",title:c.link},unlink:{cmd:"Unlink",title:c.unlink}})};a.extend(a.I18n,{link:"Insert link",unlink:"Unlink",enterhref:"Enter the URL of the link"})})(punymce);(function(a){a.plugins.TextColor=function(d){var c="000000,993300,333300,003300,003366,000080,333399,333333,800000,FF6600,808000,008000,008080,0000FF,666699,808080,FF0000,FF9900,99CC00,339966,33CCCC,3366FF,800080,999999,FF00FF,FFCC00,FFFF00,00FF00,00FFFF,00CCFF,993366,C0C0C0,FF99CC,FFCC99,FFFF99,CCFFCC,CCFFFF,99CCFF,CC99FF,FFFFFF";var f=a.DOM,b=a.Event,g=a.each,h=a.extend,e;if(!d.settings.textcolor||d.settings.textcolor.skip_css){f.loadCSS(a.baseURL+"/plugins/textcolor/css/editor.css")}e=h({colors:c},d.settings.textcolor);h(d.commands,{mceColor:function(w,s,o){var k,x=this,i=d.settings.id,j=f.getPos(o.target),q,l;if(d.hideMenu){return d.hideMenu()}function m(n){d.hideMenu=null;b.remove(document,"click",m);b.remove(d.getDoc(),"click",m);f.get(i+"_mcolor").style.display="none";return 1}k=f.get(i+"_mcolor");if(!k){k=f.get(i+"_t");k=f.add(document.body,"div",{id:i+"_mcolor","class":"punymce_color punymce"});k=f.add(k,"table",{"class":"punymce"});k=f.add(k,"tbody");q=8;g(e.colors.split(","),function(n){if(q==8){r=f.add(k,"tr");q=0}q++;b.add(f.add(f.add(r,"td"),"a",{href:"#",style:"background:#"+n}),"mousedown",function(p){m.call(x);d.execCommand("forecolor",0,"#"+n);return b.cancel(p)})})}b.add(document,"click",m,x);b.add(d.getDoc(),"click",m,x);d.hideMenu=m;e=f.get(i+"_mcolor").style;e.left=j.x+"px";e.top=(j.y+o.target.clientHeight+2)+"px";e.display="block"}});h(d.tools,{textcolor:{cmd:"mceColor",title:a.I18n.textcolor}})};a.extend(a.I18n,{textcolor:"Text color"})})(punymce);(function(a){a.plugins.Entities=function(e){var j,c,h="",b={},f,d,g;j=e.settings;j.entities="named";g=j.entity_list;if(!g){g="160,nbsp,161,iexcl,162,cent,163,pound,164,curren,165,yen,166,brvbar,167,sect,168,uml,169,copy,170,ordf,171,laquo,172,not,173,shy,174,reg,175,macr,176,deg,177,plusmn,178,sup2,179,sup3,180,acute,181,micro,182,para,183,middot,184,cedil,185,sup1,186,ordm,187,raquo,188,frac14,189,frac12,190,frac34,191,iquest,192,Agrave,193,Aacute,194,Acirc,195,Atilde,196,Auml,197,Aring,198,AElig,199,Ccedil,200,Egrave,201,Eacute,202,Ecirc,203,Euml,204,Igrave,205,Iacute,206,Icirc,207,Iuml,208,ETH,209,Ntilde,210,Ograve,211,Oacute,212,Ocirc,213,Otilde,214,Ouml,215,times,216,Oslash,217,Ugrave,218,Uacute,219,Ucirc,220,Uuml,221,Yacute,222,THORN,223,szlig,224,agrave,225,aacute,226,acirc,227,atilde,228,auml,229,aring,230,aelig,231,ccedil,232,egrave,233,eacute,234,ecirc,235,euml,236,igrave,237,iacute,238,icirc,239,iuml,240,eth,241,ntilde,242,ograve,243,oacute,244,ocirc,245,otilde,246,ouml,247,divide,248,oslash,249,ugrave,250,uacute,251,ucirc,252,uuml,253,yacute,254,thorn,255,yuml,402,fnof,913,Alpha,914,Beta,915,Gamma,916,Delta,917,Epsilon,918,Zeta,919,Eta,920,Theta,921,Iota,922,Kappa,923,Lambda,924,Mu,925,Nu,926,Xi,927,Omicron,928,Pi,929,Rho,931,Sigma,932,Tau,933,Upsilon,934,Phi,935,Chi,936,Psi,937,Omega,945,alpha,946,beta,947,gamma,948,delta,949,epsilon,950,zeta,951,eta,952,theta,953,iota,954,kappa,955,lambda,956,mu,957,nu,958,xi,959,omicron,960,pi,961,rho,962,sigmaf,963,sigma,964,tau,965,upsilon,966,phi,967,chi,968,psi,969,omega,977,thetasym,978,upsih,982,piv,8226,bull,8230,hellip,8242,prime,8243,Prime,8254,oline,8260,frasl,8472,weierp,8465,image,8476,real,8482,trade,8501,alefsym,8592,larr,8593,uarr,8594,rarr,8595,darr,8596,harr,8629,crarr,8656,lArr,8657,uArr,8658,rArr,8659,dArr,8660,hArr,8704,forall,8706,part,8707,exist,8709,empty,8711,nabla,8712,isin,8713,notin,8715,ni,8719,prod,8721,sum,8722,minus,8727,lowast,8730,radic,8733,prop,8734,infin,8736,ang,8743,and,8744,or,8745,cap,8746,cup,8747,int,8756,there4,8764,sim,8773,cong,8776,asymp,8800,ne,8801,equiv,8804,le,8805,ge,8834,sub,8835,sup,8836,nsub,8838,sube,8839,supe,8853,oplus,8855,otimes,8869,perp,8901,sdot,8968,lceil,8969,rceil,8970,lfloor,8971,rfloor,9001,lang,9002,rang,9674,loz,9824,spades,9827,clubs,9829,hearts,9830,diams,338,OElig,339,oelig,352,Scaron,353,scaron,376,Yuml,710,circ,732,tilde,8194,ensp,8195,emsp,8201,thinsp,8204,zwnj,8205,zwj,8206,lrm,8207,rlm,8211,ndash,8212,mdash,8216,lsquo,8217,rsquo,8218,sbquo,8220,ldquo,8221,rdquo,8222,bdquo,8224,dagger,8225,Dagger,8240,permil,8249,lsaquo,8250,rsaquo,8364,euro"}c=g.split(",");for(f=0;f<c.length;f+=2){b[String.fromCharCode(c[f])]=c[f+1];d=parseInt(c[f]).toString(16);h+="\\u"+"0000".substring(d.length)+d}h=new RegExp("["+h+"]","g");e.onGetContent.add(function(i,k){if(k.format=="html"){k.content=k.content.replace(h,function(l){var m;if(m=b[l]){l="&"+m+";"}return l})}})}})(punymce);(function(b){var a=b.Event;function c(h,f){var g,e;g=f.parentNode;e=f.nextSibling;if(e){g.insertBefore(h,e)}else{g.appendChild(h)}return h}function d(g,i,h){var e,f=g.getDoc().createTreeWalker(i,NodeFilter.SHOW_TEXT,null,false);if(h){return f.nextNode()}while(e=f.nextNode()){i=e}return i}b.plugins.Paste=function(f){var i=b.DOM,g;f.onPaste=new b.Dispatcher(f);function h(t){var u,s=[],m,q,l=f.selection,k,n,p,j,o;f.getWin().focus();if(g){r=f.selection.getRng();r.moveToBookmark(g);r.select()}u=t.split(/\r?\n/);if(u.length>1){t="";b.each(u,function(v){t+="<p>"+v+"</p>"});if(!b.isIE){f.execCommand("Delete");l.setContent('<span id="marker"></span>');m=f.dom.getParent(f.dom.get("marker").parentNode,function(v){s.push(v);if(/^(p|h[1-6]|div)$/i.test(v.nodeName)){return true}});if(m){f.onPaste.dispatch({text:t});k=n="";for(p=0;p<s.length;p++){k+="</"+s[p].nodeName.toLowerCase()+">"}for(p=s.length-1;p>=0;p--){n+="<"+s[p].nodeName.toLowerCase()+">"}t=k+t+n+'<span id="_caret">&nbsp;</span>';f.getBody().innerHTML=f.getBody().innerHTML.replace(/<span id=\"marker\"><\/span>/gi,t);q=f.dom.get("_caret");if(!b.isGecko){q.scrollIntoView()}j=f.getDoc().createRange();j.setStartBefore(q);j.setEndAfter(q);l.setRng(j);f.execCommand("Delete");return}else{o=f.dom.get("marker");o.parentNode.removeChild(o)}}}f.selection.setContent(t);f.onPaste.dispatch({text:t})}function e(p){var q,k,m=f.selection,l=m.getSel(),o,j=f.getBody();q=f.dom.add(j,"div",{id:"_mcePaste",style:"position:absolute;left:-10000px;top:"+j.scrollTop},"&nbsp;");o=m.getRng();q=q.firstChild;k=f.getDoc().createRange();k.setStart(q,0);k.setEnd(q,1);l.removeAllRanges();l.addRange(k);window.setTimeout(function(){var t=f.dom.get("_mcePaste"),s;s=t.innerHTML;t.parentNode.removeChild(t);if(o){m.setRng(o)}h(s.replace(/[\r\n]/g,"").replace(/<(\/p|br\s*\/?)>/g,"\n").replace(/<!--.*?-->/g,"").replace(/<[^>]+>/g,""))},0)}f.onInit.add(function(){if(b.isOpera){return}if(/Firefox\/2/.test(navigator.userAgent)){a.add(f.getDoc(),"keydown",function(j){if(((j.metaKey||j.ctrlKey)&&j.keyCode==86)||(j.shiftKey&&j.keyCode==45)){if(b.isIE){g=f.selection.getRng().getBookmark()}e(j)}},this)}else{a.add(b.isIE?f.getBody():f.getDoc(),"paste",function(j){var k;if(f.getWin().clipboardData){h(f.getWin().clipboardData.getData("Text"));return a.cancel(j)}if(j.clipboardData){h(j.clipboardData.getData("text/plain"));return a.cancel(j)}e(j)})}})}})(punymce);(function(a){a.plugins.ForceBlocks=function(d){var w=a.Event,u,g=this;var n,k,v,q;var c,s,p;n=a.isIE;k=a.isGecko;v=a.isOpera;q=a.isWebKit;c=a.each;s=a.extend;this.settings=p=s({element:"P"},d.settings.forceblocks);d.onPreInit.add(m,g);if(!n){d.onSetContent.add(function(t,x){if(x.format=="html"){x.content=x.content.replace(/<p>[\s\u00a0]+<\/p>/g,"<p><br /></p>")}})}d.onPostProcess.add(function(t,x){x.content=x.content.replace(/<p><\/p>/g,"<p>\u00a0</p>")});function m(){u=d.dom;w.add(d.getDoc(),"keyup",j);d.onSetContent.add(j);d.onBeforeGetContent.add(j);if(!n){d.onPreProcess.add(function(t,x){c(x.node.getElementsByTagName("br"),function(z){var y=z.parentNode;if(y&&y.nodeName=="p"&&(y.childNodes.length==1||y.lastChild==z)){y.replaceChild(t.getDoc().createTextNode("\u00a0"),z)}})});w.add(d.getDoc(),"keypress",function(t){if(t.keyCode==13&&!t.shiftKey){if(!o(t)){return w.cancel(t)}}});if(k){w.add(d.getDoc(),"keydown",function(t){if((t.keyCode==8||t.keyCode==46)&&!t.shiftKey){h(t,t.keyCode==8)}})}}}function b(x){var y,t;y=x.document;t=y.compatMode=="CSS1Compat"?y.documentElement:y.body;return{x:x.pageXOffset||t.scrollLeft,y:x.pageYOffset||t.scrollTop,w:x.innerWidth||t.clientWidth,h:x.innerHeight||t.clientHeight}}function l(B,y,z){var x=d.getDoc().createTreeWalker(B,4,null,false),B,A=-1;while(B=x.nextNode()){A++;if(y==0&&B==z){return A}if(y==1&&A==z){return B}}return -1}function j(){var D=this,P=d.getBody(),M=d.getDoc(),S=d.selection,E=S.getSel(),F=S.getRng(),Q=-2,B,K,x,y,N=-16777215;var O,z,R,J,G,A=P.childNodes,I,H,C;for(I=A.length-1;I>=0;I--){O=A[I];if(O.nodeType==3||(!f(O)&&O.nodeType!=8)){if(!z){if(O.nodeType!=3||/[^\s]/g.test(O.nodeValue)){if(Q==-2&&F){if(!n){if(F.startContainer.nodeType==1&&(H=F.startContainer.childNodes[F.startOffset])&&H.nodeType==1){C=H.getAttribute("id");H.setAttribute("id","__mce")}else{if(d.dom.getParent(F.startContainer,function(t){return t===P})){K=F.startOffset;x=F.endOffset;Q=l(P,0,F.startContainer);B=l(P,0,F.endContainer)}}}else{y=M.body.createTextRange();y.moveToElementText(P);y.collapse(1);R=y.move("character",N)*-1;y=F.duplicate();y.collapse(1);J=y.move("character",N)*-1;y=F.duplicate();y.collapse(0);G=(y.move("character",N)*-1)-J;Q=J-R;B=G}}z=d.dom.create(p.element);z.appendChild(O.cloneNode(1));O.parentNode.replaceChild(z,O)}}else{if(z.hasChildNodes()){z.insertBefore(O,z.firstChild)}else{z.appendChild(O)}}}else{z=null}}if(Q!=-2){if(!n){z=P.getElementsByTagName(p.element)[0];F=M.createRange();if(Q!=-1){F.setStart(l(P,1,Q),K)}else{F.setStart(z,0)}if(B!=-1){F.setEnd(l(P,1,B),x)}else{F.setEnd(z,0)}if(E){E.removeAllRanges();E.addRange(F)}}else{try{F=E.createRange();F.moveToElementText(P);F.collapse(1);F.moveStart("character",Q);F.moveEnd("character",B);F.select()}catch(L){}}}else{if(!n&&(H=d.dom.get("__mce"))){if(C){H.setAttribute("id",C)}else{H.removeAttribute("id")}F=M.createRange();F.setStartBefore(H);F.setEndBefore(H);S.setRng(F)}}}function f(t){return t.nodeType==1&&/^(H[1-6]|P|DIV|ADDRESS|PRE|FORM|TABLE|LI|OL|UL|TD|CODE|CAPTION|BLOCKQUOTE|CENTER|DL|DT|DD|DIR|FIELDSET|NOSCRIPT|NOFRAMES|MENU|ISINDEX|SAMP)$/.test(t.nodeName)}function e(t){return u.getParent(t,function(x){return f(x)})}function i(t){t=t.innerHTML;t=t.replace(/<img|hr|table/g,"d");t=t.replace(/<[^>]+>/g,"");return t.replace(/[ \t\r\n]+/g,"")==""}function o(P){var Q=d.getDoc(),H=d.selection.getSel(),I=d.selection.getRng(),R=Q.body;var L,M,J,O,N,A,x,B,D,t,F,S,z,C,K,E,G;if(a.isOldWebKit){return true}L=Q.createRange();L.setStart(H.anchorNode,H.anchorOffset);L.collapse(true);M=Q.createRange();M.setStart(H.focusNode,H.focusOffset);M.collapse(true);J=L.compareBoundaryPoints(L.START_TO_END,M)<0;O=J?H.anchorNode:H.focusNode;N=J?H.anchorOffset:H.focusOffset;A=J?H.focusNode:H.anchorNode;x=J?H.focusOffset:H.anchorOffset;O=O.nodeName=="BODY"?O.firstChild:O;A=A.nodeName=="BODY"?A.firstChild:A;B=e(O);D=e(A);t=B?B.nodeName:p.element;if(u.getParent(B,function(y){return/OL|UL/.test(y.nodeName)})){return true}if(B&&(B.nodeName=="CAPTION"||/absolute|relative|static/gi.test(B.style.position))){t=p.element;B=null}if(D&&(D.nodeName=="CAPTION"||/absolute|relative|static/gi.test(D.style.position))){t=p.element;D=null}if(/(TD|TABLE|TH|CAPTION)/.test(t)||(B&&t=="DIV"&&/left|right/gi.test(B.style.cssFloat))){t=p.element;B=D=null}F=(B&&B.nodeName==t)?B.cloneNode(0):Q.createElement(t);S=(D&&D.nodeName==t)?D.cloneNode(0):Q.createElement(t);S.id="";if(/^(H[1-6])$/.test(t)&&O.nodeValue&&N==O.nodeValue.length){S=Q.createElement(p.element)}K=z=O;do{if(K==R||K.nodeType==9||f(K)||/(TD|TABLE|TH|CAPTION)/.test(K.nodeName)){break}z=K}while((K=K.previousSibling?K.previousSibling:K.parentNode));K=C=A;do{if(K==R||K.nodeType==9||f(K)||/(TD|TABLE|TH|CAPTION)/.test(K.nodeName)){break}C=K}while((K=K.nextSibling?K.nextSibling:K.parentNode));if(z.nodeName==t){L.setStart(z,0)}else{L.setStartBefore(z)}L.setEnd(O,N);F.appendChild(L.cloneContents());M.setEndAfter(C);M.setStart(A,x);S.appendChild(M.cloneContents());I=Q.createRange();if(!z.previousSibling&&z.parentNode.nodeName==t){I.setStartBefore(z.parentNode)}else{if(L.startContainer.nodeName==t&&L.startOffset==0){I.setStartBefore(L.startContainer)}else{I.setStart(L.startContainer,L.startOffset)}}if(!C.nextSibling&&C.parentNode.nodeName==t){I.setEndAfter(C.parentNode)}else{I.setEnd(M.endContainer,M.endOffset)}I.deleteContents();if(F.firstChild&&F.firstChild.nodeName==t){F.innerHTML=F.firstChild.innerHTML}if(S.firstChild&&S.firstChild.nodeName==t){S.innerHTML=S.firstChild.innerHTML}if(i(F)){F.innerHTML=v?" <br />":"<br />"}if(i(S)){S.innerHTML=v?"<br /> ":"<br />"}I.insertNode(S);I.insertNode(F);S.normalize();F.normalize();I=Q.createRange();I.selectNodeContents(S);I.collapse(1);H.removeAllRanges();H.addRange(I);vp=b(d.getWin());E=d.dom.getPos(S).y;G=S.clientHeight;if(E<vp.y||E+G>vp.y+vp.h){d.getWin().scrollTo(0,E<vp.y?E:E-vp.h+25)}return false}function h(y,E){var B=d.getBody(),x,z=d.selection,t=z.getRng(),A=t.startContainer,x,C,D;if(A&&f(A)&&!/^(TD|TH)$/.test(A.nodeName)&&E){if(A.childNodes.length==0||(A.childNodes.length==1&&A.firstChild.nodeName=="BR")){x=A;while((x=x.previousSibling)&&!f(x)){}if(x){if(A!=B.firstChild){C=d.getDoc().createTreeWalker(x,NodeFilter.SHOW_TEXT,null,false);while(D=C.nextNode()){x=D}t=d.getDoc().createRange();t.setStart(x,x.nodeValue?x.nodeValue.length:0);t.setEnd(x,x.nodeValue?x.nodeValue.length:0);z.getSel().removeAllRanges();z.getSel().addRange(t);A.parentNode.removeChild(A)}return w.cancel(y)}}}function F(G){var H;G=G.target;if(G&&G.parentNode&&G.nodeName=="BR"&&(x=e(G))){H=G.previousSibling;w.remove(B,"DOMNodeInserted",F);if(H&&H.nodeType==3&&/\s+$/.test(H.nodeValue)){return}if(G.previousSibling||G.nextSibling){G.parentNode.removeChild(G)}}}w._add(B,"DOMNodeInserted",F);window.setTimeout(function(){w._remove(B,"DOMNodeInserted",F)},1)}}})(punymce);(function(){var a="inpl-noresize",d=Inpl.LoadableModules,b=new Gettext({domain:"punymce_plugins_interiamail",locale_data:Inpl.Mail.L10n}),c=function(e){return b.gettext(e)};punymce.plugins.InteriaMail=function(g){var f=Inpl.Mail,j=f.DOM,e=punymce.Event;g.onInit.add(function(){var k=g.settings.id.split("_")[1],l=Inpl.Mail.Tabs.getById(k),m=g.getDoc();punymce.Event.add(m,"keyup",function(){l.contentChanged=true},this);window.scrollTo(0,0);punymce.Event.add(m,"dblclick",i,this);punymce.Event.add(m,"click",f.UI.PopupMenu.hideAll,this)});g.onSetContent.add(function(){var l=g.getDoc();Array.forEach(l.getElementsByTagName("base"),function(m){m.parentNode.removeChild(m)});try{if(l.documentElement.setAttributeNS){l.documentElement.setAttributeNS("http://www.w3.org/XML/1998/namespace","base",f.env.staticUrl)}}catch(k){f.UI.showNotice(k,"error")}});g.onInit.add(function(){var k=g.dom;if(punymce.isGecko){e.add(g.getDoc(),"mousedown",function(m){var l=k.getAttr(m.target,"class");if(m.target.id=="inpl-mail-stationery-content"){return}if(m.target.tagName=="IMG"&&l.indexOf(a)==-1){g.getDoc().execCommand("enableObjectResizing",false,true)}else{g.getDoc().execCommand("enableObjectResizing",false,false)}})}else{e.add(g.getDoc(),"controlselect",function(l){if(k.getAttr(l.target,"class").indexOf(a)!=-1){return e.cancel(l)}})}});function h(p){var m="http://"+Inpl.Mail.env.videoHost,u=p.offsetHeight-22,n=p.offsetWidth-22,s=p.getAttribute("rel").split("@"),o=s[0],k=s[1],t="multimedialną",q="multimedialna",l=g.dom.create("div",{"class":"inpl_av_msg",style:"height:"+u+"px;width:"+n+"px;text-align:center;display:inline-block;border:1px solid #005599;background-color:#D8EBFA;padding:10px;color:black;font:normal normal normal 12px Arial, Helvetica, sans-serif;"});l.innerHTML="<br><br><br><br><br>Użytkownik poczty INTERIA.PL<br>wysłał do Ciebie wiadomość "+t+'.<br><br>Kliknij w poniższy link aby ją otworzyć:<br><br><a class="inpl_av_link" style="font-weight:bold;text-decoration:none;color:#005599" href="'+m+"/odtworz,"+o+'">wiadomość '+q+"</a><br><br><br><br><br>";p.parentNode.replaceChild(l,p)}g.inpl_prepareContent=function(n){var k=g.getBody(),m=j.nodeListToArray(k.getElementsByTagName("img")),l=m.filter(function(o){return o.className.indexOf("inpl-video-placeholder")>=0});m.forEach(function(o){if(o.getAttribute("mce_src")){o.removeAttribute("mce_src")}});l.forEach(h)};function i(m){m=m||event;var k,l=m.target||m.srcElement;if(l.tagName.toLowerCase()==="img"&&j.hasClass(l,"inpl-video-placeholder")){k=l.getAttribute("rel");if(k.indexOf("@")>=0){k=k.split("@");d.require("Inpl.Mail.VideoRecorder",function(){Inpl.Mail.VideoRecorder.preview(k[0],k[1])})}}}punymce.extend(g.commands,{inplUploadImage:function(l,k,m){d.require("Inpl.Mail.InlineImageUploader",function(){f.InlineImageUploader.openDialog(g.relatedComposition.messageId)})},inplChooseStationery:function(l,k,m){f.Stationery.showPopupMenu(m.target,g)}});punymce.extend(g.tools,{inpluploadimage:{cmd:"inplUploadImage",title:c("Prześlij obrazek...")},inplstationery:{cmd:"inplChooseStationery",title:c("Wybierz papeterię...")},inplNewFeature:{cmd:"",title:c("Nowość"),disabled:true},separator:{cmd:"",disabled:true}})};punymce.plugins.InteriaMail.INPL_NORESIZE_CLASS=a;punymce.extend(punymce.I18n,{bold:c("Pogrubienie (Ctrl+B)"),italic:c("Kursywa (Ctrl+I)"),underline:c("Podkreślenie (Ctrl+U)"),strike:c("Przekreślenie"),ul:c("Lista wypunktowana"),ol:c("Lista numerowana"),indent:c("Większe wcięcie"),outdent:c("Mniejsze wcięcie"),left:c("Wyrównaj do lewej"),center:c("Wyrównaj do środka"),right:c("Wyrównaj do prawej"),style:c("Styl tekstu"),removeformat:c("Usuń formatowanie"),decreasefontsize:c("Zmniejsz rozmiar czcionki"),increasefontsize:c("Zwiększ rozmiar czcionki"),insertimage:c("Wstaw obrazek"),entersrc:c("Wprowadź adres URL obrazka:"),link:c("Wstaw odnośnik"),unlink:c("Usuń odnośnik"),enterhref:c("Wprowadź adres URL odnośnika"),textcolor:c("Kolor tekstu"),editsource:c("Edytuj źródło HTML")})}());(function(e){var c=Inpl.Mail,b=".gif",d="_m-inpl-emoticons",g="inpl-emoticon "+e.plugins.InteriaMail.INPL_NORESIZE_CLASS,a=new Gettext({domain:"punymce_plugins_interiaemoticons",locale_data:Inpl.Mail.L10n}),f=function(h){return a.gettext(h)};e.plugins.InteriaEmoticons=function(i){var h=e.Event,l=e.extend,k=e.DOM,j;j=this.settings=l({interiaemoticons:{aniolek:f("aniolek"),bije:f("bije"),bojesie:f("bojesie"),budzik:f("budzik"),chytry:f("chytry"),cisza:f("cisza"),cmok:f("cmok"),cwaniak:f("cwaniak"),czarodziej:f("czarodziej"),czyta:f("czyta"),czytaj:f("czytaj"),faja:f("faja"),glaszcze:f("glaszcze"),glupek:f("glupek"),haha:f("haha"),hmm:f("hmm"),jezyczek:f("jezyczek"),jezyk:f("jezyk"),klotnia:f("klotnia"),krzywy:f("krzywy"),kwasny:f("kwasny"),kwasny2:f("kwasny2"),kwiatek:f("kwiatek"),lol:f("lol"),lol2:f("lol2"),mail:f("mail"),mruga:f("mruga"),nie:f("nie"),niepowiem:f("niepowiem"),niewiem:f("niewiem"),paker:f("paker"),papa:f("papa"),pisze:f("pisze"),piwo:f("piwo"),placze:f("placze"),prezent:f("prezent"),prysznic:f("prysznic"),przytul:f("przytul"),pytajnik:f("pytajnik"),rotfl:f("rotfl"),sciana:f("sciana"),serce:f("serce"),serduszka:f("serduszka"),sex:f("sex"),smutny:f("smutny"),spioch:f("spioch"),stop:f("stop"),student:f("student"),szok:f("szok"),tak:f("tak"),telefon:f("telefon"),uczen:f("uczen"),uscisk:f("uscisk"),usmiech:f("usmiech"),usta:f("usta"),wow:f("wow"),wsciekly:f("wsciekly"),wykrzyknik:f("wykrzyknik"),ysz:f("ysz"),zawstydzony:f("zawstydzony"),zdziwiony:f("zdziwiony"),ziewa:f("ziewa"),zly:f("zly")},icons_in_row:7,base_url:Inpl.Mail.env.staticUrl+"/ei/"},i.settings.interiaemoticons);l(i.commands,{mceInteriaEmoticons:function(E,D,A){var y=this,o=i.settings.id,w=k.getPos(A.target),m=j.icons_in_row,t=j.interiaemoticons,C=o+d,q,x,p,n,B;function z(u){delete i.hideMenu;h.remove(document,"click",x);h.remove(i.getDoc(),"click",x);q.style.display="none";return 1}function s(u){setTimeout(function(){z(u)},200);return 1}x=(c.browser.ie&&c.browser<9)?s:z;if(i.hideMenu){return i.hideMenu()}else{i.hideMenu=x}q=k.get(C);if(!q){q=k.add(document.body,"div",{id:C,"class":"inpl-emoticons-list"});p=k.add(q,"table");p=k.add(p,"tbody");Object.keys(t).forEach(function(G,F){var v,u;if(F%m===0){n=k.add(p,"tr")}v={src:j.base_url+G+b,title:"["+t[G]+"]","class":g,"data-inpl-emoticon":G+b,alt:"["+t[G]+"]"};u=k.add(k.add(n,"td"),"a",{href:"#","class":g,title:G},k.create("img",v));h.add(u,"mousedown",function(J){var H=i.getDoc().getElementById("inpl-mail-stationery-content");if(H){var I=i.selection.getSel();if(I.anchorNode===i.getBody()&&I.isCollapsed){i.selection.select(H)}}i.selection.setNode(i.dom.create("img",v));if(c.browser.ie){setTimeout(function(){i.getWin().focus()},20)}x();return false})})}B=q.style;B.top=(w.y+A.target.clientHeight+2)+"px";B.left=w.x+"px";B.display="block";h.add(document,"click",x,y);h.add(i.getDoc(),"click",x,y)}});l(i.tools,{interiaemoticons:{cmd:"mceInteriaEmoticons",title:f("Wstaw emotikonę")}})}}(punymce));(function(){var a=punymce.DOM;function b(f){var c,e=document.createDocumentFragment(),d=f.split("\n");for(c=0;c<d.length;c++){e.appendChild(document.createTextNode(d[c]));if(d[c+1]){e.appendChild(document.createElement("br"))}}return e}punymce.plugins.InteriaUrls=function(i){var h=/(ftp:\/\/|http:\/\/|https:\/\/|www\.)(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#:.?+=&%@!\-\/]))?/ig,l=punymce.Event,e,f,k,c,g,j,d;if(!punymce.isIE){d=function(o,m){var n=a.create("a",{href:m.indexOf("www.")===0?"http://"+m:m});n.appendChild(o.createTextNode(m));return n};e=function(o){var q,m,p,n;try{q=o.startContainer;m=o.startOffset;p=o.endOffset;if(m>0&&q.nodeType===Node.TEXT_NODE){n=q.nodeValue.split(/\s/i);if(n){return n[n.length-1]}}}catch(s){}return""};c=function(m){if(m.clipboardData){return g(m)}else{return j(m)}};g=function(p){var s=""+p.clipboardData.getData("text/plain"),o,q,n,m;m=s.match(h);if(m){q=document.createDocumentFragment();for(o=0;o<m.length;o++){n=s.split(m[o],1);q.appendChild(b(n[0]));q.appendChild(d(i.getDoc(),m[o]));s=s.substring(n[0].length+m[o].length)}i.selection.setNode(q);i.selection.collapse(0);p.preventDefault()}};j=function(p){var o=i.getDoc(),n;try{n=o.createEvent("KeyboardEvent")}catch(m){}if(!n){return}if(n.initKeyEvent){n.initKeyEvent("keypress",true,true,null,false,false,false,false,32,32)}else{if(n.initKeyboardEvent){n.initKeyboardEvent("keypress",true,true,null," ",0,"",false)}else{return}}n.preventDefault();setTimeout(function(){o.body.dispatchEvent(n)},50)};f=function(p,o){var v,n,u,t=i.getDoc(),q=i.selection,w=q.getSel(),m=q.getRng();v=e(m);n=v.match(h);n=n?n[0]:null;if(n&&(o||/\s/i.test(String.fromCharCode(p.charCode||p.keyCode)))){u=i.selection.getNode();while(u!==t.body){if(u instanceof HTMLAnchorElement){return}u=u.parentNode}m=i.selection.getRng();m.setStart(m.startContainer,m.startOffset-n.length);w.removeAllRanges();w.addRange(m);i.selection.setNode(d(t,n));i.selection.collapse(0)}};k=function(m){return f(m,true)};i.onInit.add(function(){var m=i.getDoc();l.add(m,"keypress",f);l.add(m.body,"paste",c);i.inplOnBeforeSend=k})}}}());