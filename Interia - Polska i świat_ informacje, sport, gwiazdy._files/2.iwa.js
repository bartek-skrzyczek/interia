webpackJsonp([2],{155:function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,s=!1,o=void 0;try{for(var a,r=e[Symbol.iterator]();!(n=(a=r.next()).done)&&(i.push(a.value),!t||i.length!==t);n=!0);}catch(e){s=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(s)throw o}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=n(i(52)),r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(6)),l=n(i(11)),u=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tracker=t,this.conf=i,this.logger=new l.default,this.viewThresholdOffset=0,this.scrollThreshold=100,this.isLoaded=!1,this.nodesList=[],this.nodeIdsList=[],this.fnOnScrollDebounce=r.debounce(this.onScroll,this.scrollThreshold),this.isWorking=!1,this.attributeName="data-iwa-viewability-name",this.attributeDatasetName="iwaViewabilityName",this.attributeSize="data-iwa-viewability-size",this.viewAbilityTime=1e3,this.secondsFactor=.001,this.lastScrollPosY=null,this.browserPrefixes=["moz","ms","o","webkit"],this.isPageVisible=!0,this.browserPrefix=this.getBrowserPrefix(),this.hiddenPropertyName=this.getHiddenPropertyName(this.browserPrefix),this.visibilityEventName=this.getVisibilityEvent(this.browserPrefix),this.fnRequestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}return o(e,[{key:"init",value:function(){var e=this;r.LoadOnDomReady(function(){e.isLoaded||(e.isLoaded=!0,e.observeNodes(),e.handleEvents(),e.updateNodes())})}},{key:"setInitialProperties",value:function(e){var t=e;t.startWidth=t.offsetWidth,t.startHeight=t.offsetHeight,t.oneSecViewCounter=0,t.fullTimeViewCounter=0}},{key:"handleEvents",value:function(){var e=this;this.addEvent(window,"scroll",this.fnOnScrollDebounce.bind(this)),this.addEvent(window,"beforeunload",this.onBeforeUnload.bind(this)),this.addEvent(document,this.visibilityEventName,this.handlePageVisibilityChange.bind(this),!1),this.addEvent(document,"focus",function(){return e.handlePageVisibilityChange.call(e,[!0])},!1),this.addEvent(document,"blur",function(){return e.handlePageVisibilityChange.call(e,[!1])},!1),this.addEvent(window,"focus",function(){return e.handlePageVisibilityChange.call(e,[!0])},!1),this.addEvent(window,"blur",function(){return e.handlePageVisibilityChange.call(e,[!1])},!1)}},{key:"addEvent",value:function(e,t,i){e&&i&&(r.isDefined(e.addEventListener)?e.addEventListener(t,i,!1):r.isDefined(e.attachEvent)&&e.attachEvent("on"+t,i))}},{key:"updateScrollPosY",value:function(e){this.lastScrollPosY=e||window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop}},{key:"isVisible",value:function(e){return null!==e.offsetParent}},{key:"offsetTop",value:function(e){return e.getBoundingClientRect().top+window.pageYOffset-document.documentElement.clientTop}},{key:"isAbove",value:function(e){return this.lastScrollPosY>=this.offsetTop(e)+this.viewThresholdOffset+e.offsetHeight}},{key:"isBelow",value:function(e){return(window.innerHeight?window.innerHeight:window.offsetHeight)+this.lastScrollPosY<=this.offsetTop(e)-this.viewThresholdOffset}},{key:"isNearViewport",value:function(e){return!this.isAbove(e)&&!this.isBelow(e)}},{key:"handleAppearedElement",value:function(e){var t=this,i=e;i.isVisible=!0,i.timeStart=(new Date).valueOf(),i.timeoutID=window.setTimeout(function(){t.sendData(t.completeData(i,{type:"oneSecView",time:r.round(t.viewAbilityTime*t.secondsFactor,2),counter:i.oneSecViewCounter+=1}))},this.viewAbilityTime)}},{key:"handleDisappearedElement",value:function(e){var t=e;t.isVisible=!1,t.timeStop=(new Date).valueOf(),t.elapsedTime=r.round((t.timeStop-t.timeStart)*this.secondsFactor,2),clearTimeout(t.timeoutID),this.sendData(this.completeData(t,{type:"fullTimeView",counter:t.fullTimeViewCounter+=1}))}},{key:"updateNodes",value:function(){if(this.nodesList.length){void 0===this.lastScrollPosY&&this.updateScrollPosY();for(var e,t,i=this.nodesList.length-1;i>=0;i--)(e=this.nodesList[i])&&this.isVisible(e)&&((t=this.isNearViewport(e))&&!e.isVisible?this.handleAppearedElement(e,i):!t&&e.isVisible&&this.handleDisappearedElement(e,i))}this.isWorking=!1}},{key:"onScroll",value:function(){this.updateScrollPosY(),this.isWorking||(this.isWorking=!0,this.fnRequestAnimationFrame.call(window,this.updateNodes.bind(this)))}},{key:"onBeforeUnload",value:function(){this.updateScrollPosY(-1e6),this.isWorking||(this.isWorking=!0,this.updateNodes())}},{key:"handlePageVisibilityChange",value:function(e){return"boolean"==typeof e?e?this.onPageVisible():this.onPageHidden():document[this.hiddenPropertyName]?this.onPageHidden():this.onPageVisible()}},{key:"onPageHidden",value:function(){return this.isPageVisible?(this.isPageVisible=!1,this.updateScrollPosY(-1e6),this.isWorking||(this.isWorking=!0,this.updateNodes()),this.isPageVisible):this.isPageVisible}},{key:"onPageVisible",value:function(){return this.isPageVisible?this.isPageVisible:(this.isPageVisible=!0,this.updateScrollPosY(),this.isWorking||(this.isWorking=!0,this.updateNodes()),this.isPageVisible)}},{key:"getHiddenPropertyName",value:function(e){return e?e+"Hidden":"hidden"}},{key:"getVisibilityEvent",value:function(e){return e?e+"visibilitychange":"visibilitychange"}},{key:"getBrowserPrefix",value:function(){for(var e=0;e<this.browserPrefixes.length;e++)if(this.getHiddenPropertyName(this.browserPrefixes[e])in document)return this.browserPrefixes[e];return null}},{key:"observeNodes",value:function(){for(var e=document.querySelectorAll("["+this.attributeName+"]"),t=0;t<e.length;t++)this.observe(e[t]);this.sendData({viewAbilityNodesList:JSON.stringify(this.nodeIdsList)})}},{key:"observe",value:function(e){return!!e&&(this.setInitialProperties(e),this.nodesList.push(e),this.nodeIdsList.push(e.dataset[this.attributeDatasetName]),!0)}},{key:"completeData",value:function(e,t){var i=e,n=t;try{i.getAttribute(this.attributeName)&&(n.name=i.getAttribute(this.attributeName)),!t.time&&i.elapsedTime&&(n.time=i.elapsedTime),n.width=i.offsetWidth?i.offsetWidth:0,n.height=i.offsetHeight?i.offsetHeight:0,n.startWidth=i.startWidth?i.startWidth:0,n.startHeight=i.startHeight?i.startHeight:0}catch(e){this.logger.log(e)}return n}},{key:"sendData",value:function(e){if(r.isDefined(e)&&r.isObjectInstance(e)){var t=new a.default,i=!0,n=!1,o=void 0;try{for(var l,u=r.objIterator(e)[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var h=s(l.value,2),d=h[0],f=h[1];t.set(d,f,"page")}}catch(e){n=!0,o=e}finally{try{!i&&u.return&&u.return()}finally{if(n)throw o}}if(window.CustomEvent){var c=new window.CustomEvent("viewabilitySend",{detail:t.get()});window.dispatchEvent(c)}this.tracker.send(["event","viewability",{customVariables:t}])}}}]),e}();t.default=u}});